<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : 1-Wire kill the controller</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : 1-Wire kill the controller
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Dec 02, 2012 by <font color="#0050B2">palle500</font>.
				    </div>

				    <p>HI I have been used OR for about two weeks now and have added 1-Wire temp-sensors that works well but if the owserver goes down the local controller stops due to an exceptions in the sensor reading if not the owserver respond!</p>

<p>The biggest problem are that other things continue to work (clock, WEB display etc) and also the temperature values just freeze! Not showing N/A as usual if some I had some other 1-Wire reading problems!</p>

<p>I run the owserver on Raspberry Pi and the controller on a W7 laptop.</p>

<p>Any one who knows how to take care about this exception and just do a time out and send N/A as temperature value as long the owserver not respond?</p>

<p>/Palle500</p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/21038015/21135411.class">OneWireCommand.class</a> (application/octet-stream)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/21038015/21135412.class">OneWireCommand$1.class</a> (application/octet-stream)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-21038024"></a>
                                    <font class="smallfont"><p>Which version of the controller are you using?<br/>
Can you try and use the 2-1-0-DeveloperSnapshot.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Dec 03, 2012 08:20
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21038026"></a>
                                    <font class="smallfont"><p>Dear Marcus,<br/>
I use the official verson 2.01 and don't know how to find any newer beta versions (i'm new to Java and are Windows programmer in Delphi, C, asssembler and some embedding systems). I have been searching in the forum for some guides how to find/use the latest online designer and local controller. I don't run any Java development tools so I can't compile the latest source code.  </p>

<p>!-Wire log looks like this:<br/>
ERROR 2012-12-02 22:47:02,151 (1-WIRE): OneWire IO error, unable to read from OWSERVER.<br/>
java.net.UnknownHostException: OwTemp.lan<br/>
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:195)<br/>
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)<br/>
	at java.net.Socket.connect(Socket.java:529)<br/>
	at org.owfs.jowfsclient.internal.OwfsClientImpl.connect(OwfsClientImpl.java:103)<br/>
	at org.owfs.jowfsclient.internal.OwfsClientImpl.establishConnection(OwfsClientImpl.java:173)<br/>
	at org.owfs.jowfsclient.internal.OwfsClientImpl.sendRequest(OwfsClientImpl.java:501)<br/>
	at org.owfs.jowfsclient.internal.OwfsClientImpl.read(OwfsClientImpl.java:313)<br/>
	at org.openremote.controller.protocol.onewire.OneWireCommand.read(OneWireCommand.java:131)<br/>
	at org.openremote.controller.protocol.onewire.OneWireCommand.run(OneWireCommand.java:228)<br/>
	at java.lang.Thread.run(Thread.java:662)</p>

<p>EDIT: I have found by trail and error that it works fine if the Owserver and the controller machine are on the same switch (fast response) but then I connect the Owserver to an ethernet power line coupler (bad speed) the problem show up approximatly after 1-5 minutes.<br/>
/Lars</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by palle500 at Dec 03, 2012 09:27
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21038029"></a>
                                    <font class="smallfont"><p>The 2-1-DeveloperSnapshot can be found here: <a href="http://sourceforge.net/projects/openremote/files/For%20Developers/OpenRemote%202.0%20%28Developer%20Releases%29/OpenRemote-Controller-2.1.0_Developer-Snapshot-20120920.zip/download">http://sourceforge.net/projects/openremote/files/For%20Developers/OpenRemote%202.0%20%28Developer%20Releases%29/OpenRemote-Controller-2.1.0_Developer-Snapshot-20120920.zip/download</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Dec 03, 2012 09:34
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21038033"></a>
                                    <font class="smallfont"><p>Thanks Marcus,<br/>
Found some different files in this version. Started the new version and it works fine.<br/>
But I got the same problem if I disconnet the Owserver?</p>

<p>INFO 2012-12-03 10:45:23,070 : Registered sensor : Sensor (Name = 'TempA', ID =<br/>
'1120186', State Mappings: {})<br/>
INFO 2012-12-03 10:45:23,071 : Startup complete.<br/>
INFO 2012-12-03 10:45:23,072 : Controller Definition File Watcher for Default De<br/>
ployer started.<br/>
2012-dec-03 10:45:23 org.apache.coyote.http11.Http11Protocol start<br/>
INFO: Starting Coyote HTTP/1.1 on http-8080<br/>
2012-dec-03 10:45:23 org.apache.catalina.startup.Catalina start<br/>
INFO: Server startup in 2898 ms<br/>
Exception in thread "Polling thread for sensor: TempA" java.lang.NullPointerException<br/>
        at org.owfs.jowfsclient.internal.OwfsClientImpl.sendRequest(OwfsClientImpl.java:509)<br/>
        at org.owfs.jowfsclient.internal.OwfsClientImpl.read(OwfsClientImpl.java:313)<br/>
        at org.openremote.controller.protocol.onewire.OneWireCommand.read(OneWireCommand.java:139)<br/>
        at org.openremote.controller.protocol.onewire.OneWireCommand.run(OneWireCommand.java:219)<br/>
        at java.lang.Thread.run(Thread.java:662)java.lang.NullPointerException<br/>
        at org.owfs.jowfsclient.internal.OwfsClientImpl.sendRequest(OwfsClientImpl.java:509)<br/>
        at org.owfs.jowfsclient.internal.OwfsClientImpl.read(OwfsClientImpl.java:313)<br/>
        at org.openremote.controller.protocol.onewire.OneWireCommand.read(OneWireCommand.java:139)<br/>
        at org.openremote.controller.protocol.onewire.OneWireCommand.run(OneWireCommand.java:219)<br/>
        at java.lang.Thread.run(Thread.java:662)</p>

<p>/Lars</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by palle500 at Dec 03, 2012 10:04
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21038035"></a>
                                    <font class="smallfont"><p>Ok, thanks for double checking against the latest version.<br/>
I will create a Jira issue and double check when I find some time.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Dec 03, 2012 10:44
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21038057"></a>
                                    <font class="smallfont"><p>Please take the 2 files attached to this post and replace the files from the 2.1 DeveloperSnapshot<br/>
in the folder Controller-2-1/webapps/controller/WEB-INF/classes/org/openremote/controller/protocol/onewire.</p>

<p>This should create "N/A" sensor value and once owserver is running again show the correct value.<br/>
<a href="attachments/21038015/21135411.class">OneWireCommand.class</a><br/>
<a href="attachments/21038015/21135412.class">OneWireCommand$1.class</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Dec 03, 2012 22:38
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21038058"></a>
                                    <font class="smallfont"><p>Great job Marcus!<br/>
It now works perfectly. I tested it with 1 sec reading intervall with three 1-Wire temp sensors, no problem.<br/>
If I disconnet the Owserver N/A show up directly and then reconnected it show the temperature again and the values are changing, so it not a new bug <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>Again Gretfully thanks for your help.</p>

<p>I public here my way of do the scaling for my sensors. The differens against all the rules example I have fond on the forum are that i use IF to select all of my temp sensors and only do the converting once:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">   
<span class="code-keyword">package</span> org.openremote.controller.model.event

global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;

<span class="code-keyword">import</span> org.openremote.controller.protocol.Event;
<span class="code-keyword">import</span> java.text.DecimalFormat;

<span class="code-comment">// Fix nice temp format
</span>rule <span class="code-quote">"TempX"</span>
when

  $tempSensorX:CustomState( source == <span class="code-quote">"TempA"</span> ) OR
  $tempSensorX:CustomState( source == <span class="code-quote">"TempB"</span> ) OR
  $tempSensorX:CustomState( source == <span class="code-quote">"TempC"</span> )

then

  $tempSensorX.setValue(formatDouble(<span class="code-object">Double</span>.valueOf($tempSensorX.getValue()))+<span class="code-quote">"\272c"</span>);  <span class="code-comment">// Unicode <span class="code-keyword">for</span> <span class="code-quote">"Âºc"</span>
</span>
end

function <span class="code-object">String</span> formatDouble(<span class="code-object">double</span> d) {
  <span class="code-keyword">return</span> (<span class="code-keyword">new</span> DecimalFormat(<span class="code-quote">"#,###.0"</span>)).format(d);
}
</pre>
</div></div>

<p>EDIT: Don't know why the "Unknown macro:" are added to my code example?<br/>
Could some one tell me how i insert code in this Wiki?<br/>
/Lars</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by palle500 at Dec 03, 2012 23:11
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21038064"></a>
                                    <font class="smallfont"><p>Glad to see that my fix works.<br/>
You have to surround your code with a {code} tag at the beginning and one at the end.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Dec 04, 2012 08:02
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:29</font></td>
		    </tr>
	    </table>
    </body>
</html>