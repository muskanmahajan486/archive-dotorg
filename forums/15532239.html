<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Status polling doing........ nothing?</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Status polling doing........ nothing?
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 31, 2011 by <font color="#0050B2">kide</font>.
				    </div>

				    <p>I tried to create a sensor for a (working) telnet switch but i get a strange polling message that seems to be hanging:</p>

<p>In the controller.log i see the following:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">[Controller]2011-01-31 10:30:11,506 INFO [HTTP-<span class="code-object">Thread</span>-5] org.openremote.controller.<span class="code-keyword">rest</span>.StatusPollingRESTServlet.doPost(77) | Started polling at 2011-01-31 10:30:11
[Controller]2011-01-31 10:30:11,507 INFO [HTTP-<span class="code-object">Thread</span>-5] org.openremote.controller.service.impl.StatusPollingServiceImpl.queryChangedState(74) | Querying changed state from ChangedStatus table...
[Controller]2011-01-31 10:30:11,508 INFO [HTTP-<span class="code-object">Thread</span>-5] org.openremote.controller.service.impl.StatusPollingServiceImpl.queryChangedState(89) | Not Found: [device =&gt; 030070774321090, sensorIDs =&gt; 499] in ChangedStatus table.
[Controller]2011-01-31 10:30:11,508 INFO [HTTP-<span class="code-object">Thread</span>-5] org.openremote.controller.service.impl.StatusPollingServiceImpl.queryChangedState(107) | DEVICEID:030070774321090	sensorID:[499]statusChangedSensorID:[]Waiting...
[Controller]2011-01-31 10:30:11,646 INFO [<span class="code-object">Thread</span>-8] org.openremote.controller.statuscache.StatusCache.saveOrUpdateStatus(68) | Status is <span class="code-keyword">null</span> or "" <span class="code-keyword">while</span> calling saveOrUpdateStatus in statusCache.
[Controller]2011-01-31 10:30:11,646 INFO [<span class="code-object">Thread</span>-8] org.openremote.controller.statuscache.StatusCache.saveOrUpdateStatus(68) | Status is <span class="code-keyword">null</span> or "" <span class="code-keyword">while</span> calling saveOrUpdateStatus in statusCache.
[Controller]2011-01-31 10:30:12,146 INFO [<span class="code-object">Thread</span>-8] org.openremote.controller.statuscache.StatusCache.saveOrUpdateStatus(68) | Status is <span class="code-keyword">null</span> or "" <span class="code-keyword">while</span> calling saveOrUpdateStatus in statusCache.
[Controller]2011-01-31 10:30:12,647 INFO [<span class="code-object">Thread</span>-8] org.openremote.controller.statuscache.StatusCache.saveOrUpdateStatus(68) | Status is <span class="code-keyword">null</span> or "" <span class="code-keyword">while</span> calling saveOrUpdateStatus in statusCache.
[Controller]2011-01-31 10:30:13,147 INFO [<span class="code-object">Thread</span>-8] org.openremote.controller.statuscache.StatusCache.saveOrUpdateStatus(68) | Status is <span class="code-keyword">null</span> or "" <span class="code-keyword">while</span> calling saveOrUpdateStatus in statusCache.
[Controller]2011-01-31 10:30:13,648 INFO [<span class="code-object">Thread</span>-8] org.openremote.controller.statuscache.StatusCache.saveOrUpdateStatus(68) | Status is <span class="code-keyword">null</span> or "" <span class="code-keyword">while</span> calling saveOrUpdateStatus in statusCache.
[Controller]2011-01-31 10:30:14,148 INFO [<span class="code-object">Thread</span>-8] org.openremote.controller.statuscache.StatusCache.saveOrUpdateStatus(68) | Status is <span class="code-keyword">null</span> or "" <span class="code-keyword">while</span> calling saveOrUpdateStatus in statusCache.
[Controller]2011-01-31 10:30:14,579 INFO [HTTP-<span class="code-object">Thread</span>-4] org.openremote.controller.protocol.telnet.TelnetCommand.sendString(203) | send: set Stalamp_KL on
[Controller]2011-01-31 10:30:14,649 INFO [<span class="code-object">Thread</span>-8] org.openremote.controller.statuscache.StatusCache.saveOrUpdateStatus(68) | Status is <span class="code-keyword">null</span> or "" <span class="code-keyword">while</span> calling saveOrUpdateStatus in statusCache.
[Controller]2011-01-31 10:30:15,150 INFO [<span class="code-object">Thread</span>-8] org.openremote.controller.statuscache.StatusCache.saveOrUpdateStatus(68) | Status is <span class="code-keyword">null</span> or "" <span class="code-keyword">while</span> calling saveOrUpdateStatus in statusCache.
[Controller]2011-01-31 10:30:15,650 INFO [<span class="code-object">Thread</span>-8] org.openremote.controller.statuscache.StatusCache.saveOrUpdateStatus(68) | Status is <span class="code-keyword">null</span> or "" <span class="code-keyword">while</span> calling saveOrUpdateStatus in statusCache.
[Controller]2011-01-31 10:30:16,151 INFO [<span class="code-object">Thread</span>-8] org.openremote.controller.statuscache.StatusCache.saveOrUpdateStatus(68) | Status is <span class="code-keyword">null</span> or "" <span class="code-keyword">while</span> calling saveOrUpdateStatus in statusCache.
[Controller]2011-01-31 10:30:16,651 INFO [<span class="code-object">Thread</span>-8] org.openremote.controller.statuscache.StatusCache.saveOrUpdateStatus(68) | Status is <span class="code-keyword">null</span> or "" <span class="code-keyword">while</span> calling saveOrUpdateStatus in statusCache.
[Controller]2011-01-31 10:30:17,152 INFO [<span class="code-object">Thread</span>-8] org.openremote.controller.statuscache.StatusCache.saveOrUpdateStatus(68) | Status is <span class="code-keyword">null</span> or "" <span class="code-keyword">while</span> calling saveOrUpdateStatus in statusCache.

</pre>
</div></div>
<p>The&nbsp; Reciever that should be queried for the status is not recieving any traffic except when i send a command. I decoded the stream and no data except "set Stalamp_KL on" is found (as far as my knowledge goes)</p>

<p>Does somebody has an idea on this?</p>

				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-15532240"></a>
                                    <font class="smallfont"><p>As the controller starts there is an HTTP error which i cannot define but when you start it without the sensor in place its gone</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">INFO: Server startup in 5893 ms
 -------- Started thread <span class="code-keyword">for</span> sensor 511 <span class="code-keyword">switch</span> org.openremote.controller.protocol.telnet.TelnetCommand@571cac41
 -------- Started thread <span class="code-keyword">for</span> sensor 511 <span class="code-keyword">switch</span> org.openremote.controller.protocol.telnet.TelnetCommand@2575679c
[Controller]2011-01-31 11:49:10,495 ERROR [HTTP-<span class="code-object">Thread</span>-11] org.openremote.controller.<span class="code-keyword">rest</span>.StatusCommandRESTServlet.doPost(106) | CommandException occurs
org.openremote.controller.exception.NoSuchComponentException: No such component in status cache : 511
	at org.openremote.controller.statuscache.StatusCache.queryStatuses(StatusCache.java:96)
	at org.openremote.controller.service.impl.StatusCacheServiceImpl.queryStatuses(StatusCacheServiceImpl.java:43)
	at org.openremote.controller.service.impl.StatusCommandServiceImpl.readFromCache(StatusCommandServiceImpl.java:97)
	at org.openremote.controller.<span class="code-keyword">rest</span>.StatusCommandRESTServlet.doPost(StatusCommandRESTServlet.java:103)
	at org.openremote.controller.<span class="code-keyword">rest</span>.StatusCommandRESTServlet.doGet(StatusCommandRESTServlet.java:68)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:617)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.openremote.controller.<span class="code-keyword">rest</span>.support.json.JSONCallbackFilter.doFilter(JSONCallbackFilter.java:65)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:78)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:77)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:286)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:845)
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)
	at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:354)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
	at java.lang.<span class="code-object">Thread</span>.run(<span class="code-object">Thread</span>.java:662)
 -------- Started thread <span class="code-keyword">for</span> sensor 513 <span class="code-keyword">switch</span> org.openremote.controller.protocol.telnet.TelnetCommand@318f37c
 -------- Started thread <span class="code-keyword">for</span> sensor 513 <span class="code-keyword">switch</span> org.openremote.controller.protocol.telnet.TelnetCommand@4fbfc4a4

</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kide at Jan 31, 2011 11:02
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-15532243"></a>
                                    <font class="smallfont"><p>Ernst - I don't believe a sensor (read) has yet been implemented in the the Telnet command....</p>

<p>from telnetcommand.java.....</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">   <span class="code-keyword">public</span> <span class="code-object">String</span> read(EnumSensorType sensoryType, Map&lt;<span class="code-object">String</span>, <span class="code-object">String</span>&gt; statusMap) {
      <span class="code-comment">// TODO Auto-generated method stub
</span>      <span class="code-keyword">return</span> <span class="code-keyword">null</span>;
   }
</pre>
</div></div>
<p>it looks like the Socket version has though...</p>

<p>Currently I cant get a switch (or slider) to change state though based on the read. Still checking all my config and options.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by deanox at Jan 31, 2011 16:32
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-15532252"></a>
                                    <font class="smallfont"><p>Ernst, I have been doing some work with the Telnet Command and I've updated the TelnetCommand.java and TelnetCommandBuilder.java files<br/>
to implement the read method (which is needed for updating sensors). As Dean has pointed out, this method is not implemented in the current release.<br/>
I have implemented a regex filter to sift through the telnet response and extract the required information for the sensor. I am going to put this<br/>
in branches/feature/Controller_2_0_0_Alpha11_telnet/ of the repo sometime in the next day or so.</p>

<p>If you want more info on this so you can test it out then let me know and I'll give you an overview.</p>

<p>Rich</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kurrazyman at Jan 31, 2011 21:58
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-15532253"></a>
                                    <font class="smallfont"><p>Rich - I'd certainly like a copy to try. I've now got a local copy that is building so it should be a relativly straightforward copy over the top for the 2 files or does it need any XML changes ?</p>


<p>Could you mail it to dean@eatworms.org.uk.</p>

<p>Thanks - Dean</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by deanox at Jan 31, 2011 22:16
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-15532262"></a>
                                    <font class="smallfont"><p>Yes i'll test no problem. Please supply me with the info you have and i'll send you back a test report.</p>

<p>Page me as soon as you've uploaded the branch so i can check it out.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kide at Feb 01, 2011 06:31
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-15532279"></a>
                                    <font class="smallfont"><p>Ernst,</p>

<p>I've uploaded my code changes to a new branch as promised, I've written an overview in a separate thread:</p>

<p><a href="http://www.openremote.org/display/forums/Telnet+Status+Read+Implemented">Telnet Read Status Implemented</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kurrazyman at Feb 02, 2011 22:27
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-15532384"></a>
                                    <font class="smallfont"><p>Topic closed</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kide at Feb 10, 2011 13:12
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:32</font></td>
		    </tr>
	    </table>
    </body>
</html>