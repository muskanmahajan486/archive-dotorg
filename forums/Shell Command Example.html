<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Shell Command Example</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Shell Command Example
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jul 02, 2014 by <font color="#0050B2">sirvsz28</font>.
				    </div>

				    <p>Hello all,<br/>
  I am having a huge issue trying to get open remote sensors to work with the regex and shell scripts.<br/>
Essentially, I created an object to run the script and used regex to filter out the response.<br/>
Running the shell logs, I see that I am actually getting the correct response.  I am getting no regex errors so I assume it is finding what it needs.<br/>
I checked with an online regex tester, and it seems to test out fine with the output and input i provide.</p>

<p>The issue, when I apply the regex to a custom sensor, the label for that sensor always shows N/A.</p>

<p>Could someone simply show me an example of their setup (or sample setup)?<br/>
Looking for the following:<br/>
Sample shell script<br/>
Screen shots of Open remote setup. Command, regex, sensor, label, etc.</p>

<p>I hope its not too much to ask, I'm just at a complete loss. <br/>
I figure its easier to ask for a working example and figure out what mine is missing than uploading my stuff and asking for help troubleshooting.</p>

<p>Thank you for any and all help!</p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22887401/23036595.png">command.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22887401/23036596.png">label.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22887401/23036597.png">switch.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22887401/23036598.png">switchcon.PNG</a> (image/png)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-22887402"></a>
                                    <font class="smallfont"><p>Google is your best friend. I tried <em>how to shell script</em>, and got this a.o.:<br/>
<a href="http://www.openremote.org/display/docs/OpenRemote+2.0+How+To+-+Execute+Shell+commands">http://www.openremote.org/display/docs/OpenRemote+2.0+How+To+-+Execute+Shell+commands</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jul 02, 2014 16:50
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887408"></a>
                                    <font class="smallfont"><p>Thank you for the reply.<br/>
I've been through this piece, and configured my sensors to be very similar.<br/>
The issue I think I may be having could be related to my script itself and how/what it is returning.<br/>
The reason I ask screen shots and all is to make sure I'm not doing anything stupid, but currently my system is setup the same as the link you have provided.<br/>
The test still shows as n/a though.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by sirvsz28 at Jul 02, 2014 21:52
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887465"></a>
                                    <font class="smallfont"><p>There is a little problem with the Execute Shell protocol which makes it not working after updating the design. The working work around is to hard stop and start the controller (it can be achieved by rebooting the computer which is running the controller).</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aktur at Jul 07, 2014 14:56
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887497"></a>
                                    <font class="smallfont"><p>Thanks for the suggestion Michal.  I tried rebooting after I update the design, but it does not seem to be still updating, or I really have something wrong.</p>

<p>Here is the output from my shell.log:<br/>
DEBUG 2014-07-10 02:16:01,454 (Shell): Building ShellExe command<br/>
DEBUG 2014-07-10 02:16:01,457 (Shell): ShellExe Command: regex = (on|off)<br/>
DEBUG 2014-07-10 02:16:01,463 (Shell): ShellExe Command: sensorNamesList = test_switch<br/>
DEBUG 2014-07-10 02:16:01,470 (Shell): ShellExe Command: commandPath= /home/pi/RF24/librf24-rpi/librf24/examples/status.sh<br/>
DEBUG 2014-07-10 02:16:01,472 (Shell): ShellExe Command created successfully<br/>
DEBUG 2014-07-10 02:16:01,474 (Shell): Will start shell command: /home/pi/RF24/librf24-rpi/librf24/examples/status.sh and use params: null<br/>
DEBUG 2014-07-10 02:16:01,496 (Shell): Shell command: /home/pi/RF24/librf24-rpi/librf24/examples/status.sh returned: Hello World on 5</p>

<p>As I can see, the regex is looking for on or off and "on" is being returned in the string.<br/>
I tied the switch on or off to a label to say on or off, but it is always stating "N/A".  Am i missing something?<br/>
<img src="attachments/22887401/23036595.png" align="absmiddle" border="0"/><br/>
<img src="attachments/22887401/23036596.png" align="absmiddle" border="0"/></p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by sirvsz28 at Jul 10, 2014 03:31
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887500"></a>
                                    <font class="smallfont"><p>I assume you did use a sensor of type:<b>switch</b>. I do a similar thing with http protocol, but I do not use () in the RegEx, just on|off.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jul 10, 2014 08:22
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887510"></a>
                                    <font class="smallfont"><p>You would need a polling interval of some value to run the shell command in a loop and update sensor state. Try few seconds, for example 3s.<br/>
In the log you should see that polling.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aktur at Jul 10, 2014 14:41
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887511"></a>
                                    <font class="smallfont"><p>Thank you for the replies Pieter and Michal.<br/>
Yes this is a switch type command.  I tried to remove the (), but that does not seem to update the label.<br/>
I had also introduced the pollingInterval, but for some reason it does not seem to actually trigger off periodically.</p>

<p>EBUG 2014-07-11 00:53:27,187 (Shell): Found cached ShellExe command with id: 130<br/>
DEBUG 2014-07-11 00:53:27,221 (Shell): Will start shell command: /home/pi/RF24/librf24-rpi/librf24/examples/status.sh and use params: null<br/>
DEBUG 2014-07-11 00:53:27,248 (Shell): Shell command: /home/pi/RF24/librf24-rpi/librf24/examples/status.sh returned: Hello World on 5<br/>
DEBUG 2014-07-11 00:53:32,679 (Shell): Building ShellExe command<br/>
DEBUG 2014-07-11 00:53:32,682 (Shell): ShellExe Command: regex = on|off<br/>
DEBUG 2014-07-11 00:53:32,684 (Shell): ShellExe Command: pollingInterval = 2<br/>
DEBUG 2014-07-11 00:53:32,687 (Shell): ShellExe Command: sensorNamesList = test_switch<br/>
DEBUG 2014-07-11 00:53:32,689 (Shell): ShellExe Command: commandPath= /home/pi/RF24/librf24-rpi/librf24/examples/status.sh<br/>
DEBUG 2014-07-11 00:53:32,691 (Shell): ShellExe Command created successfully<br/>
DEBUG 2014-07-11 00:53:32,694 (Shell): Will start shell command: /home/pi/RF24/librf24-rpi/librf24/examples/status.sh and use params: null<br/>
DEBUG 2014-07-11 00:53:32,714 (Shell): Shell command: /home/pi/RF24/librf24-rpi/librf24/examples/status.sh returned: Hello World on 5</p>

<p>I'm starting to think OpenRemote really hates raspberry Pis or me</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by sirvsz28 at Jul 11, 2014 02:06
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887518"></a>
                                    <font class="smallfont"><p>From the log I see that you did not reboot the controller after updating it as it is using Found cached ShellExe command. You really need do this if you change anything in the command.<br/>
Your polling interval is 2 which means probably 2ms, this is too frequently, try to put few seconds there, either 2000 or 2s would do.<br/>
Without () your regex would not return the value which switch sensor can use. However, if you use a custom sensor instead then it can accept any return value and you will see in the linked label what was given back.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aktur at Jul 11, 2014 11:15
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887520"></a>
                                    <font class="smallfont"><blockquote><p>Without () your regex would not return the value which switch sensor can use</p></blockquote>
<p>Apparantly the ShellExe command works differently compared to http command. For my http calls to RaZberry I had to remove the () to get it working at the time.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jul 11, 2014 12:36
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:38</font></td>
		    </tr>
	    </table>
    </body>
</html>