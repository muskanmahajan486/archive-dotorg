<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Sensor with TCP command (Regular Expression)</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Sensor with TCP command (Regular Expression)
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Nov 05, 2013 by <font color="#0050B2">hennemarc</font>.
				    </div>

				    <p>Hello all,</p>

<p>I am controlling my ventilation system via TCP/IP commands by sending HEX strings to the device. A pure command works perfectly, but now I would like to read the status of the unit. That works as well by sending the status hex command as shown below:</p>

<p><img src="attachments/22879424/23036229.jpg" align="absmiddle" border="0"/></p>

<p>The unit is sending a hex string back.</p>

<p>What I am not able to do is to "receive" the reply from the unit into a label by using a custom sensor.</p>

<p>For the moment I would be happy if I am able to display the (raw) hex string coming from the device, without doing some parsing activities, but this does not work. </p>

<p>Can anybody give me a hint how to do this?</p>

<p>As a second step I would be interested how to work with the Regular Expression in the TCP/IP command. I have read some forum posts, but it seems that the Regex is quite difficult to create. I found a testing tool in the internet, but for this I need the Regex created before. Is there a HowTo available how to create (not to test) the Regular Expression.</p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22879424/23036229.jpg">hex01.jpg</a> (image/jpeg)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-22879438"></a>
                                    <font class="smallfont"><p>You need to use a custom sensor for displaying arbitrary string.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by atamariya at Nov 05, 2013 15:34
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22879461"></a>
                                    <font class="smallfont"><p>OK, using a custom sensor works, but now I see that the reply is in binary and not as ASCII. Is there a way to convert this back to ASCII, so readable letters?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hennemarc at Nov 05, 2013 21:00
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22879479"></a>
                                    <font class="smallfont"><p>Not possible without some programming.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by atamariya at Nov 06, 2013 03:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22879482"></a>
                                    <font class="smallfont"><p>Can you give an example(s) of the returned string? I am not at all a regex expert, but would love to give it a try.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Nov 06, 2013 09:02
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22879488"></a>
                                    <font class="smallfont"><p>If you have the result in a custom sensor you could use a rule to convert that into a string.<br/>
There are some forum posts with examples for conversions with rules</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Nov 06, 2013 11:52
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22879591"></a>
                                    <font class="smallfont"><p>Hello,</p>

<p>actually I don't know how to provide an example of the received answer, because it seems that the answer from the device is sent in binary mode, in other words I do not see the the HEX strings like 0x07 F0 00 68 0D 03 3C 20 43 41 33 35 30 20 6C 75 78 65 7B 07 0F, because the results are non printable ASCII Codes.</p>

<p>I am thinking about to add a rule for this sensor with the java command getBytes(), but actually I do not know how to implement this or whether this is supported by the drool engine.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hennemarc at Nov 07, 2013 22:22
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22879594"></a>
                                    <font class="smallfont"><p>Then you would just use the string from the custom sensor as a transport media to get the hey values from the command into the rules. <br/>
This could work but I don't know.<br/>
On the rule side you would use getBytes() and then only extract what ever you need and convert that back into a string.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Nov 07, 2013 23:08
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:42</font></td>
		    </tr>
	    </table>
    </body>
</html>