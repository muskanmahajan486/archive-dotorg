<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : XML Readout DREAMBOX</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : XML Readout DREAMBOX
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jun 11, 2013 by <font color="#0050B2">peterchrisben</font>.
				    </div>

				    <p>Hi Guys,<br/>
i have some trouble to readout current program information with the xml parser.<br/>
This is the xml site:</p>

<p><a class="confluence-thumbnail-link 785x831" href='http://www.openremote.org/download/attachments/22872528/Bildschirmfoto 2013-06-11 um 08.14.37.png'><img src="attachments/thumbnails/22872528/23035923" align="absmiddle" border="0"/></a></p>

<p>Here is my Controller Setup:</p>

<p><a class="confluence-thumbnail-link 399x520" href='http://www.openremote.org/download/attachments/22872528/Bildschirmfoto 2013-06-11 um 08.15.27.png'><img src="attachments/thumbnails/22872528/23035924" align="absmiddle" border="0"/></a></p>


<p>Read out of volume information with this XPath Expression work fine:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-comment">//e2currentserviceinformation/e2volume/e2result
</span>
<span class="code-comment">//e2currentserviceinformation/e2volume/e2resulttext
</span>
<span class="code-comment">//e2currentserviceinformation/e2volume/e2ismuted
</span> </pre>
</div></div>

<p>All other requests fail an i get only a N/A in my panel:</p>

 <div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-comment">//e2currentserviceinformation/e2service/e2servicename
</span>
<span class="code-comment">//e2currentserviceinformation/e2eventlist/e2event/e2eventname</span>
</pre>
</div></div>

<p>Any idea what is wrong or what i can do to get this information? Or is this a bug?</p>


<p>Thanks and regards,<br/>
Chris</p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22872528/23035923.png">Bildschirmfoto 2013-06-11 um 08.14.37.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22872528/23035924.png">Bildschirmfoto 2013-06-11 um 08.15.27.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22872528/23035929.class">HttpGetCommand.class</a> (application/octet-stream)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-22872535"></a>
                                    <font class="smallfont"><p>Have a look here: <a href="http://www.openremote.org/display/forums/XPath+help?focusedCommentId=21860351">http://www.openremote.org/display/forums/XPath+help?focusedCommentId=21860351</a></p>

<p>What sensor types do you use in both cases?<br/>
If you put the xml in readible form here, I can have a look on my own rig.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 11, 2013 09:14
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872542"></a>
                                    <font class="smallfont"><p>Hey... thanks for your reply. i checked out your link to the other topic and use the xpath-online-tester.</p>

<p>the path-online-tester show no fault. everything shout be fine.<br/>
I use a custom sensor and a label on the panel. </p>



<p>here is the xml in code tags:</p>

<div style="max-width: 800px;"><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;?xml version=<span class="code-quote">"1.0"</span> encoding=<span class="code-quote">"UTF-8"</span>?&gt;
&lt;e2currentserviceinformation&gt;
	&lt;e2service&gt;
		&lt;e2servicereference&gt;1:0:19:7B:6:85:FFFF0000:0:0:0:&lt;/e2servicereference&gt;
		&lt;e2servicename&gt;TNT Serie HD&lt;/e2servicename&gt;
		&lt;e2providername&gt;SKY&lt;/e2providername&gt;
		&lt;e2videowidth&gt;1920&lt;/e2videowidth&gt;
		&lt;e2videoheight&gt;1080&lt;/e2videoheight&gt;
		&lt;e2servicevideosize&gt;1920x1080&lt;/e2servicevideosize&gt;
		&lt;e2iswidescreen&gt;&lt;/e2iswidescreen&gt;
		&lt;e2apid&gt;259&lt;/e2apid&gt;
		&lt;e2vpid&gt;255&lt;/e2vpid&gt;
		&lt;e2pcrpid&gt;255&lt;/e2pcrpid&gt;
		&lt;e2pmtpid&gt;96&lt;/e2pmtpid&gt;
		&lt;e2txtpid&gt;32&lt;/e2txtpid&gt;
		&lt;e2tsid&gt;6&lt;/e2tsid&gt;
		&lt;e2onid&gt;133&lt;/e2onid&gt;
		&lt;e2sid&gt;123&lt;/e2sid&gt;		
	&lt;/e2service&gt;
	&lt;e2eventlist&gt;
		&lt;e2event&gt;
			&lt;e2eventservicereference&gt;1:0:19:7B:6:85:FFFF0000:0:0:0:&lt;/e2eventservicereference&gt;
			&lt;e2eventservicename&gt;TNT Serie HD&lt;/e2eventservicename&gt;
			&lt;e2eventprovidername&gt;SKY&lt;/e2eventprovidername&gt;
			&lt;e2eventid&gt;17878&lt;/e2eventid&gt;	
			&lt;e2eventname&gt;Mord ist ihr Hobby&lt;/e2eventname&gt;
			&lt;e2eventtitle&gt;Mord ist ihr Hobby&lt;/e2eventtitle&gt;
			&lt;e2eventdescription&gt;Mord in Montana&lt;/e2eventdescription&gt;
			&lt;e2eventstart&gt;1370940900&lt;/e2eventstart&gt;
			&lt;e2eventduration&gt;2700&lt;/e2eventduration&gt;
			&lt;e2eventremaining&gt;2054&lt;/e2eventremaining&gt;
			&lt;e2eventcurrenttime&gt;1370941546.93&lt;/e2eventcurrenttime&gt;
			&lt;e2eventdescriptionextended&gt;Ein junger Schriftsteller ruft Jessica und ihre Verlegerin nach Montana, doch bald darauf wird er tot aufgefunden. Jessica macht sich auf die Suche nach dem Mörder...
USA 1988. 45 Min.&lt;/e2eventdescriptionextended&gt;			
		&lt;/e2event&gt;
		&lt;e2event&gt;
			&lt;e2eventservicereference&gt;1:0:19:7B:6:85:FFFF0000:0:0:0:&lt;/e2eventservicereference&gt;
			&lt;e2eventservicename&gt;TNT Serie HD&lt;/e2eventservicename&gt;		
			&lt;e2eventprovidername&gt;SKY&lt;/e2eventprovidername&gt;
			&lt;e2eventid&gt;17879&lt;/e2eventid&gt;
			&lt;e2eventname&gt;Mord ist ihr Hobby&lt;/e2eventname&gt;
			&lt;e2eventtitle&gt;Mord ist ihr Hobby&lt;/e2eventtitle&gt;
			&lt;e2eventdescription&gt;Der Privatdetektiv&lt;/e2eventdescription&gt;
			&lt;e2eventstart&gt;1370943600&lt;/e2eventstart&gt;
			&lt;e2eventduration&gt;3000&lt;/e2eventduration&gt;
			&lt;e2eventremaining&gt;3000&lt;/e2eventremaining&gt;
			&lt;e2eventcurrenttime&gt;1370941546.99&lt;/e2eventcurrenttime&gt;
			&lt;e2eventdescriptionextended&gt;In Boston trifft Jessica ihren alten Freund John Winslow. Der gibt vor, sie nicht zu kennen. Jessica sucht daraufhin Johns Frau Maude auf, die ihr erklärt, dass ihr Mann tot sei...
USA 1988. 46 Min.&lt;/e2eventdescriptionextended&gt;
		&lt;/e2event&gt;
	&lt;/e2eventlist&gt;
	&lt;e2volume&gt;
		&lt;e2result&gt;True&lt;/e2result&gt;
		&lt;e2resulttext&gt;State&lt;/e2resulttext&gt;
		&lt;e2current&gt;55&lt;/e2current&gt;
		&lt;e2ismuted&gt;False&lt;/e2ismuted&gt;
	&lt;/e2volume&gt;
&lt;/e2currentserviceinformation&gt;
</pre>
</div></div></div>

</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by peterchrisben at Jun 11, 2013 10:30
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872545"></a>
                                    <font class="smallfont"><p>i checked the dev.log an see following log message:</p>

<div style="max-width: 800px;"><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">

2013-06-11 11:52:16,718 INFO [Polling thread <span class="code-keyword">for</span> sensor: DM800 Aktuelle Sendung]: received message: &lt;?xml version=<span class="code-quote">"1.0"</span> encoding=<span class="code-quote">"UTF-8"</span>?&gt;
&lt;e2currentserviceinformation&gt;
	&lt;e2service&gt;
		&lt;e2servicereference&gt;1:0:19:70:D:85:FFFF0000:0:0:0:&lt;/e2servicereference&gt;
		&lt;e2servicename&gt;NatGeo HD&lt;/e2servicename&gt;
		&lt;e2providername&gt;SKY&lt;/e2providername&gt;
		&lt;e2videowidth&gt;1920&lt;/e2videowidth&gt;
		&lt;e2videoheight&gt;1080&lt;/e2videoheight&gt;
		&lt;e2servicevideosize&gt;1920x1080&lt;/e2servicevideosize&gt;
		&lt;e2iswidescreen&gt;&lt;/e2iswidescreen&gt;
		&lt;e2apid&gt;515&lt;/e2apid&gt;
		&lt;e2vpid&gt;511&lt;/e2vpid&gt;
		&lt;e2pcrpid&gt;511&lt;/e2pcrpid&gt;
		&lt;e2pmtpid&gt;97&lt;/e2pmtpid&gt;
		&lt;e2txtpid&gt;32&lt;/e2txtpid&gt;
		&lt;e2tsid&gt;13&lt;/e2tsid&gt;
		&lt;e2onid&gt;133&lt;/e2onid&gt;
		&lt;e2sid&gt;112&lt;/e2sid&gt;		
	&lt;/e2service&gt;
	&lt;e2eventlist&gt;
		&lt;e2event&gt;
			&lt;e2eventservicereference&gt;1:0:19:70:D:85:FFFF0000:0:0:0:&lt;/e2eventservicereference&gt;
			&lt;e2eventservicename&gt;NatGeo HD&lt;/e2eventservicename&gt;
			&lt;e2eventprovidername&gt;SKY&lt;/e2eventprovidername&gt;
			&lt;e2eventid&gt;43165&lt;/e2eventid&gt;	
			&lt;e2eventname&gt;Mega-St�dte&lt;/e2eventname&gt;
			&lt;e2eventtitle&gt;Mega-St�dte&lt;/e2eventtitle&gt;
			&lt;e2eventdescription&gt;Taipeh 101&lt;/e2eventdescription&gt;
			&lt;e2eventstart&gt;1370942400&lt;/e2eventstart&gt;
			&lt;e2eventduration&gt;3300&lt;/e2eventduration&gt;
			&lt;e2eventremaining&gt;1366&lt;/e2eventremaining&gt;
			&lt;e2eventcurrenttime&gt;1370944334.61&lt;/e2eventcurrenttime&gt;
			&lt;e2eventdescriptionextended&gt;1. Staffel, Folge 1: In einer neuen Folge geht es in die brodelnde taiwanesische Metropole Taipeh. Hier wurde zwischen 1999 und 2003 der h�chste Wolkenkratzer der Welt errichtet: Der 509 Meter hohe Taipei 101 ist nicht nur technisch eine Meisterleistung, sondern steht auch als Symbol f�r die wiedererstarkende Wirtschaftsmacht Taiwans.
USA 2005. 55 Min.&lt;/e2eventdescriptionextended&gt;			
		&lt;/e2event&gt;
		&lt;e2event&gt;
			&lt;e2eventservicereference&gt;1:0:19:70:D:85:FFFF0000:0:0:0:&lt;/e2eventservicereference&gt;
			&lt;e2eventservicename&gt;NatGeo HD&lt;/e2eventservicename&gt;		
			&lt;e2eventprovidername&gt;SKY&lt;/e2eventprovidername&gt;
			&lt;e2eventid&gt;43166&lt;/e2eventid&gt;
			&lt;e2eventname&gt;Naked Science&lt;/e2eventname&gt;
			&lt;e2eventtitle&gt;Naked Science&lt;/e2eventtitle&gt;
			&lt;e2eventdescription&gt;Der Feuerball Christi - Vision oder Komet?&lt;/e2eventdescription&gt;
			&lt;e2eventstart&gt;1370945700&lt;/e2eventstart&gt;
			&lt;e2eventduration&gt;3000&lt;/e2eventduration&gt;
			&lt;e2eventremaining&gt;3000&lt;/e2eventremaining&gt;
			&lt;e2eventcurrenttime&gt;1370944334.66&lt;/e2eventcurrenttime&gt;
			&lt;e2eventdescriptionextended&gt;8. Staffel, Folge 4: Im Jahr 312 n. Chr., kurz vor der entscheidenden Schlacht gegen seinen Erzrivalen Maxentius, soll Kaiser Konstantin der Gro�e eine Erscheinung gehabt haben: ein leuchtendes Kreuz mit der Inschrift <span class="code-quote">"In diesem Zeichen wirst du siegen"</span>. Konstantin entschied sich daraufhin, das Kreuz als Feldzeichen zu verwenden. Tats�chlich gelang es dem Kaiser, Maxentius in der Schlacht bei der Milvischen Br�cke zu t�ten. Damit wurde Konstantin zum unumstrittenen Alleinherrscher des gewaltigen R�mischen Weltreiches. Ein Jahr sp�ter schrieb er mit der Toleranzvereinbarung von Mailand die Freiheit der Religions...
GB/E 2009. 50 Min.&lt;/e2eventdescriptionextended&gt;
		&lt;/e2event&gt;
	&lt;/e2eventlist&gt;
	&lt;e2volume&gt;
		&lt;e2result&gt;True&lt;/e2result&gt;
		&lt;e2resulttext&gt;State&lt;/e2resulttext&gt;
		&lt;e2current&gt;55&lt;/e2current&gt;
		&lt;e2ismuted&gt;False&lt;/e2ismuted&gt;
	&lt;/e2volume&gt;
&lt;/e2currentserviceinformation&gt;

2013-06-11 11:52:16,718 ERROR [Polling thread <span class="code-keyword">for</span> sensor: DM800 Aktuelle Sendung]: Could not perform xpath evaluation
com.sun.org.apache.xerces.internal.impl.io.MalformedByteSequenceException: Invalid <span class="code-object">byte</span> 2 of 3-<span class="code-object">byte</span> UTF-8 sequence.
	at com.sun.org.apache.xerces.internal.impl.io.UTF8Reader.invalidByte(UTF8Reader.java:684)
	at com.sun.org.apache.xerces.internal.impl.io.UTF8Reader.read(UTF8Reader.java:405)
	at com.sun.org.apache.xerces.internal.impl.XMLEntityScanner.load(XMLEntityScanner.java:1742)
	at com.sun.org.apache.xerces.internal.impl.XMLEntityScanner.skipChar(XMLEntityScanner.java:1416)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2793)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:647)
	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511)
	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808)
	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737)
	at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119)
	at com.sun.org.apache.xerces.internal.parsers.DOMParser.parse(DOMParser.java:232)
	at com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderImpl.parse(DocumentBuilderImpl.java:284)
	at javax.xml.parsers.DocumentBuilder.parse(DocumentBuilder.java:124)
	at org.openremote.controller.protocol.http.HttpGetCommand.run(HttpGetCommand.java:260)
	at java.lang.<span class="code-object">Thread</span>.run(<span class="code-object">Thread</span>.java:662)
2013-06-11 11:52:16,718 TRACE [Polling thread <span class="code-keyword">for</span> sensor: DM800 Aktuelle Sendung]: Processed 'N/A', received 'N/A'

</pre>
</div></div></div>

<p>Any ideas what this means? </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by peterchrisben at Jun 11, 2013 10:56
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872546"></a>
                                    <font class="smallfont"><p>It works for me to retrieve the service name <b>TNT Serie HD</b>. I did not try any of the others.</p>
<ul class="alternate" type="square">
	<li>I copied your source in a file on the OR Controller in subdirectory webapps/private</li>
	<li>in the http command I use<br/>
  URL: <a href="http://ds212:8688/private/dreambox.xml">http://ds212:8688/private/dreambox.xml</a><br/>
  Method: POST<br/>
  XPATH: //e2currentserviceinformation/e2service/e2servicename <br/>
  Polling: 2s</li>
	<li>I made a sensor type:Custom</li>
	<li>I used Webconsole version 7746; Designer Pro 1.09; Controller Pro 1.07</li>
</ul>


<p>I remember having had problems with this type of xml before, but I could not reproduce later. It might have to do with the software versions you are using, but I can't tell for sure.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 11, 2013 10:58
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872547"></a>
                                    <font class="smallfont"><p>It does mean that it has problems with what the Americans call "funny characters". Your umlauts seem to be bugging. I did not have that in my test sample shown further down.<br/>
If I do change the service name in the XML to <em>TNT <b>Séerie</b> HD</em>, I see that this one character does not display correctly on my screen. But the string as a whole is still presented</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 11, 2013 11:07
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872551"></a>
                                    <font class="smallfont"><p>thanks for your tries...</p>

<p>it does not work here. i use the actual designer preview Version 2.14.0 (2013-04-20 Markab) and the Controller 2.0.2. <br/>
i tried also the developer snapshot Openremot-Controller-2.1.0_Alpha-SNAPSHOT-2013-05-11. No help. </p>

<p>Read out of the volume information on same xml-file works.... that's weird!</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by peterchrisben at Jun 11, 2013 11:58
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872560"></a>
                                    <font class="smallfont"><p>Well looks like a problem in OpenRemote. <br/>
I am not a specialist, so I have to leave it to the OpenRemote guys to help you further<br/>
Pieter</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 11, 2013 13:27
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872575"></a>
                                    <font class="smallfont"><p>Thanks for posting the error logs.</p>

<p>This looks like a some kind of mismatch with the claimed character encoding in the XML document (UTF-8) and the actual encoding which yields the error:</p>

<p>Invalid byte 2 of 3-byte UTF-8 sequence.</p>

<p>Is the generated XML document something you have no control over?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jun 11, 2013 17:48
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872577"></a>
                                    <font class="smallfont"><p>I think there are two unrelated problems</p>
<ul class="alternate" type="square">
	<li>Not correctly displaying the diacritical characters</li>
	<li>Some versions of OpenRemote not being able to evaluate the XPATH correctly</li>
</ul>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 11, 2013 18:12
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872578"></a>
                                    <font class="smallfont"><p>The display in this case is not relevant, since the error is coming from the parser. The error is not related to xpath directly but specifically the file's UTF encoding which the parser fails to understand.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jun 11, 2013 18:52
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872580"></a>
                                    <font class="smallfont"><p>To put my observation in other words:</p>

<p>In my Pro-version of OpenRemote Xpath evaluates correctly, in his version ?? it does not. This observation on my side is unrelated to whether the text string sought contains diacritical characters or not. </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 11, 2013 19:22
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872588"></a>
                                    <font class="smallfont"><p>Hi Juha...</p>

<p>... the xml document is generated by my dreambox and i have no control of the output and layout.<br/>
What i cant understand is that some xpath replies work and others don't with the same xml document.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by peterchrisben at Jun 11, 2013 22:14
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872589"></a>
                                    <font class="smallfont"><p>Can you try the results with the attached <a href="attachments/22872528/23035929.class">HttpGetCommand.class</a> ?</p>

<p>Please copy it over the original in Controller (2.1 alpha branch)/webapps/controller/WEB-INF/classes/org/openremote/controller/protocol/http/HttpGetCommand.class</p>

<p>It brute forces the incoming characters to UTF-8 charset. When malformed input characters are encountered, the bytes are replaced with the default replacement byte array of UTF-8.</p>

<p>This is not a viable long-term fix but an attempt to unbug the suspected bug in character encodings. If it works, it should get you past the error you posted earlier.</p>

<p>Let me know how it goes.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jun 11, 2013 22:58
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872605"></a>
                                    <font class="smallfont"><p>Hi...</p>

<p>... i changed the httpGetCommand.class with the attached one. I get following failure messages at boot up from the controller and http is not working:</p>

<p>This Version of OR is installed: -&gt; Openremot-Controller-2.1.0_Alpha-SNAPSHOT-2013-05-11</p>

<div style="width: 800px;"><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">

 DEPLOYING NEW CONTROLLER RUNTIME...

--------------------------------------------------------------------

INFO 2013-06-12 06:29:16,125 : Initialized event processor : Drools Rule Engine
ERROR 2013-06-12 06:29:16,296 : Creating sensor failed. Error : org.openremote.controller.protocol.http.HttpGetCommand.&lt;init&gt;(Ljava/net/URI;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">Integer</span>;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">String</span>;)V 
 XML Element : &lt;sensor xmlns=<span class="code-quote">"http:<span class="code-comment">//www.openremote.org"</span> id=<span class="code-quote">"2590573"</span> name=<span class="code-quote">"DM800 SENDERABFRAGE"</span> type=<span class="code-quote">"custom"</span>&gt;
</span>      &lt;include type=<span class="code-quote">"command"</span> ref=<span class="code-quote">"2627"</span> /&gt;
    &lt;/sensor&gt;
java.lang.NoSuchMethodError: org.openremote.controller.protocol.http.HttpGetCommand.&lt;init&gt;(Ljava/net/URI;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">Integer</span>;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">String</span>;)V
	at org.openremote.controller.protocol.http.HttpGetCommandBuilder.build(HttpGetCommandBuilder.java:188)
	at org.openremote.controller.command.CommandFactory.getCommand(CommandFactory.java:93)
	at org.openremote.controller.model.xml.Version20SensorBuilder.parseSensorEventProducer(Version20SensorBuilder.java:420)
	at org.openremote.controller.model.xml.Version20SensorBuilder.build(Version20SensorBuilder.java:287)
	at org.openremote.controller.deployer.Version20ModelBuilder.buildSensorObjectModelFromXML(Version20ModelBuilder.java:799)
	at org.openremote.controller.deployer.Version20ModelBuilder.buildSensorModel(Version20ModelBuilder.java:645)
	at org.openremote.controller.deployer.Version20ModelBuilder.build(Version20ModelBuilder.java:539)
	at org.openremote.controller.deployer.AbstractModelBuilder.buildModel(AbstractModelBuilder.java:148)
	at org.openremote.controller.service.Deployer.startup(Deployer.java:785)
	at org.openremote.controller.service.Deployer.startController(Deployer.java:289)
	at org.openremote.controller.spring.SpringContext.initializeController(SpringContext.java:109)
	at org.openremote.controller.service.ServiceContext.init(ServiceContext.java:364)
	at org.openremote.controller.bootstrap.Startup.loadServiceContext(Startup.java:85)
	at org.openremote.controller.bootstrap.servlet.ServletStartup.initializeServiceContext(ServletStartup.java:190)
	at org.openremote.controller.bootstrap.servlet.ServletStartup.contextInitialized(ServletStartup.java:109)
	at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:3843)
	at org.apache.catalina.core.StandardContext.start(StandardContext.java:4342)
	at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:791)
	at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:771)
	at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:525)
	at org.apache.catalina.startup.HostConfig.deployDirectory(HostConfig.java:926)
	at org.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:889)
	at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:492)
	at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1149)
	at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:311)
	at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:117)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1053)
	at org.apache.catalina.core.StandardHost.start(StandardHost.java:719)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1045)
	at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:443)
	at org.apache.catalina.core.StandardService.start(StandardService.java:516)
	at org.apache.catalina.core.StandardServer.start(StandardServer.java:710)
	at org.apache.catalina.startup.Catalina.start(Catalina.java:578)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:288)
	at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:413)
ERROR 2013-06-12 06:29:16,328 : Creating sensor failed. Error : org.openremote.controller.protocol.http.HttpGetCommand.&lt;init&gt;(Ljava/net/URI;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">Integer</span>;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">String</span>;)V 
 XML Element : &lt;sensor xmlns=<span class="code-quote">"http:<span class="code-comment">//www.openremote.org"</span> id=<span class="code-quote">"2590572"</span> name=<span class="code-quote">"DM800 GET VOLUME RANGE"</span> type=<span class="code-quote">"range"</span>&gt;
</span>      &lt;include type=<span class="code-quote">"command"</span> ref=<span class="code-quote">"2624"</span> /&gt;
      &lt;min value=<span class="code-quote">"0"</span> /&gt;
      &lt;max value=<span class="code-quote">"100"</span> /&gt;
    &lt;/sensor&gt;
java.lang.NoSuchMethodError: org.openremote.controller.protocol.http.HttpGetCommand.&lt;init&gt;(Ljava/net/URI;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">Integer</span>;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">String</span>;)V
	at org.openremote.controller.protocol.http.HttpGetCommandBuilder.build(HttpGetCommandBuilder.java:188)
	at org.openremote.controller.command.CommandFactory.getCommand(CommandFactory.java:93)
	at org.openremote.controller.model.xml.Version20SensorBuilder.parseSensorEventProducer(Version20SensorBuilder.java:420)
	at org.openremote.controller.model.xml.Version20SensorBuilder.build(Version20SensorBuilder.java:287)
	at org.openremote.controller.deployer.Version20ModelBuilder.buildSensorObjectModelFromXML(Version20ModelBuilder.java:799)
	at org.openremote.controller.deployer.Version20ModelBuilder.buildSensorModel(Version20ModelBuilder.java:645)
	at org.openremote.controller.deployer.Version20ModelBuilder.build(Version20ModelBuilder.java:539)
	at org.openremote.controller.deployer.AbstractModelBuilder.buildModel(AbstractModelBuilder.java:148)
	at org.openremote.controller.service.Deployer.startup(Deployer.java:785)
	at org.openremote.controller.service.Deployer.startController(Deployer.java:289)
	at org.openremote.controller.spring.SpringContext.initializeController(SpringContext.java:109)
	at org.openremote.controller.service.ServiceContext.init(ServiceContext.java:364)
	at org.openremote.controller.bootstrap.Startup.loadServiceContext(Startup.java:85)
	at org.openremote.controller.bootstrap.servlet.ServletStartup.initializeServiceContext(ServletStartup.java:190)
	at org.openremote.controller.bootstrap.servlet.ServletStartup.contextInitialized(ServletStartup.java:109)
	at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:3843)
	at org.apache.catalina.core.StandardContext.start(StandardContext.java:4342)
	at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:791)
	at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:771)
	at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:525)
	at org.apache.catalina.startup.HostConfig.deployDirectory(HostConfig.java:926)
	at org.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:889)
	at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:492)
	at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1149)
	at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:311)
	at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:117)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1053)
	at org.apache.catalina.core.StandardHost.start(StandardHost.java:719)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1045)
	at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:443)
	at org.apache.catalina.core.StandardService.start(StandardService.java:516)
	at org.apache.catalina.core.StandardServer.start(StandardServer.java:710)
	at org.apache.catalina.startup.Catalina.start(Catalina.java:578)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:288)
	at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:413)
ERROR 2013-06-12 06:29:16,859 : Creating sensor failed. Error : org.openremote.controller.protocol.http.HttpGetCommand.&lt;init&gt;(Ljava/net/URI;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">Integer</span>;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">String</span>;Ljava/lang/<span class="code-object">String</span>;)V 
 XML Element : &lt;sensor xmlns=<span class="code-quote">"http:<span class="code-comment">//www.openremote.org"</span> id=<span class="code-quote">"2590321"</span> name=<span class="code-quote">"DM800 GET VOLUME"</span> type=<span class="code-quote">"custom"</span>&gt;
</span>      &lt;include type=<span class="code-quote">"command"</span> ref=<span class="code-quote">"2624"</span> /&gt;
    &lt;/sensor&gt;

</pre>
</div></div></div>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by peterchrisben at Jun 12, 2013 05:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872607"></a>
                                    <font class="smallfont"><p>Ok, sorry about that, looks like there was still other API changes that caused the patch not to load correctly.</p>

<p>I've instead uploaded the full compiled binary here: <a href="http://sourceforge.net/projects/openremote/files/For%20Developers/OpenRemote%202.0%20%28Developer%20Releases%29/OpenRemote-Controller-2.1.0_SNAPSHOT-2013-06-12.zip/download">OpenRemote-Controller-2.1.0_SNAPSHOT-2013-06-12.zip</a></p>

<p>Do give that one try instead.</p>

<p>If you see errors at startup related to Z-wave, please ignore them.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jun 12, 2013 10:59
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872627"></a>
                                    <font class="smallfont"><p>Hi Juha,</p>

<p>your snapshot works! Now i get a reply. Here is the dev.log</p>

<div style="width: 800px;"><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">

2013-06-12 20:43:23,968 INFO [Polling thread <span class="code-keyword">for</span> sensor: DM800 SENDUNG]: received message: &lt;?xml version=<span class="code-quote">"1.0"</span> encoding=<span class="code-quote">"UTF-8"</span>?&gt;
&lt;e2currentserviceinformation&gt;
	&lt;e2service&gt;
		&lt;e2servicereference&gt;1:0:19:70:D:85:FFFF0000:0:0:0:&lt;/e2servicereference&gt;
		&lt;e2servicename&gt;NatGeo HD&lt;/e2servicename&gt;
		&lt;e2providername&gt;SKY&lt;/e2providername&gt;
		&lt;e2videowidth&gt;1920&lt;/e2videowidth&gt;
		&lt;e2videoheight&gt;1080&lt;/e2videoheight&gt;
		&lt;e2servicevideosize&gt;1920x1080&lt;/e2servicevideosize&gt;
		&lt;e2iswidescreen&gt;&lt;/e2iswidescreen&gt;
		&lt;e2apid&gt;515&lt;/e2apid&gt;
		&lt;e2vpid&gt;511&lt;/e2vpid&gt;
		&lt;e2pcrpid&gt;511&lt;/e2pcrpid&gt;
		&lt;e2pmtpid&gt;97&lt;/e2pmtpid&gt;
		&lt;e2txtpid&gt;32&lt;/e2txtpid&gt;
		&lt;e2tsid&gt;13&lt;/e2tsid&gt;
		&lt;e2onid&gt;133&lt;/e2onid&gt;
		&lt;e2sid&gt;112&lt;/e2sid&gt;		
	&lt;/e2service&gt;
	&lt;e2eventlist&gt;
		&lt;e2event&gt;
			&lt;e2eventservicereference&gt;1:0:19:70:D:85:FFFF0000:0:0:0:&lt;/e2eventservicereference&gt;
			&lt;e2eventservicename&gt;NatGeo HD&lt;/e2eventservicename&gt;
			&lt;e2eventprovidername&gt;SKY&lt;/e2eventprovidername&gt;
			&lt;e2eventid&gt;43208&lt;/e2eventid&gt;	
			&lt;e2eventname&gt;Naked Science&lt;/e2eventname&gt;
			&lt;e2eventtitle&gt;Naked Science&lt;/e2eventtitle&gt;
			&lt;e2eventdescription&gt;Die verschollene Flotte von Benjamin Franklin&lt;/e2eventdescription&gt;
			&lt;e2eventstart&gt;1371060600&lt;/e2eventstart&gt;
			&lt;e2eventduration&gt;3300&lt;/e2eventduration&gt;
			&lt;e2eventremaining&gt;1296&lt;/e2eventremaining&gt;
			&lt;e2eventcurrenttime&gt;1371062604.02&lt;/e2eventcurrenttime&gt;
			&lt;e2eventdescriptionextended&gt;8. Staffel, Folge 6: Dass Freibeuter im Regierungsauftrag Jagd auf die Schiffe konkurrierender Nationen machten, war im 18. Jahrhundert eine Allt�glichkeit. Dass jedoch eine der Piratenflotten unter dem Kommando eines Gr�ndervaters der USA stand, ist eher unbekannt. Im Unabh�ngigkeitskrieg gegen England heuerte Benjamin Franklin, damals Botschafter in Frankreich, eine bunte Schar Freibeuter an. Ihr Ziel: in der Irischen See Jagd auf englische Schiffe zu machen. Gefangengenommene britische Seeleute, so Franklins Kalk�l, k�nnten anschlie�end gegen ihre amerikanischen Leidensgenossen ausgetauscht werden - ein huma...
GB/E 2009. 55 Min.&lt;/e2eventdescriptionextended&gt;			
		&lt;/e2event&gt;
		&lt;e2event&gt;
			&lt;e2eventservicereference&gt;1:0:19:70:D:85:FFFF0000:0:0:0:&lt;/e2eventservicereference&gt;
			&lt;e2eventservicename&gt;NatGeo HD&lt;/e2eventservicename&gt;		
			&lt;e2eventprovidername&gt;SKY&lt;/e2eventprovidername&gt;
			&lt;e2eventid&gt;43209&lt;/e2eventid&gt;
			&lt;e2eventname&gt;Prison Breaks - Die wahren Geschichten&lt;/e2eventname&gt;
			&lt;e2eventtitle&gt;Prison Breaks - Die wahren Geschichten&lt;/e2eventtitle&gt;
			&lt;e2eventdescription&gt;Inselfestung&lt;/e2eventdescription&gt;
			&lt;e2eventstart&gt;1371063900&lt;/e2eventstart&gt;
			&lt;e2eventduration&gt;3000&lt;/e2eventduration&gt;
			&lt;e2eventremaining&gt;3000&lt;/e2eventremaining&gt;
			&lt;e2eventcurrenttime&gt;1371062604.07&lt;/e2eventcurrenttime&gt;
			&lt;e2eventdescriptionextended&gt;2. Staffel, Folge 8: Matthew Williams kam wegen Brandstiftung ins Parkhurst-Gef�ngnis. Er war fest dazu entschlossen zu fliehen, wusste aber auch, dass das nicht einfach sein w�rde. Denn Parkhurst ist nicht nur von mehreren Z�unen umgeben - es liegt auch auf einer Insel. Selbst wenn es ihm gelingen sollte, aus dem Gef�ngnis auszubrechen, m�sste er auch einen Weg finden, die Insel zu verlassen. Matthew tat sich mit anderen Gefangenen zusammen und fertigte einen Schl�ssel an, mit dem man einige T�ren im Gef�ngnis �ffnen konnte. In der Metallwerkstatt des Gef�ngnisses bauten sie eine Leiter, die sie in ihre Einzelteile zerlegten, damit sie nicht gefunden w
USA 2009. 50 Min.&lt;/e2eventdescriptionextended&gt;
		&lt;/e2event&gt;
	&lt;/e2eventlist&gt;
	&lt;e2volume&gt;
		&lt;e2result&gt;True&lt;/e2result&gt;
		&lt;e2resulttext&gt;State&lt;/e2resulttext&gt;
		&lt;e2current&gt;27&lt;/e2current&gt;
		&lt;e2ismuted&gt;False&lt;/e2ismuted&gt;
	&lt;/e2volume&gt;
&lt;/e2currentserviceinformation&gt;

2013-06-12 20:43:23,968 WARN [Polling thread <span class="code-keyword">for</span> sensor: DM800 SENDUNG]: Replacing malformed input with UTF-8 <span class="code-keyword">default</span> replacement <span class="code-object">byte</span> array!
2013-06-12 20:43:23,968 INFO [Polling thread <span class="code-keyword">for</span> sensor: DM800 SENDUNG]: result of xpath evaluation: Naked Science
2013-06-12 20:43:23,968 TRACE [Polling thread <span class="code-keyword">for</span> sensor: DM800 SENDUNG]: Processed 'Naked Science', received 'Naked Science'

</pre>
</div></div></div>

<p>Thanks for your time and your work. Is this a bug in the actual release or is my xml document (dreambox) wrong formatted?</p>

<p>regards,<br/>
Chris</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by peterchrisben at Jun 12, 2013 19:48
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872633"></a>
                                    <font class="smallfont"><p>It would seem to be an issue with the dreambox. If you have a way to contact the dreambox developers it might be good idea to report it to them and have it fixed, or check if it has already been reported or if there's already a patch or a fix release for it.</p>

<p>The issue seems to be with the stated encoding of the XML document vs. the actual character encoding used with the HTTP response. The return document claims to be UTF-8 formatted:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml">
<span class="code-tag">&lt;?xml version=<span class="code-quote">"1.0"</span> encoding=<span class="code-quote">"UTF-8"</span>?&gt;</span>
</pre>
</div></div>  

<p>However, the HTTP return document is obviously not using UTF-8 encoding which is why the parser fails when it assumes the UTF-8 encoding found in the beginning of the XML document but then finds bytes that are not in the expected UTF-8 range or format. That causes the error you were seeing and ultimately the failure of the XPath expression evaluation.</p>

<p>I'm not able to check what character encoding the HTTP response claims to have with its response document, or whether Dreambox would respect Accept-Charset headers. I would have to prepare additional patches that log the HTTP headers for you to try with Dreambox. However, it would be sensible for the HTTP charset to match the claimed XML encoding &#8211; otherwise every consumer would have to do character conversions between the HTTP response and XML document which usually isn't what the developers intended. So raising the issue with dreambox would still make sense.</p>


<p>The current patch in the snapshot is not something we can keep as part of the release. It is currently making a brute force conversion to UTF-8 to satisfy the parser, but this causes malformed bytes to be replaced by default replacement bytes (which often show up as question marks, or empty squares or similar when displayed). The patch will obviously be wrong if in some cases the returned XML document would claim a character encoding other than UTF-8.</p>

<p>If there's no chance of patching dreambox, we could try </p>

<ol>
	<li>charset detection &#8211; this is in general unreliable and according to wikipedia has been used to circumvent security policies even</li>
	<li>include a user configurable option to do character conversions &#8211; this is a game of trial and error if you do not know what the HTTP character encoding is, and you usually only find the error one day when there's an odd character you didn't expect in the input</li>
	<li>check whether Accept-Charset header is respected and add an option to configure all headers in HTTP requests</li>
	<li>check if there's a reasonable character conversion that could be done between HTTP charset and XML character encoding &#8211; might require pre-processing the &lt;?xml?&gt; directive before feeding the document to the parser</li>
	<li>create separate patch for dreambox &#8211; wouldn't include this with the standard build process for now, so would be per request only for dreambox users, the patch itself is a simple one-liner</li>
</ol>


<p>I would still prefer the option of HTTP response charset matching the XML document charset in Dreambox over the above options.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jun 12, 2013 21:53
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872649"></a>
                                    <font class="smallfont"><p>Juha,<br/>
We do/did have a similar issue with a free Swedish weather station (<a href="http://www.openremote.org/display/forums/Get+Weather+information+from+XML">http://www.openremote.org/display/forums/Get+Weather+information+from+XML</a>). The URL to the site is with diacritical characters, so are some of the contents. The URL is:
<a href="http://www.yr.no/place/Sweden/V">http://www.yr.no/place/Sweden/V</a>ästra_Götaland/Torslanda/forecast.xml.<br/>
The user just confirmed that things work perfectly for him, but I can only make selections if I copy the XML to my localhost webserver.<br/>
An example Xpath we used is: <br/>
//weatherdata/location/name/</p>

<p>I am passing this information to you just as a reference case. </p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 13, 2013 08:21
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872653"></a>
                                    <font class="smallfont"><p>The headers there would seem to indicate UTF-8 encoding as expected:</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Last-Modified: Thu, 13 Jun 2013 08:29:21 GMT
Server: Microsoft-IIS/7.5
X-AspNet-Version: 4.0.30319
X-Frontserver: MADMZYRWWW04
X-Powered-By: ASP.NET
Cache-Control: public, max-age=120
Expires: Thu, 13 Jun 2013 08:31:21 GMT
Date: Thu, 13 Jun 2013 08:29:21 GMT
Content-Length: 22379
Connection: keep-alive

&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;weatherdata&gt;

...
</pre>
</div></div>

<p>So what is the error you are seeing?</p>

<p>If you still suspect it is the same issue, you can attempt to use the same snapshot posted earlier to see if it resolves the issue.</p>

</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jun 13, 2013 09:34
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872656"></a>
                                    <font class="smallfont"><p>I'll dig into it and try that out after I have solved some pressing Razberry issues.<br/>
Can I use Pro designer models on that snapshot, or must I use the free designer?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 13, 2013 09:52
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872700"></a>
                                    <font class="smallfont"><p>Installed the snapshot, used Free Designer to make a new model with one device that contained a http command and a custom sensor. The latter displayed N/A&gt; on screen.<br/>
The Http used this url:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">http:<span class="code-comment">//www.yr.no/place/Sweden/V%C3%A4stra_G%C3%B6taland/Torslanda/forecast.xml</span></pre>
</div></div>
<p>and had as XPATH </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">//weatherdata/location/name/</span></pre>
</div></div>
<p>Polling at 20s interval.<br/>
This is what I got with the snapshot:<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
2013-06-13 15:47:37,915 INFO [Polling thread <span class="code-keyword">for</span> sensor: Torslanda]: received message: 
2013-06-13 15:47:37,915 WARN [Polling thread <span class="code-keyword">for</span> sensor: Torslanda]: Replacing malformed input with UTF-8 <span class="code-keyword">default</span> replacement <span class="code-object">byte</span> array!
2013-06-13 15:47:37,915 ERROR [Polling thread <span class="code-keyword">for</span> sensor: Torslanda]: Could not perform xpath evaluation
org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 1; Premature end of file.
	at com.sun.org.apache.xerces.internal.parsers.DOMParser.parse(Unknown Source)
	at com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderImpl.parse(Unknown Source)
	at javax.xml.parsers.DocumentBuilder.parse(Unknown Source)
	at org.openremote.controller.protocol.http.HttpGetCommand.run(HttpGetCommand.java:270)
	at java.lang.<span class="code-object">Thread</span>.run(Unknown Source)
2013-06-13 15:47:37,915 TRACE [Polling thread <span class="code-keyword">for</span> sensor: Torslanda]: Processed 'N/A', received 'N/A'
</pre>
</div></div><br/>
So I guess it does not find the <a href="http://www.yr.no/place/Sweden/Västra_Götaland/Torslanda/forecast.xml">Torslanda XML page</a> Seems like an URL problem. I did try both with diacritical and URL-encoded diacritical signs in the URL. Both failed.</p>

</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 13, 2013 15:15
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872701"></a>
                                    <font class="smallfont"><p>For some reason you are getting an empty response back from your request:</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>2013-06-13 15:47:37,915 INFO [Polling thread for sensor: Torslanda]: received message: 
</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jun 13, 2013 15:40
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872712"></a>
                                    <font class="smallfont"><p>Indeed it is empty. I first thought it might have to do with ORC running on Synology, but this snapshot was installed on my XP machine.<br/>
If I download my production models from the PRO designer to the XP machine, I can see the complete XML downloads from the other sites I use. For example from the weathersite wunderground.com. So it does work in principle. Also if I place the address of the Torslanda URL in a web browser I can download the content.</p>

<p>Though it does not affect me personally it remains strange.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 13, 2013 20:30
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872713"></a>
                                    <font class="smallfont"><p>Ok, I guess could add some debug logging there to see if it reveals anything.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jun 13, 2013 21:43
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872718"></a>
                                    <font class="smallfont"><p>Tried the HTTP GET request through controller and the return document came back fine, not as empty. With funny characters and all. So can't reproduce it for now.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jun 14, 2013 00:18
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872727"></a>
                                    <font class="smallfont"><p>Thanks for your efforts. It is good to know that it does work for you and Henrik.<br/>
I have tried the snapshot on the XP machine and two other Win7 machines. All the same result.<br/>
Also shut down firewalls and other protection. Nothing. Can't think of anything more.<br/>
I'll park this problem for the moment.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 14, 2013 09:47
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:43</font></td>
		    </tr>
	    </table>
    </body>
</html>