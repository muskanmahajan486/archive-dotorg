<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Noobie - Parsing HTML results</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Noobie - Parsing HTML results
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Aug 24, 2013 by <font color="#0050B2">juha</font>.
				    </div>

				    <p>I'm just starting out with home automation and OpenRemote.  I have LightWaveRF switches being controlled by an RFXtrx433 card, I'm using Domoticz to successfully switch the sockets off and on.</p>

<p>I'm attempting to use the HTML/JSON created by Domoticz to control the switches from within Open remote, but need some help parsing values.</p>

<p>When sending the following HTML request, <a href="http://192.168.0.xx:yyyy/json.htm?type=devices&amp;filter=light&amp;used=true&amp;order=Name">http://192.168.0.xx:yyyy/json.htm?type=devices&amp;filter=light&amp;used=true&amp;order=Name</a></p>

<p>I get the following response</p>

<div style="max-width: 800px;"><div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>"5MinuteHistoryDays" : 1,  
"Data" : "On", 
"Favorite" : 1, 
"HardwareID" : 1, 
"HardwareName" : "RFXtrx", 
"HaveDimmer" : true, 
"HaveGroupCmd" : true, 
"ID" : "F1559B", 
"IsSubDevice" : false, 
"LastUpdate" : "2013-08-22 01:42:51", 
"Level" : 0, 
"LevelInt" : 0, 
"MaxDimLevel" : 32, 
"Name" : "StudyTest", 
"Notifications" : "false", 
"SignalLevel" : 7, 
"Status" : "On", 
"SubType" : "LightwaveRF", 
"SwitchType" : "On/Off", 
"SwitchTypeVal" : 0, 
"Timers" : "true", 
"Type" : "Lighting 5", 
"TypeImg" : "lightbulb", 
"Unit" : 2, 
"Used" : 1, 
"idx" : "3" } ], 
"status" : "OK", "title" : "Devices"
</pre>
</div></div></div>

<p>How can I parse the "Data" value into OR in order to use this as a sensor?</p>

<p>Many thanks.</p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22875226/23036066.jpg">response.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22875226/23036067.jpg">exp.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22875226/23036068.jpg">httplog.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22875226/23036069.jpg">success.jpg</a> (image/jpeg)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-22875329"></a>
                                    <font class="smallfont"><p>You could use JSON-Path but this response is not a valid JSON structure. Something is missing at the beginning and at the end.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Aug 23, 2013 08:51
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875391"></a>
                                    <font class="smallfont"><p>This is what the URL returns.  Essentially I need to extract and evaluate the "Data" field for the sensor .  </p>

<p><img src="attachments/22875226/23036066.jpg" align="absmiddle" border="0"/></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by foo76 at Aug 23, 2013 20:50
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875392"></a>
                                    <font class="smallfont"><p>The JSONPath should be "/result/Status"</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Aug 23, 2013 21:12
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875396"></a>
                                    <font class="smallfont"><p>Thanks for the help, but I'm still not able to get this to work, this is what I have in the command<br/>
<img src="attachments/22875226/23036067.jpg" align="absmiddle" border="0"/></p>

<p>The sensor has been configured (against the command above) as type=switch</p>

<p>Would really appreciate some help!</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by foo76 at Aug 24, 2013 01:26
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875405"></a>
                                    <font class="smallfont"><p>Do you see anything in the log files?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Aug 24, 2013 08:46
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875406"></a>
                                    <font class="smallfont"><p>This is the output in the html log:</p>


<p><img src="attachments/22875226/23036068.jpg" align="absmiddle" border="0"/></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by foo76 at Aug 24, 2013 09:54
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875432"></a>
                                    <font class="smallfont"><p>So I've made a little bit of progress.</p>

<p>I believe the JSON expression I need is "$.result..Status", now the "Could not perform jsonpath evaluation" errors are no longer appearing, but the switch still doesn't work.</p>

<p>When I use "$.result..Status" it returns "On" including the quotes, is this suitable for a switch type sensor?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by foo76 at Aug 24, 2013 10:57
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875475"></a>
                                    <font class="smallfont"><p>More progress, but still not quite there...</p>

<p>Checking sensors.log it was clear the command enumerating the JSON expression was returning a string.  I therefore created a 'custom' sensor and set the values to:<br/>
on="On"<br/>
off="Off"</p>

<p>The dev.log now seems a lot happier and is correctly returning the state when the lamp is on or off, see extract below:</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>2013-08-24 14:36:21,024 TRACE [Polling thread for sensor: LampSensor_String]: Processed '["On"]', received '["On"]'
</pre>
</div></div>

<p>The switch is still not working though, it simply shows "Off" all the time.  Any advice?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by foo76 at Aug 24, 2013 15:39
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875479"></a>
                                    <font class="smallfont"><p>Jumping in the middle, and I haven't read the full thread yet but:</p>

<p>the log says the string returned (between single quotes) is ["On"]. You will probably need to find a way to strip out the brackets and double quotes first before the On value is consumed and accepted by the switch.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Aug 24, 2013 16:54
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875487"></a>
                                    <font class="smallfont"><p>Success!</p>

<p>I changed the switch to 'custom' and  included the whole string ["On"].  </p>

<p><img src="attachments/22875226/23036069.jpg" align="absmiddle" border="0"/></p>


<p>Thanks for the help, really appreciate it.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by foo76 at Aug 24, 2013 17:02
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875489"></a>
                                    <font class="smallfont"><p>Glad to hear it worked. Let us know how your project goes and spread the word.</p>

<p>Thanks,</p>

<p>&#8211; Juha</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Aug 24, 2013 17:10
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22885559"></a>
                                    <font class="smallfont"><p>Hello, I have been having a similar issue using x10.  After setting up the switch using the guide at:</p>

<p><a href="http://sourceforge.net/apps/mediawiki/mochad/index.php?title=OpenRemote#Create_LM465_switch_and_slider">http://sourceforge.net/apps/mediawiki/mochad/index.php?title=OpenRemote#Create_LM465_switch_and_slider</a></p>

<p>the switch will not change from OFF and pressing it will only turn the lamp on.</p>

<p>I tried the custom sensor idea, but no luck. Any other ideas I might try?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by bherch at Mar 27, 2014 20:58
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22886162"></a>
                                    <font class="smallfont"><p>Hi !<br/>
Could you share your command (StudyLampOff and /On) settings since I have difficulties to sent the HTTP orders to Domoticz.<br/>
I used the following:</p>

<p>Get Method, <a href="http://192.168.zz.xx:yyyy/json.htm?type=command&amp;param=switchlight&amp;idx=12&amp;switchcmd=On&amp;level=0">http://192.168.zz.xx:yyyy/json.htm?type=command&amp;param=switchlight&amp;idx=12&amp;switchcmd=On&amp;level=0</a></p>

<p>This worked from any web browser, but does not trigger any thing in Domotics from Openremote.</p>

<p>Can somebody help me?</p>

<p>Thanks in advance!<br/>
Kind regards,<br/>
M.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by dswinnen at Apr 29, 2014 02:28
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:42</font></td>
		    </tr>
	    </table>
    </body>
</html>