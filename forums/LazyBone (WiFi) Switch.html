<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : LazyBone (WiFi) Switch</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : LazyBone (WiFi) Switch
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Mar 10, 2014 by <font color="#0050B2">juha</font>.
				    </div>

				    <p>Hello,</p>

<p>I'm trying to configure LazyBone WIFI switch (<a href="http://www.tinyosshop.com/index.php?route=product/product&amp;product_id=496">http://www.tinyosshop.com/index.php?route=product/product&amp;product_id=496</a>) in OpenRemote<br/>
I successful send on/off commands but unable to get status of the switch <br/>
Following the manual I need to send '[' command<br/>
<img src="attachments/22885082/23036490.jpg" align="absmiddle" border="0"/><br/>
I'm using telnet protocol to send all commands, but system send back a hex value and I don't know how to take it<br/>
I tried  connect to switch by regular telnet and write output to file<br/>
<img src="attachments/22885082/23036491.png" align="absmiddle" border="0"/><br/>
this is what I received<br/>
<img src="attachments/22885082/23036492.png" align="absmiddle" border="0"/></p>

<p>Maybe some bode have idea how to get this value?</p>

<p>This is log from my OpenRemote</p>

<div style="width:800px;"><div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>DEBUG 2014-03-08 16:36:36,636 (Telnet): Telnet Command: port= 2000
DEBUG 2014-03-08 16:36:36,639 (Telnet): Telnet Command: command = null|[
DEBUG 2014-03-08 16:36:36,642 (Telnet): Telnet Command: ipAddress = 192.168.1.200
DEBUG 2014-03-08 16:36:36,646 (Telnet): Telnet Command created successfully
DEBUG 2014-03-08 16:36:36,661 (Telnet): Initializing sensor for telnet protocol: Sensor (Name = 'sensor-wifi-status', ID = '104', State Mappings: {null=OFF, *=ON})
DEBUG 2014-03-08 16:36:36,686 (Telnet): Sensor thread started for sensor: Sensor (Name = 'sensor-wifi-status', ID = '104', State Mappings:{null=OFF, *=ON})
DEBUG 2014-03-08 16:36:36,689 (Telnet): Executing status command for sensor: Sensor (Name = 'sensor-wifi-status', ID = '104', State Mappings: {null=OFF, *=ON})
INFO 2014-03-08 16:36:36,736 (Telnet): send: [
INFO 2014-03-08 16:36:37,750 (Telnet): received: *HELLO*
DEBUG 2014-03-08 16:36:37,767 (Telnet): Telnet status command received value: *HELLO*
</pre>
</div></div></div>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036489.jpg">Lazybone%20command-2.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036490.jpg">Lazybonecommand-2.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036491.png">telnet.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036492.png">telnet-output.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036508.jpg">OR GetRelayStates.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036510.png">OR GRP Script.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036509.png">OR GRP Script.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036540.png">1_script.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036541.png">2_script.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036542.png">3_script.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036543.png">4_script.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036544.png">5_script.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036545.png">6_script.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036546.png">7_script.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036547.png">8_script.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036558.jpg">Untitled-1 copy.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036559.jpg">Untitled-2 copy.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22885082/23036560.jpg">Untitled-3 copy.jpg</a> (image/jpeg)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-22885232"></a>
                                    <font class="smallfont"><p>Hi Guys<br/>
Maybe someone can direct me where to look?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by igorvin at Mar 13, 2014 21:21
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22885274"></a>
                                    <font class="smallfont"><p>I am using a tosr0x 2-relay module from tinyosshop to control a window shade and I am now in the process of using a LazyBone to implement a thermostat. I am running OR controller on a rPi which communicates with the relay modules through WIFI.</p>

<p>I faced the same problem that you describe. I have been able to control the relay states to ON/OFF through TCP/IP protocol but I have not been able to read the status of the relays. I have tryed telnet and TCP/IP protocols. I have also tryed different versions of the OR controller.</p>

<p>In theory when you connect to the relay module and you send the '[' command you should get an answer that is '&#42;HELLO&#42;' followed with a character, that in the case of a LazyBone (module with only 1 relay), should be either 0x01 or 0x02. In theory it should be possible to receive and filter this response through a custom sensor and a regex. But I didnÂ´t succeed. Without filtering the response I was able to see the relay module's prompt on OR mobile application, but only sometimes. Most of the times I would get a 'NA'</p>

<p>The solution that I have implemented is to use shell execution protocol instead of TCP/IP. Then I execute a Python script that sends the '[' command to the relay module and converts the 0x00 or 0x01 response into the desired format to feed a sensor.</p>

<p>This is the command:</p>

<p><img src="attachments/22885082/23036508.jpg" align="absmiddle" border="0"/></p>

<p>This is the simple python script:</p>

<p><img src="attachments/22885082/23036509.png" align="absmiddle" border="0"/></p>

<p>And this is the library that I am using<br/>
(I found a library to control those relays through serial and I extended it to control them through wifi)</p>

<p><a href="https://github.com/alexroche/tosr0x.git">https://github.com/alexroche/tosr0x.git</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by alexroche at Mar 15, 2014 13:20
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22885281"></a>
                                    <font class="smallfont"><p>Dear Alex,</p>

<p>Thank you very much for excelent explanation of solution<br/>
I'm realy happy that I not alone with my problem<br/>
This week I will be out of my house and unable to check your solution<br/>
But when I'll come back, I write you  if I successfull to get switch status</p>

<p>Thank you again and Best regards,</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by igorvin at Mar 15, 2014 15:28
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22885580"></a>
                                    <font class="smallfont"><p>Hello,</p>

<p>After few days of playing with the system I want to write some tips that can help to everybody who want to configure Lazybone Wi-Fi switch.<br/>
After Alex's help I successfully received status of switch with python script.</p>

<p>This is steps what you need to perform for configure script and successfully receive switch status<br/>
1.Download tosr0x library from site <a href="https://github.com/alexroche/tosr0x">https://github.com/alexroche/tosr0x</a>  and install it following instruction on the site.<br/>
2.If you run this library on Raspberry you will receive error message about serial port because it not exists.<br/>
To solve this problem you need comment line "import serial"  in file tosr0x.py<br/>
<img src="attachments/22885082/23036540.png" align="absmiddle" border="0"/></p>

<p>3. Create script GetRelaySates.py and place it to folder "/scripts/"</p>
<div style="width:800px;"><div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>
#!/usr/bin/python
# encoding=utf-8

import tosr0x

r=tosr0x.relayModule(('192.168.1.1',2000),2)
rs=r.get_relay_positions()

if (rs[1]==0):
        mode="off"
else:
        mode="on"

if (rs[2]==0):
        direction="DOWN"
else:
        direction="UP"
print mode
</pre>
</div></div></div>

<p>4.Change  script user owner</p>
<div style="width:800px;"><div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre> sudo chown pi:root /scripts/GetRelaySates.py
</pre>
</div></div></div> 
<p>5.Run this script to test if everything is OK.<br/>
You should receive status of switch</p>

<p><img src="attachments/22885082/23036541.png" align="absmiddle" border="0"/></p>

<p>Now we ready to create switch in OpenRemote designer<br/>
1. You need create command and switch like on screenshot</p>

<p><img src="attachments/22885082/23036542.png" align="absmiddle" border="0"/></p>

<p>      a.Create SW-WIFI-OFF</p>

<p><img src="attachments/22885082/23036543.png" align="absmiddle" border="0"/></p>

<p>      b.Create SW-WIFI-ON</p>

<p><img src="attachments/22885082/23036544.png" align="absmiddle" border="0"/></p>

<p>      c.Create SW-WIFI-STAT</p>

<p><img src="attachments/22885082/23036545.png" align="absmiddle" border="0"/></p>

<p>      d.Create new sensor - sensor-wifi-stat</p>

<p><img src="attachments/22885082/23036546.png" align="absmiddle" border="0"/></p>

<p>      e.Create new switch- WIFI-SW</p>

<p><img src="attachments/22885082/23036547.png" align="absmiddle" border="0"/></p>

<p>If all steps was created successfully , you can start create switch on panel</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by igorvin at Mar 29, 2014 14:00
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22885597"></a>
                                    <font class="smallfont"><p>Hi guys I've been looking for a wifi switch and the lazybone one looks quite interesting - couple of questions for you -<br/>
what is the range like or is there a way to add an aerial to increase range?</p>

<p>I have a spare pi which could be used for the script but my live OR environment is Windows XP. Could I either call the script on the pi from XP or would it be easy to get the script to run under XP?</p>

<p>Jules</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jules_bike at Mar 30, 2014 17:27
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22885625"></a>
                                    <font class="smallfont"><p>Hi Jules </p>

<p>I am using this switch in my house, and it working good with range 3-5 meter from the router<br/>
Not sure if you can add aerial to the switch <br/>
External antenna connector not exist</p>

<p>About python script- you can run python script on Windows XP, but not sure if you can install tos0rx library on Windows.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by igorvin at Apr 01, 2014 22:13
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22886001"></a>
                                    <font class="smallfont"><p>this is how I made it work in OR:<br/>
fist setup lazybone as per lazybone instructions for Android device<br/>
then setup OR like this:</p>

<p><img src="attachments/22885082/23036558.jpg" align="left" border="0"/></p>

<p><img src="attachments/22885082/23036559.jpg" align="left" border="0"/></p>

<p><img src="attachments/22885082/23036560.jpg" align="left" border="0"/></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hesseh at Apr 20, 2014 22:33
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:37</font></td>
		    </tr>
	    </table>
    </body>
</html>