<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Transmission succeeds only once with TCP-IP</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Transmission succeeds only once with TCP-IP
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Oct 27, 2010 by <font color="#0050B2">freijon</font>.
				    </div>

				    <p>Hey there,</p>

<p>I'm trying to control a machine with a Smartphone. I've created a panel with the designer with a button, which should send a command "test" via TCP/IP to an address. <br/>
The command is being transmitted when I click the button for the first time. After that, the Controller throws an exception every time i click the button on the smartphone.</p>

<p>Here is the exception:</p>

<p>Controller2010-10-27 11:17:33,234 ERROR HTTP\-Thread\-2 org.openremote.controller.protocol.socket.TCPSocketCommand.requestSocket(151) | Socket event could not execute<br/>
java.net.ConnectException: Connection refused<br/>
	at java.net.PlainSocketImpl.socketConnect(Native Method)<br/>
	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:310)<br/>
	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:176)<br/>
	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:163)<br/>
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:384)<br/>
	at java.net.Socket.connect(Socket.java:546)<br/>
	at java.net.Socket.connect(Socket.java:495)<br/>
	at java.net.Socket.&lt;init&gt;(Socket.java:392)<br/>
	at java.net.Socket.&lt;init&gt;(Socket.java:206)<br/>
	at org.openremote.controller.protocol.socket.TCPSocketCommand.requestSocket(TCPSocketCommand.java:138)<br/>
	at org.openremote.controller.protocol.socket.TCPSocketCommand.send(TCPSocketCommand.java:132)<br/>
	at org.openremote.controller.service.impl.ControlCommandServiceImpl.trigger(ControlCommandServiceImpl.java:56)<br/>
	at org.openremote.controller.rest.ControlCommandRESTServlet.doPost(ControlCommandRESTServlet.java:76)<br/>
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:637)<br/>
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:78)<br/>
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:77)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)<br/>
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)<br/>
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)<br/>
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)<br/>
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)<br/>
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:286)<br/>
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:845)<br/>
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)<br/>
	at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:354)<br/>
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)<br/>
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)<br/>
	at java.lang.Thread.run(Thread.java:636)</p>

<p>I've tried it on various machines with different installations (windows, linux). It's always the same behaviour.<br/>
How do I fix this?</p>

<p>Thanks in advance<br/>
Jonas</p>

				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-12846938"></a>
                                    <font class="smallfont"><p>Thanks for the report Jonas. Haven't seen this issue before.</p>

<p>I'll be going through all the protocol implementations, especially to test them against error conditions so we're able to analyze such issues better (and adding bunch of other features people already asked earlier).</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Oct 27, 2010 12:09
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12846940"></a>
                                    <font class="smallfont"><p>wouldn't this depend on the target hardware?  What is the hardware you are trying to open a socket connection to? but yeah, in the abstract, taking care that all connections are closed etc may be a good thing to do in case the target hardware just supports one connection at a time. </p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by marcf at Oct 27, 2010 13:22
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12846941"></a>
                                    <font class="smallfont"><p>You are quite possibly right, the "Connection Refused" does hint in that direction. It could be a protocol issue (Jonas, maybe you need to "end" the session in your protocol).</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Oct 27, 2010 13:47
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12847051"></a>
                                    <font class="smallfont"><p>I'm listening with "netcat" on the other end, because I need the command to be converted to serial RS232 protocol. I use "netcat -l -k PORT &gt; /dev/ttyS0 &amp;", which keeps the listening-process alive forever. Your solution would be to restart netcat after every command, is that correct?</p>

<p>I decided to write an app on my own, because I also need to be able to transfer files, which doesn't seem to be possible with OpenRemote.</p>

<p>Thanks anyway!</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by freijon at Nov 03, 2010 16:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12847057"></a>
                                    <font class="smallfont"><p>Well... in the plugins you can do pretty much whatever you want!  once it is triggered if you want to upload a file that is really up to you and quite trivial to code in java/OR</p>

<p>With respect to netcat, yeah that could very well be it.  In that case if you are just trying to convert to RS232, you can receive the command parse it and copy/paste the RS232 code... it would be a bit of work but nothing too much.  Are you fluent in java or not? If yes, this would be straight forward and if no then it would be a good crash course.  We could help you with it. </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by marcf at Nov 04, 2010 10:19
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 11:02</font></td>
		    </tr>
	    </table>
    </body>
</html>