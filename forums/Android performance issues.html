<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Android performance issues</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Android performance issues
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Sep 08, 2010 by <font color="#0050B2">mgallissot</font>.
				    </div>

				    <p>Hello All,</p>

<p>I've been testing the latest version of OR (v2), using the BOSS controller and an Android.</p>

<p>Strangly, my Android gets very slow while openning panel. In fact, I just have on panel, with a sensored switch, and one image, depending on the same sensor. Even not doing anything, I've got an amazing 10s delay for any reaction.<br/>
My Android version is 1.6.</p>

<p>Is it possible it is due to the polling ? When my panel is not sensored, things are getting much better.</p>

<p>Cheers,</p>

<p>Mathieu</p>

				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-12845173"></a>
                                    <font class="smallfont"><p>Haven't tried this on hardware yet.. didn't notice anything particularly suspicious when trying this on an emulator.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by admin at Sep 10, 2010 00:55
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12845174"></a>
                                    <font class="smallfont"><p>One thing I did notice though that even on emulator, SDK 2.2 is noticeably faster than 1.5 and is not eating CPU the same way &#8211; not sure if that is reflected on actual hardware.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Sep 10, 2010 01:25
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12845176"></a>
                                    <font class="smallfont"><p>In Android 2.2 Froyo there is a JIT (Just-In-Time) Compiler. Google says 2.2 is up to 5 times faster than 2.1.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mishoboss at Sep 10, 2010 11:52
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12845177"></a>
                                    <font class="smallfont"><p>Ahh, JIT would definitely explain it.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Sep 10, 2010 12:10
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12845178"></a>
                                    <font class="smallfont"><p>So there's at least one test run on HTC Tattoo which is Android OS 1.6, and no report on such performance issue (10s delays)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by admin at Sep 10, 2010 17:04
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12845179"></a>
                                    <font class="smallfont"><p>I just tried this with the old Google Dev Phone 1 with Android 1.5 installed &#8211; the app is quite responsive (even more so than using the emulator) and had no issues with KNX update polling.</p>

<p>I can try with Android 1.6 also but would be surprised if it gets worse going forwards. So might need some other info about your device &#8211; hardware, vendor, what kind of UI design did you use, which protocol, etc?</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by admin at Sep 10, 2010 22:03
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12845283"></a>
                                    <font class="smallfont"><p>I can't find the damn log going with it, as last time it ended up crashing. I'm using an X10 Mini from Sony Ericsson, thus, it is possible the problem is on the protocol since I was trying a very beta UPnP bidirectionnal implementation...<br/>
Could it be XML errors or a to high frequency for polling (like if new statues was available each time the console is sending a request ?)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mgallissot at Sep 14, 2010 12:53
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12845287"></a>
                                    <font class="smallfont"><p>I haven't been able to reproduce this yet on 3 different hardware we've tried the app on (Android 1.5, 1.6 and 2.1) &#8211; so it would seem that it can be something configuration specific.</p>

<p>At some point we need to increase these types of stress/network testing for the Android device (the SDK seems to have some tools to do it with software) but I'm unlikely to have time to do this at least for another 2 weeks.</p>

<p>If you're able to discover anything more about it (e.g. narrow it down to as minimal as possible panel/controller XML config) then let us know.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Sep 15, 2010 12:47
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12845291"></a>
                                    <font class="smallfont"><p>Polling is logging to "POLLING" category, little inconvenient that there isn't an OpenRemote prefix for all our logging categories, they get lost in with the rest of the noise, will look to fixing that... but you can filter adb logcat</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Sep 16, 2010 02:04
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12845292"></a>
                                    <font class="smallfont"><p>yeah actually it could, the while loop looks a bit suspect &#8211; I didn't analyze the code, just a quick read, head over to PollingHelper.java and check your phone logs... you will notice if it fails to protect itself from an over-eager sensor.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
   /**
    * Request current status and start polling.
    */
   <span class="code-keyword">public</span> void requestCurrentStatusAndStartPolling() {
      HttpParams params = <span class="code-keyword">new</span> BasicHttpParams();
      HttpConnectionParams.setConnectionTimeout(params, 50 * 1000);
      
      <span class="code-comment">//make polling socket timout bigger than Controller (50s)
</span>      HttpConnectionParams.setSoTimeout(params, 55 * 1000);
      
      client = <span class="code-keyword">new</span> DefaultHttpClient(params);
      <span class="code-keyword">if</span> (isPolling) {
         <span class="code-keyword">return</span>;
      }
      
      <span class="code-keyword">try</span> {
         URL uri = <span class="code-keyword">new</span> URL(serverUrl);
         <span class="code-keyword">if</span> (<span class="code-quote">"https"</span>.equals(uri.getProtocol())) {
            Scheme sch = <span class="code-keyword">new</span> Scheme(uri.getProtocol(), <span class="code-keyword">new</span> SelfCertificateSSLSocketFactory(), uri.getPort());
            client.getConnectionManager().getSchemeRegistry().register(sch);
         }
      } <span class="code-keyword">catch</span> (MalformedURLException e) {
         Log.e(<span class="code-quote">"POLLING"</span>, <span class="code-quote">"Create URL fail:"</span> + serverUrl);
      }
      isPolling = <span class="code-keyword">true</span>;
      handleRequest(serverUrl + <span class="code-quote">"/<span class="code-keyword">rest</span>/status/"</span> + pollingStatusIds);
      <span class="code-keyword">while</span> (isPolling) {
         doPolling();
      }
   }
</pre>
</div></div>

<p>Not saying it's necessarily there but you wanna drill into that.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Sep 16, 2010 02:11
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:29</font></td>
		    </tr>
	    </table>
    </body>
</html>