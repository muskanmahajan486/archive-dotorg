<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Marantz amp TCP IP control issue</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Marantz amp TCP IP control issue
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 24, 2015 by <font color="#0050B2">baloutre</font>.
				    </div>

				    <p>Hi everybody,</p>

<p>I've got some problems controlling my Marantz NR1602 receiver with OR, installed on my NAS, 2.1 version.<br/>
I use TCP/IP protocol on port 23, as there is no telnet on the designer.<br/>
Every single commande works fine, volume, source switching, tuner preset... But when i use macro for in example, switching to tuner, and chose a preset, the control get stuck!<br/>
I tried with a time delay of 1000ms between commands without success. I have to re-power the amp, or send an ir command via the remote control to "restore" the TCP control.<br/>
After few tests, i see that if i'm already in tuner mode, and press tuner again, it is stuck. Sensor are also buggy.<br/>
One thing i know about IP control of marantz receiver is that it allows only one connection at a time.</p>

<p>Any idea of what i could try?</p>

<p>I read some post on the forum about marantz control, OR pro version has integration of it, and i read that integration in the free version was in the pipeline, is it for soon?</p>


<p>Thanks for your help!</p>




<p>PS here are the terminal logs when i use my mac as controller (same problems)</p>

<p>ERROR HTTP\-Thread\-3: SocketCommand could not execute<br/>
java.net.ConnectException: Connection refused<br/>
	at java.net.PlainSocketImpl.socketConnect(Native Method)<br/>
	at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:382)<br/>
	at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:241)<br/>
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:228)<br/>
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:431)<br/>
	at java.net.Socket.connect(Socket.java:527)<br/>
	at java.net.Socket.connect(Socket.java:476)<br/>
	at java.net.Socket.&lt;init&gt;(Socket.java:373)<br/>
	at java.net.Socket.&lt;init&gt;(Socket.java:187)<br/>
	at org.openremote.controller.protocol.socket.TCPSocketCommand.requestSocket(TCPSocketCommand.java:162)<br/>
	at org.openremote.controller.protocol.socket.TCPSocketCommand.send(TCPSocketCommand.java:156)<br/>
	at org.openremote.controller.service.impl.ControlCommandServiceImpl.trigger(ControlCommandServiceImpl.java:95)<br/>
	at org.openremote.controller.rest.ControlCommandRESTServlet.handleRequest(ControlCommandRESTServlet.java:77)<br/>
	at org.openremote.controller.rest.RESTAPI.doPost(RESTAPI.java:159)<br/>
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:637)<br/>
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at org.openremote.controller.rest.support.json.JSONCallbackFilter.doFilter(JSONCallbackFilter.java:63)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:78)<br/>
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:77)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)<br/>
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)<br/>
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)<br/>
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)<br/>
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)<br/>
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:286)<br/>
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:845)<br/>
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)<br/>
	at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:354)<br/>
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)<br/>
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)<br/>
	at java.lang.Thread.run(Thread.java:695)</p>


				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-23595645"></a>
                                    <font class="smallfont"><p>Other tests i made this evening; i used the DataViewer software provided by Extron to send command to the receiver, it is a visual interface with command and response windows, it allows to create shortcuts to send commands. When i send multiple commands as fast as i can, every command is executed with its appropriate response...</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by baloutre at Jan 20, 2015 20:07
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23595827"></a>
                                    <font class="smallfont"><p>The TCP command always creates a new socket which could be the problem. Although I am surprised that single commands work since the macro only executes single commands.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jan 24, 2015 17:00
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23595840"></a>
                                    <font class="smallfont"><p>Thanks Marcus for your reply!<br/>
More tests and i realize that it is not the macro that causes issue, it is only when i.e. i send the tuner input command, and i'm already in tuner input.<br/>
I use the macros to have TV and radio presets without need to manually choose the input source. So if i listen to radio preset 1 and want to listen preset 2, the macro sends tuner input then pst 2, but control is stuck before pst 2 because i'm already in tuner input.</p>

<p>With Extron DataViewer if i send the same commands X times it still works, but i think this software open the socket and maintain it since i disconnect.</p>

<p>Is it possible with OR to open a socket and maintain the connection? How do the marantz protocol works with the pro licence?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by baloutre at Jan 24, 2015 21:19
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23595844"></a>
                                    <font class="smallfont"><p>The marantz protocol does use a single connection.<br/>
The current socket command does not support a single connection.<br/>
The code for the marantz is publicly available in the svn repo. I will check why this is not in free version.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jan 24, 2015 22:33
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23595854"></a>
                                    <font class="smallfont"><p>I think you can also use http-commands on port 80. You can easily compile long macros from them. I have tested these only with my denon, but denon and marantz should use same commands.</p>

<p>You could test with that example:</p>

<p><a href="http://192.168.1.102/MainZone/index.put.asp?cmd0=PutZone_OnOff%2FON&amp;cmd1=PutZone_InputFunction%2FCD&amp;cmd2=PutMasterVolumeSet/-25.0">http://192.168.1.102/MainZone/index.put.asp?cmd0=PutZone_OnOff%2FON&amp;cmd1=PutZone_InputFunction%2FCD&amp;cmd2=PutMasterVolumeSet/-25.0</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nokk3r1 at Jan 25, 2015 11:12
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23595904"></a>
                                    <font class="smallfont"><p>The marantz code will also be merged into the free version but I can't say when.<br/>
If you are familiar with java you could build a version yourself.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jan 26, 2015 21:08
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23596092"></a>
                                    <font class="smallfont"><p>Great it works!<br/>
HTTP protocol is hard to find as D&amp;M doesn't communicate it, do you have other commands? Did you try feedbacks/sensors?</p>

<p>Thank you for this tip!</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by baloutre at Jan 29, 2015 20:36
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23596093"></a>
                                    <font class="smallfont"><p>I am working on the HTTP protocol for my Denon X3000. I have a document in my profile that is a work in progress. Also, see my post from earlier today, regarding sensors for Denon. </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by desertdog at Jan 29, 2015 21:02
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23596109"></a>
                                    <font class="smallfont"><p>You could try with ip address of the amp with your regular browser. Newer models serve also web page for controlling it. From there you can look commands from page source. If I remember correctly, I have collected all commands to one file, but as I'm not at home for weekend, I can't provide them before next week. Also Jack has provided great post about sensors with denon.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nokk3r1 at Jan 30, 2015 06:41
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23596149"></a>
                                    <font class="smallfont"><p>Jussi,</p>

<p>Could I trouble you for the http command just to turn the amplifier on? I've looked at the web client but can't figure out the correct http command.</p>

<p>Thanks in advance!</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kannang at Jan 31, 2015 15:38
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23596189"></a>
                                    <font class="smallfont"><p>Thank you jack for this! I tried many things today, commands, sensors, it works fine!</p>

<p>I'll put a little contribution on the page because for tuner or web radio preset the URL is not the same!
<a href="http://192.168.0.101/Tuner/TUNER/index.put.asp?">http://192.168.0.101/Tuner/TUNER/index.put.asp?</a> cmd0=PutTunerPreset/A2  or  <a href="http://192.168.0.101/NetAudio/index.put.asp?">http://192.168.0.101/NetAudio/index.put.asp?</a>   cmd0=PutNetAudioCommand/PresetCall02</p>

<p>I had to familiarize myself with Xpath expression, and wireshark, but thanks to google it's not so hard!</p>

<p>Thanks to all contributors off my post, hope it'll help others!!!!!!!!!</p>

<p><img class="emoticon" src="images/icons/emoticons/wink.gif" height="20" width="20" align="absmiddle" alt="" border="0"/>  Oli</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by baloutre at Jan 31, 2015 21:48
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23596194"></a>
                                    <font class="smallfont"><p>Kannan G,<br/>
Click on my name (while logged in) and you will go to my homepage. I have a document called OpenRemote 2.0 How to - Denon Http control. I have a list of http commands that I have found around the web. </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by desertdog at Jan 31, 2015 22:07
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23596197"></a>
                                    <font class="smallfont"><p>Thanks Jack! That's exactly what I was looking for. On/Off commands work great on a Marantz NR1504.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kannan_g at Feb 01, 2015 01:51
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23596240"></a>
                                    <font class="smallfont"><p>I moved the page to <a href="http://www.openremote.org/display/docs/OpenRemote+2.0+How+To+-+Denon+HTTP+Control" title="OpenRemote 2.0 How To - Denon HTTP Control">OpenRemote 2.0 How To &#45; Denon HTTP Control</a>. Feel free to edit the page.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by desertdog at Feb 01, 2015 06:55
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:37</font></td>
		    </tr>
	    </table>
    </body>
</html>