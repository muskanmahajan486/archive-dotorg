<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Problems with Rules</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Problems with Rules
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Nov 23, 2013 by <font color="#0050B2">bayram</font>.
				    </div>

				    <p>Hi,</p>

<p>first I want to thank the Openremote team for all your work.</p>

<p>I'am a beginner and use openremote for my KNX. Everthing work great. I have creat a panel for my iphone with my commands. I use makros allso. <br/>
Now I wankt to test the Rules but it don´t work.</p>

<p>I use the<br/>
Scheduled Rule Example for my test i creat a makro like that one in the example "All Lights OFF" and test it positiv on my panel.</p>

<p>I copy the example in the rule editor an sync with controller. I find the rule in the modeler_rules.drl.<br/>
I only change the time in cron like. but nothing happens.  </p>

<p>package org.openremote.controller.protocol</p>

<p>global org.openremote.controller.statuscache.CommandFacade execute;<br/>
global org.openremote.controller.statuscache.SwitchFacade switches;</p>

<p>rule "Lights off at 22:45"</p>

<p>  timer (cron: 0 45 22 * * ?) when eval (true) then</p>

<p>  execute.command("All Lights OFF"); </p>

<p>end</p>


<p>my cmd</p>


<p>C:\OR\bin&gt;openremote run<br/>
Using CATALINA_BASE:   C:\OR<br/>
Using CATALINA_HOME:   C:\OR<br/>
Using CATALINA_TMPDIR: C:\OR\temp<br/>
Using JRE_HOME:        C:\Program Files\Java\jdk1.6.0_45<br/>
23.11.2013 01:08:27 org.apache.catalina.core.AprLifecycleListener init<br/>
INFO: The APR based Apache Tomcat Native library which allows optimal performanc<br/>
e in production environments was not found on the java.library.path: C:\OR\webap<br/>
ps\controller\WEB-INF\lib\native<br/>
23.11.2013 01:08:28 org.apache.coyote.http11.Http11Protocol init<br/>
INFO: Initializing Coyote HTTP/1.1 on http-8080<br/>
23.11.2013 01:08:28 org.apache.catalina.startup.Catalina load<br/>
INFO: Initialization processed in 2880 ms<br/>
23.11.2013 01:08:28 org.apache.catalina.core.StandardService start<br/>
INFO: Starting service Catalina<br/>
23.11.2013 01:08:28 org.apache.catalina.core.StandardEngine start<br/>
INFO: Starting Servlet Engine: Apache Tomcat/6.0.18<br/>
23.11.2013 01:08:28 org.apache.catalina.startup.HostConfig deployWAR<br/>
INFO: Deploying web application archive webconsole.war<br/>
23.11.2013 01:08:34 org.openremote.controller.bootstrap.Startup redirectJULtoLog<br/>
4j<br/>
INFO: Initialized JUL to LOG4J Redirector.<br/>
INFO 2013-11-23 01:08:55,251 :</p>

<p>--------------------------------------------------------------------</p>

<p>  DEPLOYING NEW CONTROLLER RUNTIME...</p>

<p>--------------------------------------------------------------------</p>



<p>*****************************************************************</p>

<p>  The license restrictions Sigma Designs places on Z-Wave<br/>
  implementations prevents us from distributing Z-Wave with<br/>
  an Open Source product.</p>

<p>  To test Z-Wave, download a freely available binary from<br/>
  <a href="http://download.openremote.org/free/zwave">http://download.openremote.org/free/zwave</a> and follow the<br/>
  installation instructions at <a href="http://www.openremote.org/x/xAo4AQ">http://www.openremote.org/x/xAo4AQ</a></p>

<p>*****************************************************************</p>


<p>INFO 2013-11-23 01:09:12,224 : Initialized event processor : Drools Rule Engine<br/>
INFO 2013-11-23 01:09:12,552 : Initialized event processor : RRD4J Data Logger<br/>
INFO 2013-11-23 01:09:12,567 : Initialized event processor : EmonCMS Data Logger</p>

<p>INFO 2013-11-23 01:09:15,594 : Registered sensor : Switch Sensor (Name = 'Kueche<br/>
 Dunsthaube', ID = '1001')<br/>
INFO 2013-11-23 01:09:15,625 : Registered sensor : Switch Sensor (Name = 'Dachge<br/>
scho▀ Decke', ID = '702')<br/>
INFO 2013-11-23 01:09:15,640 : Registered sensor : Switch Sensor (Name = 'Kind2<br/>
Decke', ID = '703')<br/>
INFO 2013-11-23 01:09:15,656 : Registered sensor : Level Sensor (Name = 'Essen E<br/>
sstisch', ID = '1003', Min: 0, Max: 100)<br/>
INFO 2013-11-23 01:09:15,703 : Registered sensor : Switch Sensor (Name = 'Kueche<br/>
 Esstisch', ID = '700')<br/>
INFO 2013-11-23 01:09:15,734 : Registered sensor : Switch Sensor (Name = 'Kueche<br/>
 Decke', ID = '701')<br/>
INFO 2013-11-23 01:09:15,765 : Registered sensor : Switch Sensor (Name = 'GWC De<br/>
cke', ID = '698')<br/>
INFO 2013-11-23 01:09:15,781 : Registered sensor : Switch Sensor (Name = 'Diele<br/>
Decke', ID = '699')<br/>
INFO 2013-11-23 01:09:15,796 : Registered sensor : Switch Sensor (Name = 'Essen<br/>
Esstisch', ID = '696')<br/>
INFO 2013-11-23 01:09:15,828 : Registered sensor : Switch Sensor (Name = 'Bad De<br/>
cke', ID = '697')<br/>
INFO 2013-11-23 01:09:15,859 : Registered sensor : Switch Sensor (Name = 'Bad OG<br/>
 Spiegel', ID = '993')<br/>
INFO 2013-11-23 01:09:15,874 : Registered sensor : Switch Sensor (Name = 'Schlaf<br/>
en Decke', ID = '694')<br/>
INFO 2013-11-23 01:09:15,906 : Registered sensor : Switch Sensor (Name = 'Anklei<br/>
de Decke', ID = '695')<br/>
INFO 2013-11-23 01:09:15,921 : Registered sensor : Switch Sensor (Name = 'GWC Fe<br/>
sntersteckdose', ID = '995')<br/>
INFO 2013-11-23 01:09:15,952 : Registered sensor : Switch Sensor (Name = 'HWR De<br/>
cke', ID = '692')<br/>
INFO 2013-11-23 01:09:15,984 : Registered sensor : Switch Sensor (Name = 'Garage<br/>
 Decke', ID = '693')<br/>
INFO 2013-11-23 01:09:15,999 : Registered sensor : Switch Sensor (Name = 'GWC Sp<br/>
iegel', ID = '997')<br/>
INFO 2013-11-23 01:09:16,015 : Registered sensor : Switch Sensor (Name = 'Flur O<br/>
G Decke', ID = '690')<br/>
INFO 2013-11-23 01:09:16,046 : Registered sensor : Switch Sensor (Name = 'Buero<br/>
Decke', ID = '691')<br/>
INFO 2013-11-23 01:09:16,077 : Registered sensor : Switch Sensor (Name = 'Kueche<br/>
 Backofen', ID = '999')<br/>
INFO 2013-11-23 01:09:16,108 : Registered sensor : Switch Sensor (Name = 'Gesimm<br/>
s vorne', ID = '689')<br/>
INFO 2013-11-23 01:09:16,124 : Registered sensor : Switch Sensor (Name = 'Kueche<br/>
 Mikrowelle', ID = '987')<br/>
INFO 2013-11-23 01:09:16,155 : Registered sensor : Switch Sensor (Name = 'Terras<br/>
se OG Gesimms vorne', ID = '985')<br/>
INFO 2013-11-23 01:09:16,171 : Registered sensor : Switch Sensor (Name = 'Wohnen<br/>
 Couchtisch', ID = '991')<br/>
INFO 2013-11-23 01:09:16,202 : Registered sensor : Switch Sensor (Name = 'Kueche<br/>
 indirekt', ID = '989')<br/>
INFO 2013-11-23 01:09:16,218 : Registered sensor : Switch Sensor (Name = 'Kueche<br/>
-in', ID = '705')<br/>
INFO 2013-11-23 01:09:16,249 : Registered sensor : Switch Sensor (Name = 'Kind1<br/>
Decke', ID = '704')<br/>
INFO 2013-11-23 01:09:16,264 : Registered sensor : Switch Sensor (Name = 'HWR WM<br/>
', ID = '979')<br/>
INFO 2013-11-23 01:09:16,280 : Registered sensor : Level Sensor (Name = 'Essen E<br/>
sstisch SDL', ID = '707', Min: 0, Max: 100)<br/>
INFO 2013-11-23 01:09:16,311 : Registered sensor : Switch Sensor (Name = 'Terras<br/>
se OG Steckdose', ID = '706')<br/>
INFO 2013-11-23 01:09:16,342 : Registered sensor : Switch Sensor (Name = 'HWR Fe<br/>
sntersteckdose', ID = '977')<br/>
INFO 2013-11-23 01:09:16,374 : Registered sensor : Switch Sensor (Name = 'Terras<br/>
se OG Gesimms hinten', ID = '983')<br/>
INFO 2013-11-23 01:09:16,405 : Registered sensor : Switch Sensor (Name = 'HWR Tr<br/>
ockner', ID = '981')<br/>
INFO 2013-11-23 01:09:16,420 : Registered sensor : Switch Sensor (Name = 'Gast F<br/>
esntersteckdose', ID = '975')<br/>
INFO 2013-11-23 01:09:16,452 : Registered sensor : Switch Sensor (Name = 'Flur F<br/>
esntersteckdose', ID = '973')<br/>
INFO 2013-11-23 01:09:16,498 : Startup complete.<br/>
INFO 2013-11-23 01:09:16,514 : Controller Definition File Watcher for Default De<br/>
ployer started.<br/>
23.11.2013 01:09:17 org.apache.coyote.http11.Http11Protocol start<br/>
INFO: Starting Coyote HTTP/1.1 on http-8080<br/>
23.11.2013 01:09:17 org.apache.catalina.startup.Catalina start<br/>
INFO: Server startup in 49621 ms</p>



<p>Thank you for your support</p>

				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-22880197"></a>
                                    <font class="smallfont"><p>Unfortunately rules can not activate macros. Macros only exist in designer. If you bind a macro to a button, the designer takes care of binding all individual commands and wait period to that button. </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Nov 23, 2013 08:41
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22880301"></a>
                                    <font class="smallfont"><p>Thanks for your help, but i tried it with a command from the desinger and still nothing happens on 23:20. My command is:</p>

<p>package org.openremote.controller.protocol</p>

<p>global org.openremote.controller.statuscache.CommandFacade execute;<br/>
global org.openremote.controller.statuscache.SwitchFacade switches;</p>

<p>rule "Büro Licht off at 22:40"</p>

<p>  timer (cron: 0 20 23 * * ?) when eval (true) then</p>

<p>  execute.command("Kueche-in-on_L");</p>

<p>end</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by bayram at Nov 25, 2013 22:21
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22880308"></a>
                                    <font class="smallfont"><p>"timer" keyword should appear after "when".</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by atamariya at Nov 26, 2013 03:36
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22880310"></a>
                                    <font class="smallfont"><p>Are you sure about this "when"? <a href="http://www.openremote.org/display/docs/Designer+2.0+-+Controller+Rules#Designer2.0-ControllerRules-TimerExample">The Scheduled Rule Example in the HowTo</a> suggests his syntax is correct.<br/>
I suspect there is something wrong with "Kueche-in-on_L". A typo perhaps? Or the umlaut in the rule name?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Nov 26, 2013 07:42
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22880312"></a>
                                    <font class="smallfont"><p>No, timer should be used before when.</p>

<p>My tip why the rule is not working are typos in "Keuche-in-on_L" string not matching the command name or umlaut in rule naming.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aktur at Nov 26, 2013 08:50
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22880371"></a>
                                    <font class="smallfont"><p>I stand corrected.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by atamariya at Nov 27, 2013 04:31
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22880464"></a>
                                    <font class="smallfont"><p>Thank you all for your help.</p>

<p>Now it works yeehr! I had some problems with rules editor. When i submit the rule to the modeler_rules.drl, the modeler_rules.drl<br/>
don´t get the neu content. I don´t know why but now it works.</p>

<p>cu bayram from Germany</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by bayram at Nov 28, 2013 18:33
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:38</font></td>
		    </tr>
	    </table>
    </body>
</html>