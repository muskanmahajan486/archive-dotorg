<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Adding a new Protocol to Designer</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Adding a new Protocol to Designer
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Dec 19, 2012 by <font color="#0050B2">jwhitmore</font>.
				    </div>

				    <p>I've been away from this for a while other stuff got in the way. Previously I wrote a new protocol into the Controller for USB based boards but I wanted to add the protocol into the Designer. To do that I was trying to run the designer locally so that I could make changes and test them out. That's where I fell flat on my face.</p>

<p>Could anybody point me in the direction of running the Designer locally to design a new protocol and test? There are instruction on adding a protocol but not on how to test it locally.</p>

<p>Thanks for any help</p>

				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-21038863"></a>
                                    <font class="smallfont"><p>You need a local MySQL database, the designer source and the beehive source.<br/>
Calling "ant war" on designer and beehive project should give you 2 war files.<br/>
You can deploy those in tomcat and later have to edit the config.properties to point to your database.</p>

<p>For Beehive this should be the latest src: <a href="http://openremote.svn.sourceforge.net/viewvc/openremote/tags/project/Beehive/Beehive_3_0_0_Beta1/">http://openremote.svn.sourceforge.net/viewvc/openremote/tags/project/Beehive/Beehive_3_0_0_Beta1/</a><br/>
And the Designer: <a href="http://openremote.svn.sourceforge.net/viewvc/openremote/tags/project/Designer/Designer_2_13_6_Rosemary_20120920/">http://openremote.svn.sourceforge.net/viewvc/openremote/tags/project/Designer/Designer_2_13_6_Rosemary_20120920/</a></p>

<p>To have support for a protocol in the designer you just need to create a xml file and drop that into the protocols folder.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Dec 20, 2012 08:08
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21038909"></a>
                                    <font class="smallfont"><p>Thanks Marcus,<br/>
    I'm afraid that it's not plain sailing here. I was trying to checkout code but I keep getting a relocate error from Subversion. Been a while since I used it but searching the Internet for a reason and all I can get is that it's a server error. I assume that it's not a server error as other people would be seeing the problem.</p>

<p>svn list <a href="http://openremote.svn.sourceforge.net/viewvc/openremote/workspace">http://openremote.svn.sourceforge.net/viewvc/openremote/workspace</a></p>

<p>svn: Repository moved temporarily to 'http://openremote.svn.sourceforge.net/viewvc/openremote/workspace'; please relocate</p>

<p>Could you help me out with this svn issue?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by johnwhitmore at Dec 21, 2012 05:25
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21038910"></a>
                                    <font class="smallfont"><p>Sorry, the URL I gave you is for the webviewer. <br/>
The main repository URL is: <a href="https://openremote.svn.sourceforge.net/svnroot/openremote">https://openremote.svn.sourceforge.net/svnroot/openremote</a> </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Dec 21, 2012 08:03
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21038964"></a>
                                    <font class="smallfont"><p>Thanks for all your help Marcus. Unfortunately I have one final question which should keep me busy for the holidays. </p>

<p>I worked through the readme file for Beehive, created a mysql database and user, populated the database, built beehive to obtain the war file. I have a huge hole in my knowledge as I've no idea what to do with the war file. So my question is do I need a book on Tomcat? Or should I be looking at more general intro to web apps or something?</p>

<p>One other thing the readme suggested editing the quartz timer file but I looked at it and was not sure what was meant to be edited and why, so I left it.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by johnwhitmore at Dec 21, 2012 20:35
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21038966"></a>
                                    <font class="smallfont"><p>The war file should just be dropped into the webapps folder of a tomcat installation.<br/>
It then will be unpacked and a folder with the same name will appear. Within that folder you can edit the file "WEB-INF/classes/config.properties" to change your db setting.<br/>
I don't know of any quartz timer. That can probably be ignored.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Dec 21, 2012 20:51
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21039040"></a>
                                    <font class="smallfont"><p>Thanks Marcus and Merry Christmas to you.<br/>
   I did change my DB settings and put the resulting war in my tomcat install but I wasn't getting anything out of 127.0.0.1:8080 and I'd half expected something which was why I asked the question. I'll find out where the tomcat log messages are going to and see if that sheds any light on it. </p>

<p>My Beehive install might actually be working correctly, but I've no evidence that anything is happening at all, so was looking for reassurance. Given that beehive is a DB I should go ahead and install the Designer and see if it complains about it. Wanted to verify the step but I'll move on.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by johnwhitmore at Dec 24, 2012 20:03
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21039046"></a>
                                    <font class="smallfont"><p>Once beehive is deployed you should see a page at localhost:8080/beehive.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Dec 24, 2012 23:53
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21039290"></a>
                                    <font class="smallfont"><p>Sorry Marcus, it's all coming back to me now why I got the Controller done but never contributed it back to OR. The Designer side is a bit of a learning curve. I know all you have to do is add an xml file but it's getting to that point.</p>

<p>Chasing an error from my beehive install so I'll chase that down and get back on track then:</p>

<p>03-Jan-2013 12:40:46 org.apache.catalina.core.StandardContext start<br/>
SEVERE: Error listenerStart<br/>
03-Jan-2013 12:40:46 org.apache.catalina.core.StandardContext start<br/>
SEVERE: Context <span class="error">&#91;/beehive&#93;</span> startup failed due to previous errors<br/>
03-Jan-2013 12:40:46 org.apache.catalina.loader.WebappClassLoader clearReferencesJdbc<br/>
SEVERE: The web application <span class="error">&#91;/beehive&#93;</span> registered the JDBC driver com.mysql.jdbc.Driver but failed to unregister it when the web application was stopped. To prevent a memory leak, the JDBC Driver has been forcibly unregistered.<br/>
03-Jan-2013 12:40:46 org.apache.catalina.loader.WebappClassLoader clearReferencesThreads<br/>
SEVERE: The web application <span class="error">&#91;/beehive&#93;</span> appears to have started a thread named Timer\-5 but has failed to stop it. This is very likely to create a memory leak.<br/>
03-Jan-2013 12:40:46 org.apache.catalina.loader.WebappClassLoader clearReferencesThreads<br/>
SEVERE: The web application <span class="error">&#91;/beehive&#93;</span> appears to have started a thread named Timer\-6 but has failed to stop it. This is very likely to create a memory leak.<br/>
03-Jan-2013 12:40:46 org.apache.catalina.loader.WebappClassLoader clearReferencesThreads<br/>
SEVERE: The web application <span class="error">&#91;/beehive&#93;</span> appears to have started a thread named Timer\-7 but has failed to stop it. This is very likely to create a memory leak.<br/>
03-Jan-2013 12:40:47 org.apache.coyote.http11.Http11AprProtocol start<br/>
INFO: Starting Coyote HTTP/1.1 on http-8080<br/>
03-Jan-2013 12:40:47 org.apache.coyote.ajp.AjpAprProtocol start<br/>
INFO: Starting Coyote AJP/1.3 on ajp-8009<br/>
03-Jan-2013 12:40:47 org.apache.catalina.startup.Catalina start<br/>
INFO: Server startup in 54165 ms</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by johnwhitmore at Jan 03, 2013 12:45
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21039312"></a>
                                    <font class="smallfont"><p>Still chasing errors in beehive and:</p>

<p>SEVERE: The web application <span class="error">&#91;/beehive&#93;</span> appears to have started a thread named DefaultQuartzScheduler\_Worker\-4 but has failed to stop it. This is very likely to create a memory leak.</p>

<p>Quartz?</p>

<p>Does anybody have a virtual image for Virtual Box which would let me develop, add an xml file to the Designer? Better yet could a catch all protocol be added that sends four text fields? In the case of the HW I'm working on I simply need:</p>

<ul class="alternate" type="square">
	<li>USB Port</li>
	<li>Output Board</li>
	<li>Output Number</li>
	<li>Command</li>
</ul>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by johnwhitmore at Jan 04, 2013 00:06
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21039315"></a>
                                    <font class="smallfont"><p>The memory leak messages should not do anything.<br/>
For your protocol just take a xml file from the protocols folder in the designer, copy and modify to your needs.<br/>
That's pretty much it.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jan 04, 2013 08:05
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21039325"></a>
                                    <font class="smallfont"><p>Got it Marcus, well got Beehive working. The readme file called for a database named beehive but the default config file called for a database named "beehive_3_0_0_alpha5" </p>

<p>Not being sure what meant what in the config file, it was the URL for the database, I had to enable the logs and go through them to work out where I was at fault.</p>

<p>So I have Beehive up and running I'll now have a go with the Designer.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by johnwhitmore at Jan 04, 2013 13:35
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21039330"></a>
                                    <font class="smallfont"><p>My build of the Designer seems happy now but I'm not sure what the local web address is for the Designer page? I've been trying to get 127.0.0.1:8080/designer but that's not getting me anything?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by johnwhitmore at Jan 04, 2013 17:15
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21039345"></a>
                                    <font class="smallfont"><p>Getting there. 127.0.0.1:8080/modeler  From the war file. My next problem is the configuration of the svn server which is configured to use /srv/svn/repos so I'm getting an error:</p>

<p>Beehive 3.0 Beta1 | 2013-01-05 01:03:08,809 ERROR<br/>
org.openremote.beehive.api.service.impl.SVNDelegateServiceImpl : Unable to create local repository 'file:///home/john/programming/openremote/johnwhitmore/svn-repos/lirc/trunk', please install svn server to sync with LIRC.</p>


<p>I've been trying to resolve the above error and I think part of my problem is that I've got Beehive configured incorrectly. There is one point in the readme instructions:</p>

<p> c) set "work.dir" parameter value to the folder which is the workspace of the beehive, including svn-repos, workCopy and syncHistory directory.</p>

<p>and I'm not sure which Directory this should be set to. I have no "workCopy" Directory in the file system so I'm not sure if this should be the directory of the Beehive source I checked out of SVN or if it's the Beehive directory created by TomCat for it's work. I have got the svn server now installed but Beehive is still not happy. I wonder should I have created a "svn-repos", "workCopy" and "syncHostory" Directories somewhere?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by johnwhitmore at Jan 05, 2013 01:07
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:29</font></td>
		    </tr>
	    </table>
    </body>
</html>