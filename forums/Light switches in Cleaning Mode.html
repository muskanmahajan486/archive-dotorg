<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Light switches in Cleaning Mode</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Light switches in Cleaning Mode
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Apr 04, 2013 by <font color="#0050B2">goovaerg</font>.
				    </div>

				    <p>Hi,</p>

<p>I have some Basalte light switches which I can put in a cleaning state. This cleaning object in ETS is of datatype on/off. <br/>
I don't think it has a corresponding status object.</p>

<p>I've created an ON and an OFF command. I want to use a switch to turn the cleaning state on/off. </p>

<p>But without a status comming back from the bus, I can't create a sensor. So I can't use a switch.</p>

<p>How do I proceed with this? I want to be able to toggle the cleaning state of all my switches in my house.</p>

<p>Kind regards,<br/>
Glenn</p>

				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-21859823"></a>
                                    <font class="smallfont"><p>You could use the virtual command and a rule which sends the real KNX command.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Apr 07, 2013 20:09
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859853"></a>
                                    <font class="smallfont"><p>Hi Marcus,</p>

<p>can you give me a little bit more info to get me started?</p>

<p>Glenn</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by goovaerg at Apr 08, 2013 05:17
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859855"></a>
                                    <font class="smallfont"><p>If there's no status, usually two distinct buttons (one for on and one for off command) is preferrable. Is that not an option for your UI?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Apr 08, 2013 05:22
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859857"></a>
                                    <font class="smallfont"><p>I can do that but I thought it would look a little bit better with a swich. </p>

<p>No problem.</p>

<p>Glenn</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by goovaerg at Apr 08, 2013 05:25
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859860"></a>
                                    <font class="smallfont"><p>I don't recall if we allow a switch without a sensor. In theory there wouldn't be an issue with this other than the switch visual state may get out of sync with the physical switches actual state. But we may enforce sensor on the switch on the designer configuration if a sensorless switch wasn't considered a valid use case. I'd need to check with Eric.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Apr 08, 2013 05:29
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859861"></a>
                                    <font class="smallfont"><p>Like Marcus mentioned, you could create an in-memory (fake) sensor state with the virtual commands that are available in the Designer. This is just to fullfil the sensor requirement (if any) on the switch. This is a little more involved and currently only discussed on the forums, the documentation is on the todo list.</p>

<ul class="alternate" type="square">
	<li><a href="In-Memory Virtual Command Help.html" title="In-Memory Virtual Command Help">In&#45;Memory Virtual Command Help</a></li>
</ul>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Apr 08, 2013 05:34
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859863"></a>
                                    <font class="smallfont"><p>Ok, a switch does always require a sensor which is a bit restrictive but should be able to work around with an in-memory virtual command.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Apr 08, 2013 05:42
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859865"></a>
                                    <font class="smallfont"><p>Ok this is what I did.</p>

<p>I created a Cleaning (ON) and Claning (OFF) command using group address 1/0/4<br/>
I Created an in memory virtual command Status Cleaning with command "status". But what is the group address? I tried specifying 1/0/4 but that's not allowed. So for now I used some dummy address<br/>
I created Sensor Cleaning wich uses the in memory virtual command</p>

<p>Finally I created a switch which uses the ON and OFF commands together with the Sensor Cleaning. I assigned this to my actual switch</p>

<p>Will this work?</p>

<p>Glenn</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by goovaerg at Apr 08, 2013 06:31
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859866"></a>
                                    <font class="smallfont"><p>Give it a try. I'm worried the sensor UI will not behave as you'd like if it's going to pull its state from the virtual command (keeping the visual switch state fixed to a single view).</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Apr 08, 2013 06:43
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859867"></a>
                                    <font class="smallfont"><p>Ok I'll give it a try and let you guys know what happened.</p>

<p>Glenn</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by goovaerg at Apr 08, 2013 07:01
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859932"></a>
                                    <font class="smallfont"><p>The way to use the virtual command in this case is to have 3 commands using in memory protocol:<br/>
ON, OFF and STATUS, use whatever address you want, but the same for the 3 commands.<br/>
Create a sensor and a switch object based on those 3 commands, then assign the UI switch.</p>

<p>This will just toggle the values of an in memory switch.<br/>
Then, using rules, based on the sensor value, send the appropriate KNX command (or commands).</p>

<p>So you would still have your cleaning on and cleaning off commands like above, but only call those from the rules.</p>

<p>Here is an example rules file for this:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.protocol;

global org.openremote.controller.statuscache.CommandFacade execute;

rule <span class="code-quote">"LightOn"</span>
when
  $evt : Event(source==<span class="code-quote">"LightSensor"</span>, value==<span class="code-quote">"on"</span>)
then
   <span class="code-object">System</span>.out.println(<span class="code-quote">"LightOn rule"</span>);
   execute.command(<span class="code-quote">"CL_On"</span>);
end

rule <span class="code-quote">"LightOff"</span>
when
  $evt : Event(source==<span class="code-quote">"LightSensor"</span>, value==<span class="code-quote">"off"</span>)
then
   <span class="code-object">System</span>.out.println(<span class="code-quote">"LightOff rule"</span>);
   execute.command(<span class="code-quote">"CL_Off"</span>);
end
</pre>
</div></div>

<p>In this example, LightSensor is the name of the sensor linked to the in memory virtual commands.<br/>
CL_On and CL_Off are the 2 commands that actually do send the commands you want to the device (KNX in your case).</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ebariaux at Apr 08, 2013 20:00
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22873752"></a>
                                    <font class="smallfont"><p>The workaround with the virtual commands works for me. but is there an option to read the knx bus to update my virtual switch if I turn the light on with knx hardware? In this case my OR still shows OFF...</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by sinonimo at Jul 09, 2013 08:07
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22873754"></a>
                                    <font class="smallfont"><p>If your KNX actuator sends a status after changing the state just create a STATUS command on that group address.<br/>
If you actuator cannot send status commands you can create a STATUS command to listen on the switching group address.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jul 09, 2013 08:40
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22873759"></a>
                                    <font class="smallfont"><p>@Marcus: <br/>
My actuator can't send status... <img class="emoticon" src="images/icons/emoticons/sad.gif" height="20" width="20" align="absmiddle" alt="" border="0"/><br/>
I have the following configuration:</p>

<p>command: name:LightON, KNX, 2/1/1, on, 1.001<br/>
command: name:LightOFF, KNX, 2/1/1, off, 1.001</p>

<p>command: name:VIRTUALLightON, protocol:VirtualCommand, command:on, address:TestAddress<br/>
command: name:VIRTUALLightOFF, protocol:VirtualCommand, command:off, address:TestAddress<br/>
command: name:VIRTUALLightStatus, protocol:VirtualCommand, command:status, address:TestAddress</p>

<p>sensor: name:VirtualLightSensor, command:VIRTUALLightStatus, type:switch</p>

<p>I added the rules and this works fine!</p>

<p>now I create a command and a sensor:<br/>
command: name:TESTLightStatus, KNX, 2/1/1, status, 1.001<br/>
sensor: name:TESTLightSensor, command:TESTLightStatus, type:switch</p>

<p>I added an image (sensor:TESTLightSensor) to show the status but this will not work. I only get the off picture. Where is my mistake???</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by sinonimo at Jul 09, 2013 09:45
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22873766"></a>
                                    <font class="smallfont"><p>There is an isse that OpenRemote does not receive the KNX message it sends (discussed in anthoer thread).<br/>
But TESTLightSensor should work, when you use your KNX hardware (eg wall switch).<br/>
In that case you can have another rule which updates VIRTUALLightStatus.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jul 09, 2013 10:24
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22873768"></a>
                                    <font class="smallfont"><p>I have a rule to update VIRTUALLIGHTStatus:</p>

<p>rule "TESTON"<br/>
when<br/>
  Event (source=="TESTLightSensor", value=="on")<br/>
then<br/>
  System.out.print("Try VIRTUALLightON");<br/>
  execute.command("VIRTUALLightON");<br/>
  System.out.println("-Positiv " + now());<br/>
end</p>

<p>But I don't understand the meaning of "But TESTLightSensor should work, when you use your KNX hardware (eg wall switch)". </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by sinonimo at Jul 09, 2013 10:34
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22873770"></a>
                                    <font class="smallfont"><p>You were saying that everything is fine when you use your virtual switch (UI on SmartPhone) but the UI is out of sync when using your KNX hardware (I assume a wall switch). Creating an extra status command that listens on the group address which is sent from your wall switch this should work.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jul 09, 2013 10:58
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22873771"></a>
                                    <font class="smallfont"><p>after your post i added an extra status command:</p>

<p>command: name:TESTLightStatus, KNX, 2/1/1, status, 1.001<br/>
sensor: name:TESTLightSensor, command:TESTLightStatus, type:switch</p>

<p>but it does not work... no idea why not...  </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by sinonimo at Jul 09, 2013 11:41
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22873772"></a>
                                    <font class="smallfont"><p>If you connect a label to the TESTLightSensor and you use your wall switch, does the label change?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jul 09, 2013 11:56
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22873773"></a>
                                    <font class="smallfont"><p>NO. It does not change...</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by sinonimo at Jul 09, 2013 12:08
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22873774"></a>
                                    <font class="smallfont"><p>Do you see anything in the log files? Maybe change KNX logging to debug in webapps/controller/WEB-INF/classes/log4j.properties</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jul 09, 2013 12:15
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22873836"></a>
                                    <font class="smallfont"><p>amazing... spend some time on other things and today return to this problem... delete all components and recreate them. and ... surprise... it works. thank you!</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by sinonimo at Jul 11, 2013 10:54
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:41</font></td>
		    </tr>
	    </table>
    </body>
</html>