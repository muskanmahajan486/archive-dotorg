<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : communicating with Thermostat</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : communicating with Thermostat
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Oct 21, 2011 by <font color="#0050B2">drygravytrain</font>.
				    </div>

				    <p>I have a thermostat that is accessible over the network.  I can retrieve data from the thermostat with http requests</p>

<p>For example: to get current temperature- <a href="http://myaddress/tstat/temp">http://myaddress/tstat/temp</a>   returns {"temp":65.50}</p>

<p>Does openremote allow me a way to work with this information? send http requests and then display the response?</p>

				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-19433162"></a>
                                    <font class="smallfont"><p>Yes, you can send HTTP requests. In the moment the result cannot be parsed though. <br/>
You would receive the complete result.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Oct 21, 2011 20:52
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19433163"></a>
                                    <font class="smallfont">
<p>Why not add a simple regexp option in your HTTP protocol, should be trivial and in this case sufficient.</p>

<p>Richard Turner already did this for telnet reply values.</p>


</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by admin at Oct 21, 2011 21:08
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597133"></a>
                                    <font class="smallfont"><p>Ok, this is probably a dumb question but what kind of sensor do you use to get this to show up? Same scenario as stated above, I'm simply trying to display the temp from the same http string returned above ({"temp":65.50}}.    Regexp aside, I'm not even getting it to show the entire string. (I've tried with and without the regex in place hoping to see any value returned.)</p>

<p>I've created the command. An http protocol command using the http method get.</p>

<p>I then tried a bunch of different sensors to use this command but nothing seems to display the string. I keep getting N/A.</p>

<p>Custom seems like the right choice but I am not sure what to put in the Custom State fields.</p>

<p>I've been using a Label to display the end result within the UI Designer because it seems like the correct widget to use. But I feel like I'm being stupid here.</p>

<p>Any advice on how to get this to work?</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kslate at Mar 21, 2015 16:16
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597134"></a>
                                    <font class="smallfont"><p>And one follow up question:</p>

<p>Where does the http requests from above log to within openremote?</p>

<p>C:\OpenRemote\logs\http\http.log does not log anything. It's a 0 byte file.</p>

<p>Or do I have to enable logging in order to get this to work?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kslate at Mar 21, 2015 16:55
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597136"></a>
                                    <font class="smallfont"><p>What response do your get if you just issue the command with your favourite web browser?<br/>
(Use CTRL-U keys to see the full text returned)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 21, 2015 19:34
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597138"></a>
                                    <font class="smallfont"><p>The response is just as listed above.</p>

<p>It returns:</p>

<p>"temp":65.50   </p>

<p>Inside of 2 curly brackets.</p>

<p>Nothing else.</p>

<p>(For whatever reason when I post the curly brackets with this post, this site tries to treat it as a variable and won't post it correctly.)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kslate at Mar 21, 2015 20:09
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597139"></a>
                                    <font class="smallfont"><p>In building modeler make<br/>
1 new device<br/>
2 new command of type http<br/>
3 new sensor of type custom without any further specification<br/>
4 in ui designer make label and connect this sensor</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 21, 2015 20:16
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597140"></a>
                                    <font class="smallfont"><p>Ok, all morning testing this, it did not log anything to the http log file. Just looked again and it is now logging (not sure why it did not before?).</p>

<p>It looks like openremote can not connect to the web site. But I'm not really sure why. Looks like a java error<img class="emoticon" src="images/icons/emoticons/help_16.gif" height="16" width="16" align="absmiddle" alt="" border="0"/>. If I connect with a we browser (chrome) it connects and displays the temp just fine. The java client in openremote does not connect.</p>

<p>Here's what the log looks like:</p>

<p>ERROR 2015-03-21 16:16:40,215 (HTTP): IOException when executing HTTP method<br/>
org.apache.http.conn.HttpHostConnectException: Connection to <a href="http://192.169.1.41">http://192.169.1.41</a> refused<br/>
	at org.apache.http.impl.conn.DefaultClientConnectionOperator.openConnection(DefaultClientConnectionOperator.java:127)<br/>
	at org.apache.http.impl.conn.AbstractPoolEntry.open(AbstractPoolEntry.java:147)<br/>
	at org.apache.http.impl.conn.AbstractPooledConnAdapter.open(AbstractPooledConnAdapter.java:108)<br/>
	at org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:415)<br/>
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:641)<br/>
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:731)<br/>
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:709)<br/>
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:700)<br/>
	at org.openremote.controller.protocol.http.HttpGetCommand.requestURL(HttpGetCommand.java:231)<br/>
	at org.openremote.controller.protocol.http.HttpGetCommand.run(HttpGetCommand.java:245)<br/>
	at java.lang.Thread.run(Unknown Source)<br/>
Caused by: java.net.ConnectException: Connection timed out: connect<br/>
	at java.net.DualStackPlainSocketImpl.connect0(Native Method)<br/>
	at java.net.DualStackPlainSocketImpl.socketConnect(Unknown Source)<br/>
	at java.net.AbstractPlainSocketImpl.doConnect(Unknown Source)<br/>
	at java.net.AbstractPlainSocketImpl.connectToAddress(Unknown Source)<br/>
	at java.net.AbstractPlainSocketImpl.connect(Unknown Source)<br/>
	at java.net.PlainSocketImpl.connect(Unknown Source)<br/>
	at java.net.SocksSocketImpl.connect(Unknown Source)<br/>
	at java.net.Socket.connect(Unknown Source)<br/>
	at org.apache.http.conn.scheme.PlainSocketFactory.connectSocket(PlainSocketFactory.java:123)<br/>
	at org.apache.http.impl.conn.DefaultClientConnectionOperator.openConnection(DefaultClientConnectionOperator.java:123)<br/>
	... 10 more<br/>
INFO 2015-03-21 16:16:40,217 (HTTP): received message: </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kslate at Mar 21, 2015 20:26
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597142"></a>
                                    <font class="smallfont"><p>Maybe your browser is using a proxy? Is the browser and the controller running on the same machine? If not, is the routing on the controller machine correcr? Can you ping from the controller machine the 192.169... address?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 21, 2015 21:44
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597145"></a>
                                    <font class="smallfont"><p>Same computer and no proxy and They are both in the same /24 network. The server can ping the thermostat.</p>

<p>Anyone know if chrome can deal with json? I have read something that implies that the radiothermostat uses it<img class="emoticon" src="images/icons/emoticons/help_16.gif" height="16" width="16" align="absmiddle" alt="" border="0"/>.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kslate at Mar 22, 2015 00:25
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597146"></a>
                                    <font class="smallfont"><p>PZ1, That is what I ended up with. I re read the "basic" tutorial docs and settled on that.</p>

<p>Still no luck. It does not display the temp in any format and the logs say failure to connect. Which I don't get since I can get to it from the same computer and do get results.</p>

<p>Java browser connection within Openremote vs Chrome? Json involved?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kslate at Mar 22, 2015 00:25
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597153"></a>
                                    <font class="smallfont"><p>Strange behaviour. Have you looked in the dev.log files as well? (I know you tried the more obvious http logs). JSON should not matter. Many including myself have successfully parsed that.</p>

<p>PS: Include your code texts in {code}...{code} tags. (Curly bracketed tags are use for formatting in this forum. That makes your entries distorted)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 22, 2015 15:56
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 10:46</font></td>
		    </tr>
	    </table>
    </body>
</html>