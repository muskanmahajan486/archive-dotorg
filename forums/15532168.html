<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Openremote & telnet</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Openremote & telnet
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 26, 2011 by <font color="#0050B2">jrkalf</font>.
				    </div>

				    <p>Hi,</p>


<p>I just looked at the Openremote page after Ernst Cozijnsen pointed me to it. It looks very good as a custom interface builder for my domotics system. I've downloaded the website version of Openremote controller and started the software, made me some devices and put them on my panel (iphone). Now I have the issue that I'm using FS20 devices (just like Ernst) via FHEM. Which means I have to instruct my OR controller to send telnet commands to the FHEM service running on port 7072.</p>

<p>My issue is that the OR controller seems to give me back some errors trying to issue the telnet command:</p>

<p>&#45;-------------&#45;</p>

<p>[Controller]2011-01-26 21:00:58,895 ERROR [HTTP-Thread-1] org.openremote.controller.protocol.telnet.TelnetCommand.send(156) &#124; could not perform telnetEvent<br/>
java.lang.Exception: Response timed-out waiting for "set lamp.zoldergang on"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.openremote.controller.protocol.telnet.TelnetCommand.waitForString(TelnetCommand.java:186)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.openremote.controller.protocol.telnet.TelnetCommand.send(TelnetCommand.java:149)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.openremote.controller.service.impl.ControlCommandServiceImpl.trigger(ControlCommandServiceImpl.java:56)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.openremote.controller.rest.ControlCommandRESTServlet.doPost(ControlCommandRESTServlet.java:76)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at javax.servlet.http.HttpServlet.service(HttpServlet.java:637)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:78)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:77)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:286)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:845)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:354)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at java.lang.Thread.run(Thread.java:636)</p>


<p>&#45;-------------&#45;</p>

<p>I'm not sure if it's really a fhem issue, a OR issue, or just a problem existing between keyboard &amp; chair. (don't opt for the last one)....</p>

<p>The way the FHEM telnet interface works is you start the session and it'll give you "nothing" back. no command interface, no nothing. It expects you to send a simple command like "set lamp on" or "set lamp off" and it'll execute the task. Again without sending any feedback. Also it doesn't terminate the session immediately. I think there's a 5 minute timer on that.</p>

<p>Does anybody know what I'm doing wrong here?</p>

				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-15532189"></a>
                                    <font class="smallfont"><p>Jelle</p>

<p>See <a href="http://www.openremote.org/pages/viewpage.action?pageId=15532042&amp;focusedCommentId=15532157#comment-15532157">http://www.openremote.org/pages/viewpage.action?pageId=15532042&amp;focusedCommentId=15532157#comment-15532157</a></p>

<p>Sounds like the FHEM is much like the MCE Controller. If the far end doesn't respond the current telnet or tcp/ip OR commands wont really work as they will wait for "something" to be returned.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by deanox at Jan 28, 2011 10:12
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-15532192"></a>
                                    <font class="smallfont"><p>i see what you mean but the far end does respond. If you manually do a telnet to the destination ip/port you can enter commands.</p>

<p>Is there a way to debug how far OR is getting in executing a command?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kide at Jan 28, 2011 17:17
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-15532195"></a>
                                    <font class="smallfont"><p>I did some research and i've created 2 switches </p>

<p>1 has 2 commands sending via Telnet and the other sends the same string via a socket.</p>

<p>On both machines (controller and telnet reciever) i'm running tcpdump to see the traffic.</p>

<p>When i hit the socket type button there is no message in the controller.log and on both ends i see traffic coming and going. When i read the socket stream you can clearly see the command that should be executed.</p>

<p>When i hit the telnet type button there is an error in the controller.log saying timeout (like above). On the reciever end i see data coming in on the correct port but when i analyze the stream there is no data in the packets.</p>

<p>Below a dump from the reciever end when the telnet button is pushed.</p>

<p>.110 is the reciever<br/>
.108 is the sender</p>



<p>21:31:32.570913 IP (tos 0x0, ttl 64, id 28381, offset 0, flags DF, proto TCP (6), length 60)<br/>
    192.168.10.108.59410 &gt; 192.168.10.110.7072: Flags S, cksum 0xcb4a (correct), seq 1016426562, win 5840, options mss 1460,sackOK,TS val 9510559 ecr 0,nop,wscale 7, length 0<br/>
21:31:32.570959 IP (tos 0x0, ttl 64, id 0, offset 0, flags DF, proto TCP (6), length 60)<br/>
    192.168.10.110.7072 &gt; 192.168.10.108.59410: Flags S., cksum 0x2f84 (correct), seq 2095884986, ack 1016426563, win 5792, options mss 1460,sackOK,TS val 26768040 ecr 9510559,nop,wscale 5, length 0<br/>
21:31:32.571602 IP (tos 0x0, ttl 64, id 28382, offset 0, flags DF, proto TCP (6), length 52)<br/>
    192.168.10.108.59410 &gt; 192.168.10.110.7072: Flags ., cksum 0x74c0 (correct), seq 1, ack 1, win 46, options nop,nop,TS val 9510559 ecr 26768040, length 0<br/>
21:31:33.574931 IP (tos 0x0, ttl 64, id 28383, offset 0, flags DF, proto TCP (6), length 52)<br/>
    192.168.10.108.59410 &gt; 192.168.10.110.7072: Flags F., cksum 0x745a (correct), seq 1, ack 1, win 46, options nop,nop,TS val 9510660 ecr 26768040, length 0<br/>
21:31:33.575719 IP (tos 0x0, ttl 64, id 55315, offset 0, flags DF, proto TCP (6), length 52)<br/>
    192.168.10.110.7072 &gt; 192.168.10.108.59410: Flags F., cksum 0x736e (correct), seq 1, ack 2, win 181, options nop,nop,TS val 26768140 ecr 9510660, length 0<br/>
21:31:33.576340 IP (tos 0x0, ttl 64, id 28384, offset 0, flags DF, proto TCP (6), length 52)<br/>
    192.168.10.108.59410 &gt; 192.168.10.110.7072: Flags ., cksum 0x73f5 (correct), seq 2, ack 2, win 46, options nop,nop,TS val 9510660 ecr 26768140, length 0</p>



<p>Here is a dump from the reciever when the socket type button is pushed</p>



<p>21:34:22.265560 IP (tos 0x0, ttl 64, id 16006, offset 0, flags DF, proto TCP (6), length 60)<br/>
    192.168.10.108.59412 &gt; 192.168.10.110.7072: Flags S, cksum 0xfcf0 (correct), seq 3665256046, win 5840, options mss 1460,sackOK,TS val 9527528 ecr 0,nop,wscale 7, length 0<br/>
21:34:22.265623 IP (tos 0x0, ttl 64, id 0, offset 0, flags DF, proto TCP (6), length 60)<br/>
    192.168.10.110.7072 &gt; 192.168.10.108.59412: Flags S., cksum 0xcd98 (correct), seq 438656714, ack 3665256047, win 5792, options mss 1460,sackOK,TS val 26785009 ecr 9527528,nop,wscale 5, length 0<br/>
21:34:22.269629 IP (tos 0x0, ttl 64, id 16007, offset 0, flags DF, proto TCP (6), length 52)<br/>
    192.168.10.108.59412 &gt; 192.168.10.110.7072: Flags ., cksum 0x12d4 (correct), seq 1, ack 1, win 46, options nop,nop,TS val 9527529 ecr 26785009, length 0<br/>
21:34:22.269966 IP (tos 0x0, ttl 64, id 16008, offset 0, flags DF, proto TCP (6), length 70)<br/>
    192.168.10.108.59412 &gt; 192.168.10.110.7072: Flags P., cksum 0xcabd (correct), seq 1:19, ack 1, win 46, options nop,nop,TS val 9527529 ecr 26785009, length 18<br/>
21:34:22.270013 IP (tos 0x0, ttl 64, id 59962, offset 0, flags DF, proto TCP (6), length 52)<br/>
    192.168.10.110.7072 &gt; 192.168.10.108.59412: Flags ., cksum 0x123b (correct), seq 1, ack 19, win 181, options nop,nop,TS val 26785009 ecr 9527529, length 0</p>


<p>Clearly you can see that this command contains data if you look at the next to last line "length 18"</p>

<p>Is this a bug of some sort</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kide at Jan 28, 2011 20:36
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-15532199"></a>
                                    <font class="smallfont"><p>Yes, that behaviour is exactly as I described for the MCE Controller and captured in Wireshark.</p>


<p>if the receiver doesn't acknowledge the connection or commands (at the telnet/command level not at TCP/IP) the telnet option timesout before even sending the command. And a socket connection timesout after sending the initial command because the recevier doesnt send any text back.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by deanox at Jan 28, 2011 22:27
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-15532208"></a>
                                    <font class="smallfont"><p>ok i see your point now.</p>

<p><del>But the question is now is it a problem of the client or is it a problem on the telnet server side. If i do a manual telnet to that device and port i can execute a command without a problem. In the TCPdump i see that the data package is &gt;0 so this connection is valid.</del></p>

<p><del>How do we figure out on which side the problem is?</del></p>

<p>After reading your post more carefully i see i get it. I'll try to modify it and see how it works.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kide at Jan 29, 2011 19:39
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-15532234"></a>
                                    <font class="smallfont"><p>Please see:</p>


<p><a href="http://www.openremote.org/pages/viewpage.action?pageId=15532042&amp;focusedCommentId=15532223#comment-15532223">Generic TCP IP &amp; Telnet Questions</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kide at Jan 31, 2011 08:42
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 10:51</font></td>
		    </tr>
	    </table>
    </body>
</html>