<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : event if an IP is connected on network</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : event if an IP is connected on network
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Nov 26, 2014 by <font color="#0050B2">pappabjoern</font>.
				    </div>

				    <p>Hi,<br/>
I'm looking for a way to trigger events or do stuff if a certain device is connected to the network. Say that my wife is home and connected to the network, then I don't want a certain lamp turn on. But if she's not connected it should fire. If this is possible, could someone please explain how to get this to work.</p>

<p>Regards<br/>
pappabjoern</p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789882.png">Capture1.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789896.png">openrem.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789897.png">dev.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789898.png">folders.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789901.png">check IP.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789900.png">folders1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789899.png">check IP.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789932.png">sensor_android.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789933.png">sensor_ipad.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789915.png">sensor_ipod.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789934.png">sensor_agg.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789935.png">sensor_all.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789918.png">crontab.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789919.png">crontab1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789920.png">vi_crontab.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789921.png">owner.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789922.png">create task.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789923.png">create task1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789924.png">cron editor.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789925.png">crontab2.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789926.png">error.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789927.png">task.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789929.png">crontab3.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789930.png">facts sensor_android.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789938.png">pingsensor.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789936.png">sensor_android.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789914.png">sensor_ipad.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789937.png">sensor_agg.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789917.png">sensor_all.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789913.png">sensor_android.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789916.png">sensor_agg.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789931.png">pingsensor.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789939.png">dev off.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23594199/23789940.png">dev on.png</a> (image/png)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-23596583"></a>
                                    <font class="smallfont"><p>hey mate.<br/>
i think this is possible in the free designer using the "ping " sensor . i have the pro version and we dont have it yet but want do the same thing.</p>

<p>regards jon  </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jon.gillioz at Feb 15, 2015 12:38
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597031"></a>
                                    <font class="smallfont"><p>You can tell more where to look / read? How to configure?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aleksey_z at Mar 11, 2015 15:38
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599656"></a>
                                    <font class="smallfont"><p>i've done exactly this, i use it to control entry / exit routines in the house.  Turn on lights etc if it is dark, when i am out, simulating occupancy, turning off all of the plugs etc.</p>

<p>The way i did it (and probably not the best but it does work) was to write shell scripts running on linux (raspi) to  detect ip addressed (assigned by router by MAC id).  these shell scripts write out a value to a file, one for each of us in the house. These files are then reviewed by another script which decides if the house is completely empty or anyone is in.  The output of this second script then writes another value to a file which is used (via a sensor input) to tell openremote whether the house is occupied or not.</p>

<p>THere is probably a better way to do this, but it works and is robust.  The use of the files and scripts also means that if there is a power cut nothing is lost from memory.</p>

<p>LMK if this sounds like it would help and if you need some examples.</p>

<p>HTH  Nick</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nickbrookes76 at Jun 19, 2015 18:55
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599657"></a>
                                    <font class="smallfont"><p>sorry - forgot to add, initially i had some issues with the ping not responding in time, meaning everything got switched off even when i was in the house.  i therefore changed the rules to check if i missed 3 consecutive pings before deciding if i was out or not.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nickbrookes76 at Jun 19, 2015 18:57
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599659"></a>
                                    <font class="smallfont"><p>It would be interesting to do the same. But I have a little knowledge to write scripts and shell. It is interesting to see examples, screenshots, for simple scenes. (for example: if I came in the office (my phone), then turn on the lights, etc. Thank you.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aleksey_z at Jun 19, 2015 19:38
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599660"></a>
                                    <font class="smallfont"><p>all scripts are linux bash shell scripts.</p>

<p>script to check ip address:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
#!/bin/bash
#set up <span class="code-keyword">new</span> vars;
new_var=0
var1=nick
var2=192.168.1.20
ddd=$(date +<span class="code-quote">"%Y-%m-%d %H:%M:%S,%3N"</span>)
echo <span class="code-quote">"datetime = $ddd"</span>

echo <span class="code-quote">"ipaddress to check is $var2"</span>
status=`ping -qc 1 $var2 | grep -wi '[0-9][[:space:]]received'|awk -F, '{print $2}'|awk '{print $1}'`
echo <span class="code-quote">"$var1 status is :$status"</span>;

# <span class="code-keyword">if</span> status is ge 1 that means one of the ips responded to a ping.
# therefore value in pingsensor table should be set to 0;

   <span class="code-keyword">if</span> [[ $status -gt 0 ]]; then
   echo <span class="code-quote">"ping response received resetting $var1 status to 1"</span>
   echo <span class="code-quote">"1"</span> &gt; /opt/openremote/facts/sensor_$var1
   <span class="code-keyword">else</span>
    #write out a 0 in the nicksensor file
    echo <span class="code-quote">"0"</span> &gt; /opt/openremote/facts/sensor_$var1
   fi

ddd=$(date +<span class="code-quote">"%Y-%m-%d %H:%M:%S,%3N"</span>)
echo <span class="code-quote">"datetime = $ddd"</span>
echo <span class="code-quote">"**********************************************************"</span>
</pre>
</div></div>

<p>script to aggregate responses (more than one IP address to be checked). I even have one for the baby-sitter's phone!</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
#!/bin/bash
#set up <span class="code-keyword">new</span> vars;
run_tot=0
new_var=0

ddd=$(date +<span class="code-quote">"%Y-%m-%d %H:%M:%S,%3N"</span>)
echo <span class="code-quote">"datetime = $ddd"</span>
exec &lt; /opt/openremote/facts/pingsensor
read old_val
echo <span class="code-quote">"old_val is $old_val"</span>
exec &lt; /opt/openremote/facts/sensor_sarah
read sarah_val
echo <span class="code-quote">"sarah-val is $sarah_val"</span>
exec &lt; /opt/openremote/facts/sensor_extra
read extra_val
echo <span class="code-quote">"extra_val is $extra_val"</span>
exec &lt; /opt/openremote/facts/sensor_note
read note_val
echo <span class="code-quote">"note_val is $note_val"</span>

run_tot=$(($sarah_val + $extra_val + $note_val));
echo <span class="code-quote">"run_tot is $run_tot"</span>
<span class="code-keyword">if</span> [[ $run_tot -gt 0 ]]; then
 echo <span class="code-quote">"ping response received resetting pingcycle to 0"</span>
 echo <span class="code-quote">"0"</span> &gt; /opt/openremote/facts/pingsensor
 <span class="code-keyword">else</span>
 new_val=$(($old_val + 1 ));
 #write out a 1 in the nicksensor file
 echo <span class="code-quote">"$new_val"</span> &gt; /opt/openremote/facts/pingsensor
fi

exec &lt; /opt/openremote/facts/pingsensor
read msp0
echo <span class="code-quote">"intervals since last ping response is : $msp0"</span>

ddd=$(date +<span class="code-quote">"%Y-%m-%d %H:%M:%S,%3N"</span>)
echo <span class="code-quote">"datetime = $ddd"</span>

echo <span class="code-quote">"**********************************************************"</span>
</pre>
</div></div>

<p>script to run above scripts</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
/opt/openremote/scripts/sensor_agg &gt; /opt/openremote/logs/dev/sensor_agg.log &amp;
/opt/openremote/scripts/sensor_note &gt; /opt/openremote/logs/dev/sensor_note.log &amp;
/opt/openremote/scripts/sensor_sarah &gt; /opt/openremote/logs/dev/sensor_sarah.log &amp;
/opt/openremote/scripts/sensor_extra &gt; /opt/openremote/logs/dev/sensor_extra.log &amp;

sleep 5

/opt/openremote/scripts/sensor_agg &gt;&gt; /opt/openremote/logs/dev/sensor_agg.log &amp;
/opt/openremote/scripts/sensor_note &gt;&gt; /opt/openremote/logs/dev/sensor_note.log &amp;
/opt/openremote/scripts/sensor_sarah &gt;&gt; /opt/openremote/logs/dev/sensor_sarah.log &amp;
/opt/openremote/scripts/sensor_extra &gt;&gt; /opt/openremote/logs/dev/sensor_extra.log &amp;
...
</pre>
</div></div> 

<p>(script repeats every 5 seconds)</p>

<p>cron entry to run scripts</p>
<ul>
	<li>* * * * /opt/openremote/scripts/sensor_all &gt;&gt; /opt/openremote/logs/dev/sensor_all.log</li>
</ul>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nickbrookes76 at Jun 19, 2015 19:57
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599661"></a>
                                    <font class="smallfont"><p>you will need to ensure your phone / whatever you are sensing always gets the same ip address or this won't work...</p>

<p><img src="attachments/23594199/23789882.png" align="absmiddle" border="0"/></p>


<p>sample of sensor used to read in result of ping scripts</p>

<p>the file pingsensor just contains a 1 or 0 indicating if the house is occupied or not.</p>

<p>sample rule to turn lights on if noone is home.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.model.event
global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;
global org.openremote.controller.statuscache.LevelFacade levels;
global org.openremote.controller.statuscache.RangeFacade ranges;
<span class="code-keyword">import</span> org.openremote.controller.protocol.*;
<span class="code-keyword">import</span> java.util.*;
<span class="code-keyword">import</span> java.io.*;
<span class="code-keyword">import</span> java.lang.*;
<span class="code-keyword">import</span> java.util.Random;


<span class="code-comment">//----------------------------------------------------------------------------------
</span><span class="code-comment">//- holiday section
</span><span class="code-comment">//----------------------------------------------------------------------------------------
</span><span class="code-comment">//----------------------------------------------------------------------------------------
</span><span class="code-comment">//- 20ish minutes until sunset - turn living room light on.
</span><span class="code-comment">//----------------------------------------------------------------------------------------
</span>rule <span class="code-quote">"h1"</span>
when
Switch( source==<span class="code-quote">"vacation_sensor"</span>, value ==<span class="code-quote">"on"</span> )
Switch(source ==<span class="code-quote">"bypass2_sensor"</span>, value ==<span class="code-quote">"off"</span> )
 CustomState( source==<span class="code-quote">"sensor_minutesUntilSunset"</span>, value == <span class="code-quote">"30"</span>) then
 execute.command(<span class="code-quote">"a1_on"</span>);
end

</pre>
</div></div>

<p>note bypass2_sensor is used to override this functionality</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">

<span class="code-keyword">package</span> org.openremote.controller.model.event
global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;
global org.openremote.controller.statuscache.LevelFacade levels;
global org.openremote.controller.statuscache.RangeFacade ranges;
<span class="code-keyword">import</span> org.openremote.controller.protocol.*;
<span class="code-keyword">import</span> java.util.*;
<span class="code-keyword">import</span> java.io.*;
<span class="code-keyword">import</span> java.lang.*;
<span class="code-keyword">import</span> java.util.Random;

<span class="code-comment">// going out
</span>rule <span class="code-quote">"go"</span>
when
   Range( source==<span class="code-quote">"person_sensor2"</span>, value &gt; 3 )
   Switch( source==<span class="code-quote">"bypass2_sensor"</span>, value==<span class="code-quote">"off"</span> )
   Switch( source==<span class="code-quote">"vacation_sensor"</span>, value ==<span class="code-quote">"off"</span> )
then
 execute.command(<span class="code-quote">"arm"</span>);
 execute.command(<span class="code-quote">"vacation_on"</span>);
 execute.command (<span class="code-quote">"put_slider2"</span>, 5);
 execute.command(<span class="code-quote">"a1_off"</span>);
 execute.command(<span class="code-quote">"a2_off"</span>);
 execute.command(<span class="code-quote">"tv_plug_off"</span>);
 execute.command(<span class="code-quote">"a14_off"</span>);
 execute.command(<span class="code-quote">"a15_off"</span>);
 execute.command(<span class="code-quote">"a16_off"</span>);
 execute.command(<span class="code-quote">"c1_off"</span>);
 execute.command(<span class="code-quote">"d1_off"</span>);
 execute.command(<span class="code-quote">"d16_off"</span>);
 execute.command(<span class="code-quote">"e1_off"</span>);
 execute.command(<span class="code-quote">"g16_off"</span>);
 execute.command(<span class="code-quote">"g15_off"</span>);
 execute.command(<span class="code-quote">"h15_off"</span>);
 execute.command(<span class="code-quote">"h16_off"</span>);
 execute.command(<span class="code-quote">"f1_off"</span>);
 execute.command(<span class="code-quote">"g1_off"</span>);
end;
</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nickbrookes76 at Jun 19, 2015 20:05
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599675"></a>
                                    <font class="smallfont"><p>Thank you for examples. It looks pretty hard for me. I'm just starting to learn the logic and operation of the "Rules". 
<a href="http://www.openremote.org/pages/viewpage.action?pageId=23597123">http://www.openremote.org/pages/viewpage.action?pageId=23597123</a><br/>
And yet not quite figured out the logic of the virtual switch. But gradually I learn.</p>

<p>I use: Synology DS3615; OpenRemote 2.1.1 + AeonLabs Z-Wave Stick 2.<br/>
How and where to write, and how to call the scripts? In which folders are saved scripts? How can I use your example to make a simple scene (to my understanding):</p>

<p>When:<br/>
I attend (person_sensor (ping?) ON))<br/>
Time (9-18) every day (except sundays)<br/>
Then:<br/>
set dimmer level 60</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aleksey_z at Jun 20, 2015 09:52
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599677"></a>
                                    <font class="smallfont"><p>sorry i can't help as i use a raspberry pi running rasbian, and i've no experience with your OS.  Someone will be along shortly to help.</p>

<p>Best of luck</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nickbrookes76 at Jun 20, 2015 10:22
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599838"></a>
                                    <font class="smallfont"><p>I want to try to understand your way.<br/>
Following your example, I have to create a folder /scripts and /facts in a folder /volume1/@appstore/OpenRemote. <a class="confluence-thumbnail-link 589x327" href='http://www.openremote.org/download/attachments/23594199/openrem.png'><img src="attachments/thumbnails/23594199/23789896" align="absmiddle" border="0"/></a><br/>
Then, in a folder /volume1/@appstore/OpenRemote/scripts I have to put the scripts, mentioned above (you examples), in the folder /volume1/@appstore/OpenRemote/logs/dev <a class="confluence-thumbnail-link 593x353" href='http://www.openremote.org/download/attachments/23594199/dev.png'><img src="attachments/thumbnails/23594199/23789897" align="absmiddle" border="0"/></a> I have to create log-files (as in the you example above). What should be in the folder /volume1/@appstore/OpenRemote/facts? What permissions should have created folders and scripts? What purpose are sensor_note, sensor_sarah, sensor_extra?<br/>
If you can, please help me understand.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aleksey_z at Jun 29, 2015 15:35
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599840"></a>
                                    <font class="smallfont"><p>Aleksey,</p>

<p>The /scripts folder should contain the scripts, and the /facts folder should contain all of the files that are used to store the values written out by scripts (apart from the logs).  In each script, you should change the file path for the file being written to, to your /volume1/@appstore/OpenRemote/facts folder.  i think from my example these paths were originally /opt/openremote/facts/<br/>
the scripts should have executable bit set (chmod +x name_of_script or chmod 774 name_of_script).  The logs folder and the facts folder should have permission for the scripts to write to.  so if you run the scripts as nick, nick should have permission to write to these folders...</p>

<p>HTH, let me know if you have any questions.</p>

<p>Nick</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nickbrookes76 at Jun 29, 2015 15:47
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599842"></a>
                                    <font class="smallfont"><p>Thanks for the answer, but I have little knowledge.<br/>
I start trying.<br/>
With WinSCP I created a folder in the /volume1/@appstore/OpenRemote/.<br/>
<a class="confluence-thumbnail-link 590x342" href='http://www.openremote.org/download/attachments/23594199/folders.png'><img src="attachments/thumbnails/23594199/23789898" align="absmiddle" border="0"/></a><br/>
In the Putty I must do?<br/>
&gt; chown -R openremote.users /volume1/@appstore/OpenRemote/scripts<br/>
&gt; chown -R openremote.users /volume1/@appstore/OpenRemote/facts</p>

<p>After &gt; chown<br/>
<a class="confluence-thumbnail-link 575x334" href='http://www.openremote.org/download/attachments/23594199/folders1.png'><img src="attachments/thumbnails/23594199/23789900" align="absmiddle" border="0"/></a><br/>
In the test folder on the my PC I copy and changed your script, put my data.<br/>
I called him "checkmyphoneip".<br/>
<a class="confluence-thumbnail-link 733x547" href='http://www.openremote.org/download/attachments/23594199/check IP.png'><img src="attachments/thumbnails/23594199/23789899" align="absmiddle" border="0"/></a><br/>
As it was called correctly in order to avoid confusion in the future?<br/>
I understand that this script will record values in the folder /volume1/@appstore/OpenRemote/facts will have to appear sensor_$var1, Ie sensor_alex</p>

<p>How to do next, what scripts? What to do with the second script sensor_agg? I can not understand the purpose of sensor_note, sensor_sarah, sensor_extra?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aleksey_z at Jun 29, 2015 16:14
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599999"></a>
                                    <font class="smallfont"><p>Hi.<br/>
Help me to understand.<br/>
I wrote three scripts (sensor_android, sensor_ipad, sensor_ipod) - for android, Ipad, iPod.<br/>
<a class="confluence-thumbnail-link 496x615" href='http://www.openremote.org/download/attachments/23594199/sensor_android.png'><img src="attachments/thumbnails/23594199/23789913" align="left" border="0"/></a><a class="confluence-thumbnail-link 494x228" href='http://www.openremote.org/download/attachments/23594199/sensor_ipad.png'><img src="attachments/thumbnails/23594199/23789914" align="absmiddle" border="0"/></a><a class="confluence-thumbnail-link 716x399" href='http://www.openremote.org/download/attachments/23594199/sensor_ipod.png'><img src="attachments/thumbnails/23594199/23789915" align="absmiddle" border="0"/></a><br/>
I wrote the script - sensor_agg   <a class="confluence-thumbnail-link 497x598" href='http://www.openremote.org/download/attachments/23594199/sensor_agg.png'><img src="attachments/thumbnails/23594199/23789916" align="absmiddle" border="0"/></a><br/>
I wrote the script - sensor_all  <a class="confluence-thumbnail-link 865x478" href='http://www.openremote.org/download/attachments/23594199/sensor_all.png'><img src="attachments/thumbnails/23594199/23789917" align="absmiddle" border="0"/></a></p>

<p>I put these scripts into a folder /volume1/@appstore/OpenRemote/scripts<br/>
and<br/>
chmod +x name_of_script<br/>
for them.</p>

<p>How and where to write this entry?</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
cron entry to run scripts

* * * * /volume1/@appstore/OpenRemote/scripts/sensor_all &gt;&gt; /volume1/@appstore/OpenRemote/logs/dev/sensor_all.log
</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aleksey_z at Jul 07, 2015 08:21
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23600000"></a>
                                    <font class="smallfont"><p>Ok if you're only monitoring one device (ip) then you don't need to run sensor aggressive as this just aggregates multiple sensors. The other sensor_ scripts are for checking others devices. You need to run sensor_all to continually kick off the sensor_all script at x second intervals. Remove the other scripts from sensor_all that you don't need. The reason for sensor_all rather than con is that con cannot run scripts several times per minute without messing around. You will need to add a con job to kick off the sensor_all script every x minutes. The permissions for the scripts should be chmod 774</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nickbrookes76 at Jul 07, 2015 08:23
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23600001"></a>
                                    <font class="smallfont"><p>I want to try to monitor the three devices.<br/>
What I wrote above, is that correct?</p>

<blockquote>
<p>The reason for sensor_all rather than con is that con cannot run scripts several <br/>
times per minute without messing around. <br/>
You will need to add a con job to kick off the sensor_all script every x minutes. <br/>
The permissions for the scripts should be chmod 774</p></blockquote>

<p>Where is it you need to add?</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
* * * * /volume1/@appstore/OpenRemote/scripts/sensor_all &gt;&gt; /volume1/@appstore/OpenRemote/logs/dev/sensor_all.log
</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aleksey_z at Jul 07, 2015 08:43
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23600005"></a>
                                    <font class="smallfont"><p>The last entry must be added to this table?</p>

<p><a class="confluence-thumbnail-link 1196x413" href='http://www.openremote.org/download/attachments/23594199/crontab.png'><img src="attachments/thumbnails/23594199/23789918" align="absmiddle" border="0"/></a></p>

<p>or this? <a class="confluence-thumbnail-link 575x155" href='http://www.openremote.org/download/attachments/23594199/crontab1.png'><img src="attachments/thumbnails/23594199/23789919" align="absmiddle" border="0"/></a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aleksey_z at Jul 07, 2015 09:15
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23600007"></a>
                                    <font class="smallfont"><p>side note @Aleksey</p>
<blockquote><p>If you refer tot text, you can use {quote}..{quote} to get layout like this </p></blockquote></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jul 07, 2015 09:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23600011"></a>
                                    <font class="smallfont"><p>Insert replica understood, thanks.<br/>
I read your posts in the topic <a href="http://forum.synology.com/enu/viewtopic.php?t=68438#p265203">http://forum.synology.com/enu/viewtopic.php?t=68438#p265203</a></p>

<p>Tell me, how do I add an entry in cron?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aleksey_z at Jul 07, 2015 09:55
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23600012"></a>
                                    <font class="smallfont"><p>I has been a while. I did use a terminal connection to the Synobox using Putty, and edited <b>crontab</b> with editor vi. So after login as admin:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
cd /etc
vi crontab
</pre>
</div></div>

<p>Not a nice editor, but afaik the only one standard in Synobox. What I do remember is that you have to type all the commands. Don't copy&amp;paste things</p>

<p>So here my toplines (click to enlarge)<br/>
<a class="confluence-thumbnail-link 865x59" href='http://www.openremote.org/download/attachments/23594199/vi_crontab.PNG'><img src="attachments/thumbnails/23594199/23789920" align="left" border="0"/></a><br/>
Hope this works for you</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jul 07, 2015 10:12
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23600014"></a>
                                    <font class="smallfont"><blockquote><p>So after login as admin:</p></blockquote>

<p>As admin or root?</p>

<p>I have to add an entry</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
*/1 * * * /volume1/@appstore/OpenRemote/scripts/sensor_all &gt;&gt; /volume1/@appstore/OpenRemote/logs/dev/sensor_all.log
</pre>
</div></div>
<p>which will be executed every minute?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aleksey_z at Jul 07, 2015 10:25
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23600015"></a>
                                    <font class="smallfont"><p>I think I did it as admin</p>

<p>*/1 Indeed means once every minute</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jul 07, 2015 10:34
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23600017"></a>
                                    <font class="smallfont"><p>NICK BROOKES SAYS:</p>
<blockquote>
<p>The /scripts folder should contain the scripts, and the /facts folder should contain all of the files that are used to store the values written out by scripts (apart from the logs). In each script, you should change the file path for the file being written to, to your /volume1/@appstore/OpenRemote/facts folder. i think from my example these paths were originally /opt/openremote/facts/<br/>
the scripts should have executable bit set (chmod +x name_of_script or chmod 774 name_of_script). The logs folder and the facts folder should have permission for the scripts to write to. so if you run the scripts as nick, nick should have permission to write to these folders...</p></blockquote>

<p>I'm confused with the owners and rights.<br/>
I have a folders <a class="confluence-thumbnail-link 575x334" href='http://www.openremote.org/download/attachments/23594199/folders1.png'><img src="attachments/thumbnails/23594199/23789900" align="absmiddle" border="0"/></a>  owner openremote<br/>
What the owner should be in allocated scripts, <a class="confluence-thumbnail-link 585x357" href='http://www.openremote.org/download/attachments/23594199/owner.png'><img src="attachments/thumbnails/23594199/23789921" align="absmiddle" border="0"/></a>  owner root<br/>
and folder /facts  owner openremote</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aleksey_z at Jul 07, 2015 11:00
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23600018"></a>
                                    <font class="smallfont"><p>I found a way to edit crontab. Will work?
<a href="http://forum.synology.com/enu/viewtopic.php?f=27&amp;t=91830">http://forum.synology.com/enu/viewtopic.php?f=27&amp;t=91830</a></p>

<p><a class="confluence-thumbnail-link 748x523" href='http://www.openremote.org/download/attachments/23594199/create task.png'><img src="attachments/thumbnails/23594199/23789922" align="left" border="0"/></a><a class="confluence-thumbnail-link 766x599" href='http://www.openremote.org/download/attachments/23594199/create task1.png'><img src="attachments/thumbnails/23594199/23789923" align="absmiddle" border="0"/></a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aleksey_z at Jul 07, 2015 11:34
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23600032"></a>
                                    <font class="smallfont"><p>It script "sensor_all.sh" does not work of the cron.<br/>
I installed a utility for editing cron.<br/>
<a class="confluence-thumbnail-link 652x506" href='http://www.openremote.org/download/attachments/23594199/cron editor.png'><img src="attachments/thumbnails/23594199/23789924" align="left" border="0"/></a><a class="confluence-thumbnail-link 875x63" href='http://www.openremote.org/download/attachments/23594199/crontab2.png'><img src="attachments/thumbnails/23594199/23789925" align="absmiddle" border="0"/></a><br/>
From WinSCP script "sensor_all.sh" starts, but with this error, <a class="confluence-thumbnail-link 796x358" href='http://www.openremote.org/download/attachments/23594199/error.png'><img src="attachments/thumbnails/23594199/23789926" align="absmiddle" border="0"/></a><br/>
but the rest of the scripts are triggered and write new values to the relevant files.</p>

<p>P.S. Ups.. If I use the built-in scheduler, <a class="confluence-thumbnail-link 521x271" href='http://www.openremote.org/download/attachments/23594199/task.png'><img src="attachments/thumbnails/23594199/23789927" align="absmiddle" border="0"/></a></p>

<p>when you click on the Run, the script triggered and writes in the sensor_all.log: (earlier in the sensor_all.log did not write anything at all.)</p>

<p>P.S.S.  Ups</p>

<p>I was able to help VI and hands, I enter the desired entry. <br/>
<a class="confluence-thumbnail-link 1334x78" href='http://www.openremote.org/download/attachments/23594199/crontab3.png'><img src="attachments/thumbnails/23594199/23789929" align="absmiddle" border="0"/></a></p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
*/1 * * * /volume1/@appstore/OpenRemote/scripts/sensor_all &gt;&gt; /volume1/@appstore/OpenRemote/logs/dev/sensor_all.log 2&gt;@1
</pre>
</div></div>

<p>The script triggered once a minute.<br/>
But these messages are written sensor_all.log: <br/>
of how to deal with it?</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
sh: 0: unknown operand
sh: 0: unknown operand
grep: invalid option -- 'w'
BusyBox v1.16.1 (2015-01-07 14:56:36 CST) multi-call binary.

Usage: grep [-HhnlLoqvsriFE] [-m N] [-A/B/C N] PATTERN/-e PATTERN.../-f FILE [FILE]...

Search <span class="code-keyword">for</span> PATTERN in FILEs (or stdin)

Options:
	-H	Add 'filename:' prefix
	-h	Do not add 'filename:' prefix
	-n	Add 'line_no:' prefix
	-l	Show only names of files that match
	-L	Show only names of files that don't match
	-c	Show only count of matching lines
	-o	Show only the matching part of line
	-q	Quiet. Return 0 <span class="code-keyword">if</span> PATTERN is found, 1 otherwise
	-v	Select non-matching lines
	-s	Suppress open and read errors
	-r	Recurse
	-i	Ignore <span class="code-keyword">case</span>
	-F	PATTERN is a literal (not regexp)
	-E	PATTERN is an extended regexp
	-m N	Match up to N times per file
	-A N	Print N lines of trailing context
	-B N	Print N lines of leading context
	-C N	Same as '-A N -B N'
	-e PTRN	Pattern to match
	-f FILE	Read pattern from file

grep: invalid option -- 'w'
BusyBox v1.16.1 (2015-01-07 14:56:36 CST) multi-call binary.

Usage: grep [-HhnlLoqvsriFE] [-m N] [-A/B/C N] PATTERN/-e PATTERN.../-f FILE [FILE]...

Search <span class="code-keyword">for</span> PATTERN in FILEs (or stdin)

Options:
	-H	Add 'filename:' prefix
	-h	Do not add 'filename:' prefix
	-n	Add 'line_no:' prefix
	-l	Show only names of files that match
	-L	Show only names of files that don't match
	-c	Show only count of matching lines
	-o	Show only the matching part of line
	-q	Quiet. Return 0 <span class="code-keyword">if</span> PATTERN is found, 1 otherwise
	-v	Select non-matching lines
	-s	Suppress open and read errors
	-r	Recurse
	-i	Ignore <span class="code-keyword">case</span>
	-F	PATTERN is a literal (not regexp)
	-E	PATTERN is an extended regexp
	-m N	Match up to N times per file
	-A N	Print N lines of trailing context
	-B N	Print N lines of leading context
	-C N	Same as '-A N -B N'
	-e PTRN	Pattern to match
	-f FILE	Read pattern from file

grep: invalid option -- 'w'
BusyBox v1.16.1 (2015-01-07 14:56:36 CST) multi-call binary.

Usage: grep [-HhnlLoqvsriFE] [-m N] [-A/B/C N] PATTERN/-e PATTERN.../-f FILE [FILE]...

Search <span class="code-keyword">for</span> PATTERN in FILEs (or stdin)

Options:
	-H	Add 'filename:' prefix
	-h	Do not add 'filename:' prefix
	-n	Add 'line_no:' prefix
	-l	Show only names of files that match
	-L	Show only names of files that don't match
	-c	Show only count of matching lines
	-o	Show only the matching part of line
	-q	Quiet. Return 0 <span class="code-keyword">if</span> PATTERN is found, 1 otherwise
	-v	Select non-matching lines
	-s	Suppress open and read errors
	-r	Recurse
	-i	Ignore <span class="code-keyword">case</span>
	-F	PATTERN is a literal (not regexp)
	-E	PATTERN is an extended regexp
	-m N	Match up to N times per file
	-A N	Print N lines of trailing context
	-B N	Print N lines of leading context
	-C N	Same as '-A N -B N'
	-e PTRN	Pattern to match
	-f FILE	Read pattern from file

sh: 0: unknown operand
</pre>
</div></div>

<p>If I remove the record </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
2&gt;@1
</pre>
</div></div>

<p>in sensor_all.log  0B</p>

<p>Now, questions about the files they look like this: it seems that something is wrong.</p>

<p>in /facts: sensor_android, ipad, ipod <a class="confluence-thumbnail-link 474x89" href='http://www.openremote.org/download/attachments/23594199/facts sensor_android.png'><img src="attachments/thumbnails/23594199/23789930" align="absmiddle" border="0"/></a> pingsensor <a class="confluence-thumbnail-link 470x95" href='http://www.openremote.org/download/attachments/23594199/pingsensor.png'><img src="attachments/thumbnails/23594199/23789931" align="absmiddle" border="0"/></a> and increases.</p>

<p>in logs: sensor_android, ipad, ipod <a class="confluence-thumbnail-link 496x615" href='http://www.openremote.org/download/attachments/23594199/sensor_android.png'><img src="attachments/thumbnails/23594199/23789913" align="absmiddle" border="0"/></a> <a class="confluence-thumbnail-link 494x228" href='http://www.openremote.org/download/attachments/23594199/sensor_ipad.png'><img src="attachments/thumbnails/23594199/23789914" align="absmiddle" border="0"/></a></p>

<p>sensor_agg <a class="confluence-thumbnail-link 497x598" href='http://www.openremote.org/download/attachments/23594199/sensor_agg.png'><img src="attachments/thumbnails/23594199/23789916" align="absmiddle" border="0"/></a> and increases.</p>

<p>NICK BROOKES SAYS: <blockquote><p>you will need to ensure your phone / whatever you are sensing always gets the same ip address or this won't work...</p>

<p>sample of sensor used to read in result of ping scripts</p>

<p>the file pingsensor just contains a 1 or 0 indicating if the house is occupied or not.</p>

<p>sample rule to turn lights on if noone is home.</p></blockquote></p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aleksey_z at Jul 08, 2015 11:20
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23600061"></a>
                                    <font class="smallfont"><p>Hi.<br/>
I got work to all the scripts.<br/>
But I had to be replaced in the script, which checks the ip address in the "status =" letter "w", on the letter "v."</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
#!/bin/bash
#set up <span class="code-keyword">new</span> vars;
new_var=0
var1=nick
var2=192.168.1.20
ddd=$(date +<span class="code-quote">"%Y-%m-%d %H:%M:%S,%3N"</span>)
echo <span class="code-quote">"datetime = $ddd"</span>

echo <span class="code-quote">"ipaddress to check is $var2"</span>
status=`ping -qc 1 $var2 | grep -wi '[0-9][[:space:]]received'|awk -F, '{print $2}'|awk '{print $1}'`
echo <span class="code-quote">"$var1 status is :$status"</span>;

# <span class="code-keyword">if</span> status is ge 1 that means one of the ips responded to a ping.
# therefore value in pingsensor table should be set to 0;

   <span class="code-keyword">if</span> [[ $status -gt 0 ]]; then
   echo <span class="code-quote">"ping response received resetting $var1 status to 1"</span>
   echo <span class="code-quote">"1"</span> &gt; /opt/openremote/facts/sensor_$var1
   <span class="code-keyword">else</span>
    #write out a 0 in the nicksensor file
    echo <span class="code-quote">"0"</span> &gt; /opt/openremote/facts/sensor_$var1
   fi

ddd=$(date +<span class="code-quote">"%Y-%m-%d %H:%M:%S,%3N"</span>)
echo <span class="code-quote">"datetime = $ddd"</span>
echo <span class="code-quote">"**********************************************************"</span>
</pre>
</div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
status=`ping -qc 1 $var2 | grep -wi '[0-9][[:space:]]received'|awk -F, '{print $2}'|awk '{print $1}'`
</pre>
</div></div>
<p>in my script</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
status=`ping -qc 1 $var2 | grep -vi '[0-9][[:space:]]received'|awk -F, '{print $2}'|awk '{print $1}'`
</pre>
</div></div>

<p>In crontab:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
*/1 * * * /volume1/@appstore/OpenRemote/scripts/sensor_all &gt;&gt; /volume1/@appstore/OpenRemote/logs/dev/sensor_all.log 2&gt;@1
</pre>
</div></div>

<p>in sensor_all.log = 0B</p>

<p>Script sensor_all (Correct if wrong) <a class="confluence-thumbnail-link 865x478" href='http://www.openremote.org/download/attachments/23594199/sensor_all.png'><img src="attachments/thumbnails/23594199/23789917" align="absmiddle" border="0"/></a></p>

<p>Now I see in the log such records:</p>

<p>sensor_android, ipad, ipod <a class="confluence-thumbnail-link 496x615" href='http://www.openremote.org/download/attachments/23594199/sensor_android.png'><img src="attachments/thumbnails/23594199/23789913" align="absmiddle" border="0"/></a> or "0", if WiFi connection on device - off</p>

<p>sensor_agg <a class="confluence-thumbnail-link 497x598" href='http://www.openremote.org/download/attachments/23594199/sensor_agg.png'><img src="attachments/thumbnails/23594199/23789916" align="absmiddle" border="0"/></a></p>

<p>in /facts: sensor_android, ipad, ipod:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
0 or 1
</pre>
</div></div>

<p>pingsensor  <a class="confluence-thumbnail-link 470x95" href='http://www.openremote.org/download/attachments/23594199/pingsensor.png'><img src="attachments/thumbnails/23594199/23789931" align="absmiddle" border="0"/></a></p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
0 or 1
</pre>
</div></div>

<p>But, if no ping from devices, the value in the file "pingsensor" increases. </p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
Range( source==<span class="code-quote">"person_sensor2"</span>, value &gt; 3 )
</pre>
</div></div>

<p>If I create RangeSensor, which i need indicate the range: 0-500000, if I'm not in the office for a long time? Correct if wrong.</p>

<p>P.S.  I noticed when the devices Apple (Ipad and Ipod Touch) goes into sleep mode (screen goes blank), then they stop responding to pings. But Android smart phone Sony - no.</p>


<p>P.S.S.  </p>



<blockquote><p> NICK BROOKES SAYS:<br/>
let me know if you have any questions. </p></blockquote>

<p>I am trying to understand further.<br/>
I added Shell commands and sensors in OpenRemote.  Deduced the to the screen, here's what happened:</p>

<p>If all devices are not present (I disabled wi-fi on devices), it looks like <a class="confluence-thumbnail-link 356x237" href='http://www.openremote.org/download/attachments/23594199/dev off.png'><img src="attachments/thumbnails/23594199/23789939" align="absmiddle" border="0"/></a></p>

<p>if at least one (or several) device is present (I included wi-fi on devices), it looks like <a class="confluence-thumbnail-link 349x238" href='http://www.openremote.org/download/attachments/23594199/dev on.png'><img src="attachments/thumbnails/23594199/23789940" align="absmiddle" border="0"/></a></p>

<p>This is normal, everything is working properly?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aleksey_z at Jul 09, 2015 11:30
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:35</font></td>
		    </tr>
	    </table>
    </body>
</html>