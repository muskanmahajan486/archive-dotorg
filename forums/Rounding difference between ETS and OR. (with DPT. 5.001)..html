<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Rounding difference between ETS and OR. (with DPT. 5.001).</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Rounding difference between ETS and OR. (with DPT. 5.001).
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Feb 26, 2012 by <font color="#0050B2">kenta</font>.
				    </div>

				    <p>Hi, I have a minor problem. I get different values ​​in the ETS and OR.</p>

<p>I have create a KNX command "status" with DPT 5.001, the group address to the fan of my heat exchanger and bind it to a level sensor, then a label to display the value.</p>

<p>If I set the fan speed to 55% in the control panel (to the heat exchanger), I can read 55% in ETS, but OR shows 54%</p>

<p>The heat exchanger sends (55%) 8Ch -&gt; 140 x (100/255) = 54.90196...., ETS shows 55% and OR shows 54%.</p>

<p>I don't know if it can be of any help, but here is some readings I made in ETS and OR (I send a hex value and read it in ETS and OR).</p>

<p>Hex ETS% OR%</p>

<p>1 0 0<br/>
2 1 0<br/>
3 1 1<br/>
4 2 1<br/>
5 2 1<br/>
6 2 2<br/>
7 3 2<br/>
8 3 3<br/>
9 4 3<br/>
A 4 3<br/>
B 4 4<br/>
C 5 4<br/>
D 5 5<br/>
E 5 5<br/>
F 6 5<br/>
10 6 6<br/>
11 7 6<br/>
12 7 7<br/>
13 7 7<br/>
14 8 7<br/>
15 8 8<br/>
16 9 8<br/>
17 9 9<br/>
18 9 9<br/>
19 10 9<br/>
1A 10 10<br/>
1B 11 10<br/>
1C 11 10<br/>
1D 11 11<br/>
1E 12 11<br/>
.<br/>
.<br/>
8B 55 54<br/>
8C 55 54<br/>
8D 55 55<br/>
.<br/>
.<br/>
/Kenneth</p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19437530/19398798.class">Unsigned8Bit.class</a> (application/octet-stream)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-19437631"></a>
                                    <font class="smallfont"><p>Which version of the controller are you using?<br/>
There is a new version which has a lot KNX fixes: <a href="http://sourceforge.net/projects/openremote/files/For%20Developers/OpenRemote-Controller-2.0.0_SNAPSHOT_20120103.zip/download">http://sourceforge.net/projects/openremote/files/For%20Developers/OpenRemote-Controller-2.0.0_SNAPSHOT_20120103.zip/download</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 25, 2012 08:19
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437636"></a>
                                    <font class="smallfont"><p>Thanks</p>

<p>I´m using the new version.</p>

<p>/Kenneth</p>


</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Feb 25, 2012 09:06
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437761"></a>
                                    <font class="smallfont"><p>It couldn´t be that you take the integer Instead of rounding?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Feb 26, 2012 06:56
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437770"></a>
                                    <font class="smallfont"><p>Level sensor is indeed an integer <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/><br/>
Please try a custom sensor with state values attached. You will then receive the not rounded value as string.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 26, 2012 09:21
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437872"></a>
                                    <font class="smallfont"><p>Thank you Marcus.</p>

<p>I tried a custom sensor, but I didn´t get it to work. I got this error message in the controller.</p>

<p>Controller 2012-02-27 08:27:30,769 ERROR [Polling sensor Thread ID<br/>
  = 'test'] org.openremote.controller.bootstrap.Startup $ Log4jRedirect.</p>
<table class='confluenceTable'><tbody>
<tr>
<td class='confluenceTd'> Implementation error in protocol handler FRAME L_Data.req 0.0.0<br/>
Data: 0x00: unrecognized data point type 5001 on CUSTOM sensor.<br/>
java.lang.Error: unrecognized data point type 5001 CUSTOM one sensor.</td>
</tr>
</tbody></table>

<p>But, I'm not sure I managed to explain what I meant (sorry for my english).</p>

<p>I want an integer value (0-100) (DPT5.001). My problem is that I get different values ​​in  ETS and in OR, as in the example.<br/>
"The heat exchanger sends (55%) in hex "8C", the exact value is = 140 x (100/255) = 54.90196 .... ETS shows 55% and OR shows 54%."<br/>
What I meant was that it looks like that OR just takes the integer value (54) and skips the decimals, while ETS rounds 54.90196 .... to 55.</p>

<p>/Kenneth</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Feb 27, 2012 08:34
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437873"></a>
                                    <font class="smallfont"><p>The error looks like you forgot the "." when entering the DPT in the command (5001 instead 5.001).<br/>
We will have to take a look at the rounding issue.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 27, 2012 08:38
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437910"></a>
                                    <font class="smallfont"><p>Tanks</p>

<p>Strange! The "." must have disappeared when I did the copy and paste. The error log is with the "."</p>

<p>Controller 2012-02-27 08:27:30,769 ERROR [Polling Sensor Thread ID<br/>
 ='test'] org.openremote.controller.bootstrap.Startup$Log4jRedirect.<br/>
Implementation error in protocol handler FRAME L_Data.req 0.0.0<br/>
Data: 0x00 : Unrecognized datapoint type 5.001 on CUSTOM sensor.<br/>
java.lang.Error: Unrecognized datapoint type 5.001 on CUSTOM sensor.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Feb 27, 2012 12:53
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437919"></a>
                                    <font class="smallfont"><p>Ok, I just checked the source. Custom sensor indeed does not support DPT 5.001.<br/>
Could you try with the range sensor instead the level sensor. See if that returns the same value.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 27, 2012 13:32
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437924"></a>
                                    <font class="smallfont"><p>I tested with a range sensor instead, but I got the same values.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Feb 27, 2012 14:06
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439261"></a>
                                    <font class="smallfont"><p>Kenneth,</p>

<p>Thanks for sending the ETS numbers for comparison, that was very helpful.</p>

<p>I've patched things to round up, could you please confirm (I don't have KNX to test with) the attached patch.</p>

<p>You should be able to do a drop-in replacement of attached Unsigned8Bit.class to OpenRemote-Controller/webapps/controller/WEB-INF/classes/org/openremote/controller/protocol/knx/datatype/Unsigned8Bit.class</p>

<p>Thanks for reporting this issue.</p>

<p><a href="attachments/19437530/19398798.class">Unsigned8Bit.class</a></p>

<p>(I've confirmed the issue and fix with tests but not with a physical KNX installation)</p>

<p>&#8211; Juha</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Mar 04, 2012 19:14
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439385"></a>
                                    <font class="smallfont"><p>Thanks Juha!</p>

<p>I've tried the patch and it works perfect.</p>

<p>(You do not have time to take a look at the issue of minus degrees and DPT. 9001 too?)</p>

<p>/Kenneth</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Mar 05, 2012 10:21
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439527"></a>
                                    <font class="smallfont"><p>Yes, will patch it today and send the patch for testing with ETS.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Mar 06, 2012 09:12
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:31</font></td>
		    </tr>
	    </table>
    </body>
</html>