<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : A couple of questions about rules.</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : A couple of questions about rules.
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Mar 19, 2012 by <font color="#0050B2">kenta</font>.
				    </div>

				    <p>Hi!</p>

<p>I've looked in the sample file "Holidays.drl" from the test suite, and it says for example<br/>
&gt; then<br/>
&gt;<br/>
&gt;   execute.command ("temp", 21);<br/>
&gt;<br/>
&gt; end</p>

<p>What kind of command is "temp"? I haven't found any command to write a specific value. Is it possible to send 21 to the KNX installation without using a slider?</p>

<p>Another question. <br/>
I want to show different images for different ranges of values ​​(ex, a type of stabeldigram for the air supply fan, 0 - 10% one pin 10 - 20% two pins 20 - 30% three pins...... </p>

<p>My first thought was to use a Custom sensor and have different states for different ranges of values, but I couldn't get it to work with &lt; and &gt; characters in the Value field (is it possible to have a Custom Sensor with ex. "State1" Value &lt;10 and "State2", Value &gt; 10 &amp;&amp; &lt;20)? </p>

<p>Then I tried with a rule file and create a "virtual value" (ex. 10 for 0-10, 20 for 10-20....) And then use a custom sensor with states for 10, 20 .... and different images for different states. But I didn't found any way to get the custom sensor to read the virtual value. Is there any way to solve this? <br/>
(A In-memory virtual command to save and view "virtual" values from the rules would be an nice feature) </p>

<p>Now I use rule files and "In-memory Virtual" On, Off, and Status commands for each interval then I have Images and use a On/Off-Status-sensor to put on and off the images for each interval . It works, but there will be two rules, three commands and one sensor for each (11) interval. Then I must have an "off picture" for each interval (witch I don't want). <br/>
(Did anyone understand this???)</p>

<p>Is there any easier or better way to solve this?</p>

<p>/Kenneth</p>


				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439807/19398806.zip">openremote.zip</a> (application/zip)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439807/19398809.class">VirtualCommand.class</a> (application/octet-stream)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439807/19398808.drl">modeler_rules.drl</a> (application/octet-stream)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439807/19398807.class">VirtualCommand.class</a> (application/octet-stream)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439807/22052907.png">State_command.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439807/22052908.png">State_sensor.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439807/22052909.png">Image properties.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439807/22052910.jpg">FTX.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439807/22052911.jpg">awing.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439807/22052912.jpg">lamp.jpg</a> (image/jpeg)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-19439817"></a>
                                    <font class="smallfont"><p>"temp" in that case is a dummy command which created from the testsuite.<br/>
You can create a KNX command with DPT9.001 and command param "temp" to send temperature values to KNX devices.<br/>
The rule sysntax will be the same except the command name is the one you give when creating the command.</p>

<p>The custom sensor does not allow the greater or smaller logic. You could create a rule for that and give the state 1,2,3 into the sensor from the rule.<br/>
This way you only need one custom sensor with the 3 state and one image ui object which is linked to that sensor which has one image for each state.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 20, 2012 13:14
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439837"></a>
                                    <font class="smallfont"><p>Thank you very much Markus!</p>

<p>I tried with a "temp" command together with my rules and I got it to work.<br/>
Thanks alot!<br/>
(But I had some problems, I had to set the temp command in a "dummy slider" and put the slider on the UI first. I also had problems with, that the disigner didn't want to export my additions and changes, first when I removed some old commands and sensors the Disigner exported the changes.)</p>

<p>The solution with, put a custom sensor in different states directly from a rule, sounds great. I'll try it as soon as I have learned a little more about rules. (I'm not sure how the rule syntax to put a sensor in different states should look.) <br/>
What command should I use when creating the custom sensor? The fan speed is in DPT. 5.001 and the custom sensor doesn't support DPT. 5.001.</p>

<p>/Kenneth</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Mar 21, 2012 14:59
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439838"></a>
                                    <font class="smallfont"><p>True, in the moment a command needs UI object linked to it to be exported into the controller.<br/>
I will have a look at that.</p>

<p>Custom sensor should also work with DPT5.001. If not try Level which 1-100%</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 21, 2012 15:18
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439866"></a>
                                    <font class="smallfont"><p>Hi, Markus.</p>

<p>Now I don't think I understand what you mean.</p>

<p>The reason you recomend a custom sensor was to use the states for showing different images. Can you have states in a level sensor?</p>

<p>I tried again with a custom sensor and a DPT5.001 command and it didn't work now either. (February 27, you wrote this to me.)<br/>
"Ok, I just checked the source. Custom Sensor indeed does not support DPT 5.001."</p>

<p>That's why I wished a "in-memory virtual command" to get a value from a rule into a sensor</p>

<p>/Kenneth</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Mar 22, 2012 14:35
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439867"></a>
                                    <font class="smallfont"><p>I think, I also misunderstood you <img class="emoticon" src="images/icons/emoticons/wink.gif" height="20" width="20" align="absmiddle" alt="" border="0"/><br/>
What you need is a level sensor for the DPT5.001 and additionally a state sensor for the three states.<br/>
When the level sensor changes, you trigger a rule which does the equation (0-10, 10-20, 20-30) and sets, depending on the values, one of the three states.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 22, 2012 15:31
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439879"></a>
                                    <font class="smallfont"><p>Thank you for taking your time to explain this to me. I really appreciate it.</p>

<p>Yes, that's the way I understood you the first time. My question was referring to what command I should use when I create the state sensor (with state sensor, I assume you mean a custom sensor with states?)</p>

<p>Can I take any command (except DPT5.001 commands) because the state sensor will not use the command?</p>

<p>/Kenneth</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Mar 23, 2012 06:42
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439881"></a>
                                    <font class="smallfont"><p>Any command should do it. You could try the dummy command.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 23, 2012 07:57
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439932"></a>
                                    <font class="smallfont"><p>Hi, Markus.</p>

<p>I've been trying all weekend to find out how the rule to put the state sensor in different states should look like, but without any success. I even tried to look in the source, but it was too difficult for me.</p>

<p>The first half is not a problem, but I can't figure out, how to put the custom sensor in different states.</p>

<p>Do you have the possibility of helping me with the missing line??</p>

<p>rule "create state1 for fan speed"</p>

<p>when</p>

<p>  Level( source == "fan speed", value &gt; 0 &amp;&amp; &lt;= 10 )</p>

<p>then</p>

<p>  ????? ("name of state sensor") ??????? ("name of state1")</p>

<p>end</p>

<p>Thanks in advance.<br/>
/Kenneth</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Mar 26, 2012 08:21
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439933"></a>
                                    <font class="smallfont"><p>I will try something myself and also asked Juha to take a look.<br/>
We will let you know.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 26, 2012 10:30
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439934"></a>
                                    <font class="smallfont"><p>Thanks a lot!</p>

<p>I really appreciate it.</p>

<p>/Kenneth</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Mar 26, 2012 10:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439963"></a>
                                    <font class="smallfont"><p>The VirtualCommand did not support a CustomSensor, but only the CustomSensor allows different images for each state.<br/>
So I fixed the VirtualCommand and it worked for me <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/><br/>
The fix is for the offical 2.0 release which you can download from sourceforge.<br/>
Please replace the file VirtualCommand.class with the attached one in folder "openremote-controller/webapps/controller/WEB-INF/classes/org/openremote/controller/protocol/virtual".<br/>
You should be able to try with the attached openremote.zip and the attached rules.<br/>
<a href="attachments/19439807/19398806.zip">openremote.zip</a><br/>
<a href="attachments/19439807/19398807.class">VirtualCommand.class</a><br/>
<a href="attachments/19439807/19398808.drl">modeler_rules.drl</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 27, 2012 16:36
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439971"></a>
                                    <font class="smallfont"><p>Yes Yes!</p>

<p>It works for me too <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>Markus Thank you so much. You guys really do a fantastic job.</p>

<p>Will the new Virtual Command "1" be added in the disigner in the future, so I can add it there instead of edit the controller.xml?</p>

<p>One small problem I noticed is, that after every time I restart the controller, I have to do a sync to get it to work.</p>

<p>This is the log text I get before I have synced:</p>

<p>Exception in thread "Polling Sensor Thread ID = 783, Name ='State sensor'" java.lang.NullPointerException<br/>
        at org.openremote.controller.model.sensor.Sensor.isUnknownSensorValue(Sensor.java:161)<br/>
        at org.openremote.controller.model.sensor.StateSensor.processEvent(StateSensor.java:231)<br/>
        at org.openremote.controller.model.sensor.Sensor.update(Sensor.java:338)<br/>
        at org.openremote.controller.model.sensor.Sensor$DeviceReader.run(Sensor.java:608)<br/>
        at java.lang.Thread.run(Thread.java:662)</p>

<p>Could it have something to do with, that I get this error message every time I stop  the controller with Ctrl C.</p>

<p>ERROR KNX IP reconnector: Disconnect failed<br/>
org.openremote.controller.protocol.knx.ip.KnxIpException: Disconnect failed<br/>
        at org.openremote.controller.protocol.knx.ip.IpTunnelClient.disconnect(IpTunnelClient.java:146)<br/>
        at org.openremote.controller.protocol.knx.KNXIpConnectionManager$KNXConnectionImpl.stop(KNXIpConnectionManager.java:816)<br/>
        at org.openremote.controller.protocol.knx.KNXIpConnectionManager$KNXConnectionImpl.access$000(KNXIpConnectionManager.java:636)<br/>
        at org.openremote.controller.protocol.knx.KNXIpConnectionManager.stop(KNXIpConnectionManager.java:209)<br/>
        at org.openremote.controller.protocol.knx.KNXIpConnectionManager$ConnectionTask.removeConnection(KNXIpConnectionManager.java:990)<br/>
        at org.openremote.controller.protocol.knx.KNXIpConnectionManager$ConnectionTask.run(KNXIpConnectionManager.java:977)<br/>
        at java.util.TimerThread.mainLoop(Timer.java:512)<br/>
        at java.util.TimerThread.run(Timer.java:462)<br/>
Exception in thread "KNX IP reconnector" java.lang.IllegalStateException: Shutdown in progress<br/>
        at java.lang.ApplicationShutdownHooks.add(ApplicationShutdownHooks.java:39)<br/>
        at java.lang.Runtime.addShutdownHook(Runtime.java:192)<br/>
        at org.openremote.controller.protocol.knx.ip.IpTunnelClient.connect(IpTunnelClient.java:128)<br/>
        at org.openremote.controller.protocol.knx.KNXIpConnectionManager$KNXConnectionImpl.connect(KNXIpConnectionManager.java:704)<br/>
        at org.openremote.controller.protocol.knx.KNXIpConnectionManager.getConnection(KNXIpConnectionManager.java:224)<br/>
        at org.openremote.controller.protocol.knx.KNXIpConnectionManager$ConnectionTask.run(KNXIpConnectionManager.java:980)<br/>
        at java.util.TimerThread.mainLoop(Timer.java:512)<br/>
        at java.util.TimerThread.run(Timer.java:462)</p>

<p>The result is that I have to wait a few minutes before I can get the controller to start properly again. I don't think I had that problem with earlier versions of the controller.</p>

<p>Thank you,<br/>
/ Kenneth</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Mar 28, 2012 08:29
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439972"></a>
                                    <font class="smallfont"><p>The polling Error and the KNX error should not be related.<br/>
I also see the KNX error lately with my setup and we will have to take a look at that.</p>

<p>The virtual command itself should be already in the designer. What is not available there?</p>

<p>The few minutes wait could be because your KNX gateway only releases the connection after a few minutes if the connection was not closed properly. This is probably related to the KNX problem.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 28, 2012 11:47
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439974"></a>
                                    <font class="smallfont"><p>When I try to create the new Virtual Command "1" in the designer, I can't fill in command = 1. It says "use on/off or status"</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Mar 28, 2012 13:16
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439976"></a>
                                    <font class="smallfont"><p>The NullPointerException is from my modification. Please update with the attached VirtualCommand.class.<br/>
You can just use "status" as a command since this is not used at the time of controller startup anyway.</p>

<p>The KNX problem, we have to investigate.<br/>
<a href="attachments/19439807/19398807.class">VirtualCommand.class</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 28, 2012 14:03
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439985"></a>
                                    <font class="smallfont"><p>Thanks Markus!</p>

<p>Now the state sensor works perfectly, no polling errors and status as command works too.</p>

<p>Thank you very much.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Mar 29, 2012 06:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439987"></a>
                                    <font class="smallfont"><p>You are welcome.<br/>
If you are done with your design and it's worth sharing, you could post some screenshots <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 29, 2012 08:09
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440004"></a>
                                    <font class="smallfont"><p>I'm just at the beginning of my design, but as soon as I have something that may be worth showing, I promise to post some screenshots.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Mar 30, 2012 09:13
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440227"></a>
                                    <font class="smallfont"><p>Hi all!</p>

<p>I focus on monitoring my 1-wire radiation solar sensor. Sensor gives me the current values witch I can display with using custom sensor. Output value is like 0.0002343. I would like to set rules to separate range of output values. Like from 0 to 0.0003454, display "it is dark " and so on.</p>

<p>I did the following steps:</p>

<ul class="alternate" type="square">
	<li>I create In-memory Virtual Command:<br/>
  Command: State<br/>
  Address: 1</li>
</ul>


<ul class="alternate" type="square">
	<li>I update my controller with the attached VirtualCommand.class.</li>
</ul>


<ul class="alternate" type="square">
	<li>I also create custom sensor and add mapping:<br/>
  Name: a, Value: a<br/>
  Name: b, Value: b</li>
</ul>


<ul class="alternate" type="square">
	<li>and define the rules:</li>
</ul>


<p>  package org.openremote.controller.protocol<br/>
  package org.openremote.controller.model.event</p>

<p>  global org.openremote.controller.statuscache.CommandFacade execute;<br/>
  global org.openremote.controller.statuscache.SwitchFacade switches;<br/>
  global org.openremote.controller.statuscache.LevelFacade levels;<br/>
(i just add all that i found)</p>

<p>rule "crate a"<br/>
when<br/>
  ????( source == "solar command ", value &gt; 0.0000000 &amp;&amp; &lt;= 0.0002111 )<br/>
then<br/>
  execute.command("state", "a");<br/>
end</p>

<p>rule "create b"<br/>
when<br/>
  ????( source == "solar command", value &gt; 0.0002111 &amp;&amp; &lt;= 0.0050111 )<br/>
then<br/>
  execute.command("state", "b");<br/>
end</p>

<p>I tried with "Level" but it didn't work. Do I need to use "CustomState"?  I'm also confused by the line " $evt : "(like $evt : Range()). When can i use this?</p>


<p>Thanks for all support,<br/>
Nejc</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nejc at Apr 18, 2012 12:18
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440231"></a>
                                    <font class="smallfont"><p>Are you using the 2.0 release with the patches from this thread?</p>

<p>The 1-Wire command only returns a String and no number like the KNX temperature command.<br/>
This means you are most likely using a CustomSensor to display your 1-Wire reading which is fine for the UI.<br/>
For the rule to work you need to use CustomState where you have your questionmarks but also need to convert the value (which is a String) into a number.<br/>
Could you try this one:</p>

<p>rule "crate a"<br/>
when<br/>
CustomState( source == "solar command ", Float.parseFloat(value) &gt; 0.0000000 &amp;&amp; &lt;= Float.parseFloat(0.0002111) )<br/>
then<br/>
execute.command("state", "a");<br/>
end</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Apr 18, 2012 12:57
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440233"></a>
                                    <font class="smallfont"><p>First, thanks for your quick reply.</p>

<p>Yes i'm using the 2.0 release with the patches from this thread. </p>

<p>But i have strange problem. When i define rules and upload it into controller, all my display number(labels)... temperature (1-Wire) and date (DateTime protocol) (which is not connected with rules or virtual command) became N/A.</p>

<p>Rules: </p>

<p>package org.openremote.controller.protocol<br/>
package org.openremote.controller.model.event</p>

<p>global org.openremote.controller.statuscache.CommandFacade execute;<br/>
global org.openremote.controller.statuscache.SwitchFacade switches;<br/>
global org.openremote.controller.statuscache.LevelFacade levels;</p>


<p>rule "create a"<br/>
when<br/>
  CustomState( source == "svetilnost", Float.parseFloat(value) &gt; Float.parseFloat(0.0000000) &amp;&amp; &lt;= Float.parseFloat(0.0002111))<br/>
then<br/>
  execute.command("state", "a");<br/>
end</p>

<p>rule "create b"<br/>
when<br/>
  Level( source == "svetilnost", Float.parseFloat(value) &gt; Float.parseFloat(0.0002111) &amp;&amp; &lt;= Float.parseFloat(0.0050111))<br/>
then<br/>
  execute.command("state", "b");<br/>
end</p>


<p>Thank you,<br/>
Nejc</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nejc at Apr 18, 2012 14:01
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440235"></a>
                                    <font class="smallfont"><p>Please check the log directory and see if you find any errors and stacktraces.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Apr 18, 2012 14:05
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440236"></a>
                                    <font class="smallfont"><p>This is from boot.log.</p>

<p>DEBUG 2012-04-18 15:17:37,274 : Initializing event processor: Drools Rule Engine<br/>
DEBUG 2012-04-18 15:17:37,302 : Adding Rule 'modeler_rules.drl'...<br/>
ERROR 2012-04-18 15:17:37,719 : Cannot start event processor 'Drools Rule Engine' : Unable to load dialect 'org.drools.rule.builder.dialect.java.JavaDialectConfiguration:java:org.drools.rule.builder.dialect.java.JavaDialectConfiguration'<br/>
org.drools.RuntimeDroolsException: Unable to load dialect 'org.drools.rule.builder.dialect.java.JavaDialectConfiguration:java:org.drools.rule.builder.dialect.java.JavaDialectConfiguration'<br/>
	at org.drools.compiler.PackageBuilderConfiguration.addDialect(PackageBuilderConfiguration.java:283)<br/>
	at org.drools.compiler.PackageBuilderConfiguration.buildDialectConfigurationMap(PackageBuilderConfiguration.java:268)<br/>
	at org.drools.compiler.PackageBuilderConfiguration.init(PackageBuilderConfiguration.java:181)<br/>
	at org.drools.compiler.PackageBuilderConfiguration.&lt;init&gt;(PackageBuilderConfiguration.java:159)<br/>
	at org.drools.compiler.PackageBuilder.&lt;init&gt;(PackageBuilder.java:210)<br/>
	at org.drools.compiler.PackageBuilder.&lt;init&gt;(PackageBuilder.java:143)<br/>
	at org.drools.builder.impl.KnowledgeBuilderFactoryServiceImpl.newKnowledgeBuilder(KnowledgeBuilderFactoryServiceImpl.java:34)<br/>
	at org.drools.builder.KnowledgeBuilderFactory.newKnowledgeBuilder(KnowledgeBuilderFactory.java:47)<br/>
	at org.openremote.controller.statuscache.rules.RuleEngine.getValidKnowledgePackages(RuleEngine.java:484)<br/>
	at org.openremote.controller.statuscache.rules.RuleEngine.start(RuleEngine.java:253)<br/>
	at org.openremote.controller.statuscache.EventProcessorChain.start(EventProcessorChain.java:112)<br/>
	at org.openremote.controller.statuscache.StatusCache.start(StatusCache.java:120)<br/>
	at org.openremote.controller.deployer.Version20ModelBuilder.buildSensorModel(Version20ModelBuilder.java:615)<br/>
	at org.openremote.controller.deployer.Version20ModelBuilder.build(Version20ModelBuilder.java:537)<br/>
	at org.openremote.controller.deployer.AbstractModelBuilder.buildModel(AbstractModelBuilder.java:148)<br/>
	at org.openremote.controller.service.Deployer.startup(Deployer.java:760)<br/>
	at org.openremote.controller.service.Deployer.softRestart(Deployer.java:373)<br/>
	at org.openremote.controller.service.Deployer$ControllerDefinitionWatch.run(Deployer.java:1188)<br/>
	at java.lang.Thread.run(Thread.java:722)<br/>
Caused by: org.drools.RuntimeDroolsException: value '1.7' is not a valid language level<br/>
	at org.drools.rule.builder.dialect.java.JavaDialectConfiguration.getDefaultLanguageLevel(JavaDialectConfiguration.java:162)<br/>
	at org.drools.rule.builder.dialect.java.JavaDialectConfiguration.init(JavaDialectConfiguration.java:57)<br/>
	at org.drools.compiler.PackageBuilderConfiguration.addDialect(PackageBuilderConfiguration.java:279)<br/>
	... 18 more</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nejc at Apr 18, 2012 14:26
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440238"></a>
                                    <font class="smallfont"><p>The Drools version we currently use, does not support Java7. Can you try with a Java6?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Apr 18, 2012 14:39
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440239"></a>
                                    <font class="smallfont"><p>I will try with a Java6.</p>

<p>Thank you very much,<br/>
Nejc</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nejc at Apr 18, 2012 14:45
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440257"></a>
                                    <font class="smallfont"><p>Hi.</p>

<p>I installed java6 and tried deploy my configurations.</p>

<p>I get this (boot.log):</p>

<p>  UNDEPLOYING CURRENT CONTROLLER RUNTIME...<br/>
--------------------------------------------------------------------<br/>
DEBUG 2012-04-19 12:44:53,921 : Stopping event processor: Drools Rule Engine<br/>
INFO 2012-04-19 12:44:53,922 : Stopped event processor : Drools Rule Engine<br/>
INFO 2012-04-19 12:44:53,923 : Shutdown complete.<br/>
INFO 2012-04-19 12:44:53,923 :</p>


<p>Any idea why Drools Rule Engine stopped?</p>

<p>Thanks,<br/>
Nejc</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nejc at Apr 19, 2012 12:05
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440260"></a>
                                    <font class="smallfont"><p>It looks like the system started with a configuration that was already there and then a new sync was performed which does an undeploy first and then deploys again.</p>

<p>Please stop your Tomcat, delete controller.xml, panel.xml, panel.obj and any files in "rules" folder. Then start Tomcat again which should not deploy anything.</p>

<p>Now you can do a clean sync and see what happens.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Apr 19, 2012 12:20
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440261"></a>
                                    <font class="smallfont"><p>Now i get more useful errors:</p>

<p>DEBUG 2012-04-19 13:26:30,891 : Adding Rule 'modeler_rules.drl'...<br/>
ERROR 2012-04-19 13:26:31,550 : Rule definition 'modeler_rules.drl' could not be deployed. See errors below.<br/>
ERROR 2012-04-19 13:26:31,551 : ERR 103 Line 2:0 rule 'rule_key' failed predicate: <div class="error"><span class="error">Unknown macro: {(validateIdentifierKey(DroolsSoftKeywords.RULE))}</span> </div>? in rule<br/>
ERROR 2012-04-19 13:26:31,551 : ERR 101 Line 2:8 no viable alternative at input 'org' in rule package<br/>
ERROR 2012-04-19 13:26:31,551 : ERR 101 Line 4:0 no viable alternative at input 'global' in rule package in rule event<br/>
ERROR 2012-04-19 13:26:31,551 : ERR 101 Line 12:56 no viable alternative at input 'value' in rule package in rule event in rule "ustvari stanje a" in pattern CustomState<br/>
ERROR 2012-04-19 13:26:31,551 : ERR 102 Line 12:82 mismatched input '0.0000000' expecting ')' in rule package in rule event in rule "ustvari stanje a" in pattern CustomState in pattern Float.parseFloat<br/>
ERROR 2012-04-19 13:26:31,551 : ERR 101 Line 12:96 no viable alternative at input '&lt;=' in rule package in rule event in rule "ustvari stanje a" in pattern CustomState<br/>
ERROR 2012-04-19 13:26:31,551 : ERR 102 Line 12:116 mismatched input '0.0002111' expecting ')' in rule package in rule event in rule "ustvari stanje a" in pattern CustomState in pattern Float.parseFloat<br/>
ERROR 2012-04-19 13:26:31,551 : ERR 101 Line 19:50 no viable alternative at input 'value' in rule package in rule event in rule "ustvari stanje a" in rule "ustvari stanje b" in pattern Level<br/>
ERROR 2012-04-19 13:26:31,552 : ERR 102 Line 19:76 mismatched input '0.0002111' expecting ')' in rule package in rule event in rule "ustvari stanje a" in rule "ustvari stanje b" in pattern Level in pattern Float.parseFloat<br/>
ERROR 2012-04-19 13:26:31,552 : ERR 101 Line 19:90 no viable alternative at input '&lt;=' in rule package in rule event in rule "ustvari stanje a" in rule "ustvari stanje b" in pattern Level<br/>
ERROR 2012-04-19 13:26:31,552 : ERR 102 Line 19:110 mismatched input '0.0050111' expecting ')' in rule package in rule event in rule "ustvari stanje a" in rule "ustvari stanje b" in pattern Level in pattern Float.parseFloat<br/>
ERROR 2012-04-19 13:26:31,555 : There was an error parsing the rule definition 'modeler_rules.drl' : Could not parse knowledge.<br/>
java.lang.IllegalArgumentException: Could not parse knowledge.<br/>
	at org.drools.builder.impl.KnowledgeBuilderImpl.newKnowledgeBase(KnowledgeBuilderImpl.java:58)<br/>
	at org.openremote.controller.statuscache.rules.RuleEngine.getValidKnowledgePackages(RuleEngine.java:532)<br/>
	at org.openremote.controller.statuscache.rules.RuleEngine.start(RuleEngine.java:253)<br/>
	at org.openremote.controller.statuscache.EventProcessorChain.start(EventProcessorChain.java:112)<br/>
	at org.openremote.controller.statuscache.StatusCache.start(StatusCache.java:120)<br/>
	at org.openremote.controller.deployer.Version20ModelBuilder.buildSensorModel(Version20ModelBuilder.java:615)<br/>
	at org.openremote.controller.deployer.Version20ModelBuilder.build(Version20ModelBuilder.java:537)<br/>
	at org.openremote.controller.deployer.AbstractModelBuilder.buildModel(AbstractModelBuilder.java:148)<br/>
	at org.openremote.controller.service.Deployer.startup(Deployer.java:760)<br/>
	at org.openremote.controller.service.Deployer.softRestart(Deployer.java:373)<br/>
	at org.openremote.controller.service.Deployer$ControllerDefinitionWatch.run(Deployer.java:1188)<br/>
	at java.lang.Thread.run(Thread.java:662)<br/>
INFO 2012-04-19 13:26:31,659 : Initialized event processor : Drools Rule Engine</p>

<p>This are my rules:</p>

<p>package org.openremote.controller.protocol<br/>
package org.openremote.controller.model.event<br/>
global org.openremote.controller.statuscache.CommandFacade execute;<br/>
global org.openremote.controller.statuscache.SwitchFacade switches;<br/>
global org.openremote.controller.statuscache.LevelFacade levels;</p>

<p>rule "ustvari stanje a"<br/>
when<br/>
  CustomState( source == "svetilnost", Float.parseFloat(value) &gt; Float.parseFloat(0.0000000) &amp;&amp; &lt;= Float.parseFloat(0.0002111))<br/>
then<br/>
  execute.command("state", "a");<br/>
end</p>

<p>rule "ustvari stanje b"<br/>
when<br/>
  Level( source == "svetilnost", Float.parseFloat(value) &gt; Float.parseFloat(0.0002111) &amp;&amp; &lt;= Float.parseFloat(0.0050111))<br/>
then<br/>
  execute.command("state", "b");<br/>
end</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nejc at Apr 19, 2012 12:38
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440266"></a>
                                    <font class="smallfont"><p>I also get a lot of those errors when I use the "package org.openremote.controller.protocol"</p>

<p>Try without that line.</p>

<p>/ Kenneth</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Apr 19, 2012 14:00
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440267"></a>
                                    <font class="smallfont"><p>The same errors appeared.</p>

<p>Just for information: With this configuration (rules) my android app crashes.<br/>
In other cases my app works fine.</p>

<p>/Nejc</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nejc at Apr 19, 2012 14:16
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440278"></a>
                                    <font class="smallfont"><p>This rule works:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.model.event
global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;
global org.openremote.controller.statuscache.LevelFacade levels;

<span class="code-keyword">import</span> java.lang.<span class="code-object">Float</span>;

rule <span class="code-quote">"test 1"</span>
when
CustomState(source == <span class="code-quote">"Temp1Sensor"</span>, val : value, eval(<span class="code-object">Float</span>.valueOf(val) &gt; 24.000) &amp;&amp; eval(<span class="code-object">Float</span>.valueOf(val) &lt; 26))
then
<span class="code-object">System</span>.out.println(<span class="code-quote">"between 24 and 26"</span>);
end
</pre>
</div></div>

<p>Try to adapt to your needs.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Apr 20, 2012 10:29
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440325"></a>
                                    <font class="smallfont"><p>I tried to adopt but without success.</p>

<p>My rule: <br/>
ackage org.openremote.controller.model.event<br/>
global org.openremote.controller.statuscache.CommandFacade execute;<br/>
global org.openremote.controller.statuscache.SwitchFacade switches;<br/>
global org.openremote.controller.statuscache.LevelFacade levels;</p>

<p>import java.lang.Float;</p>

<p>rule "ustvari a"<br/>
when<br/>
CustomState(source == "svetilnost", val : value, eval(Float.valueOf(val) &gt; 0.0000000) &amp;&amp; eval(Float.valueOf(val) &lt; 0.0002111))<br/>
then<br/>
  execute.command("state", "a");<br/>
end</p>

<p>rule "ustvari b"<br/>
when<br/>
CustomState(source == "svetilnost", val : value, eval(Float.valueOf(val) &gt; 0.0002111) &amp;&amp; eval(Float.valueOf(val) &lt; 0.0050111))<br/>
then<br/>
  execute.command("state", "b");<br/>
end</p>

<p>And error list:<br/>
DEBUG 2012-04-23 09:49:25,557 : Adding Rule 'modeler_rules.drl'...<br/>
ERROR 2012-04-23 09:49:25,869 : Rule definition 'modeler_rules.drl' could not be deployed. See errors below.<br/>
ERROR 2012-04-23 09:49:25,869 : Rule Compilation error The method valueOf(String) in the type Float is not applicable for the arguments (Object)<br/>
The method valueOf(String) in the type Float is not applicable for the arguments (Object)<br/>
ERROR 2012-04-23 09:49:25,869 : Rule Compilation error The method valueOf(String) in the type Float is not applicable for the arguments (Object)<br/>
The method valueOf(String) in the type Float is not applicable for the arguments (Object)<br/>
ERROR 2012-04-23 09:49:25,869 : There was an error parsing the rule definition 'modeler_rules.drl' : Could not parse knowledge.<br/>
java.lang.IllegalArgumentException: Could not parse knowledge.<br/>
	at org.drools.builder.impl.KnowledgeBuilderImpl.newKnowledgeBase(KnowledgeBuilderImpl.java:58)<br/>
	...</p>

<p>/ Nejc</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nejc at Apr 23, 2012 10:26
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440327"></a>
                                    <font class="smallfont"><p>try: Float.valueOf((String)val)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Apr 23, 2012 11:08
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440333"></a>
                                    <font class="smallfont"><p>Now there are no errors, but Drools Rule Engine is stopped.</p>

<p>Boot.log:<br/>
DEBUG 2012-04-23 13:05:35,923 : Initializing event processor: Drools Rule Engine<br/>
DEBUG 2012-04-23 13:05:35,924 : Adding Rule 'modeler_rules.drl'...<br/>
DEBUG 2012-04-23 13:05:36,056 : Adding rule definitions from 'modeler_rules.drl'...<br/>
INFO 2012-04-23 13:05:36,067 : Initialized event processor : Drools Rule Engine<br/>
...<br/>
DEBUG 2012-04-23 13:05:38,177 : Stopping event processor: Drools Rule Engine<br/>
INFO 2012-04-23 13:05:38,178 : Stopped event processor : Drools Rule Engine<br/>
INFO 2012-04-23 13:05:38,181 : Shutdown complete.</p>

<p>Sensors.log (svetilnost sensor is custom sensor that uses Virtual command):<br/>
INFO 2012-04-23 13:05:36,167 : Started polling thread for sensor (ID = 266, name = svetilnost senzor).<br/>
INFO 2012-04-23 13:05:38,178 : Shutting down polling thread of sensor (ID = 266, name = svetilnost senzor).</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nejc at Apr 23, 2012 12:29
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440335"></a>
                                    <font class="smallfont"><p>Can you try and delete controller.xml, panel.xml, and file within rules folder.<br/>
Restart tomcat and make a fresh sync.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Apr 23, 2012 13:16
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440336"></a>
                                    <font class="smallfont"><p>The same happens.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nejc at Apr 23, 2012 14:24
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440337"></a>
                                    <font class="smallfont"><p>It seems to redeploy the configuration.<br/>
Do you find anything in the logfiles?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Apr 23, 2012 15:23
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440338"></a>
                                    <font class="smallfont"><p>No, i didn't.<br/>
Could be problem in java and javac path? I have jdk6 in /usr/lib/jvm/. I set JAVA_HOME to /usr/lib/jvm/ and JRE_HOME to /usr/lib/jvm/jre/ (jdk containing jre).</p>

<p>When I run openremote.sh I get in terminal:<br/>
root@ort-laptop:/usr/OpenRemote-Controller/bin# sh openremote.sh run<br/>
Using CATALINA_BASE:   /usr/OpenRemote-Controller<br/>
Using CATALINA_HOME:   /usr/OpenRemote-Controller<br/>
Using CATALINA_TMPDIR: /usr/OpenRemote-Controller/temp<br/>
Using JRE_HOME:       /usr/lib/jvm/jre<br/>
23.4.2012 17:17:13 org.apache.catalina.core.AprLifecycleListener init<br/>
INFO: The APR based Apache Tomcat Native library which allows optimal performance in production environments was not found on the java.library.path: /usr/OpenRemote-Controller/webapps/controller/WEB-INF/lib/native<br/>
23.4.2012 17:17:13 org.apache.coyote.http11.Http11Protocol init<br/>
INFO: Initializing Coyote HTTP/1.1 on http-8080<br/>
23.4.2012 17:17:13 org.apache.catalina.startup.Catalina load<br/>
INFO: Initialization processed in 618 ms<br/>
23.4.2012 17:17:13 org.apache.catalina.core.StandardService start<br/>
INFO: Starting service Catalina<br/>
23.4.2012 17:17:13 org.apache.catalina.core.StandardEngine start<br/>
INFO: Starting Servlet Engine: Apache Tomcat/6.0.18<br/>
23.4.2012 17:17:13 org.apache.catalina.startup.HostConfig deployWAR<br/>
INFO: Deploying web application archive webconsole.war<br/>
23.4.2012 17:17:14 org.openremote.controller.bootstrap.Startup redirectJULtoLog4j<br/>
INFO: Initialized JUL to LOG4J Redirector.<br/>
...</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nejc at Apr 23, 2012 16:39
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440339"></a>
                                    <font class="smallfont"><p>Everything looks normal.<br/>
If you start tomcat does it look like this at the end:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
INFO: Starting Coyote HTTP/1.1 on http-8080
Apr 23, 2012 5:58:48 PM org.apache.catalina.startup.Catalina start
INFO: Server startup in 6891 ms
</pre>
</div></div>

<p>Can you see your design when access the controller with your console?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Apr 23, 2012 17:00
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440340"></a>
                                    <font class="smallfont"><p>If you start tomcat does it look like this at the end: yes.</p>

<p>I can see my design in webconsole. Label that should display rule output isn't shown. Other looks normal.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nejc at Apr 23, 2012 17:32
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19988829"></a>
                                    <font class="smallfont"><p>(del) </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pawel jucewicz at May 23, 2012 15:48
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19988830"></a>
                                    <font class="smallfont"><p>I searched forums and haven't found such an issue. </p>

<p>I want send a value to KNX via Switch or button. I have created In Memory commands: on, off, status. Then i created sensor using status command and after that I created Switch. Addresses for commands are "dummy". I also added switch to a panel.</p>

<p>I also created rule which, I hope, will write value to a KNX group addres (scene recall). Updated file VirtualCommand.class</p>

<p>The Rule is</p>

<p>rule "Send Value 1"</p>

<p>when</p>

<p>  Switch( source ==  "switch 1 sensor", value == "on")</p>

<p>then</p>

<p>  execute.command("Scena 1 slide",1);</p>

<p>end</p>

<p>And I get error form openremote</p>

<p>ERROR 2012-05-23 16:31:35,925 : Rule definition 'modeler_rules.drl' could not be deployed. See errors below.<br/>
ERROR HTTP\-Thread\-1: Rule definition 'modeler_rules.drl' could not be deployed. See errors below.<br/>
ERROR 2012-05-23 16:31:35,925 : Unable to resolve ObjectType 'Switch'<br/>
ERROR HTTP\-Thread\-1: Unable to resolve ObjectType 'Switch'<br/>
ERROR 2012-05-23 16:31:35,926 : Rule Compilation error execute cannot be resolved<br/>
ERROR HTTP\-Thread\-1: Rule Compilation error execute cannot be resolved<br/>
Unable to resolve ObjectType 'Switch' : Rule name='Send Value 1'</p>

<p>Rule Compilation error : Rule name='Send Value 1'<br/>
	defaultpkg/Rule_Send_Value_1_0.java (8:295) : execute cannot be resolved</p>

<p>What am I doing wrong? I think that the value should be derived from sensor but why OpenRemote cannot resolve ObjectType Switch?</p>

<p>I would really appreciate your help.</p>

<p>P.S I tried with rule </p>

<p>rule "Send Value 1"<br/>
when<br/>
  Switch( sourceID ==  550, value == "on") <br/>
then<br/>
  execute.command("Scena 1 slide",1);<br/>
end<br/>
And had no changes...</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pawel jucewicz at May 23, 2012 15:48
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19988834"></a>
                                    <font class="smallfont"><p>Do you have the package, the globals and imports in your rule file?<br/>
If not, put the following lines </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.model.event

global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;

<span class="code-keyword">import</span> org.openremote.controller.protocol.Event;
</pre>
</div></div>

<p>infront of your rule definition</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at May 23, 2012 21:04
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19988835"></a>
                                    <font class="smallfont"><p>That's it!</p>

<p>I did quick update and everything works perfect now! Thank you very much. </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pawel jucewicz at May 23, 2012 21:21
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857062"></a>
                                    <font class="smallfont"><blockquote><p>I'm just at the beginning of my design, but as soon as I have something that may be worth showing, I promise to post some screenshots</p></blockquote>
<p>@Kenneth, Did you ever get this working and documented?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Feb 04, 2013 14:27
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857349"></a>
                                    <font class="smallfont"><p>Yes, it works perfectly, but I have not done any documentation on it.</p>

<p>I'm still not finished with my design, but of course I can show some screenshots of my images, depending on various states (as I promised).</p>

<p>I use the "State Sensor" for example to show different images depending on, dimming value of lamps, bar chart showing different fan speeds and different positions on my awnings.</p>

<p>Here are a few screenshots.</p>

<p><img src="attachments/19439807/22052910.jpg" align="left" border="0"/><br/>
<img src="attachments/19439807/22052911.jpg" align="left" border="0"/><br/>
<img src="attachments/19439807/22052912.jpg" align="left" border="0"/></p>

<p>The way I did it:</p>

<p>Create a in-memory Virtual Command (like this).</p>

<p><img src="attachments/19439807/22052907.png" align="left" border="0"/></p>


<p>Create a custom sensor to display state value from the command (like this).</p>

<p><img src="attachments/19439807/22052908.png" align="left" border="0"/></p>


<p>Connect the new sensor to your image and then add the alternate image for each state (like this).</p>

<p><img src="attachments/19439807/22052909.png" align="left" border="0"/></p>


<p>Write a rule to put the sensor in the different state (like this).</p>


<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.protocol
global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;

rule <span class="code-quote">"create state1 <span class="code-keyword">for</span> balcony awing"</span>

when
  Level( source == <span class="code-quote">"balcony awing position status"</span>, value == 0 )
then
  <span class="code-object">System</span>.out.println(<span class="code-quote">"balcony awing State1"</span>);
  execute.command(<span class="code-quote">"Set state balcony awing"</span>, <span class="code-quote">"a"</span>);
end

rule <span class="code-quote">"create state2 <span class="code-keyword">for</span> balcony awing"</span>

when
  Level( source == <span class="code-quote">"balcony awing position status"</span>, value &gt; 0 &amp;&amp; &lt;= 25 )
then
  <span class="code-object">System</span>.out.println(<span class="code-quote">"balcony awing State2"</span>);
  execute.command(<span class="code-quote">"Set state balcony awing"</span>, <span class="code-quote">"b"</span>);
end

rule <span class="code-quote">"create state3 <span class="code-keyword">for</span> balcony awing"</span>

when
  Level( source == <span class="code-quote">"balcony awing position status"</span>, value &gt; 25 &amp;&amp; &lt;= 50 )
then
  <span class="code-object">System</span>.out.println(<span class="code-quote">"balcony awing State3"</span>);
  execute.command(<span class="code-quote">"Set state balcony awing"</span>, <span class="code-quote">"c"</span>); 
end
.
.
.
</pre>
</div></div>

<p>"balcony awing position status" is the name of the level sensor, where the value will trigger the state.</p>


<p>"Set state balcony awing" is the name of the in-memory virtual command that we just created.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by kenta at Feb 08, 2013 09:08
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857356"></a>
                                    <font class="smallfont"><p>Impressive, thanks!</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Feb 08, 2013 13:50
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:43</font></td>
		    </tr>
	    </table>
    </body>
</html>