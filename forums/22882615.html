<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : drools on a button?</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : drools on a button?
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 12, 2014 by <font color="#0050B2">ptruman</font>.
				    </div>

				    <p>Lo all</p>

<p>If I have a straight forward button (not a switch), can I tie a drool to it?</p>

<p>I have a fire which has the following commands:</p>

<p>ON/UP (same command)<br/>
DOWN<br/>
OFF</p>

<p>Because On and Up are the same, I can "light" the fire by pressing On or Up within OR.  If I use a switch for On/Off, but press Up, the switch state is wrecked.  I could use a drool to update an IMVC sensor value, but can't see an example to fire a drool on a button?</p>

<p>Clues? <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>


				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-22882623"></a>
                                    <font class="smallfont"><p>NB : I actually went a bit mad and created three sensors - one for the overall fire state (on/off) and one for if someone was pressing Up or Down - to only executed Up/Down if the fire was on.  However, to avoid a loop, I have to execute fire up/down AND then reset the sensor of the up/down button - and that seems to get "stuck" within OR - hence wanting to just pick up a button press, so I can do once test and one command, not two tests and two commands....</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ptruman at Jan 12, 2014 14:30
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22882625"></a>
                                    <font class="smallfont"><p>How about using a slider on that ImVC Sensor (make it of type:range). </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jan 12, 2014 14:42
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22882626"></a>
                                    <font class="smallfont"><p>At this stage, UI events are not exposed to the rules engine, so you need to work through a variable with virtual commands.</p>

<p>Pushing the button triggers a command that sets the virtual command to On.<br/>
Via a sensor on that virtual command address, have a rule triggered when value goes to on.<br/>
In the rule, do whatever you have to do, then reset virtual command to Off.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ebariaux at Jan 12, 2014 14:45
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22882629"></a>
                                    <font class="smallfont"><blockquote><p>sensor on that virtual command address</p></blockquote>
<p>In a sensor I can select the name of a command, not the address of a virtual command. I still am a bit confused about the role/prpperties of adresses in virtual commands.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jan 12, 2014 14:55
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22882634"></a>
                                    <font class="smallfont"><p>I did exactly that, but it seems to jam (esp. if I set the button to allow being "held").  </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ptruman at Jan 12, 2014 14:57
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22882635"></a>
                                    <font class="smallfont"><p>Won't work unfortunately.</p>

<p>This is an IR based target device, and the IR emitter is a bit "hit &amp; miss", so there is no guarantee the value you 'set' is the value you 'get'.  Basically it comes on "full" and you can adjust it down (then back up) but no way (other than using your eyes) of telling the setting, and if the IR emission from the iTach doesn't process, your sensor is out of whack.</p>

<p>The only thing that works is 'spamming' on and off which guarantee it's on/off - but fine adjustments are a pain. </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ptruman at Jan 12, 2014 14:59
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22882637"></a>
                                    <font class="smallfont"><p>Sensors use commands to "get" a value - so if you are using a Hue light, you can issue the relevant HTTP get and use JSON to extract the value (brightness value for example).</p>

<p>With IMVC, you need at least an on, off and status command.  Then you wire the sensor to use the status command, typically as a switch.  That will then tell you wether it's "on" of "off".  Link with drools to execute commands when the switch (and therefore IMVC value) changes and you're away.</p>

<p>I use exactly this to give 'state' to LightWaveRF devices <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ptruman at Jan 12, 2014 15:01
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22882642"></a>
                                    <font class="smallfont"><p>The address of a virtual command is a bit like the name of a variable (or property).<br/>
You can't access the variable directly, you need to go through a getter or a setter.<br/>
Those are the commands you need to set and read the value.</p>

<p>The sensor reads the value of the variable with a given name (virtual command at a specific address) via the getter (the read command).</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ebariaux at Jan 12, 2014 15:10
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22882643"></a>
                                    <font class="smallfont"><p>Weird, I thought we used that in the past.<br/>
If I get a bit of time (can't promise), I'll try to reproduce.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ebariaux at Jan 12, 2014 15:11
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22882645"></a>
                                    <font class="smallfont"><p>I can't see any logs, but given I'm using an iTach, I can see when the event gets to it (LED lights) - single presses are fine, but holding it seems to 'clog' after about 3 or 4 command iterations and it stops.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ptruman at Jan 12, 2014 15:14
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22882646"></a>
                                    <font class="smallfont"><p>I take it that the button is set to repeat then.</p>

<p>What I could see happening is some form of race condition or issue with timings of events.<br/>
All rules execution happens in a single thread, and if the command you're triggering is an iTach command, it can take a bit of time to execute, "locking" that thread during this time.</p>

<p>As a test, could you replace the iTach command execution in the rule with a debug statement: <div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-object">System</span>.out.println(<span class="code-quote">"Should execute command"</span>);</pre>
</div></div><br/>
This should be immediate so not cause any timing issue.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ebariaux at Jan 12, 2014 15:23
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22882650"></a>
                                    <font class="smallfont"><p>My suggestion was intended to let the rule(s) do things as a response on value changes in the virtual slider. But indeed as you say due to the nature of this IR thing it won't work. (As you can in my private space I do know a bit about <a href="http://www.openremote.org/x/ByhdAQ">ImVC's</a>)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jan 12, 2014 15:41
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22882651"></a>
                                    <font class="smallfont"><p>I'll check.  That may be it, as another (separate) iTach command from the same emitter still seems to work.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ptruman at Jan 12, 2014 15:42
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:35</font></td>
		    </tr>
	    </table>
    </body>
</html>