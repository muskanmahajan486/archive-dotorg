<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Support for other DSC interfaces</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Support for other DSC interfaces
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Dec 23, 2012 by <font color="#0050B2">philetaylor</font>.
				    </div>

				    <p>Hi.</p>

<p>I have just started using OpenRemote and have my Samsung TV working fine <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>I would like to be able to control my DSC alarm as well but it looks like only the IT-100 interface is currently supported and I have the Envisalink 3 which is a 3rd party IP interface.</p>

<p>My question really is, has anybody already adapted the current DSCIT100 protocol implementation to support the newer Envisalink interfaces? If not this is something I plan to try (I am mainly a C++ programmer but I have done a bit of Java!).</p>

<p>If anybody has any help or suggestions, they will be gratefully received!</p>

<p>btw, the Envisalink TPI (Third Party Integration) document can be downloaded from: <a href="http://forum.eyez-on.com/FORUM/download/file.php?id=16&amp;sid=1686b4d4690821ed72e523b17e0a774f">http://forum.eyez-on.com/FORUM/download/file.php?id=16&amp;sid=1686b4d4690821ed72e523b17e0a774f</a></p>

<p>Thanks</p>

<p>Phil</p>

				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-21038993"></a>
                                    <font class="smallfont"><p>I would say go ahead. The DSC is currently community supported so feel free to claim ownership. Let us know if you need something to get started.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Dec 23, 2012 05:28
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21039083"></a>
                                    <font class="smallfont"><p>As it happens, the protocol is mainly unchanged, the main change that I needed to do was to add a login command when first connected (which the it100 doesn't need) there are also quite a few additional commands available which I am gradually adding. The main benefit though is that it should work with either it100 or Envisalink cards so no need to create a new protocol although I did wonder whether it should be renamed to just dsc though?</p>

<p>Thanks</p>

<p>Phil</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by philetaylor at Dec 26, 2012 10:44
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21039125"></a>
                                    <font class="smallfont"><p>Well I thought I would have a play with z-wave. I tried downloading the Controller_2_1_0_ProInstaller_1_0_5_20121212 from SVN but I guess this is only for 'pro' registered users as the online designer doesn't seem to work. Everything else is OK though...</p>

<p>I suppose I am getting far enough into OR to justify actually paying something for it now but I just wondered what other benefits I am likely to see from a pro registration as I am probably not going to use more than 10 z-wave devices as I am just using it in a 3 bedroom semi not a mansion <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>Phil</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by philetaylor at Dec 28, 2012 01:50
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21039162"></a>
                                    <font class="smallfont"><p>You should be ok with the 2.1-developer-snapshot and the zwave jar which you can find in the Zwave-Howto.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Dec 29, 2012 01:00
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21039165"></a>
                                    <font class="smallfont"><p>I went and ordered the pro license anyway <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by philetaylor at Dec 29, 2012 02:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21528996"></a>
                                    <font class="smallfont"><p>Yesterday I ordered the Envisalink and I just notice this post.</p>

<p>I know C under UNIX and few scripting languages, not java but if I'd be happy to download whatever is available so I can test and perhaps try to do some coding if required.</p>

<p>What's the current status and is there a place to download?</p>

<p>Thank you,<br/>
Pierre</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by belanger at Jan 12, 2013 20:52
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21528999"></a>
                                    <font class="smallfont"><p>Hi.</p>

<p>It is working with the Envisalink, I have added a number of features that may break support for the original DSC IT100 (I can't tell as I don't own one!)</p>

<p>I am happy to make my updated files available, I have added a number of features including sensors for the LED and Display status etc.</p>

<p>It is pretty stable and seems to work perfectly!</p>

<p>Phil</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by philetaylor at Jan 12, 2013 20:56
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21529001"></a>
                                    <font class="smallfont"><p>That was a quick reply, thank you.  I'm very happy to hear this is completed, I've myself in the past contributed to many Unix open source software. Today with children around I have less time <img class="emoticon" src="images/icons/emoticons/sad.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>I hope OpenRemote gets involve here and manage to get your patch added to the source code repo so that everyone can download it and try it under both IT100 and Envisalink.  We definitely need to make sure IT100 isn't broken.  OpenRemote being a Euro company, I hope they are aware that the Envisalink is such a great addon compare to the IT100 module.</p>

<p>So what are the steps to get the patch in the source repo?  I see you can insert a link in a post but not a file.  Maybe just paste the patch here?  or if it's available via github, put the link?</p>

<p>Thank you,<br/>
Pierre</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by belanger at Jan 12, 2013 21:31
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21529006"></a>
                                    <font class="smallfont"><p>We would like to hear from someone who wants to become a certified integrator for DSC products with responsibility to test, support and maintain DSC products. If you know anyone, send us an email.</p>

<p>Until then DSC support must be managed by the community since we have no capability to test or verify changes.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jan 13, 2013 02:35
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21529076"></a>
                                    <font class="smallfont"><p>I would be happy to take on this role although as I say I haven't got the original IT100. The Envisalink is considered the replacement owing to the fact that it has a direct IP connection and the API is almost identical (other than you need to authenticate to it.)</p>

<p>The way I have updated the code is to change as little as possible other than adding a password parameter. If this is blank then it won't attempt to authenticate so should work just like the IT100 and the Envisalink specific commands shouldn't have any impact as you won't use them unless you need to.</p>

<p>I will try to create a diff of the changes so far (it is a bit of a work in progress) and post it here.</p>

<p>Cheers</p>

<p>Phil</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by philetaylor at Jan 13, 2013 16:39
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21529084"></a>
                                    <font class="smallfont"><p>Below is a quick diff that I created against the original dscit100 code.</p>

<p>You will need to add a line into config.properties for the Envisalink password (default=user) If this password is missing then it should just work like an IT100</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
dscit100.<span class="code-keyword">interface</span>.password=user
</pre>
</div></div>

<p>Also the constructor is different so change this in applicationContext.xml</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
  &lt;!-- DSC IT Security <span class="code-object">System</span> --&gt;
  &lt;bean id = <span class="code-quote">"dscit100CommandBuilder"</span> class = <span class="code-quote">"org.openremote.controller.protocol.dscit100.DSCIT100CommandBuilder"</span>&gt;
    &lt;constructor-arg index=<span class="code-quote">"0"</span> value=<span class="code-quote">"${dscit100.<span class="code-keyword">interface</span>.password}"</span> /&gt;
  &lt;/bean&gt;
</pre>
</div></div>

<p>I found it best to create custom sensors called PARTITION and LED to store the state information, this also kick-starts the connection when it first checks the state and everything should get updated correctly. </p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
diff -urN dscit100.orig/DSCIT100CommandBuilder.java dscit100/DSCIT100CommandBuilder.java
--- dscit100.orig/DSCIT100CommandBuilder.java	2012-12-12 09:55:00.000000000 +0000
+++ dscit100/DSCIT100CommandBuilder.java	2012-12-28 00:10:56.000000000 +0000
@@ -27,6 +27,7 @@
 <span class="code-keyword">import</span> org.openremote.controller.command.Command;
 <span class="code-keyword">import</span> org.openremote.controller.command.CommandBuilder;
 <span class="code-keyword">import</span> org.openremote.controller.exception.NoSuchCommandException;
+<span class="code-keyword">import</span> org.openremote.controller.Constants;
 
 <span class="code-keyword">public</span> class DSCIT100CommandBuilder <span class="code-keyword">implements</span> CommandBuilder
 {
@@ -38,7 +39,7 @@
    * A common log category name intended to be used across all classes related
    * to DSCIT100 implementation.
    */
-  <span class="code-keyword">public</span> <span class="code-keyword">final</span> <span class="code-keyword">static</span> <span class="code-object">String</span> DSCIT100_LOG_CATEGORY = <span class="code-quote">"DSCIT100"</span>;
+  <span class="code-keyword">public</span> <span class="code-keyword">final</span> <span class="code-keyword">static</span> <span class="code-object">String</span> DSCIT100_LOG_CATEGORY  = Constants.CONTROLLER_PROTOCOL_LOG_CATEGORY + <span class="code-quote">"dscit100"</span>;
 
   /**
    * <span class="code-object">String</span> constant <span class="code-keyword">for</span> parsing DSCIT100 protocol XML entries from
@@ -132,12 +133,14 @@
   <span class="code-comment">// ------------------------------------------------------------------------------
</span> 
   <span class="code-keyword">private</span> <span class="code-keyword">final</span> DSCIT100ConnectionManager connectionManager = <span class="code-keyword">new</span> DSCIT100ConnectionManager();
+  <span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-object">String</span> dscPassword;
 
   <span class="code-comment">// Constructors
</span>   <span class="code-comment">// ---------------------------------------------------------------------------------
</span> 
-  <span class="code-keyword">public</span> DSCIT100CommandBuilder()
+  <span class="code-keyword">public</span> DSCIT100CommandBuilder(<span class="code-object">String</span> dscPassword)
   {
+	<span class="code-keyword">this</span>.dscPassword=dscPassword;
     <span class="code-comment">// TODO Auto-generated constructor stub
</span>   }
 
diff -urN dscit100.orig/DSCIT100ConnectionManager.java dscit100/DSCIT100ConnectionManager.java
--- dscit100.orig/DSCIT100ConnectionManager.java	2012-12-12 09:55:00.000000000 +0000
+++ dscit100/DSCIT100ConnectionManager.java	2012-12-28 00:22:13.000000000 +0000
@@ -53,7 +53,7 @@
   /**
    * Default TCP port <span class="code-keyword">if</span> none is provided in command definition
    */
-  <span class="code-keyword">private</span> <span class="code-keyword">final</span> <span class="code-keyword">static</span> <span class="code-object">int</span> DEFAULT_TCP_PORT = 5000;
+  <span class="code-keyword">private</span> <span class="code-keyword">final</span> <span class="code-keyword">static</span> <span class="code-object">int</span> DEFAULT_TCP_PORT = 4025;
 
   <span class="code-comment">// Instance Fields
</span>   <span class="code-comment">// ------------------------------------------------------------------------------
</span>diff -urN dscit100.orig/ExecuteCommand.java dscit100/ExecuteCommand.java
--- dscit100.orig/ExecuteCommand.java	2012-12-12 09:55:00.000000000 +0000
+++ dscit100/ExecuteCommand.java	2012-12-27 17:59:48.000000000 +0000
@@ -194,7 +194,31 @@
     <span class="code-keyword">private</span> <span class="code-keyword">static</span> Packet get(<span class="code-keyword">final</span> <span class="code-object">String</span> name, <span class="code-keyword">final</span> <span class="code-object">String</span> code,
         <span class="code-keyword">final</span> <span class="code-object">String</span> target)
     {
-      <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"ARM_AWAY"</span>))
+      <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"POLL"</span>))
+      {
+        <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"000"</span>, "");
+      }
+      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"STATUS"</span>))
+      {
+        <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"001"</span>, "");
+      }
+      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"LOGIN"</span>))
+      {
+        <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"005"</span>, <span class="code-quote">"user"</span>);
+      }
+      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"ZONE_TIMERS"</span>))
+      {
+        <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"008"</span>, "");
+      }
+      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"SET_DATETIME"</span>))
+      {
+        <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"010"</span>, code);
+      }
+      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"COMMAND_OUTPUT"</span>))
+      {
+        <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"020"</span>, target + code);
+      }
+      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"ARM_AWAY"</span>))
       {
         <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"030"</span>, target);
       }
@@ -231,6 +255,18 @@
       {
         <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"040"</span>, target + code);
       }
+      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"TIMESTAMP"</span>))
+      {
+        <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"055"</span>, target);
+      }
+      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"TIME_BROADCAST"</span>))
+      {
+        <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"056"</span>, target);
+      }
+      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"TEMP_BROADCAST"</span>))
+      {
+        <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"057"</span>, target);
+      }
       <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"PANIC_FIRE"</span>))
       {
         <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"060"</span>, <span class="code-quote">"1"</span>);
@@ -243,6 +279,26 @@
       {
         <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"060"</span>, <span class="code-quote">"3"</span>);
       }
+      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"SINGLE_KEY"</span>))
+      {
+        <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"070"</span>, target);
+      }
+      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"KEYSTROKE"</span>))
+      {
+        <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"071"</span>, target + code);
+      }
+      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"USER_CODE_PROG"</span>))
+      {
+        <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"072"</span>, target);
+      }
+      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"USER_PROG"</span>))
+      {
+        <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"073"</span>, target);
+      }
+      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"KEEPALIVE"</span>))
+      {
+        <span class="code-keyword">return</span> <span class="code-keyword">new</span> Packet(<span class="code-quote">"074"</span>, target);
+      }
       <span class="code-keyword">else</span>
       {
         <span class="code-keyword">return</span> <span class="code-keyword">null</span>;
diff -urN dscit100.orig/IpConnection.java dscit100/IpConnection.java
--- dscit100.orig/IpConnection.java	2012-12-12 09:55:00.000000000 +0000
+++ dscit100/IpConnection.java	2012-12-27 17:57:12.000000000 +0000
@@ -186,10 +186,14 @@
       log.info(<span class="code-quote">"Starting read loop <span class="code-keyword">for</span> "</span>
           + socket.getInetAddress().getHostAddress());
 
+      <span class="code-comment">// Main difference between it100 and envisalink is that envisalink needs a password!
</span>+      <span class="code-keyword">if</span> (DSCIT100CommandBuilder.dscPassword != <span class="code-keyword">null</span>)
+              sendInternal(<span class="code-keyword">new</span> Packet(<span class="code-quote">"005"</span>, DSCIT100CommandBuilder.dscPassword)); <span class="code-comment">// Always login when <span class="code-keyword">new</span> connection
</span>+
       <span class="code-comment">// Send IT100 state discovery packet to get current system state
</span>       sendInternal(<span class="code-keyword">new</span> Packet(<span class="code-quote">"001"</span>, ""));
       <span class="code-comment">// Send IT100 labels request packet to get system labels
</span>-      sendInternal(<span class="code-keyword">new</span> Packet(<span class="code-quote">"002"</span>, ""));
+      <span class="code-comment">//sendInternal(<span class="code-keyword">new</span> Packet(<span class="code-quote">"002"</span>, ""));
</span> 
       <span class="code-object">boolean</span> isConnected = <span class="code-keyword">true</span>;
 
@@ -212,16 +216,44 @@
           IpConnection.<span class="code-keyword">this</span>.close();
         }
 
-        <span class="code-keyword">if</span> (packet != <span class="code-keyword">null</span>)
-        {
-          state.processPacket(packet);
 
-          <span class="code-keyword">if</span> (packetCallback != <span class="code-keyword">null</span>)
+        <span class="code-keyword">try</span>
+        {
+          <span class="code-keyword">if</span> (packet != <span class="code-keyword">null</span>)
           {
-            log.debug(<span class="code-quote">"Executing callback method <span class="code-keyword">for</span> packet "</span> + packet);
-            packetCallback.receive(IpConnection.<span class="code-keyword">this</span>, packet);
+            <span class="code-keyword">if</span> (packet.getCommand().equals(<span class="code-quote">"505"</span>))
+            { <span class="code-comment">// Login interraction
</span>+                <span class="code-object">String</span> num = packet.getData().substring(0, 1);
+                log.debug(<span class="code-quote">"Login Interraction [number="</span> + num + <span class="code-quote">"]"</span>);
+                <span class="code-keyword">if</span> (num == <span class="code-quote">"3"</span>){
+                  log.debug(<span class="code-quote">"Login required"</span>);
+                      sendInternal(<span class="code-keyword">new</span> Packet(<span class="code-quote">"005"</span>, <span class="code-quote">"user"</span>));
+
+                } <span class="code-keyword">else</span> <span class="code-keyword">if</span> (num == <span class="code-quote">"1"</span>) {
+                  log.debug(<span class="code-quote">"Login successful"</span>);
+                } <span class="code-keyword">else</span> <span class="code-keyword">if</span> (num == <span class="code-quote">"0"</span>) {
+                  log.debug(<span class="code-quote">"Invalid password"</span>);
+                }
+
+            } <span class="code-keyword">else</span> {
+                  state.processPacket(packet);
+            }
+
+            <span class="code-keyword">if</span> (packetCallback != <span class="code-keyword">null</span>)
+            {
+              log.debug(<span class="code-quote">"Executing callback method <span class="code-keyword">for</span> packet "</span> + packet);
+              packetCallback.receive(IpConnection.<span class="code-keyword">this</span>, packet);
+            }
           }
         }
+        <span class="code-keyword">catch</span> (Exception e)
+        {
+          log.warn(<span class="code-quote">"Error in packet"</span>, e);
+          isConnected = <span class="code-keyword">false</span>;
+          <span class="code-comment">// Connection has failed, close the socket so it can be recreated
</span>+          <span class="code-comment">// later
</span>+          IpConnection.<span class="code-keyword">this</span>.close();
+        }
 
       }
     }
diff -urN dscit100.orig/PanelState.java dscit100/PanelState.java
--- dscit100.orig/PanelState.java	2012-12-12 09:55:00.000000000 +0000
+++ dscit100/PanelState.java	2012-12-29 02:41:46.000000000 +0000
@@ -52,7 +52,7 @@
 
   <span class="code-keyword">public</span> <span class="code-keyword">enum</span> StateType
   {
-    ZONE, ZONE_ALARM, PARTITION, LABEL
+    ZONE, ZONE_ALARM, PARTITION, LABEL, LED
   }
 
   <span class="code-keyword">public</span> <span class="code-keyword">enum</span> ZoneState <span class="code-keyword">implements</span> State
@@ -72,8 +72,14 @@
 
   /**
    * A security system label (i.e. Back Door, Basement Motion Detector)
-   * 
+   *
    */
+  <span class="code-keyword">public</span> <span class="code-keyword">enum</span> LedState <span class="code-keyword">implements</span> State
+  {
+    OFF,ON,FLASH
+  }
+
+
   <span class="code-keyword">public</span> class Label <span class="code-keyword">implements</span> State
   {
     <span class="code-keyword">private</span> <span class="code-object">String</span> label;
@@ -152,7 +158,29 @@
    */
   <span class="code-keyword">public</span> <span class="code-keyword">synchronized</span> void processPacket(Packet packet)
   {
-    <span class="code-keyword">if</span> (packet.getCommand().equals(<span class="code-quote">"570"</span>))
+    <span class="code-keyword">if</span> (packet.getCommand().equals(<span class="code-quote">"510"</span>))
+    { <span class="code-comment">// Led Update
</span>+      <span class="code-object">int</span> leds = <span class="code-object">Integer</span>.parseInt(packet.getData().substring(0, 2),16);
+      <span class="code-object">int</span> mask = 1 &lt;&lt; 7;
+      <span class="code-keyword">for</span> (<span class="code-object">int</span> c=1;c&lt;=8;c++)
+      {
+        log.debug(<span class="code-quote">"LED Status update [LED"</span>+<span class="code-object">String</span>.valueOf(c)+<span class="code-quote">"="</span>+((leds&amp;mask)==0?<span class="code-quote">"OFF"</span>:<span class="code-quote">"ON"</span>)+<span class="code-quote">"]"</span>);
+        updateInternalState(StateType.LED, <span class="code-object">String</span>.valueOf(c), (leds&amp;mask)==0?LedState.OFF:LedState.ON);
+        leds &lt;&lt;= 1;
+      }
+    }
+    <span class="code-keyword">else</span> <span class="code-keyword">if</span> (packet.getCommand().equals(<span class="code-quote">"511"</span>))
+    { <span class="code-comment">// Led Update
</span>+      <span class="code-object">int</span> leds = <span class="code-object">Integer</span>.parseInt(packet.getData().substring(0, 2),16);
+      <span class="code-object">int</span> mask = 1 &lt;&lt; 7;
+      <span class="code-keyword">for</span> (<span class="code-object">int</span> c=1;c&lt;=8;c++)
+      {
+        log.debug(<span class="code-quote">"LED Status update [LED"</span>+<span class="code-object">String</span>.valueOf(c)+<span class="code-quote">"="</span>+((leds&amp;mask)==0?<span class="code-quote">"OFF"</span>:<span class="code-quote">"FLASH"</span>)+<span class="code-quote">"]"</span>);
+        updateInternalState(StateType.LED, <span class="code-object">String</span>.valueOf(c), (leds&amp;mask)==0?LedState.OFF:LedState.FLASH);
+        leds &lt;&lt;= 1;
+      }
+    }
+    <span class="code-keyword">else</span> <span class="code-keyword">if</span> (packet.getCommand().equals(<span class="code-quote">"570"</span>))
     { <span class="code-comment">// Broadcast Labels
</span>       <span class="code-object">String</span> num = packet.getData().substring(0, 3);
       num = trimLeadingZeros(num);
diff -urN dscit100.orig/ReadCommand.java dscit100/ReadCommand.java
--- dscit100.orig/ReadCommand.java	2012-12-12 09:55:00.000000000 +0000
+++ dscit100/ReadCommand.java	2012-12-29 02:50:32.000000000 +0000
@@ -144,14 +144,14 @@
   @Override
   <span class="code-keyword">public</span> <span class="code-object">String</span> read(EnumSensorType sensorType, Map&lt;<span class="code-object">String</span>, <span class="code-object">String</span>&gt; stateMap)
   {
-    log.debug(<span class="code-quote">"Sensor read request [type="</span> + sensorType.toString()
-        + <span class="code-quote">", stateMap="</span> + stateMap.toString() + <span class="code-quote">"]"</span>);
-    log.debug(<span class="code-quote">"Reading state <span class="code-keyword">for</span> - "</span> + <span class="code-keyword">this</span>);
+<span class="code-comment">//    log.debug(<span class="code-quote">"Sensor read request [type="</span> + sensorType.toString()
</span>+<span class="code-comment">//       + <span class="code-quote">", stateMap="</span> + stateMap.toString() + <span class="code-quote">"]"</span>);
</span>+<span class="code-comment">//    log.debug(<span class="code-quote">"Reading state <span class="code-keyword">for</span> - "</span> + <span class="code-keyword">this</span>);
</span>     PanelState.State state = <span class="code-keyword">super</span>.read(<span class="code-keyword">this</span>);
-    <span class="code-keyword">if</span> (state != <span class="code-keyword">null</span>)
-      log.debug(<span class="code-quote">"[state="</span> + state.toString().toUpperCase() + <span class="code-quote">"]"</span>);
-    <span class="code-keyword">else</span>
-      log.debug(<span class="code-quote">"[state=NULL]"</span>);
+<span class="code-comment">//    <span class="code-keyword">if</span> (state != <span class="code-keyword">null</span>)
</span>+<span class="code-comment">//     log.debug(<span class="code-quote">"[state="</span> + state.toString().toUpperCase() + <span class="code-quote">"]"</span>);
</span>+<span class="code-comment">//    <span class="code-keyword">else</span>
</span>+<span class="code-comment">//      log.debug(<span class="code-quote">"[state=NULL]"</span>);
</span>     <span class="code-keyword">if</span> (sensorType == EnumSensorType.CUSTOM)
     {
       <span class="code-keyword">return</span> state != <span class="code-keyword">null</span> ? state.toString().toUpperCase() : "";
@@ -195,6 +195,10 @@
       {
         <span class="code-keyword">return</span> <span class="code-keyword">new</span> StateDefinition(PanelState.StateType.LABEL, target);
       }
+      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (name.equals(<span class="code-quote">"LED"</span>))
+      {
+        <span class="code-keyword">return</span> <span class="code-keyword">new</span> StateDefinition(PanelState.StateType.LED, target);
+      }
       <span class="code-keyword">else</span>
       {
         <span class="code-keyword">return</span> <span class="code-keyword">null</span>;
</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by philetaylor at Jan 13, 2013 17:18
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21529182"></a>
                                    <font class="smallfont"><p>Good to hear and thanks for the diff!</p>

<p>Let me get back to you with some details about submitting your changes and getting you set up with Subversion access.</p>

<p>But first I need some sleep.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jan 14, 2013 17:17
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21529237"></a>
                                    <font class="smallfont"><p>No problem, I am enjoying it and learning Java at the same time <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>With the DenonAVRSerial mods that I have made, I implemented sensors using EventListener. Is that considered a better/more efficient way of handling sensors? Is it worth rewriting the DSCIT100 code to use it?</p>

<p>Phil</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by philetaylor at Jan 15, 2013 11:00
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21529247"></a>
                                    <font class="smallfont"><p>Yes EventListener is a better (non-polling) way of receiving device status for devices that can actively broadcast their state changes.</p>

<p>It is probably worth it for DSCIT-100 too if it can send out status updates actively, to avoid polling the device for those changes. Functionality from the user point of view will remain the same but it will reduce the network load towards the device.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jan 15, 2013 12:18
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21529248"></a>
                                    <font class="smallfont"><p>Sent you an email separately with regards to getting a Subversion access and getting your changes merged back to the release branches.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jan 15, 2013 12:19
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857374"></a>
                                    <font class="smallfont"><p>So getting back to this patch and reviewing it &#8211; this first thing that pops up is should we separate the IT-100 and Envisalink to their own packages to avoid disrupting the existing IT-100 implementation, especially since we currently lack the ability to test it?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Feb 09, 2013 04:47
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857376"></a>
                                    <font class="smallfont"><p>Pierre,</p>

<p>Would be interested in understanding the differences between IT100 and Envisalink functionality. You seem to prefer latter?</p>

<p>Also, are you able to confirm IT100 functionality?</p>

<p>Let me know if you need binaries to test the patches Phil posted below.</p>

<p>Thanks,</p>

<p>&#8211; Juha</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Feb 09, 2013 05:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857399"></a>
                                    <font class="smallfont"><p>Hi Juha.</p>

<p>The IT100 is the older RS232 interface whereas the Envisalink is a direct Ethernet based unit that is being actively developed by eyez-on <a href="https://www.eyez-on.com/EZMAIN/envisalink3.php">https://www.eyez-on.com/EZMAIN/envisalink3.php</a> </p>

<p>I don't think that IT100 compatibility will be broken as the only real functional change that I made was authentication (as the IT100 doesn't require it). If no password is set in config.properties then it won't try to authenticate. It is also quite likely that the IT100 would simply ignore the password anyway. Other than that the commands are identical. </p>

<p>The other commands that I have added (LED support etc) should be supported by both the IT100 and Envlisalink.  If they aren't supported then we have lost nothing as IT100 should simply not use them...</p>

<p>I don't have an IT100 to test so it is possible that I have "broken" something although I think it is unlikely <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>For new installations, I would expect most (all?) people would use the Envisalink rather than the IT100</p>

<p>Phil</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by philetaylor at Feb 09, 2013 09:01
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857404"></a>
                                    <font class="smallfont"><p>Ok, good to know, thanks.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Feb 09, 2013 09:47
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857451"></a>
                                    <font class="smallfont"><p>Could we rename everything to remove "dscit100/DSCIT100" and possibly use a more generic name like "dsc-alarm" or "dsc-panel" or ? ... and Add a note at the top in the comments to mention that the module supports the IT100 and Envisalink modules.  The IT100 does bug me <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>Pierre</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by belanger at Feb 11, 2013 19:54
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857452"></a>
                                    <font class="smallfont"><p>Juha,</p>

<p>Like Phil mention the Envisalink sits directly on the IP network while the IT100 is a serial device.  It's good to support both because the IT100 has been around since quite a long time but definitely the Envisalink module is probably a better choice for most people.</p>

<p>Maybe have a IT100 delivered to to Phil so he can make tests?  It can be a lot more work for Phil, it all depends on his setup and if he'd care to do proper QA for both devices.  I also asked myself the question if the source code should be split for each device.</p>

<p>Pierre</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by belanger at Feb 11, 2013 20:12
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857453"></a>
                                    <font class="smallfont"><p>Hi Pierre.</p>

<p>Juha and I have been discussing this and I think it is quite likely that the protocol will (eventually) be renamed although obviously the difficulties of doing this without breaking compatibility with existing users will have to be taken into account!</p>

<p>While I have been careful to try not to break IT100 support (most changes are in response to commands received from the card, specifically for authentication). You are quite right that the only way to do proper QA would be to fully test with both EnvisaLink and IT100 cards. I have been keeping an eye on ebay to see if I can pick an IT100 card up cheap. For my purposes I don't actually need one (as I have an EnvisaLink) but it would be useful to have for testing purposes and would enable me to discover any differences between the two.</p>

<p>Thanks</p>

<p>Phil</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by philetaylor at Feb 11, 2013 21:02
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857458"></a>
                                    <font class="smallfont"><p>Decided not to split at this point, given the feedback from Phil. The decision is documented here: <a href="http://jira.openremote.org/browse/ORCJAVA-302?focusedCommentId=11296&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-11296">ORCJAVA-302</a></p>

<p>If the differences stay as minimal as they are right now, which is to say additional connection authentication plus possibility of unsupported packets which are ignored by the gateway, I think it's ok to stick with one generic DSC support package.</p>

<p>If however there are signs of further diverging implementations between the two gateways (which would not be unusual) then managing the conditional code in single implementation may become unnecessarily messy, and would warrant separate implementation packages.</p>

<p>Going to try to manage with single implementation for now.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Feb 12, 2013 07:40
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857459"></a>
                                    <font class="smallfont"><p>Yes, I've started this rename for the parts that have little or no impact to users and implementation, and they've been committed to phil's issue branch at <a href="https://openremote.svn.sourceforge.net/svnroot/openremote/workspace/philetaylor/Controller_2_1_0_FM_ORCJAVA-302-Envisalink/">https://openremote.svn.sourceforge.net/svnroot/openremote/workspace/philetaylor/Controller_2_1_0_FM_ORCJAVA-302-Envisalink/</a></p>

<p>Have not renamed classes or packages since those will have a bigger impact &#8211; there's an issue for tracking the rename here: <a href="http://jira.openremote.org/browse/ORCJAVA-304">ORCJAVA-304</a>.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Feb 12, 2013 07:53
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857460"></a>
                                    <font class="smallfont"><p>Let us know if you manage to spot IT-100 on the cheap. We should be able to cover the cost for you.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Feb 12, 2013 07:55
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857980"></a>
                                    <font class="smallfont"><p>HI Phil did you get an IT100 - I have one going spare - I decided to upgrade to the Envisalink prior to installing so no longer need it.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jules_bike at Feb 24, 2013 17:51
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857988"></a>
                                    <font class="smallfont"><p>Hi Jules.</p>

<p>No I never found one, most of the IT100's on eBay are in the USA so the delivery cost is a bit prohibitive.</p>

<p>I would be happy to buy it off you or if you are prepared to lend it to me that would be great!</p>

<p>Thanks</p>

<p>Phil</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by philetaylor at Feb 24, 2013 19:26
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21857989"></a>
                                    <font class="smallfont"><p>I'm not after any money - hopefully I can benefit from your work down the line!  I'm in the skype openremote contributors group if you want to contact me with your address and I'll post it next week.  I live in France so will take a few days though...</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jules_bike at Feb 24, 2013 20:05
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 10:45</font></td>
		    </tr>
	    </table>
    </body>
</html>