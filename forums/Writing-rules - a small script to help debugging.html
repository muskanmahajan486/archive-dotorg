<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Writing-rules - a small script to help debugging</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Writing-rules - a small script to help debugging
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Aug 12, 2014 by <font color="#0050B2">gheinert</font>.
				    </div>

				    <p>This may be useful for people who are using a lot of Rules as part of their design. <br/>
As far as I know there is no easy way to debug rules. When editing rules within the designer it takes some time to download the rules to your controller and to restart the controller as all of your pictures etc are downloaded. Sometimes I've found that I edited rules in the designer and for some reason the downloaded copy was not updated. So I've found it easier to edit, write and test the rules on my own computer (running windows) rather than the designer. Once the rules are working on your windows machine you can copy them to your openremote setup on the Raspberry Pi etc..<br/>
Here is also a short script that helps with the writing of rules. Once the script is running you can just pressed "Alt" and "x" together and the controller restarts and the "boot.log" file is opened so you can see whether the rule engine has started normally or whether there are any syntax problems etc.<br/>
Another tip for rules: the rule engine is case sensitive and any small typos in the names of sensors or commands means that the rule will not work. To avoid this from happening I found it's best to copy and paste the sensor name etc from designer into my rule file.</p>

<p>The other tip for rules in to include the following line in your rule after "then":</p>

<p>System.out.println(drools.getRule().getName());</p>

<p>This will print out the name of the rule in your TomCat window when it is fired.</p>

<p>Similarly you can use the following line after the then statement to display the values of variables, in this case $Ist.getValue()<br/>
System.out.println( $Ist.getValue());</p>


<p>So here is what I've done to make it easier to develop rules for your design. I am assuming Openremote is installed in C:\OpenRemote</p>

<p>1.	Don't use the rules editor inside the Designer. Keep this blank<br/>
2.	Place your rule file e.g. "rules.drl" into the directory: "C:\OpenRemote\webapps\controller\rules" The name of your file does not matter as long as it has the extension .drl. You can have your rules even in multiple *.drl file<br/>
3.	Go to the directory C:\OpenRemote\bin. Create a shortcut to openremote.bat by right clicking on the file. Right click on the created "openremote.bat - Shortcut". Click on properties and change "Target" from "C:\OpenRemote\bin\openremote.bat" to "C:\OpenRemote\bin\openremote.bat start"<br/>
4.	Download and Install SciTE4AutoHotkey from <a href="http://fincs.ahk4.net/scite4ahk/">http://fincs.ahk4.net/scite4ahk/</a><br/>
5.	Start the following Script in AutoHotKey:</p>

<p>#SingleInstance force<br/>
!x::<br/>
WinClose, boot.log<br/>
WinWaitClose<br/>
WinClose, Tomcat<br/>
WinWaitClose<br/>
FileDelete, C:\OpenRemote\logs\boot.log<br/>
run, "c:\OpenRemote\bin\openremote.bat - Shortcut.lnk"<br/>
sleep, 10000<br/>
run, notepad.exe C:\OpenRemote\logs\boot.log<br/>
return</p>

<p>Now you can edit your rule file "rules.drl" in Notepad. Once you have made your changes you just need to save the file "rules.drl" to the directory "C:\OpenRemote\webapps\controller\rules", you don't even need to close "rules.drl" in Notepad. Then press "Alt" and "x" together. The controller restarts and 10 seconds later the file "boot.log" is opened in notepads. You can check whether the rules engine has started and whether there are any syntax errors. Then you can test your rules.<br/>
If your controller takes longer than 10.000ms to start change the line sleep, 10000 as necessary in the AutoHot Key Script.</p>

<p>Maybe it helps somebody...</p>

<p>Gideon</p>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:32</font></td>
		    </tr>
	    </table>
    </body>
</html>