<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Display of feedback in UI</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Display of feedback in UI
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Dec 06, 2010 by <font color="#0050B2">ebariaux</font>.
				    </div>

				    <p>Testing my feedback in the Lutron module, I want to:<br/>
1. display the # of the scene selected in a label<br/>
2. have an image with 2 states depending of whether scene 1 is selected or not</p>

<p>For 1. I created a sensor of type range in the model, created a label in the UI and assigned the sensor to the label -&gt; label text is never updated<br/>
For 2. I created a sensor of type switch in the model, created an image in the UI and assigned the sensor as well as all images -&gt; default image is always displayed and never any of the image assigned for on or off state.</p>

<p>On the server side, I do see my status command being executed and I do return e.g. for 2. either on or off depending on the scene selected.</p>

<p>Any idea on where to look?</p>

<p>Thanks,<br/>
Eric</p>

				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-13697314"></a>
                                    <font class="smallfont"><p>Hi Eric,</p>

<p>I tested #2 and it was working ok for me.</p>

<p>I used the "virtual" protocol for testing that support on/off state.</p>

<p>Posting the XML files below, in case it helps. If you want to test on controller, replace the images with something of your own on the controller.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml">
<span class="code-tag">&lt;?xml version=<span class="code-quote">"1.0"</span> encoding=<span class="code-quote">"UTF-8"</span>?&gt;</span>
&lt;openremote xmlns=<span class="code-quote">"http://www.openremote.org"</span> 
            <span class="code-keyword">xmlns:xsi</span>=<span class="code-quote">"http://www.w3.org/2001/XMLSchema-instance"</span> 
            xsi:schemaLocation=<span class="code-quote">"http://www.openremote.org http://www.openremote.org/schemas/panel.xsd"</span>&gt;
  <span class="code-tag">&lt;panels&gt;</span>
    <span class="code-tag">&lt;panel id=<span class="code-quote">"69"</span> name=<span class="code-quote">"Test Image States"</span>&gt;</span>
      <span class="code-tag">&lt;include type=<span class="code-quote">"group"</span> ref=<span class="code-quote">"70"</span> /&gt;</span>
    <span class="code-tag">&lt;/panel&gt;</span>
  <span class="code-tag">&lt;/panels&gt;</span>
  <span class="code-tag">&lt;screens&gt;</span>
    <span class="code-tag">&lt;screen id=<span class="code-quote">"71"</span> name=<span class="code-quote">"Starting Screen"</span>&gt;</span>
      <span class="code-tag">&lt;absolute left=<span class="code-quote">"162"</span> top=<span class="code-quote">"97"</span> width=<span class="code-quote">"50"</span> height=<span class="code-quote">"50"</span>&gt;</span>
        <span class="code-tag">&lt;switch id=<span class="code-quote">"74"</span>&gt;</span>
          <span class="code-tag">&lt;link type=<span class="code-quote">"sensor"</span> ref=<span class="code-quote">"77"</span>&gt;</span>
            <span class="code-tag">&lt;state name=<span class="code-quote">"on"</span> value=<span class="code-quote">"infrared.png"</span> /&gt;</span>
            <span class="code-tag">&lt;state name=<span class="code-quote">"off"</span> value=<span class="code-quote">"pause.png"</span> /&gt;</span>
          <span class="code-tag">&lt;/link&gt;</span>
        <span class="code-tag">&lt;/switch&gt;</span>
      <span class="code-tag">&lt;/absolute&gt;</span>
      <span class="code-tag">&lt;absolute left=<span class="code-quote">"33"</span> top=<span class="code-quote">"189"</span> width=<span class="code-quote">"266"</span> height=<span class="code-quote">"192"</span>&gt;</span>
        <span class="code-tag">&lt;image id=<span class="code-quote">"76"</span> src=<span class="code-quote">"OpenRemote.Logo.30x32.png"</span>&gt;</span>
          <span class="code-tag">&lt;link type=<span class="code-quote">"sensor"</span> ref=<span class="code-quote">"77"</span>&gt;</span>
            <span class="code-tag">&lt;state name=<span class="code-quote">"off"</span> value=<span class="code-quote">"Designer64x821291789024106.png"</span> /&gt;</span>
            <span class="code-tag">&lt;state name=<span class="code-quote">"on"</span> value=<span class="code-quote">"AndroidAd256x2201291788994626.png"</span> /&gt;</span>
          <span class="code-tag">&lt;/link&gt;</span>
        <span class="code-tag">&lt;/image&gt;</span>
      <span class="code-tag">&lt;/absolute&gt;</span>
    <span class="code-tag">&lt;/screen&gt;</span>
  <span class="code-tag">&lt;/screens&gt;</span>
  <span class="code-tag">&lt;groups&gt;</span>
    <span class="code-tag">&lt;group id=<span class="code-quote">"70"</span> name=<span class="code-quote">"Default Group"</span>&gt;</span>
      <span class="code-tag">&lt;include type=<span class="code-quote">"screen"</span> ref=<span class="code-quote">"71"</span> /&gt;</span>
    <span class="code-tag">&lt;/group&gt;</span>
  <span class="code-tag">&lt;/groups&gt;</span>
<span class="code-tag">&lt;/openremote&gt;</span>
</pre>
</div></div>



<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml">
<span class="code-tag">&lt;?xml version=<span class="code-quote">"1.0"</span> encoding=<span class="code-quote">"UTF-8"</span>?&gt;</span>
&lt;openremote xmlns=<span class="code-quote">"http://www.openremote.org"</span> 
            <span class="code-keyword">xmlns:xsi</span>=<span class="code-quote">"http://www.w3.org/2001/XMLSchema-instance"</span> 
            xsi:schemaLocation=<span class="code-quote">"http://www.openremote.org http://www.openremote.org/schemas/controller.xsd"</span>&gt;
  <span class="code-tag">&lt;components&gt;</span>
    <span class="code-tag">&lt;switch id=<span class="code-quote">"74"</span>&gt;</span>
      <span class="code-tag">&lt;on&gt;</span>
        <span class="code-tag">&lt;include type=<span class="code-quote">"command"</span> ref=<span class="code-quote">"78"</span> /&gt;</span>
      <span class="code-tag">&lt;/on&gt;</span>
      <span class="code-tag">&lt;off&gt;</span>
        <span class="code-tag">&lt;include type=<span class="code-quote">"command"</span> ref=<span class="code-quote">"79"</span> /&gt;</span>
      <span class="code-tag">&lt;/off&gt;</span>
      <span class="code-tag">&lt;include type=<span class="code-quote">"sensor"</span> ref=<span class="code-quote">"77"</span> /&gt;</span>
    <span class="code-tag">&lt;/switch&gt;</span>
    <span class="code-tag">&lt;image id=<span class="code-quote">"76"</span>&gt;</span>
      <span class="code-tag">&lt;include type=<span class="code-quote">"sensor"</span> ref=<span class="code-quote">"77"</span> /&gt;</span>
    <span class="code-tag">&lt;/image&gt;</span>
  <span class="code-tag">&lt;/components&gt;</span>
  <span class="code-tag">&lt;sensors&gt;</span>
    <span class="code-tag">&lt;sensor id=<span class="code-quote">"77"</span> name=<span class="code-quote">"sensor"</span> type=<span class="code-quote">"switch"</span>&gt;</span>
      <span class="code-tag">&lt;include type=<span class="code-quote">"command"</span> ref=<span class="code-quote">"80"</span> /&gt;</span>
      <span class="code-tag">&lt;state name=<span class="code-quote">"on"</span> /&gt;</span>
      <span class="code-tag">&lt;state name=<span class="code-quote">"off"</span> /&gt;</span>
    <span class="code-tag">&lt;/sensor&gt;</span>
  <span class="code-tag">&lt;/sensors&gt;</span>
  <span class="code-tag">&lt;commands&gt;</span>
    <span class="code-tag">&lt;command id=<span class="code-quote">"78"</span> protocol=<span class="code-quote">"virtual"</span>&gt;</span>
      <span class="code-tag">&lt;property name=<span class="code-quote">"address"</span> value=<span class="code-quote">"device"</span> /&gt;</span>
      <span class="code-tag">&lt;property name=<span class="code-quote">"command"</span> value=<span class="code-quote">"on"</span> /&gt;</span>
    <span class="code-tag">&lt;/command&gt;</span>
    <span class="code-tag">&lt;command id=<span class="code-quote">"79"</span> protocol=<span class="code-quote">"virtual"</span>&gt;</span>
      <span class="code-tag">&lt;property name=<span class="code-quote">"address"</span> value=<span class="code-quote">"device"</span> /&gt;</span>
      <span class="code-tag">&lt;property name=<span class="code-quote">"command"</span> value=<span class="code-quote">"off"</span> /&gt;</span>
    <span class="code-tag">&lt;/command&gt;</span>
    <span class="code-tag">&lt;command id=<span class="code-quote">"80"</span> protocol=<span class="code-quote">"virtual"</span>&gt;</span>
      <span class="code-tag">&lt;property name=<span class="code-quote">"address"</span> value=<span class="code-quote">"device"</span> /&gt;</span>
      <span class="code-tag">&lt;property name=<span class="code-quote">"command"</span> value=<span class="code-quote">"status"</span> /&gt;</span>
    <span class="code-tag">&lt;/command&gt;</span>
  <span class="code-tag">&lt;/commands&gt;</span>
  <span class="code-tag">&lt;config&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"controller.roundrobin.tcpserver.port"</span> value=<span class="code-quote">"20000"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"multicast.address"</span> value=<span class="code-quote">"224.0.1.100"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"controller.roundrobin.multicast.port"</span> value=<span class="code-quote">"10000"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"multicast.port"</span> value=<span class="code-quote">"3333"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"controller.groupname"</span> value=<span class="code-quote">"floor20"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"Macro.IR.Execution.Delay"</span> value=<span class="code-quote">"500"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"controller.roundrobin.multicast.address"</span> value=<span class="code-quote">"224.0.1.200"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"lircd.conf.path"</span> value=<span class="code-quote">"/etc/lircd.conf"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"controller.groupmember.autodetect.on"</span> value=<span class="code-quote">"true"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"webapp.port"</span> value=<span class="code-quote">"8080"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"copy.lircd.conf.on"</span> value=<span class="code-quote">"true"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"irsend.path"</span> value=<span class="code-quote">"/usr/local/bin/irsend"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"resource.upload.enable"</span> value=<span class="code-quote">"true"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"controller.applicationname"</span> value=<span class="code-quote">"controller"</span> /&gt;</span>
  <span class="code-tag">&lt;/config&gt;</span>
<span class="code-tag">&lt;/openremote&gt;</span>
</pre>
</div></div>

<p>The only difference I can think of is that I added the switch, because I didn't have anything handy to drive the state changes from the controller side.</p>

<p>I used the iPad console.</p>

<p>Can you try the above first and see if you can get the basic case working?  If yes, then maybe switch the controller commands to your Lutron implementation and see if it still works? And finally if still not reproducible remove the switch and drive the state changes from controller side and see if that makes a difference?</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Dec 08, 2010 06:43
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-13697324"></a>
                                    <font class="smallfont"><p>Thanks Juha,</p>

<p>It'll need some investigation because what I did is:</p>
<ul class="alternate" type="square">
	<li>unzip my configuration</li>
	<li>replace the content of controller.xml and panel.xml with your above files, updating image names as appropriate</li>
	<li>re-zip the configuration</li>
	<li>restart my controller and upload this new config</li>
	<li>I launch the iPad console and now I see my old GUI, that is now working, images are displayed correctly and label displays selected scene as appropriate.</li>
</ul>


<p>I might be doing something wrong or there is something with the cache / reload.<br/>
I'll investigate further and try understand what happens.</p>

<p>Eric</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ebariaux at Dec 08, 2010 07:27
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-13697330"></a>
                                    <font class="smallfont"><p>I was just being stupid with my configuration loading, I did zip the directory instead of the content, so indeed the old files were used.</p>

<p>And I now found the pattern of how to reproduce/fix the issue:</p>
<ul class="alternate" type="square">
	<li>start with no iPad console on the iPad simulator</li>
	<li>deploy of fresh copy of the controller and start tomcat</li>
	<li>upload the configuration to the controller</li>
	<li>launch iPad console from XCode</li>
	<li>go to Settings and manually point the console at the controller -&gt; error message: Controller did not recognized the sent command id<br/>
Error on controller is:<br/>
Controller2010-12-08 09:53:40,298 ERROR http\-8080\-1 org.openremote.controller.rest.StatusCommandRESTServlet.doPost(92) | CommandException occurs<br/>
org.openremote.controller.exception.NoSuchComponentException: No such component in status cache : 32<br/>
	at org.openremote.controller.statuscache.StatusCache.queryStatuses(StatusCache.java:96)<br/>
	at org.openremote.controller.service.impl.StatusCacheServiceImpl.queryStatuses(StatusCacheServiceImpl.java:20)<br/>
	at org.openremote.controller.service.impl.StatusCommandServiceImpl.readFromCache(StatusCommandServiceImpl.java:99)<br/>
	at org.openremote.controller.rest.StatusCommandRESTServlet.doPost(StatusCommandRESTServlet.java:89)<br/>
	at org.openremote.controller.rest.StatusCommandRESTServlet.doGet(StatusCommandRESTServlet.java:66)<br/>
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:690)<br/>
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:803)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:78)<br/>
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:77)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)<br/>
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)<br/>
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)<br/>
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:175)<br/>
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)<br/>
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)<br/>
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)<br/>
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:263)<br/>
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:844)<br/>
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:584)<br/>
	at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:447)<br/>
	at java.lang.Thread.run(Thread.java:680)</li>
	<li>stop tomcat and restart -&gt; same issue</li>
	<li>quit and relaunch console -&gt; working fine</li>
</ul>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ebariaux at Dec 08, 2010 08:56
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-13697331"></a>
                                    <font class="smallfont"><p>Great, thanks for the steps to reproduce. Indeed, seen the same issue quite often on the status cache failing with unpopulated entry on a fresh install.</p>


</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Dec 08, 2010 09:01
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 10:47</font></td>
		    </tr>
	    </table>
    </body>
</html>