<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Openremote Designer "scalability"</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Openremote Designer "scalability"
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Nov 08, 2010 by <font color="#0050B2">trondk</font>.
				    </div>

				    <p>Hi,</p>

<p>I have some doubts about the scalability of how devices are added in the Openremote building modeller.</p>

<p>E.g. for a KNX installation you typically would want to have on/off and dimming for all your dimmer zones. </p>

<p>If I have figured things correctly you would then create:</p>

<ul class="alternate" type="square">
	<li>a "switch on" command</li>
	<li>a "switch off" command</li>
	<li>a "status" command to see on/off state</li>
	<li>a switch device</li>
	<li>a sensor device (for the switch)</li>
	<li>a "dim" command to set dimmer value</li>
	<li>a "dim" status command to see current dimmer value</li>
	<li>a slider device</li>
	<li>a sensor device (for the dimmer value)</li>
</ul>


<p>In other words, you quickly get 9 "entries" in your building modeller for each dimmer zone.</p>

<p>For a "whole house" installation I would claim that it is not unheard of to have more than 30-50 dimmer zones, which then yields 270-450 entries in your building modeller, and this for light control alone...</p>

<p>Am I missing something here, am I to hang up in the "KNX way" of doing light control, or is this somewhat of an issue?</p>

<p>Additionally, for the building modeller I do not see the big advantage of doing these definitions by means of a GUI, as there is not really any "WYSIWYG" benefit like there is for the UI designer.</p>

<p>From my point of view it would be much better if it was possible to produce the controller.xml file directly (then I could make some python script etc, and parameterize things to the point where adding a new dimmer zone would be a one-liner...), and then import the building model into the Openremote Designer GUI.</p>


<p>Regards,<br/>
Trond</p>



				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-12847164"></a>
                                    <font class="smallfont"><p>First of all, congratulations.  For having gotten this far and figured out all of the steps.  I couldn't create a slider to test your bug in android yesterday that easily.  It is clear that our software is v0.1 so far and needs A LOT OF IMPROVEMENT. It is not a finished product by any stretch of the imagination, it is just a start.   </p>

<p>I think you are exactly right that there is little benefit to a wysiwyg for building declaration. </p>

<p>Question is what are the ways to simplify this?</p>

<p>1- ETS import? With ETS 4 I think we can come up with something that gives you a palette from file definition.  With ETS 3 it is trickier and involves a hack. Are you based on ETS4? Alternatively Olivier Gandit was saying we could build a plug-in for ETS and export the data with a controller.xml file. </p>

<p>2. templates? </p>

<p>3. scripts? we are open to that as well...</p>

<p>Any ideas are welcome.  If this is something you want to help with we can talk offline.  Are you a consultant in the field? an installer? obviously you know your way around a keyboard... </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by marcf at Nov 08, 2010 09:01
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12847168"></a>
                                    <font class="smallfont"><p>Hey Trond,</p>

<p>Yeah makes sense. I will look at adding the import utility in as soon as possible. Should help with local scripting and then upload to model and use designer for the UI.</p>

<p>&#8211; Juha</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Nov 08, 2010 09:31
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12847174"></a>
                                    <font class="smallfont"><p>Hi,</p>

<p>That was a quick reply <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>I am a consultant/contractor working with SW development, primarily in the embedded space. I am also a homeowner with a growing KNX installation.</p>

<p>So, I am not really working with KNX or home automation in a professional capacity (at least not yet <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/>, but I have done the programming part of the KNX installation in my home, using ETS3.</p>

<p>As you write the Openremote SW is still in its infancy, but I think you have come a long way already.</p>

<p>I think that being able to import the building model from ETS in some way would be a great long term goal for the building modeller, and and I would guess that its probably something you would want/need to be able to do to get the professional KNX installers on board.</p>

<p>As I mentioned, being able to import the building model (as far as I understand basically controller.xml) into the Openremote Designer would also be a great improvment I think, and possibly one which would not be to difficult to add (I guess depending on how much validation/sanity checks you would want to add.)</p>

<p>Also, in the building modeller, I think it would have been great if there was a possibility to "collapse" the definition of command(s), status, sensor, and switch/slider for a given dimmer (or simmilar physical device) into one object instead of having them as separate objects could maybe be nice. Or, at least being able to define them all in one go in the same "dialog", without having to define them separately, would be an improvement.</p>

<p>At the moment I have just deployed the released packages both for the ORB and for the Android panel, so I have not really got the full toolchain verified to build everything from scratch myself. I am hoping to find time to do that soon, both for the ORB and for the Android app. When I have that in place I would be glad to contribute whatever functionality time and competence allows for.</p>

<p>One feature I am really looking forward to is the addition of some sort of scriptable rules engine. Currently I am rolling my own very simple one, based on python scripts and XML configuration files, but it would be great to get something more integrated and powerful. Visualization features is also something that would be a great addition.</p>

<p>In other words, when Openremote is an acceptable replacement for the outrageously priced Gira HomeServer products I will be a happy man <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>


<p>Regards,<br/>
Trond</p>


</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by trondk at Nov 08, 2010 10:20
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12847175"></a>
                                    <font class="smallfont"><p>Thanks for the props on Designer and saying it has come a long way <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/> it has, but it can be frustrating as well. </p>

<p>ETS4 supports an export function so that can be straightforward. </p>

<p>Thanks for the offer to contribute on the android front.  I know juha is planning on scripting for the 3.0 release.  It will take some time but it is on the roadmap.  Also if juha has you on the scripting then you can be looking forward to that.  </p>

<p>yeah replacing GiraHomeServer is a valuable goal. </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by marcf at Nov 08, 2010 11:10
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12847266"></a>
                                    <font class="smallfont"><p>I've hacked together a simple Python script that lets me generate a controller.xml and a matching panel.xml with something like this:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">

<span class="code-keyword">if</span> __name__ == <span class="code-quote">"__main__"</span>:

    cfg = config()
    gui = gui()

    #
    # List the devices in the configuration
    #
    cfg.addDimmerChannel(<span class="code-quote">"LigthZone 1"</span>, <span class="code-quote">"2/6/6"</span>)
    cfg.addDimmerChannel(<span class="code-quote">"LigthZone 2"</span>, <span class="code-quote">"1/1/7"</span>)

    #
    # Then specify the panel(s)
    #
    scr = screen(<span class="code-quote">"Starting Screen"</span>)
    scr.addSlider(cfg.getSlider(<span class="code-quote">"LigthZone 1"</span>), 51, 60, 198, 44)
    scr.addLabel(cfg.getLabel(<span class="code-quote">"LigthZone 1"</span>),
                 <span class="code-quote">"Label Text"</span>, 51, 140, 198, 44)

    grp = group(<span class="code-quote">"Default Group"</span>, scr)

    pnl = panel(<span class="code-quote">"TestPanel"</span>, grp)
    
    gui.addScreen(scr)
    gui.addGroup(grp)
    gui.addPanel(pnl)

    #
    # Lastly, write the XML files..
    #
    cfg.write(open(<span class="code-quote">"controller.xml"</span>, <span class="code-quote">"w"</span>))
    gui.write(open(<span class="code-quote">"panel.xml"</span>, <span class="code-quote">"w"</span>))
</pre>
</div></div>

<p>The script would then generate a slider, a switch, and a label bound to the slider sensor for each of the dimmer channels.</p>

<p>The panel stuff is just to be able to make really simple panel configurations until it is possible to import a generated controller.xml into the online designer.</p>

<p>Have not had time to test the generated config yet, but plan to post the complete script once I am sure it generates a working config.</p>

<p>One thing though, the panels.obj, which as far as I have figured out is "Java serialization data" (whatever that means), is that something that is specific to the config as well, or is it just related to the format?</p>

<p>I guess what I am asking is if I need to generate this panels.obj file as well for my generated panel.xml file.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by trondk at Nov 11, 2010 12:23
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12847270"></a>
                                    <font class="smallfont"><p>Panel.obj IIRC is legacy from 1.0 &#8211; although related to import. It stores the designer state.</p>

<p>You shouldn't need it for 'first-time' import where your design doesn't exist in the first place, the designer just defaults to normal start state. Will see later if necessary to reintroduce it for export/import cycle for other designer related state. Ignore for now.</p>

</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Nov 11, 2010 13:14
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-12847272"></a>
                                    <font class="smallfont"><p>Ok, I have tested the script now, and it generates a configuration that at least works with my setup.</p>

<p>Incuded below if anybody else have a need for it.</p>


<p>Regards,<br/>
Trond</p>

<p>(edited Thu Nov 11 21:49:32 CET 2010: Added support for different group addresses for the dimming and the status)</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
#!/usr/bin/python
#
# Quick and dirty script to generate controller.xml and panel.xml
# <span class="code-keyword">for</span> the Openremote controller.
#
# Configure server settings at the top, and devices and panels at the bottom.
#
# 2010-11-11 Trond Kjeldaas
#
<span class="code-keyword">import</span> sys
<span class="code-keyword">import</span> xml.etree.cElementTree as ET

#
# General controller config
#
controller_config = [

    { <span class="code-quote">"name"</span>  : <span class="code-quote">"controller.roundrobin.tcpserver.port"</span>,
      <span class="code-quote">"value"</span> : <span class="code-quote">"20000"</span> },
    { <span class="code-quote">"name"</span>  : <span class="code-quote">"multicast.address"</span>,
      <span class="code-quote">"value"</span> : <span class="code-quote">"224.0.1.100"</span>},
    { <span class="code-quote">"name"</span>  : <span class="code-quote">"controller.roundrobin.multicast.port"</span>,
      <span class="code-quote">"value"</span> : <span class="code-quote">"10000"</span>},
    { <span class="code-quote">"name"</span>  : <span class="code-quote">"multicast.port"</span>,
      <span class="code-quote">"value"</span> : <span class="code-quote">"3333"</span>},
    { <span class="code-quote">"name"</span>  : <span class="code-quote">"controller.groupname"</span>,
      <span class="code-quote">"value"</span> : <span class="code-quote">"floor20"</span>},
    { <span class="code-quote">"name"</span>  : <span class="code-quote">"Macro.IR.Execution.Delay"</span>,
      <span class="code-quote">"value"</span> : <span class="code-quote">"500"</span>},
    { <span class="code-quote">"name"</span>  : <span class="code-quote">"controller.roundrobin.multicast.address"</span>,
      <span class="code-quote">"value"</span> : <span class="code-quote">"224.0.1.200"</span>},
    { <span class="code-quote">"name"</span>  : <span class="code-quote">"lircd.conf.path"</span>,
      <span class="code-quote">"value"</span> : <span class="code-quote">"/etc/lircd.conf"</span>},
    { <span class="code-quote">"name"</span>  : <span class="code-quote">"controller.groupmember.autodetect.on"</span>,
      <span class="code-quote">"value"</span> : <span class="code-quote">"<span class="code-keyword">true</span>"</span>},
    { <span class="code-quote">"name"</span>  : <span class="code-quote">"webapp.port"</span>,
      <span class="code-quote">"value"</span> : <span class="code-quote">"8080"</span>},
    { <span class="code-quote">"name"</span>  : <span class="code-quote">"copy.lircd.conf.on"</span>,
      <span class="code-quote">"value"</span> : <span class="code-quote">"<span class="code-keyword">true</span>"</span>},
    { <span class="code-quote">"name"</span>  : <span class="code-quote">"irsend.path"</span>,
      <span class="code-quote">"value"</span> : <span class="code-quote">"/usr/local/bin/irsend"</span>},
    { <span class="code-quote">"name"</span>  : <span class="code-quote">"resource.upload.enable"</span>,
      <span class="code-quote">"value"</span> : <span class="code-quote">"<span class="code-keyword">true</span>"</span>},
    { <span class="code-quote">"name"</span>  : <span class="code-quote">"controller.applicationname"</span>,
      <span class="code-quote">"value"</span> : <span class="code-quote">"controller"</span>}
    ]


# Global <span class="code-quote">"ID"</span> allocator...
nextid = 0
def allocId():
    global nextid
    nextid += 1
    <span class="code-keyword">return</span> nextid

def prettyPrint(e, indent = 0):
    <span class="code-quote">"Add tail-content to elements so that we get a nice printout"</span>
    e.tail = <span class="code-quote">"\n"</span> + <span class="code-quote">" "</span>*indent
    <span class="code-keyword">if</span> len(e) &gt; 0:
        <span class="code-keyword">if</span> not e.text:
            e.text = <span class="code-quote">"\n"</span> + <span class="code-quote">" "</span>*(indent+2)
        <span class="code-keyword">for</span> c in e:
            prettyPrint(c, indent+2)
        e[-1].tail = <span class="code-quote">"\n"</span> + <span class="code-quote">" "</span>*indent

class component(object):

    def getType(self):
        <span class="code-keyword">return</span> self.type

    def getId(self):
        <span class="code-keyword">return</span> self.id

    def getName(self):
        <span class="code-keyword">return</span> self.name

    def getSensorId(self):
        <span class="code-keyword">return</span> self.sensorId
    
class command(object):

    def __init__(self, value, groupAddr, DPT):

        self.id        = allocId()
        self.value     = value
        self.groupAddr = groupAddr
        self.DPT       = DPT

    def getId(self):

        <span class="code-keyword">return</span> self.id
    
    def xml(self):

        c = ET.Element(<span class="code-quote">"command"</span>, id=<span class="code-quote">"%s"</span>%self.id, protocol=<span class="code-quote">"knx"</span>)
        c.append(ET.Element(<span class="code-quote">"property"</span>, name=<span class="code-quote">"command"</span>, value=self.value))
        c.append(ET.Element(<span class="code-quote">"property"</span>,
                            name=<span class="code-quote">"groupAddress"</span>, value=self.groupAddr))
        c.append(ET.Element(<span class="code-quote">"property"</span>, name=<span class="code-quote">"DPT"</span>, value=self.DPT))

        <span class="code-keyword">return</span> c
        

class sensor(component):

    def __init__(self, name, typ, command):

        self.type  = <span class="code-quote">"sensor"</span>
        self.id    = allocId()
        self.name  = name
        self.type  = typ
        self.cmdId = command.getId()

    def xml(self):

        s = ET.Element(<span class="code-quote">"sensor"</span>, id=<span class="code-quote">"%s"</span>%self.id,
                       name=self.name, type=self.type)
        s.append(ET.Element(<span class="code-quote">"include"</span>, type=<span class="code-quote">"command"</span>, ref=<span class="code-quote">"%s"</span>%self.cmdId))

        <span class="code-keyword">return</span> s
        
class label(component):

    def __init__(self, name, sensor):

        self.type     = <span class="code-quote">"label"</span>
        self.id       = allocId()
        self.name     = name
        self.sensorId = sensor.getId()

    def xml(self):

        s = ET.Element(<span class="code-quote">"label"</span>, id=<span class="code-quote">"%s"</span>%self.id)
        s.append(ET.Element(<span class="code-quote">"include"</span>, type=<span class="code-quote">"sensor"</span>, ref=<span class="code-quote">"%s"</span>%self.sensorId))

        <span class="code-keyword">return</span> s

class slider(component):

    def __init__(self, name, command, sensor):

        self.type     = <span class="code-quote">"slider"</span>
        self.id       = allocId()
        self.name     = name
        self.cmdId    = command.getId()
        self.sensorId = sensor.getId()

    def xml(self):

        s = ET.Element(<span class="code-quote">"slider"</span>, id=<span class="code-quote">"%s"</span>%self.id)
        sv = ET.Element(<span class="code-quote">"setValue"</span>)
        sv.append(ET.Element(<span class="code-quote">"include"</span>, type=<span class="code-quote">"command"</span>, ref=<span class="code-quote">"%s"</span>%self.cmdId))
        s.append(sv)
        s.append(ET.Element(<span class="code-quote">"include"</span>, type=<span class="code-quote">"sensor"</span>, ref=<span class="code-quote">"%s"</span>%self.sensorId))

        <span class="code-keyword">return</span> s

class config(object):

    def __init__(self):

        self.components = []
        self.sensors    = []
        self.commands   = []
        
    def addDimmerChannel(self, name, groupAddr, sensGroupAddr=None):

        # If sensor group address not specified, use the same
        # group address as <span class="code-keyword">for</span> the set dimmer value
        <span class="code-keyword">if</span> sensGroupAddr == None:
            sensGroupAddr = groupAddr
            
        dimCmd    = command(<span class="code-quote">"Dim"</span>, groupAddr, <span class="code-quote">"5.001"</span>)
        dimStat   = command(<span class="code-quote">"status"</span>, sensGroupAddr, <span class="code-quote">"5.001"</span>)
        dimSensor = sensor(name, <span class="code-quote">"level"</span>, dimStat)
        dimLabel  = label(name, dimSensor)

        dimSlider = slider(name, dimCmd, dimSensor)
        
        self.components.append(dimSlider)
        self.components.append(dimLabel)
        self.sensors.append(dimSensor)
        self.commands.append(dimCmd)
        self.commands.append(dimStat)

    def getComponent(self, typ, name):
        # print <span class="code-quote">"finding: %s/%s"</span> %(typ, name)
        <span class="code-keyword">for</span> c in self.components:
            # print <span class="code-quote">"  %s/%s"</span> %(c.getType(),  c.getName())
            <span class="code-keyword">if</span> c.getType() == typ and c.getName() == name:
                <span class="code-keyword">return</span> c

        # not found...
        raise TypeError

    def getSlider(self, name):

        <span class="code-keyword">return</span> self.getComponent(<span class="code-quote">"slider"</span>, name)

    def getLabel(self, name):

        <span class="code-keyword">return</span> self.getComponent(<span class="code-quote">"label"</span>, name)

    def write(self, file):

        root = ET.Element(<span class="code-quote">"openremote"</span>)
        root.set(<span class="code-quote">"xmlns"</span>, <span class="code-quote">"http:<span class="code-comment">//www.openremote.org"</span>)
</span>        root.set(<span class="code-quote">"xmlns:xsi"</span>, <span class="code-quote">"http:<span class="code-comment">//www.w3.org/2001/XMLSchema-instance"</span>)
</span>        root.set(<span class="code-quote">"xsi:schemaLocation"</span>,<span class="code-quote">"http:<span class="code-comment">//www.openremote.org "</span>
</span>                 <span class="code-quote">"http:<span class="code-comment">//www.openremote.org/schemas/controller.xsd"</span>)
</span>
        components = ET.Element(<span class="code-quote">"components"</span>)
        sensors    = ET.Element(<span class="code-quote">"sensors"</span>)
        commands   = ET.Element(<span class="code-quote">"commands"</span>)

        <span class="code-keyword">for</span> c in self.components:
            components.append(c.xml())
            
        <span class="code-keyword">for</span> s in self.sensors:
            sensors.append(s.xml())

        <span class="code-keyword">for</span> c in self.commands:
            commands.append(c.xml())
        
        root.append(components)
        root.append(sensors)
        root.append(commands)

        # Add the <span class="code-quote">"<span class="code-keyword">static</span>"</span> configuration stuff at the bottom...
        
        c = ET.Element(<span class="code-quote">"config"</span>)
        <span class="code-keyword">for</span> cc in controller_config:
            c.append(ET.Element(<span class="code-quote">"property"</span>, name=cc[<span class="code-quote">"name"</span>], value=cc[<span class="code-quote">"value"</span>]))
        root.append(c)
        
        prettyPrint(root)
        
        tree = ET.ElementTree(root)
        tree.write(file, <span class="code-quote">"UTF-8"</span>)

class gui(object):

    def __init__(self):

        self.panels  = []
        self.screens = []
        self.groups  = []

    def addGroup(self, group):

        self.groups.append(group)

    def addPanel(self, panel):

        self.panels.append(panel)

    def addScreen(self, screen):

        self.screens.append(screen)
    
    def write(self, file):

        root = ET.Element(<span class="code-quote">"openremote"</span>)
        root.set(<span class="code-quote">"xmlns"</span>, <span class="code-quote">"http:<span class="code-comment">//www.openremote.org"</span>)
</span>        root.set(<span class="code-quote">"xmlns:xsi"</span>, <span class="code-quote">"http:<span class="code-comment">//www.w3.org/2001/XMLSchema-instance"</span>)
</span>        root.set(<span class="code-quote">"xsi:schemaLocation"</span>,<span class="code-quote">"http:<span class="code-comment">//www.openremote.org "</span>
</span>                 <span class="code-quote">"http:<span class="code-comment">//www.openremote.org/schemas/panel.xsd"</span>)
</span>
        panels = ET.Element(<span class="code-quote">"panels"</span>)
        <span class="code-keyword">for</span> p in self.panels:
            panels.append(p.xml())
        root.append(panels)

        screens = ET.Element(<span class="code-quote">"screens"</span>)
        <span class="code-keyword">for</span> scr in self.screens:
            screens.append(scr.xml())
        root.append(screens)

        groups = ET.Element(<span class="code-quote">"groups"</span>)
        <span class="code-keyword">for</span> g in self.groups:
            groups.append(g.xml())
        root.append(groups)

            
        prettyPrint(root)
        
        tree = ET.ElementTree(root)
        tree.write(file, <span class="code-quote">"UTF-8"</span>)


class panel(object):

    def __init__(self, name, group):

        self.id      = allocId()
        self.name    = name
        self.groupId = group.getId()

    def xml(self):

        s = ET.Element(<span class="code-quote">"panel"</span>, name=self.name, id=<span class="code-quote">"%s"</span>%self.id)
        s.append(ET.Element(<span class="code-quote">"include"</span>, type=<span class="code-quote">"group"</span>, ref=<span class="code-quote">"%s"</span>%self.groupId))

        <span class="code-keyword">return</span> s

class group(object):

    def __init__(self, name, screen):

        self.id         = allocId()
        self.name       = name
        self.screenRef  = screen.getId()

    def getId(self):
        <span class="code-keyword">return</span> self.id

    def xml(self):

        s = ET.Element(<span class="code-quote">"group"</span>, name=self.name, id=<span class="code-quote">"%s"</span>%self.id)
        s.append(ET.Element(<span class="code-quote">"include"</span>, type=<span class="code-quote">"screen"</span>, ref=<span class="code-quote">"%s"</span>%self.screenRef))

        <span class="code-keyword">return</span> s


class screen(object):

    def __init__(self, name):

        self.id      = allocId()
        self.name = name
        self.components = []

    def getId(self):
        <span class="code-keyword">return</span> self.id
    
    def addSlider(self, slider, posX, posY, width, height):

        self.components.append((<span class="code-quote">"slider"</span>,
                                (posX, posY, width, height),
                                (slider.getId(), slider.getSensorId())))

    def addLabel(self, label, initialText, posX, posY, width, height):

        self.components.append((<span class="code-quote">"label"</span>,
                                (posX, posY, width, height),
                                (label.getId(), label.getSensorId(),
                                 initialText)))

    def xml(self):
        
        s = ET.Element(<span class="code-quote">"screen"</span>, name=self.name, id=<span class="code-quote">"%s"</span>%self.id)

        <span class="code-keyword">for</span> c  in self.components:

            typ, position, params = c

            x,y,w,h = position
            
            p = ET.Element(<span class="code-quote">"absolute"</span>, left=<span class="code-quote">"%s"</span>%x, top=<span class="code-quote">"%s"</span>%y,
                           width=<span class="code-quote">"%s"</span>%w, height=<span class="code-quote">"%s"</span>%h)
            
            <span class="code-keyword">if</span> typ == <span class="code-quote">"slider"</span>:

                sid, sref = params
                
                sl = ET.Element(<span class="code-quote">"slider"</span>, id=<span class="code-quote">"%s"</span>%sid,
                                vertical=<span class="code-quote">"<span class="code-keyword">false</span>"</span>, passive=<span class="code-quote">"<span class="code-keyword">false</span>"</span>)
                sl.append(ET.Element(<span class="code-quote">"link"</span>, type=<span class="code-quote">"sensor"</span>, ref=<span class="code-quote">"%s"</span>%sref))
                sl.append(ET.Element(<span class="code-quote">"min"</span>, value=<span class="code-quote">"0"</span>))
                sl.append(ET.Element(<span class="code-quote">"max"</span>, value=<span class="code-quote">"100"</span>))

                p.append(sl)

            elif typ == <span class="code-quote">"label"</span>:

                lid, sref, ltext = params
                
                sl = ET.Element(<span class="code-quote">"label"</span>, id=<span class="code-quote">"%s"</span>%lid,
                                fontsize=<span class="code-quote">"14"</span>, color=<span class="code-quote">"#FFFFFF"</span>, text=ltext)
                sl.append(ET.Element(<span class="code-quote">"link"</span>, type=<span class="code-quote">"sensor"</span>, ref=<span class="code-quote">"%s"</span>%sref))

                p.append(sl)

            s.append(p)
            
        <span class="code-keyword">return</span> s

        
<span class="code-keyword">if</span> __name__ == <span class="code-quote">"__main__"</span>:

    cfg = config()
    gui = gui()

    #
    # List the devices in the configuration
    #
    cfg.addDimmerChannel(<span class="code-quote">"LightZone 1"</span>, <span class="code-quote">"1/1/6"</span>)
    cfg.addDimmerChannel(<span class="code-quote">"LightZone 2"</span>, <span class="code-quote">"1/1/7"</span>)
    cfg.addDimmerChannel(<span class="code-quote">"LightZone 3"</span>, <span class="code-quote">"1/1/8"</span>)
    cfg.addDimmerChannel(<span class="code-quote">"LightZone 5"</span>, <span class="code-quote">"1/1/9"</span>)
    cfg.addDimmerChannel(<span class="code-quote">"LightZone 6"</span>, <span class="code-quote">"1/1/10"</span>)

    #
    # Then specify the panel(s)
    #
    scr = screen(<span class="code-quote">"Starting Screen"</span>)
    scr.addSlider(cfg.getSlider(<span class="code-quote">"LightZone 1"</span>), 51, 20, 198, 44)
    scr.addLabel(cfg.getLabel(<span class="code-quote">"LightZone 1"</span>),
                 <span class="code-quote">"Label Text"</span>, 51, 70, 198, 44)
    scr.addSlider(cfg.getSlider(<span class="code-quote">"LightZone 3"</span>), 51, 120, 198, 44)
    scr.addLabel(cfg.getLabel(<span class="code-quote">"LightZone 3"</span>),
                 <span class="code-quote">"Label Text"</span>, 51, 170, 198, 44)

    grp = group(<span class="code-quote">"Default Group"</span>, scr)

    pnl = panel(<span class="code-quote">"TestPanel"</span>, grp)
    
    gui.addScreen(scr)
    gui.addGroup(grp)
    gui.addPanel(pnl)

    #
    # Lastly, write the XML files..
    #
    cfg.write(open(<span class="code-quote">"controller.xml"</span>, <span class="code-quote">"w"</span>))
    gui.write(open(<span class="code-quote">"panel.xml"</span>, <span class="code-quote">"w"</span>))
</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by trondk at Nov 11, 2010 15:08
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-13303810"></a>
                                    <font class="smallfont"><p>Excellent, thanks!</p>

<p>This here precisely demonstrates the issue with designer today:</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>    #
    # List the devices in the configuration
    #
    cfg.addDimmerChannel("LightZone 1", "1/1/6")
    cfg.addDimmerChannel("LightZone 2", "1/1/7")
    cfg.addDimmerChannel("LightZone 3", "1/1/8")
    cfg.addDimmerChannel("LightZone 5", "1/1/9")
    cfg.addDimmerChannel("LightZone 6", "1/1/10")
</pre>
</div></div>

<p>Which says, once we know what protocol you're dealing with, we can derive a lot of defaults from limited set of information.</p>

<p>The challenge, and the headache today, is how to deal with this in a generic enough fashion so when someone comes up with a new device protocol, it can be supported easily in a similar fashion, without requiring hard-coded protocol support in the designer.</p>

<p>What your script implies to me is a flow of (leaving out the UI part):</p>

<p>Select protocol: KNX -&gt; Create Slider -&gt; Enter name and group address</p>

<p>Read/write commands and sensor can then be created with default values, and only modified if necessary (it seems to happen sometimes read and write come from different group addresses, etc.)</p>

<p>Top-down vs. bottom-up.</p>

<p>We could hard code this reverse flow for KNX (and maybe we should) but it still leaves the main issue open of how do we do the same for the next protocol without it all costing too much in terms of designer implementation per protocol. I don't have an obvious solution to it yet. Maybe ideas will pop up. At the moment, the bottom-up approach works for the "generic" protocol but leaves a lot of frustrating click-work to the user.</p>

<p>Maybe the solution then is to make user written import tools (such as your script) cheap to add to the designer, instead? Putting the cost back to individual protocol implementers.</p>

<p>And maybe the third major area where scripting is now sorely needed.</p>

<p>Hmm.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Nov 11, 2010 20:13
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-13303815"></a>
                                    <font class="smallfont"><p>Further thoughts on this, how do we make it simple to add new protocol support to designer without knowing the specific protocol details in advance?</p>

<p>The part that is customizable in designer now is the protocol dialog, ie. the dialog for KNX commands are not hard-coded but are defined in knx.xml</p>

<p>Part of the issue is that this XML UI definition works on the simple v1.0 vocabulary of "commands" - i.e the simple control abstraction of commands bound to buttons to control. Something Marc is now repeating with the serverless android experience.</p>

<p>What we did in 2.0 was increase this vocabulary to read/write commands, sensors, switches, and sliders. So now we have a larger vocabulary, but the protocol UI customizations still operate on the 1.0 vocabulary (how do I enter a command?)</p>

<p>So one way of addressing this is to extend the designer customization mechanism to deal with all the new constructs.</p>

<p>So for example, the use cases for KNX user might be:</p>

<p>1. Create KNX Switch<br/>
2. Create KNX Dimmer<br/>
3. Create KNX Scene<br/>
4. ....</p>

<p>In the designer flow, these would follow from:</p>

<p>New Model -&gt; Which Protocol? KNX -&gt; 1. Create KNX Switch, 2. Create KNX Dimmer ...</p>

<p>Where the dialogs and flow for particular KNX use cases can be specified and externalized in the designer configuration using xml and/or scripting. Today this only allows for command properties, and therefore all the other abstractions are built up from bottom-up (single vocabulary of "commands").</p>

<p>So this translates to a much richer mechanism to customize the designer UI flow:</p>

<p>1. Create KNX Switch</p>

<p>becomes</p>

<p>a. Designer Dialog for properties 'name' and 'group address'<br/>
b. Designer Invocation: Create 'Write KNX Switch On Command' with default name<br/>
c. Designer Invocation: Create 'Write KNX Switch Off Command' with default name<br/>
d. Designer Invocation: Create 'Read KNX Switch Status Command' with default name<br/>
e. Designer Invocation: Create 'KNX Switch Sensor with Read Command (d)' with default name<br/>
f. Designer Invocation: Create Switch with aggregate of (b), (c), (d), (e) using 'name'</p>

<p>Where (a) to (f) are specified in generic language that is not specific to individual protocols but our current abstractions of 'command', 'sensor', 'switch', 'slider'. And (a) to (f) are externalized as configuration of the designer.</p>

<p>This reduces the necessary click-heavy approach by presenting a dialog to new users that they can follow (without necessarily introducing them to a script immediately which they are expected to modify). It is not as low effort as the script, so for a large installation of dozens or even hundreds of dimmers, modifying a script to do the job may still be preferred. But would be an option for the power users, not the expected initial experience to the designer.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by admin at Nov 12, 2010 05:57
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-13303816"></a>
                                    <font class="smallfont"><p>Further note:</p>

<p>"Designer Invocations" in this case should be REST API Invocations against Beehive database to create and store these constructs on individual user accounts.</p>

<p>Something that was always intended to be there but was lost in the current 2.0 implementation quagmire.</p>

<p>It's been on the todo list for a while to correct this design mistake, this would be another reason to drive it home.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by admin at Nov 12, 2010 06:02
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-13697235"></a>
                                    <font class="smallfont"><p>Maybe a crazy thought here.. but I find the OR KNX app easy in configuring dimmers, lights and shutters.</p>

<p>Why not have the ability to read the config file that one stores on google apps into the OR BOSS designer interface?</p>

<p>Rick</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by rickcn at Dec 03, 2010 19:32
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:31</font></td>
		    </tr>
	    </table>
    </body>
</html>