<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : x10 controller in pc-bsd</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : x10 controller in pc-bsd
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Oct 13, 2013 by <font color="#0050B2">hessehk</font>.
				    </div>

				    <p>I have a working setup on raspberry but I wanted OpenRemote integrated in my FreeNAS server which is PC-BSD based...<br/>
I have been able to install OR in My FreeNAS using the jail plugin...<br/>
But I have not been able to find compatible bsd mochad software for my cm15a controller...<br/>
If I buy a 2413U PowerLinc Modem INSTEON Dual-Band USB controller, do I still need the mochad software or is the Insteon controller natively supported by OpenRemote?</p>

				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-22878343"></a>
                                    <font class="smallfont"><p>OK: got it! I also need a isy99...</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hessehk at Oct 16, 2013 19:57
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22878854"></a>
                                    <font class="smallfont"><p>Correct. No native Insteon support yet.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Oct 25, 2013 11:28
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22883144"></a>
                                    <font class="smallfont"><p>Could you please share the steps involved in installing OpenRemote on FreeNas.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ggraja at Jan 20, 2014 18:08
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22883157"></a>
                                    <font class="smallfont"><p>as much as I remember:<br/>
1- create a FreeNas Jail<br/>
2- create folder and copy in OpenRemote image<br/>
3- install Java for FreeBSD (FreeBSD forum help available: you need also <a href="http://doc.freenas.org/index.php/Installing_a_PC-BSD_PBI">http://doc.freenas.org/index.php/Installing_a_PC-BSD_PBI</a> )<br/>
OpenRemote must be started manually with every reboot of FreeNas (never could setup auto-start)<br/>
I used Putty and WinSCP for installations and configurations</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hessehk at Jan 20, 2014 22:53
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884353"></a>
                                    <font class="smallfont"><p>Thank you, I finally got it working.<br/>
How I wish I can get it to start automatically in the FreeNas Jail.<br/>
The final icing on the cake would be to have it setup in a way that a check is performed at regular intervals and OR is started automatically if it is found to have stopped.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ggraja at Feb 15, 2014 16:34
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884356"></a>
                                    <font class="smallfont"><p>I wish I could have provided more detailed instructions but I did not keep a record of my installation and I simply dealt ad-hoc with problems as I was confronted with them... if you ever find an auto-start solution please let me know...</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hessehk at Feb 15, 2014 22:49
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884593"></a>
                                    <font class="smallfont"><p>Able to start OpenRemote manually through the web shell inside the FreeNAS Jail.</p>

<p>When I SSH into FreeNAS and try to start OR I get the following error </p>

<p>Neither the JAVA_HOME nor the JRE_HOME environment variable is defined<br/>
At least one of these environment variable is needed to run this program</p>

<p>I get the above error even when I try starting OR through Post Init Script which makes me believe that if I can make JRE_HOME to point to /mnt/FREENAS/Jails/OpenRemote/usr/local which is the absolute path I might be able to get OR to autostart.</p>

<p>The Relative path of JRE_HOME is /usr/local inside the OpenRemote Jail. </p>

<p>OR is able to figure out when running from inside the Jail web shell, the absolute path of JRE_HOME is as below</p>

<p>/mnt/FREENAS/Jails/OpenRemote/usr/local</p>

<p>I was wondering if Juha or Markus could throw some light on where changes need to be made for JRE_HOME to point to the absolute path which is /mnt/FREENAS/Jails/OpenRemote/usr/local in my case.</p>

<p>OpenRemote is installed in OpenRemote Jail, path to openremote.sh is /mnt/FREENAS/Jails/OpenRemote/OpenRemote/bin/openremote.sh</p>

<p>From being a noob on FreeNAS, I managed to figure out most of the stuff going through various forums and man pages of FreeNAS and that is the reason for the delay in my posts.</p>

<p>I feel somehow I am very close but the crucial link is still missing <img class="emoticon" src="images/icons/emoticons/sad.gif" height="20" width="20" align="absmiddle" alt="" border="0"/>.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ggraja at Feb 21, 2014 13:29
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884597"></a>
                                    <font class="smallfont"><p>Tried with the following changes - DID NOT HELP</p>

<p>In the file</p>

<p>OpenRemote\bin\tomcat\setclasspath.sh</p>

<p>replaced<br/>
if [ -x /usr/bin/java ]; then</p>

<p>with</p>

<p>if [ -x /mnt/FREENAS/Jails/OpenRemote/usr/bin/java ]; then</p>

<p>also replaced</p>

<p>        JRE_HOME=/usr</p>

<p>with </p>

<p>        JRE_HOME=/mnt/FREENAS/Jails/OpenRemote/usr</p>

<p>These changes did not work, running out of ideas <img class="emoticon" src="images/icons/emoticons/sad.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ggraja at Feb 21, 2014 14:32
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884599"></a>
                                    <font class="smallfont"><p>when I tried to setup auto start for OR I thought in the end that it was a matter of security features in the PC-BSD operating system. We do not really "install" OR but simply copy the OR image to a folder. I thought that I could manually add the necessary code for auto start but a simple hack like that was not possible. I simply could not properly modify the start up  dependencies. Then I tried another approach by writing a cron job for FreeNAS jail. Again the security features in jail will prevent that also. On the other hand Java starts perfectly because it has to be installed, not just copied in. There are several layers of security before any program is allowed to start automatically. </p>

<p>(on the other hand FreeNAS is stable and secure and unless of a power failure there is no need ever for a reboot)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hessehk at Feb 21, 2014 17:01
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884601"></a>
                                    <font class="smallfont"><p>Are you using the run option or the start option?</p>

<p>./openremote.sh run </p>

<p>         Or</p>

<p>./openremote.sh start?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ggraja at Feb 21, 2014 18:55
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884608"></a>
                                    <font class="smallfont"><p>./openremote.sh start</p>

<p>I thought I could just simply create a program named "openremote" in the /etc/rc.d folder with code like this:<br/>
#!/bin/sh</p>

<p>. /etc/rc.subr</p>

<p>name=openremote<br/>
rcvar=openremote_enable<br/>
start_cmd="${name}_start"<br/>
stop_cmd=":"</p>

<p>load_rc_config $name</p>

<p>cd /your directory/OpenRemote-Controller-2.1.0_SNAPSHOT-2013-06-17/bin<br/>
./openremote.sh start</p>

<p>but security will not run it automatically at startup but will run it manually and will start OR</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hessehk at Feb 22, 2014 00:11
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884640"></a>
                                    <font class="smallfont"><p>I tried this</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
#!/bin/sh

. /etc/rc.subr
name=<span class="code-quote">"or"</span>
rcvar=or

start_cmd=<span class="code-quote">"${name}_start"</span>
stop_cmd=<span class="code-quote">":"</span>

or_start(){
cd /OpenRemote/bin
./openremote.sh start
}
load_rc_config $name
run_rc_command <span class="code-quote">"$1"</span>
</pre>
</div></div>

<p>named the file or - location /usr/local/etc/rc.d inside the jail</p>

<p>OpenRemote is the name of the folder where the OR files are located</p>

<p>I also added or_enable="YES" in the file /etc/rc.conf within the jail itself</p>

<p>I came across the post below </p>

<p><a href="http://forums.freenas.org/index.php?threads/how-can-i-auto-run-a-program-when-the-jail-starts.10048/">http://forums.freenas.org/index.php?threads/how-can-i-auto-run-a-program-when-the-jail-starts.10048/</a></p>

<p>which appeared to hold the key to providing a solution to our situation.</p>

<p>I am quoting the author of that post </p>

<p>"Ok, I was a idiot, the start script was running, but the run.sh assumed java was in the path, but because of the way I'm starting it, the script couldn't find java. I just edited the run.sh to include the full path to java and it starts right up."</p>

<p>If only I had could figure out how to include the full path to java ?? <img class="emoticon" src="images/icons/emoticons/sad.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ggraja at Feb 22, 2014 17:04
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884642"></a>
                                    <font class="smallfont"><p>My Java path inside the jail is as follows</p>

<p>/usr/local/jdk6</p>

<p>I tried changing the followin in setclasspath.sh</p>

<p>JRE_HOME=/usr</p>

<p>to</p>

<p>JRE_HOME=/usr/local/openjdk6</p>

<p>running out of ideas</p>

<p>Need to make changes wherever necessary to the Java path - in my case the path inside the jail is /usr/local/openjdk6</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ggraja at Feb 22, 2014 17:52
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884648"></a>
                                    <font class="smallfont"><p>this forum does not allow complete code:<br/>
the following is really one line: delete the Unknown macro: and the spacing...</p>

<p>start_cmd="${name}_start"</p>

<p>(I am not sure I can help you much further... I think I am beyond my skill and knowledge...)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hessehk at Feb 22, 2014 19:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884665"></a>
                                    <font class="smallfont"><p>Juha, can we get some help on what changes need to be made and where to include the full path to Java? Or how to approach this problem.</p>

<p>The script runs fine inside the jail web shell, but does not execute at startup when placed at /usr/local/etc/rc.d</p>

<p>Jail name : OpenRemote<br/>
Openremote directory inside jail: /OpenRemote<br/>
Java directory inside jail: /usr/local/jdk6<br/>
Startup script or location inside jail: /usr/local/etc/rc.d</p>

<p>Reference thread
<a href="http://forums.freenas.org/index.php?threads/how-can-i-auto-run-a-program-when-the-jail-starts.10048/">http://forums.freenas.org/index.php?threads/how-can-i-auto-run-a-program-when-the-jail-starts.10048/</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ggraja at Feb 23, 2014 03:54
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884756"></a>
                                    <font class="smallfont"><p>HMS - Good news! Its finally starting up! <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>1. Created a file openremote - location /usr/local/etc/rc.d inside the Jail - The code posted below for your reference.</p>

<p>2. Added openremote_enable="YES" to the end of to /etc/rc.conf inside the Jail.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
#!/bin/sh
#
#
#

# PROVIDE: openremote
# REQUIRE: LOGIN
# KEYWORD: shutdown

#
# Add the following line to /etc/rc.conf to enable openremote
#
# openremote_enable=<span class="code-quote">"YES"</span>
#

. /etc/rc.subr

name=openremote
rcvar=openremote_enable

start_cmd=<span class="code-quote">"${name}_start"</span>
stop_cmd=<span class="code-quote">":"</span>

openremote_start()
{
	cd /OpenRemote/bin
	./openremote.sh start
}

load_rc_config ${name}

export JAVA_HOME=<span class="code-quote">"/usr/local/openjdk6"</span>

run_rc_command <span class="code-quote">"$1"</span>
</pre>
</div></div>

<p>Hope this helps ! <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/>. <br/>
The key was to set up the set JAVA_HOME using the below statement<br/>
                              export JAVA_HOME="/usr/local/openjdk6"</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ggraja at Feb 25, 2014 11:28
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884774"></a>
                                    <font class="smallfont"><p>THANKS!<br/>
Congratulations! I am sure you must have gone through a very steep learning curve...<br/>
I think that FreeNAS is perfect for OR and besides FreeNAS is the best NAS available.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hessehk at Feb 25, 2014 16:50
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22885093"></a>
                                    <font class="smallfont"><p>Thanks for documenting your changes here. If you want to turn it into a full wiki page, let us know.</p>

<p>Best regards,</p>

<p>&#8211; Juha</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Mar 09, 2014 01:17
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22885286"></a>
                                    <font class="smallfont"><p>I have mailed you a rough draft of the documentation.</p>

<p>Looking for your guidance to create the full wiki page.</p>

<p>&#8211; Govind</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ggraja at Mar 15, 2014 21:26
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:43</font></td>
		    </tr>
	    </table>
    </body>
</html>