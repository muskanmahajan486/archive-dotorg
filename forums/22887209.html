<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : KNX problems - "Disconnect failed"</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : KNX problems - "Disconnect failed"
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jun 21, 2014 by <font color="#0050B2">jlevy</font>.
				    </div>

				    <p>Hi,</p>

<p>Running OR on Raspberry Pi - hard float, Java 1.8.</p>

<p>Sometimes everything is OK - I run and can control KNX fine. Then, when I let my iphone shutdown or if I just wait a while, I get many Disconnect Failed exceptions. I then stop and start OR again and mostly it does NOT return to working order.</p>

<p>BTW - I get Exception on VeraClient initon startup. On shutdown I get a huge amount of exceptions.</p>

<p>I am desperate - I want to use OR but this reliability issue is killing me.</p>

<p>Please assist. I have posted the KNX log. I don't know why it thinks there's no KNX connection. Note that I've configured the gateway IP in the conf file (before then it wouldn't work at all).</p>

<p>Thanks,<br/>
Yosi.</p>

<p><a href="attachments/22887209/23036589.txt" title="KNX Log">KNX Log</a></p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22887209/23036590.txt">knx.log.txt</a> (text/plain)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22887209/23036589.txt">knx.log.txt</a> (text/plain)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-22887217"></a>
                                    <font class="smallfont"><p>Just saw <a href="http://www.openremote.org/display/forums/*RESOLVED*+-+KNX+interface,+dropping+connection">http://www.openremote.org/display/forums/*RESOLVED*+-+KNX+interface,+dropping+connection</a></p>

<p>This is the same symptom that I'm having - the socket gets closed. But I'm using MDT SCN-IP000.01 which is the formal OR supported interfaces and I'm not using eibnetmux as far as I know... Just plain OR.</p>

<p>Any help would be much appreciated. Maybe this is fixed and I need a new build?</p>

<p>Thanks.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jlevy at Jun 22, 2014 04:24
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887226"></a>
                                    <font class="smallfont"><p>BTW everything works perfectly and stable when controller is on Win7 + Java 1.7. I'm guessing I should get a copy of Wheezy soft float + install Java 1.7...</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jlevy at Jun 22, 2014 18:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887227"></a>
                                    <font class="smallfont"><p>What KNX gateway do you use? It could be that you need to power off the gateway or wait 10 minutes or so until the gateway releases old connections. Also, if your gateway only supports one connection at a time that can cause problems if you use ETS or connect with something else before starting OR.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jun 22, 2014 19:14
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887230"></a>
                                    <font class="smallfont"><p>Hi Marcus,</p>

<p>Thanks for your reply. I'm using MDT SCN-IP000.01. As I said - it works perfectly when OR controller runs on Win7 with Java 1.7.0_55. On the raspberry I have 1.8 and it's hard float.</p>

<p>The disconnect failed happens when I try to connect. Did you see the logs?</p>

<p>Thank you!</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jlevy at Jun 22, 2014 19:42
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887231"></a>
                                    <font class="smallfont"><p>Then I would also assume it's related to the Pi.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jun 22, 2014 19:48
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887232"></a>
                                    <font class="smallfont"><p>So what do you recommend? Java 1.6 on soft float?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jlevy at Jun 22, 2014 19:49
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887233"></a>
                                    <font class="smallfont"><p>Does it work if you start everything from scratch? Power off IP gateway and PI. Power on gateway (without anything else trying to connect to KNX) start Pi?<br/>
Does that work and errors occur only after a while or do you already receive errors when starting?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jun 22, 2014 20:02
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887234"></a>
                                    <font class="smallfont"><p>WOW!!! I restarted the IP gateway (actually the whole bus) and the Pi and it works! Looks good but I need to give it some more time. So this means every time I use ETS it will disconnect and require a full bus restart? What is the reason? Anything I can do?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jlevy at Jun 22, 2014 20:24
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887235"></a>
                                    <font class="smallfont"><p>Was happy too soon. Now I restarted app on iphone, clicking a button and I get "Service failed".</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jlevy at Jun 22, 2014 20:26
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887236"></a>
                                    <font class="smallfont"><p>Anything in the logs now?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jun 22, 2014 20:28
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887237"></a>
                                    <font class="smallfont"><p>A little different but same socket stuff.</p>

<p>Now with the log:<br/>
<a href="attachments/22887209/23036589.txt" title="KNX log 2">KNX log 2</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jlevy at Jun 22, 2014 20:31
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887241"></a>
                                    <font class="smallfont"><p>No idea. Maybe you can try the other Java.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jun 22, 2014 20:48
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887242"></a>
                                    <font class="smallfont"><p>I will. Hopefully tomorrow. Not sure how to install the OS without NOOBS.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jlevy at Jun 22, 2014 20:50
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887255"></a>
                                    <font class="smallfont"><p>Moved to soft float, Java SE Embedded 1.6 - same problems. Socket gets closed. I'm going crazy.</p>

<p>Does anyone have a working raspberry pi image with KNX just so I can check to see if it's the PI hardware...<br/>
Does anyone have any idea how to check the PI nic?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jlevy at Jun 23, 2014 18:53
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887271"></a>
                                    <font class="smallfont"><p>Turns out there was a duplicate IP causing this but this was not detectable until I used WireShark. Now everything seems stable although I do get a Socket Closed error on load. But then everything stays stable.</p>

<p>Marcus - do you know the reason for this initial Socket Closed Error? It happens a few milliseconds after the KNX connection is reported as connected...</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jlevy at Jun 25, 2014 06:47
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887274"></a>
                                    <font class="smallfont"><p>Do you have something in logs?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jun 25, 2014 09:04
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887284"></a>
                                    <font class="smallfont"><p>Yes. See below. After the last line it stayed stable for 3 hours and then it actually happened again and it seems that the process crashed. Could it be because the terminal session I ran openremote was closed (it was closed a few hours before the crash occured).</p>

<p>BTW with all the tries I ended up with Java 1.7. Planning on re-installing the PI to soft float + Java 1.6.</p>


<p>INFO 2014-06-25 03:17:31,116 (KNX): KNX IP interface hostname set to '192.168.1.50'<br/>
INFO 2014-06-25 03:17:31,118 (KNX): KNX IP interface port set to '3671'<br/>
INFO 2014-06-25 03:17:31,120 (KNX): KNX PhysicalBus clazz set to 'org.openremote.controller.protocol.port.DatagramSocketPort'<br/>
INFO 2014-06-25 03:17:31,134 (KNX): Scheduled reconnection task<br/>
INFO 2014-06-25 03:17:31,138 (KNX): Trying to create connection<br/>
INFO 2014-06-25 03:17:31,144 (KNX): Removing connection<br/>
WARN 2014-06-25 03:17:31,147 (KNX): Unknown KNX property '&lt;property name = "name" value = "B4-N KITCHEN CENTER LIGHT ST"/&gt;'.<br/>
INFO 2014-06-25 03:17:31,168 (KNX): KNX Connection manager resolving local host IP addresses...<br/>
INFO 2014-06-25 03:17:31,175 (KNX): Found candidate NIC: name:eth0 (eth0)<br/>
INFO 2014-06-25 03:17:31,189 (KNX): Added candidate IP address to set - /192.168.1.5<br/>
INFO 2014-06-25 03:17:31,191 (KNX): Skipping loopback interface: name:lo (lo)<br/>
INFO 2014-06-25 03:17:31,663 (KNX): Created KNX Command FRAME L_Data.req 0.0.0 -&gt; 0/0/123 Data: 0x00 for group address '0/0/123'<br/>
INFO 2014-06-25 03:17:31,749 (KNX): Found a KNX IP interface at /192.168.1.50:3671<br/>
INFO 2014-06-25 03:17:31,904 (KNX): Connection created for KNX IP interface at /192.168.1.50:3671<br/>
INFO 2014-06-25 03:17:31,993 (KNX): Notified with KNX interface status = connected<br/>
INFO 2014-06-25 03:17:31,995 (KNX): Connected to KNX-IP interface /192.168.1.50:3671<br/>
INFO 2014-06-25 03:17:32,008 (KNX): KNX-IP socket listener IOException<br/>
java.net.SocketException: Socket closed<br/>
	at java.net.PlainDatagramSocketImpl.receive0(Native Method)<br/>
	at java.net.AbstractPlainDatagramSocketImpl.receive(AbstractPlainDatagramSocketImpl.java:145)<br/>
	at java.net.DatagramSocket.receive(DatagramSocket.java:786)<br/>
	at org.openremote.controller.protocol.port.DatagramSocketPort.receive(DatagramSocketPort.java:78)<br/>
	at org.openremote.controller.protocol.knx.ip.IpProcessor$PhysicalBusListener.run(IpProcessor.java:82)<br/>
WARN 2014-06-25 03:17:32,012 (KNX): KNX-IP socket listener stopped<br/>
INFO 2014-06-25 03:17:32,015 (KNX): Stopping connection timer<br/>
WARN 2014-06-25 03:17:32,083 (KNX): Unknown KNX property '&lt;property name = "name" value = "D1-D LIVING ROOM DIMMER ST"/&gt;'.<br/>
INFO 2014-06-25 03:17:32,085 (KNX): Created KNX Command FRAME L_Data.req 0.0.0 -&gt; 0/0/135 Data: 0x00 for group address '0/0/135'</p>

<p>.. stable and then all of a sudden:</p>

<p>WARN 2014-06-25 03:19:17,596 (KNX): Unknown KNX property '&lt;property name = "name" value = "B4-N KITCHEN CENTER LIGHT (OFF)"/&gt;'.<br/>
INFO 2014-06-25 03:19:17,597 (KNX): Created KNX Command FRAME L_Data.req 0.0.0 -&gt; 0/0/122 Data: 0x00 for group address '0/0/122'<br/>
INFO 2014-06-25 05:28:56,799 (KNX): KNX-IP socket listener IOException<br/>
java.net.SocketException: Socket closed<br/>
	at java.net.PlainDatagramSocketImpl.receive0(Native Method)<br/>
	at java.net.AbstractPlainDatagramSocketImpl.receive(AbstractPlainDatagramSocketImpl.java:145)<br/>
	at java.net.DatagramSocket.receive(DatagramSocket.java:786)<br/>
	at org.openremote.controller.protocol.port.DatagramSocketPort.receive(DatagramSocketPort.java:78)<br/>
	at org.openremote.controller.protocol.knx.ip.IpProcessor$PhysicalBusListener.run(IpProcessor.java:82)<br/>
WARN 2014-06-25 05:28:56,806 (KNX): KNX-IP socket listener stopped<br/>
INFO 2014-06-25 05:28:56,807 (KNX): Notified with KNX interface status = disconnected<br/>
INFO 2014-06-25 05:28:56,810 (KNX): KNX connection not available.<br/>
INFO 2014-06-25 05:28:56,818 (KNX): KNX connection not available.<br/>
INFO 2014-06-25 05:28:56,827 (KNX): Scheduled reconnection task<br/>
INFO 2014-06-25 05:28:56,828 (KNX): Disconnected gracefully from /192.168.1.50:3671<br/>
INFO 2014-06-25 05:28:56,831 (KNX): Notified with KNX interface status = disconnected<br/>
INFO 2014-06-25 05:28:56,832 (KNX): Trying to create connection<br/>
INFO 2014-06-25 05:28:56,833 (KNX): Removing connection<br/>
INFO 2014-06-25 05:28:56,876 (KNX): KNX connection not available.<br/>
INFO 2014-06-25 05:28:56,893 (KNX): KNX connection not available.<br/>
INFO 2014-06-25 05:28:56,907 (KNX): KNX connection not available.<br/>
INFO 2014-06-25 05:28:56,909 (KNX): KNX connection not available.<br/>
INFO 2014-06-25 05:28:56,922 (KNX): KNX connection not available.<br/>
INFO 2014-06-25 05:28:56,925 (KNX): Notified with KNX interface status = disconnected<br/>
ERROR 2014-06-25 05:28:56,927 (KNX): Disconnect failed<br/>
org.openremote.controller.protocol.knx.ip.KnxIpException: Disconnect failed<br/>
	at org.openremote.controller.protocol.knx.ip.IpTunnelClient.disconnect(IpTunnelClient.java:147)<br/>
	at org.openremote.controller.protocol.knx.KNXIpConnectionManager$KNXConnectionImpl.stop(KNXIpConnectionManager.java:819)<br/>
	at org.openremote.controller.protocol.knx.KNXIpConnectionManager$KNXConnectionImpl.access$000(KNXIpConnectionManager.java:637)<br/>
	at org.openremote.controller.protocol.knx.KNXIpConnectionManager.stop(KNXIpConnectionManager.java:210)<br/>
	at org.openremote.controller.protocol.knx.KNXIpConnectionManager$ConnectionTask.removeConnection(KNXIpConnectionManager.java:1004)<br/>
	at org.openremote.controller.protocol.knx.KNXIpConnectionManager$ConnectionTask.run(KNXIpConnectionManager.java:991)<br/>
	at java.util.TimerThread.mainLoop(Timer.java:555)<br/>
	at java.util.TimerThread.run(Timer.java:505)<br/>
INFO 2014-06-25 05:28:56,931 (KNX): KNX Connection manager resolving local host IP addresses...<br/>
INFO 2014-06-25 05:28:56,933 (KNX): Found candidate NIC: name:eth0 (eth0)<br/>
INFO 2014-06-25 05:28:56,933 (KNX): Added candidate IP address to set - /192.168.1.5<br/>
INFO 2014-06-25 05:28:56,934 (KNX): Skipping loopback interface: name:lo (lo)<br/>
INFO 2014-06-25 05:28:56,946 (KNX): KNX connection not available.<br/>
INFO 2014-06-25 05:28:56,952 (KNX): KNX connection not available.<br/>
INFO 2014-06-25 05:28:57,028 (KNX): KNX connection not available.<br/>
INFO 2014-06-25 05:28:57,031 (KNX): Found a KNX IP interface at /192.168.1.50:3671<br/>
INFO 2014-06-25 05:28:57,034 (KNX): Connection created for KNX IP interface at /192.168.1.50:3671<br/>
INFO 2014-06-25 05:28:57,035 (KNX): KNX connection not available.<br/>
INFO 2014-06-25 05:28:57,037 (KNX): KNX connection not available.</p>

<p>(Probably here it crashed since it stopped logging anything...)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jlevy at Jun 25, 2014 21:08
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22887285"></a>
                                    <font class="smallfont"><p>I can't say why the connection closed after runnin stable for a while.<br/>
But since it was not closed properly the KNX gateway did not release the connection correct which causes the "KNX connection not available". The KNX gateways always take a few minutes until they alow a new connection unless you power it off and on.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jun 25, 2014 21:43
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:37</font></td>
		    </tr>
	    </table>
    </body>
</html>