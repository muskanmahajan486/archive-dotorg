<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Json expression fails</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Json expression fails
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on May 21, 2016 by <font color="#0050B2">robnas</font>.
				    </div>

				    <p>Hello,</p>

<p>I would like to parse the temperature from a json command.<br/>
he urls is: <a href="http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20weather.forecast%20where%20woeid%20in%20(select%20woeid%20from%20geo.places(1)%20where%20text%3D%22roermond%2C%20nl%22)%20and%20u=%27c%27&amp;format=json">http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20weather.forecast%20where%20woeid%20in%20(select%20woeid%20from%20geo.places(1)%20where%20text%3D%22roermond%2C%20nl%22)%20and%20u=%27c%27&amp;format=json</a></p>

<p>the json string is:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">{
	<span class="code-quote">"query"</span>: {
		<span class="code-quote">"count"</span>: 1,
		<span class="code-quote">"created"</span>: <span class="code-quote">"2016-05-21T18:26:40Z"</span>,
		<span class="code-quote">"lang"</span>: <span class="code-quote">"nl-NL"</span>,
		<span class="code-quote">"results"</span>: {
			<span class="code-quote">"channel"</span>: {
				<span class="code-quote">"units"</span>: {
					<span class="code-quote">"distance"</span>: <span class="code-quote">"km"</span>,
					<span class="code-quote">"pressure"</span>: <span class="code-quote">"mb"</span>,
					<span class="code-quote">"speed"</span>: <span class="code-quote">"km/h"</span>,
					<span class="code-quote">"temperature"</span>: <span class="code-quote">"C"</span>
				},
				<span class="code-quote">"title"</span>: <span class="code-quote">"Yahoo! Weather - Roermond, LM, NL"</span>,
				<span class="code-quote">"link"</span>: <span class="code-quote">"http:<span class="code-comment">//us.rd.yahoo.com/dailynews/rss/weather/Country__Country/*https://weather.yahoo.com/country/state/city-733020/"</span>,
</span>				<span class="code-quote">"description"</span>: <span class="code-quote">"Yahoo! Weather <span class="code-keyword">for</span> Roermond, LM, NL"</span>,
				<span class="code-quote">"language"</span>: <span class="code-quote">"en-us"</span>,
				<span class="code-quote">"lastBuildDate"</span>: <span class="code-quote">"Sat, 21 May 2016 08:26 PM CEST"</span>,
				<span class="code-quote">"ttl"</span>: <span class="code-quote">"60"</span>,
				<span class="code-quote">"location"</span>: {
					<span class="code-quote">"city"</span>: <span class="code-quote">"Roermond"</span>,
					<span class="code-quote">"country"</span>: <span class="code-quote">"Netherlands"</span>,
					<span class="code-quote">"region"</span>: <span class="code-quote">" LM"</span>
				},
				<span class="code-quote">"wind"</span>: {
					<span class="code-quote">"chill"</span>: <span class="code-quote">"75"</span>,
					<span class="code-quote">"direction"</span>: <span class="code-quote">"175"</span>,
					<span class="code-quote">"speed"</span>: <span class="code-quote">"22.53"</span>
				},
				<span class="code-quote">"atmosphere"</span>: {
					<span class="code-quote">"humidity"</span>: <span class="code-quote">"43"</span>,
					<span class="code-quote">"pressure"</span>: <span class="code-quote">"34134.81"</span>,
					<span class="code-quote">"rising"</span>: <span class="code-quote">"0"</span>,
					<span class="code-quote">"visibility"</span>: <span class="code-quote">"25.91"</span>
				},
				<span class="code-quote">"astronomy"</span>: {
					<span class="code-quote">"sunrise"</span>: <span class="code-quote">"5:35 am"</span>,
					<span class="code-quote">"sunset"</span>: <span class="code-quote">"9:31 pm"</span>
				},
				<span class="code-quote">"image"</span>: {
					<span class="code-quote">"title"</span>: <span class="code-quote">"Yahoo! Weather"</span>,
					<span class="code-quote">"width"</span>: <span class="code-quote">"142"</span>,
					<span class="code-quote">"height"</span>: <span class="code-quote">"18"</span>,
					<span class="code-quote">"link"</span>: <span class="code-quote">"http:<span class="code-comment">//weather.yahoo.com"</span>,
</span>					<span class="code-quote">"url"</span>: <span class="code-quote">"http:<span class="code-comment">//l.yimg.com/a/i/brand/purplelogo//uh/us/news-wea.gif"</span>
</span>				},
				<span class="code-quote">"item"</span>: {
					<span class="code-quote">"title"</span>: <span class="code-quote">"Conditions <span class="code-keyword">for</span> Roermond, LM, NL at 07:00 PM CEST"</span>,
					<span class="code-quote">"lat"</span>: <span class="code-quote">"51.18988"</span>,
					<span class="code-quote">"<span class="code-object">long</span>"</span>: <span class="code-quote">"5.9911"</span>,
					<span class="code-quote">"link"</span>: <span class="code-quote">"http:<span class="code-comment">//us.rd.yahoo.com/dailynews/rss/weather/Country__Country/*https://weather.yahoo.com/country/state/city-733020/"</span>,
</span>					<span class="code-quote">"pubDate"</span>: <span class="code-quote">"Sat, 21 May 2016 07:00 PM CEST"</span>,
					<span class="code-quote">"condition"</span>: {
						<span class="code-quote">"code"</span>: <span class="code-quote">"26"</span>,
						<span class="code-quote">"date"</span>: <span class="code-quote">"Sat, 21 May 2016 07:00 PM CEST"</span>,
						<span class="code-quote">"temp"</span>: <span class="code-quote">"23"</span>,
						<span class="code-quote">"text"</span>: <span class="code-quote">"Cloudy"</span>
					},
					<span class="code-quote">"forecast"</span>: [{
						<span class="code-quote">"code"</span>: <span class="code-quote">"26"</span>,
						<span class="code-quote">"date"</span>: <span class="code-quote">"21 May 2016"</span>,
						<span class="code-quote">"day"</span>: <span class="code-quote">"Sat"</span>,
						<span class="code-quote">"high"</span>: <span class="code-quote">"24"</span>,
						<span class="code-quote">"low"</span>: <span class="code-quote">"11"</span>,
						<span class="code-quote">"text"</span>: <span class="code-quote">"Cloudy"</span>
					}, {
						<span class="code-quote">"code"</span>: <span class="code-quote">"11"</span>,
						<span class="code-quote">"date"</span>: <span class="code-quote">"22 May 2016"</span>,
						<span class="code-quote">"day"</span>: <span class="code-quote">"Sun"</span>,
						<span class="code-quote">"high"</span>: <span class="code-quote">"20"</span>,
						<span class="code-quote">"low"</span>: <span class="code-quote">"13"</span>,
						<span class="code-quote">"text"</span>: <span class="code-quote">"Showers"</span>
					}, {
						<span class="code-quote">"code"</span>: <span class="code-quote">"11"</span>,
						<span class="code-quote">"date"</span>: <span class="code-quote">"23 May 2016"</span>,
						<span class="code-quote">"day"</span>: <span class="code-quote">"Mon"</span>,
						<span class="code-quote">"high"</span>: <span class="code-quote">"16"</span>,
						<span class="code-quote">"low"</span>: <span class="code-quote">"11"</span>,
						<span class="code-quote">"text"</span>: <span class="code-quote">"Showers"</span>
					}, {
						<span class="code-quote">"code"</span>: <span class="code-quote">"28"</span>,
						<span class="code-quote">"date"</span>: <span class="code-quote">"24 May 2016"</span>,
						<span class="code-quote">"day"</span>: <span class="code-quote">"Tue"</span>,
						<span class="code-quote">"high"</span>: <span class="code-quote">"16"</span>,
						<span class="code-quote">"low"</span>: <span class="code-quote">"8"</span>,
						<span class="code-quote">"text"</span>: <span class="code-quote">"Mostly Cloudy"</span>
					}, {
						<span class="code-quote">"code"</span>: <span class="code-quote">"28"</span>,
						<span class="code-quote">"date"</span>: <span class="code-quote">"25 May 2016"</span>,
						<span class="code-quote">"day"</span>: <span class="code-quote">"Wed"</span>,
						<span class="code-quote">"high"</span>: <span class="code-quote">"20"</span>,
						<span class="code-quote">"low"</span>: <span class="code-quote">"7"</span>,
						<span class="code-quote">"text"</span>: <span class="code-quote">"Mostly Cloudy"</span>
					}, {
						<span class="code-quote">"code"</span>: <span class="code-quote">"30"</span>,
						<span class="code-quote">"date"</span>: <span class="code-quote">"26 May 2016"</span>,
						<span class="code-quote">"day"</span>: <span class="code-quote">"Thu"</span>,
						<span class="code-quote">"high"</span>: <span class="code-quote">"24"</span>,
						<span class="code-quote">"low"</span>: <span class="code-quote">"11"</span>,
						<span class="code-quote">"text"</span>: <span class="code-quote">"Partly Cloudy"</span>
					}, {
						<span class="code-quote">"code"</span>: <span class="code-quote">"4"</span>,
						<span class="code-quote">"date"</span>: <span class="code-quote">"27 May 2016"</span>,
						<span class="code-quote">"day"</span>: <span class="code-quote">"Fri"</span>,
						<span class="code-quote">"high"</span>: <span class="code-quote">"25"</span>,
						<span class="code-quote">"low"</span>: <span class="code-quote">"13"</span>,
						<span class="code-quote">"text"</span>: <span class="code-quote">"Thunderstorms"</span>
					}, {
						<span class="code-quote">"code"</span>: <span class="code-quote">"47"</span>,
						<span class="code-quote">"date"</span>: <span class="code-quote">"28 May 2016"</span>,
						<span class="code-quote">"day"</span>: <span class="code-quote">"Sat"</span>,
						<span class="code-quote">"high"</span>: <span class="code-quote">"23"</span>,
						<span class="code-quote">"low"</span>: <span class="code-quote">"13"</span>,
						<span class="code-quote">"text"</span>: <span class="code-quote">"Scattered Thunderstorms"</span>
					}, {
						<span class="code-quote">"code"</span>: <span class="code-quote">"28"</span>,
						<span class="code-quote">"date"</span>: <span class="code-quote">"29 May 2016"</span>,
						<span class="code-quote">"day"</span>: <span class="code-quote">"Sun"</span>,
						<span class="code-quote">"high"</span>: <span class="code-quote">"22"</span>,
						<span class="code-quote">"low"</span>: <span class="code-quote">"15"</span>,
						<span class="code-quote">"text"</span>: <span class="code-quote">"Mostly Cloudy"</span>
					}, {
						<span class="code-quote">"code"</span>: <span class="code-quote">"28"</span>,
						<span class="code-quote">"date"</span>: <span class="code-quote">"30 May 2016"</span>,
						<span class="code-quote">"day"</span>: <span class="code-quote">"Mon"</span>,
						<span class="code-quote">"high"</span>: <span class="code-quote">"21"</span>,
						<span class="code-quote">"low"</span>: <span class="code-quote">"13"</span>,
						<span class="code-quote">"text"</span>: <span class="code-quote">"Mostly Cloudy"</span>
					}],
					<span class="code-quote">"description"</span>: <span class="code-quote">"&lt;![CDATA[&lt;img src=\"</span>http:<span class="code-comment">//l.yimg.com/a/i/us/we/52/26.gif\<span class="code-quote">"/&gt;\n&lt;BR /&gt;\n&lt;b&gt;Current Conditions:&lt;/b&gt;\n&lt;BR /&gt;Cloudy\n&lt;BR /&gt;\n&lt;BR /&gt;\n&lt;b&gt;Forecast:&lt;/b&gt;\n&lt;BR /&gt; Sat - Cloudy. High: 24Low: 11\n&lt;BR /&gt; Sun - Showers. High: 20Low: 13\n&lt;BR /&gt; Mon - Showers. High: 16Low: 11\n&lt;BR /&gt; Tue - Mostly Cloudy. High: 16Low: 8\n&lt;BR /&gt; Wed - Mostly Cloudy. High: 20Low: 7\n&lt;BR /&gt;\n&lt;BR /&gt;\n&lt;a href=\"</span>http://us.rd.yahoo.com/dailynews/rss/weather/Country__Country/*https://weather.yahoo.com/country/state/city-733020/\<span class="code-quote">"&gt;Full Forecast at Yahoo! Weather&lt;/a&gt;\n&lt;BR /&gt;\n&lt;BR /&gt;\n(provided by &lt;a href=\"</span>http://www.weather.com\<span class="code-quote">" &gt;The Weather Channel&lt;/a&gt;)\n&lt;BR /&gt;\n]]&gt;"</span>,
</span>					<span class="code-quote">"guid"</span>: {
						<span class="code-quote">"isPermaLink"</span>: <span class="code-quote">"<span class="code-keyword">false</span>"</span>
					}
				}
			}
		}
	}
}</pre>
</div></div>
<p>the json expression should be: <div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">$.query.results.channel.item.condition.temp</pre>
</div></div><br/>
its tested and this works according to <a href="http://jsonpath.com/">http://jsonpath.com/</a><br/>
it will get the temperature back in degrees</p>

<p>my http.log says:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
ERROR 2016-05-21 22:49:54,598 (HTTP): ClientProtocolException when executing HTTP method
org.apache.http.client.HttpResponseException: Bad Request
	at org.apache.http.impl.client.BasicResponseHandler.handleResponse(BasicResponseHandler.java:67)
	at org.apache.http.impl.client.BasicResponseHandler.handleResponse(BasicResponseHandler.java:54)
	at org.openremote.controller.protocol.http.HttpGetCommand.requestURL(HttpGetCommand.java:238)
	at org.openremote.controller.protocol.http.HttpGetCommand.run(HttpGetCommand.java:260)
	at java.lang.<span class="code-object">Thread</span>.run(<span class="code-object">Thread</span>.java:662)
INFO 2016-05-21 22:49:54,602 (HTTP): received message: 
ERROR 2016-05-21 22:49:55,428 (HTTP): Could not perform jsonpath evaluation
java.lang.IllegalArgumentException: json can not be <span class="code-keyword">null</span> or empty
	at org.apache.commons.lang.Validate.notEmpty(Validate.java:363)
	at com.jayway.jsonpath.JsonPath.read(JsonPath.java:304)
	at org.openremote.controller.protocol.http.HttpGetCommand.run(HttpGetCommand.java:297)
	at java.lang.<span class="code-object">Thread</span>.run(<span class="code-object">Thread</span>.java:662)
ERROR 2016-05-21 22:50:33,972 (HTTP): IOException when executing HTTP method
java.net.NoRouteToHostException: No route to host
	at java.net.PlainSocketImpl.socketConnect(Native Method)
	at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:351)
	at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:213)
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:200)
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)
	at java.net.Socket.connect(Socket.java:529)
	at org.apache.http.conn.scheme.PlainSocketFactory.connectSocket(PlainSocketFactory.java:123)
	at org.apache.http.impl.conn.DefaultClientConnectionOperator.openConnection(DefaultClientConnectionOperator.java:123)
	at org.apache.http.impl.conn.AbstractPoolEntry.open(AbstractPoolEntry.java:147)
	at org.apache.http.impl.conn.AbstractPooledConnAdapter.open(AbstractPooledConnAdapter.java:108)
	at org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:415)
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:641)
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:576)
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:554)
	at org.openremote.controller.protocol.http.HttpGetCommand.requestURL(HttpGetCommand.java:237)
	at org.openremote.controller.protocol.http.HttpGetCommand.run(HttpGetCommand.java:260)
	at java.lang.<span class="code-object">Thread</span>.run(<span class="code-object">Thread</span>.java:662)
INFO 2016-05-21 22:50:33,974 (HTTP): received message: 
ERROR 2016-05-21 22:50:36,926 (HTTP): Could not perform jsonpath evaluation
java.lang.IllegalArgumentException: json can not be <span class="code-keyword">null</span> or empty
	at org.apache.commons.lang.Validate.notEmpty(Validate.java:363)
	at com.jayway.jsonpath.JsonPath.read(JsonPath.java:304)
	at org.openremote.controller.protocol.http.HttpGetCommand.run(HttpGetCommand.java:297)
	at java.lang.<span class="code-object">Thread</span>.run(<span class="code-object">Thread</span>.java:662)
ERROR 2016-05-21 22:50:45,677 (HTTP): ClientProtocolException when executing HTTP method
org.apache.http.client.HttpResponseException: Bad Request
	at org.apache.http.impl.client.BasicResponseHandler.handleResponse(BasicResponseHandler.java:67)
	at org.apache.http.impl.client.BasicResponseHandler.handleResponse(BasicResponseHandler.java:54)
	at org.openremote.controller.protocol.http.HttpGetCommand.requestURL(HttpGetCommand.java:238)
	at org.openremote.controller.protocol.http.HttpGetCommand.run(HttpGetCommand.java:260)
	at java.lang.<span class="code-object">Thread</span>.run(<span class="code-object">Thread</span>.java:662)
INFO 2016-05-21 22:50:45,679 (HTTP): received message: 
ERROR 2016-05-21 22:50:51,329 (HTTP): Could not perform jsonpath evaluation
java.lang.IllegalArgumentException: json can not be <span class="code-keyword">null</span> or empty
	at org.apache.commons.lang.Validate.notEmpty(Validate.java:363)
	at com.jayway.jsonpath.JsonPath.read(JsonPath.java:304)
	at org.openremote.controller.protocol.http.HttpGetCommand.run(HttpGetCommand.java:297)
	at java.lang.<span class="code-object">Thread</span>.run(<span class="code-object">Thread</span>.java:662)
</pre>
</div></div>

<p>any ideas what should be wrong?</p>

				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-23607024"></a>
                                    <font class="smallfont"><p>Ive got it working already with <a href="http://openweathermap.org/">http://openweathermap.org/</a>  instead of using Yahoo. Yahoo doesnt worksomehow.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by robnas at May 22, 2016 14:04
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:33</font></td>
		    </tr>
	    </table>
    </body>
</html>