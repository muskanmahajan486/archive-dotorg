<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : unresponsive IR signals from input commands during button press</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : unresponsive IR signals from input commands during button press
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Mar 21, 2012 by <font color="#0050B2">tekstyle</font>.
				    </div>

				    <p>Hi there,</p>

<p>I have have openremote setup on my android tablet, a QNAP TS-219P II turbo NAS as the controller, and global cache Itach wf2ir module. I have setup the connections for them all and have been successful with controlling my AV equipment from the tablet and openremote touch interface. however, more often than not, I notice there is a significantly long delay between button press and the time the Itach sends the IR signal. Sometimes, it doesn't even send it at all. This is particularly worse when I push multiple buttons in series. the Itach will either have a 5-10 second delay and then send them all at once or if bombarded with too many commands, will skip some of them in between. </p>

<p>Is there a way to fix this to make the responsiveness faster? I have a gigabit connection and I don't think that's an issue. I used to have a pronto and it worked great but I wanted something more customizeable hence I went with openremote. thank you.</p>


<p>is it better to install the controller software on a PC vs. a NAS? I have both setup and can use either but I can't tell which one is generally should be more reliable.</p>

<p>Derek</p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439841/19398803.class">Deployer.class</a> (application/octet-stream)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439841/19398801.class">Deployer.class</a> (application/octet-stream)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439841/19398804.class">Deployer$BeehiveConnection.class</a> (application/octet-stream)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439841/19398805.class">Deployer$ControllerDefinitionWatch.class</a> (application/octet-stream)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-19439848"></a>
                                    <font class="smallfont"><p>You could try the PC, to make sure it is not related to CPU power.<br/>
Which version of the controller are you using? The final 2.0 is now available.<br/>
Do you have any sensors or just controll commands?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 22, 2012 08:09
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439855"></a>
                                    <font class="smallfont"><p>I've also seen noticeable delays with my QNAP TS-110 and a KNX installation. Both are based on ARM architecture with limited java performance. After switching off all traces and log settings delays are on an acceptable level. Maybe you should give it a try.<br/>
MArko   </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by maja at Mar 22, 2012 10:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439858"></a>
                                    <font class="smallfont"><p>Hi everyone, thanks for your response and input.</p>

<p>Marcus: both machines are running the 2.0 version of the controller. my machines are: <br/>
QNAP TS-219P II turboNAS via ethernet gigabit LAN.<br/>
Dell 710m laptop with pentium M CPU, 1GB RAM running windows XP pro via WLAN wireless G.</p>

<p>the performance of both seems to be the same. I have noticed that bombarding it 5-6 commands in quick sessions will cause it to freeze since the controller needs to catch up.<br/>
Sending 1 command at a time is pretty much instant with about .5 second delay which is acceptable.<br/>
If I don't press anything on the remote for a while and then initiate a command by pressing something whether it's a macro or a single button, it has 5-10 delay before the IR is sent. somethings need to press the command again for it to work. </p>

<p>Summary:<br/>
So based on what I have noticed, it seems that the delay is really that first command being sent from an idle state. Almost seems like the controller has been sleeping and waiting for a wake signal.</p>

<p>Possible causes:<br/>
1. Itach is slow at getting Wifi signal and converting it to IR.<br/>
how to test: I would like to hear other people's experiences have been using openremote to send a IR signal with other devices to test #1.</p>

<p>2. openremote controller falls into a pseudo-sleep mode when touch panel has been idle for a while.<br/>
how to test: maybe a more powerful machine as a controller? Or anyone making modifications/tweaks to the OR software itself.</p>

<p>3. difference in iOS app vs. Android app.<br/>
how to test: Since I have 2 touch devices: iphone and android tablet. I went ahead to see if they perform any differently. results were non-conclusive, so i'll rule out #3.</p>

<p>@ Marko: are you using a Itach as well? if not, what device are you using? I did not program any sensor or traces. It only commands IR signals without any feedback. In fact, sensors are something I am interested in but have no idea how to integrate it into my existing equipment and openremote designer.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by tekstyle at Mar 22, 2012 11:01
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439862"></a>
                                    <font class="smallfont"><p>There is not pseudo-sleep in the controller.<br/>
Also, if you do not use sensors, the sensor polling thread should not do anything.</p>

<p>I would take a close look at the Itach Wifi, but that is just a guess.<br/>
Do you have another software where you can just send commands to the Itach to test this?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 22, 2012 11:12
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439868"></a>
                                    <font class="smallfont"><p>i have just tested connection between the Itach and my macbook air via the itest software. This allows me to bypass the need for openremote software by connecting directly to the device. I was able to send commands instantly and endlessly with no lag or freezing in between. The response time is equal to that of a normal remote. It also does not suffer from non-activity.</p>

<p>the problem seems to be OR...</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by tekstyle at Mar 22, 2012 17:57
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439874"></a>
                                    <font class="smallfont"><p>This might have todo with an issue we found earlier but the fix did not make it into the latest codebase <img class="emoticon" src="images/icons/emoticons/sad.gif" height="20" width="20" align="absmiddle" alt="" border="0"/><br/>
Could you try and replace the file "Deployer.class" in the folder</p>

<p>"Controller-2.0.0/webapps/controller/WEB-INF/classes/org/openremote/controller/service/"</p>

<p>with the attached version and give it a try.</p>

<p>Thanks.<br/>
<a href="attachments/19439841/19398801.class">Deployer.class</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 22, 2012 21:02
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439878"></a>
                                    <font class="smallfont"><p>Thanks Marcus. I will do this when I get home. on a road trip right now. Should be back Monday.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by tekstyle at Mar 23, 2012 06:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439936"></a>
                                    <font class="smallfont"><p>HI marcus..</p>

<p>I replaced the deployer.class file and when i reloaded my hostip:8081/controller, i get a " An attempt was made to access service context before it was initialized" in red. I created a new folder as to create a new controller but still give me the same problem. is the issue from file or something else?</p>

<p>i also SSH and changed the directory path in the autorun file.</p>

<p>thank you.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by tekstyle at Mar 26, 2012 12:40
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439938"></a>
                                    <font class="smallfont"><p>Can you see anything in the log files? It sounds like an error occured during startup.<br/>
The file was compiled against the official 2.0 release which is available on sourceforge.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 26, 2012 13:17
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439950"></a>
                                    <font class="smallfont"><p>there is nothing in the log folder and it's subfolders. I actually went and factory restored by NAS. I installed java all over again, installed openremote controller 2.0 and replaced the deployer.class file. I then got to the controller sync page. however, now i have a different problem. when i try to sync with online designer, the spinning wheel would start and then go away. if i tried to upload an openremote.zip, the spinning wheel is eternal. </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by tekstyle at Mar 27, 2012 01:12
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439956"></a>
                                    <font class="smallfont"><p>Ok, looks like you need the inner classes that belong to the new Deployer.class also.<br/>
Please try again and replace all three files.<br/>
Sorry about that.</p>

<p><a href="attachments/19439841/19398805.class">Deployer$ControllerDefinitionWatch.class</a><br/>
<a href="attachments/19439841/19398804.class">Deployer$BeehiveConnection.class</a><br/>
<a href="attachments/19439841/19398801.class">Deployer.class</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 27, 2012 08:00
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439965"></a>
                                    <font class="smallfont"><p>Hi Mark. thanks for the files. it fixed the syncing problem.</p>

<p>I have tested with the new class files and the problem with the delayed response still exist.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by tekstyle at Mar 27, 2012 19:33
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439966"></a>
                                    <font class="smallfont"><p>Ok.<br/>
Did you also try and turn off all logging, what Marko suggested earlier?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 27, 2012 19:58
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439968"></a>
                                    <font class="smallfont"><p>oh no. not yet. i didn't know how to do that. can you please explain? do I do it from localhost:port/controller? or from within SSH?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by tekstyle at Mar 28, 2012 03:32
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439975"></a>
                                    <font class="smallfont"><p>You have to SSH and edit file log4j.properties in webapps/controller/WEB-INF/classes folder.<br/>
Change the Threshold of the various logger to "ERROR" to limit most of the logging.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 28, 2012 13:39
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439983"></a>
                                    <font class="smallfont"><p>I have changed everything with a prefix of threshold to ERROR and there was still a lag. I then changed them all to OFF. seems like the delay got worse. </p>

<p>@Marko: are you using a wf2IR? if so, what settings are your network security?</p>

<p>I have looked at several youtube videos of people using a wf2ir the response time is instant.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by tekstyle at Mar 28, 2012 23:48
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439986"></a>
                                    <font class="smallfont"><p>Which protocol do you use to control the wf2ir? TCP/HTTP/UDP/Telnet ?<br/>
Can you send me your controller.xml ?<br/>
marcus (at) openremote (dot) org</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 29, 2012 08:07
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439988"></a>
                                    <font class="smallfont"><p>Hi Allen,</p>

<p>no, I'm only using a KNX Gateway in my setup. Regarding the logging disabling, I did changes not only in the config file Markus mentioned but also in other ones. Unfortunately I don't have the changes out of my head. Let me check when I'm back home and send you an update.   </p>

<p>O.k. here we go.<br/>
I changed  : <br/>
log4j.properties in webapps/controller/WEB-INF/classes which is for the controller itself<br/>
logging.properties conf/  which I guess is for the tomcat/catalina part<br/>
Basically I've changed all logging levels to = OFF <br/>
After restarting the controller you should noticed that there is no increase of log files under the log folder /log<br/>
For better verification you can delete all log files.  </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by maja at Mar 29, 2012 09:32
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439993"></a>
                                    <font class="smallfont"><p>Hi Marcus,</p>

<p>I am using TCP/IP to control the wf2ir.</p>

<p>i did a search in the open remote folder and i came across a lot of controller.xml files and 1 controller2.xml (in fixture).</p>

<p>which did you want me to send you?</p>

<p>the immediate folder that these files are in are controller, button, gesture, sensor, slider, switch, component, fixture, configuration, configuration2, sensorsonly, sensorsonly2, polling.</p>

<p>i'll send you a screen shot.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by tekstyle at Mar 29, 2012 21:41
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439995"></a>
                                    <font class="smallfont"><p>Should be underneath OpenRemote-Controller-2.0.0/webapps/controller/controller.xml.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 29, 2012 22:11
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440034"></a>
                                    <font class="smallfont"><p>Hello Allen,</p>

<p>I did look at the controller.xml file that you sent to Marcus and have a few questions.</p>

<p>I see a lot of buttons that have multiple times the same command (for instance for volume up / down).<br/>
I suppose this is because you created a macro and you did assign that volume up command multiple times to it.<br/>
What is your purpose there? Is it to raise/lower the volume more than with a single press?</p>

<p>If this is the case, I believe this might be the issue because the way OR handles macros.<br/>
For macros, OR will execute each command in the macro in turn and insert a delay in between each command. Also, control will not return to the console until the macro has finished execution.<br/>
I'll take a closer look at the code when I get a bit of time to double-check / see how to improve that.</p>

<p>In the meantime, can you go in the designer into the "Config for Controller" pane and check under macro. There is where the default delay is configured, which by default is 500 ms. Try reducing that to maybe 10 and see how to works out.</p>

<p>More specifically for this case, instead of using a macro to just repeat the same volume command 10 times, you would be better off using the repeat feature of the sendccf command that the GlobalCach√© supports.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ebariaux at Apr 02, 2012 10:11
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440044"></a>
                                    <font class="smallfont"><p>Thanks Eric,</p>

<p>I changed the delay from 500 to 10. then i deleted the volume macro and added new IR command for the volume up and down but changed the repeat to 10 and 20. I will test this out in a few days. Thank you for yours and Marcus's support.</p>

<p>@Marko: thanks for the location of the files. I will have to play around with those files in a few days. </p>

<p>Really appreciate everyone's efforts!</p>

<p>Allen</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by tekstyle at Apr 03, 2012 02:01
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440045"></a>
                                    <font class="smallfont"><p>i had some time tonight to give it a test.</p>

<p>I modified the log files Marko directed me and changed everything (levels and threshold) to OFF. I also changed the all the maxbackupindex to 0. However, the log files are still being created after reboot though there is no content written in them.</p>

<p>when I use the macro to turn on all my AV equipment, it still takes 6-8 seconds. I might need to modify my macros and streamline things to make things cleaner. if immediately after the first command after a period of no activity i give another non-macro command, it responds fast (normal). however, if i don't do anything a while, the command is delayed. I have 2 controllers and this was tested on the Marvell CPU QNAP NAS on a gigbit LAN with the modified class files and log files along with changes to the config controller in designer as directed by Eric.</p>

<p>my pentium M laptop running the unaltered version of controller 2.0 on wirelessG seems to respond much faster. </p>

<p>I think it might be due to the process not being fast enough to handle the communication between devices. however, the changes made in designer improved the response time noticeably under the pentium controller. I have not tested this machine much so I will have to see how it behaves over time and if this level of performance can be maintained, even though inactivity for long periods of time.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by tekstyle at Apr 03, 2012 06:08
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 10:46</font></td>
		    </tr>
	    </table>
    </body>
</html>