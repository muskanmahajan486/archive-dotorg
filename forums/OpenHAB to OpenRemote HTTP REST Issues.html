<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : OpenHAB to OpenRemote HTTP REST Issues</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : OpenHAB to OpenRemote HTTP REST Issues
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Nov 02, 2015 by <font color="#0050B2">nwootton</font>.
				    </div>

				    <p>I'm currently using OR as the controller for my AV kit, with OpenHAB being used to control the other aspects of my home. Now that both systems are stable and working as I expect, I'm trying to integrate some of the OpenHAB controls into the OR interface to improve the experience for the rest of the household.</p>

<p>I can create individual buttons in OR to send OpenHAB On &amp; Off commands for devices via the HTTP REST API - a simple POST for each. However, what I need to do is get the current state returned from OpenHAB so I can populate a sensor and then use either use a single switch (toggle) or at least give some kind of indication (text label) that the device has been switched.</p>

<p>OpenRemote is currently running in a Docker container @ 192.168.1.152:8093.<br/>
OpenHAB is running on a RPi2 @ 192.168.1.153</p>

<p>In OR I can turn the device on or off with a POST to OpenHAB at <a href="http://192.168.1.153:8080/rest/items/Light_GF_Lounge_TrolleyLamp/">http://192.168.1.153:8080/rest/items/Light_GF_Lounge_TrolleyLamp/</a>. Setting the body/data/payload to content type of 'text/plain' and the actual content to be either ON or OFF. This works fine - my test lamp goes on and off.</p>

<p>Trying to get the status is proving to be an issue. Using the REST API in OpenHAB I can successfully make a call from either the browser or from a tool like Postman to GET the specific state of the item:</p>

<p><a href="http://192.168.1.153:8080/rest/items/Light_GF_Lounge_TrolleyLamp/state">http://192.168.1.153:8080/rest/items/Light_GF_Lounge_TrolleyLamp/state</a> â€”&gt; this will return a plain text of either ON or OFF</p>

<p><a class="confluence-thumbnail-link 312x398" href='http://www.openremote.org/download/attachments/23601977/Screen Shot 2015-10-28 at 13.43.10.jpg'><img src="attachments/thumbnails/23601977/23789992" align="absmiddle" border="0"/></a></p>

<p>But nothing is being shown in OR. I have tried both normal switches and custom ones (with either ON/OFF specified or left empty). As the sensor isn't being populated, I can turn stuff ON with a switch, but the state never changes, so it doesn't allow me to turn it OFF again.</p>

<p>I have tried using the XML information for the entire object and then using Xpath to query the state attribute. I have tried using the same information in JSON format and then using JSONPath to retrieve the state. With the Content-Type has been altered accordingly. I have tried changing the polling time. I have tried just using a text label on screen to see if anything comes back - all I get is either 'N/A' or 'label text' being displayed.</p>

<p>OpenHAB event logs tell me that the calls are being made and that they are succeeding - HTTP Code 200, but nothing happens in the OR interface. I even tried it across an iPad, iPhone and an Android tablet just in case it was an issue with the OR software for the specific device.</p>

<p>What am I missing? Anyone have any suggestions of other things I can try?</p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23601977/23789992.jpg">Screen Shot 2015-10-28 at 13.43.10.jpg</a> (image/jpeg)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-23601983"></a>
                                    <font class="smallfont"><p>IIRC switch requires lowercase on|off. You could use a sensor of type:custom, and map ON -&gt; on and OFF -&gt; off.  Look in the Howto for Custom sensor for the exact specifications</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Nov 02, 2015 13:00
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23601984"></a>
                                    <font class="smallfont"><p>I'll give it a try - I assumed that the normal switch should pick up the ON/OFF... but I'll try the custom mapping of ON -&gt; on &amp; OFF -&gt; off. I think I have tried this, but I'll try again.</p>

<p>I have left the custom fields blank during previous attempts in the hope that I'd see something, but nothing so far.</p>

<p>Thanks</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nwootton at Nov 02, 2015 13:19
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:33</font></td>
		    </tr>
	    </table>
    </body>
</html>