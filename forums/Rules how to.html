<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Rules how to</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Rules how to
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 03, 2012 by <font color="#0050B2">yannph</font>.
				    </div>

				    <p>Is there someone who could provide some rules definition for drools?<br/>
The idea is to have some rules like</p>
<ul class="alternate" type="square">
	<li>if temp value &gt; x then send command</li>
	<li>if time is t then send command</li>
	<li>if A is on and B is on, then send command</li>
</ul>


<p>Do you have some example rules?</p>

<p>Regards</p>

<p>Yann</p>

				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-19434816"></a>
                                    <font class="smallfont"><p>There's no how-to yet but the <a href="https://openremote.svn.sourceforge.net/svnroot/openremote/workspace/juha/Controller_EP_SNAP_20111129/test/org/openremote/controller/fixture/statuscache/rules/">testsuite</a> may have some useful examples for your cases:</p>

<ul class="alternate" type="square">
	<li><a href="https://openremote.svn.sourceforge.net/svnroot/openremote/workspace/juha/Controller_EP_SNAP_20111129/test/org/openremote/controller/fixture/statuscache/rules/level-command-execution/rules/LevelCommandExecution.drl">Execute Command on Level Value</a></li>
	<li><a href="https://openremote.svn.sourceforge.net/svnroot/openremote/workspace/juha/Controller_EP_SNAP_20111129/test/org/openremote/controller/fixture/statuscache/rules/range-limits/rules/RangeLimits.drl">Execute Command on Range Value</a></li>
	<li><a href="https://openremote.svn.sourceforge.net/svnroot/openremote/workspace/juha/Controller_EP_SNAP_20111129/test/org/openremote/controller/fixture/statuscache/rules/scheduled-command-execution/rules/ScheduledCommandExecution.drl">Scheduled Command Execution</a></li>
	<li><a href="https://openremote.svn.sourceforge.net/svnroot/openremote/workspace/juha/Controller_EP_SNAP_20111129/test/org/openremote/controller/fixture/statuscache/rules/sensor-three-switches/rules/ThreeSwitches.drl">Execute Command on Three Switches</a></li>
</ul>

</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jan 09, 2012 05:22
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19435311"></a>
                                    <font class="smallfont"><p>Thank you Juha,<br/>
Indeed, very useful<br/>
A quick question, can we have several drl files in the rules dir or only one file with all the rules included in it?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by yannph at Jan 31, 2012 10:33
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19435313"></a>
                                    <font class="smallfont"><p>Several rule files should work ok.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jan 31, 2012 10:46
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19435364"></a>
                                    <font class="smallfont"><p>Thank you Juha.<br/>
Doesn't seem to work with my two files, I'll try to find what I'm doing wrong.<br/>
If I change an existing rule or if I add a new file, do I have to relaunch the controller?<br/>
Can't have a rule working. Is there some log info that I can activate for the rules engine?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by yannph at Jan 31, 2012 18:25
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437660"></a>
                                    <font class="smallfont"><p>Hi,<br/>
What is this command ("counter") doing in all the examples? Still trying to create something of a schedule to switch lights on and off during holidays. Any further suggestions there are more then welcome <img class="emoticon" src="images/icons/emoticons/biggrin.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>Cheers<br/>
David</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by bolki at Feb 25, 2012 14:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437704"></a>
                                    <font class="smallfont"><p>"counter" is just a command from the test-suite.<br/>
You need to use your own command names. I am not sure if the currently deployed designer does already export the command name with the needed attribute "name" into the controller.xml file. A new version is coming soon which will do that.<br/>
If your version does not do that, you need to edit controller.xml to add the attribute "name" to your commands, so that the rule engine can find the command via name.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 25, 2012 19:25
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437768"></a>
                                    <font class="smallfont"><p>Hi</p>

<p>I'm starting to explore the drools engine and started reading Juhas examples. The vacation example has source = "time of day" and I was wondering where this comes from? Can it be set in drools or do I have to set it in the designer?</p>

<p>I'm interested in time based states triggered by my motion sensors and would like to know how to get the current time. Basically I need only the fuzzy state (night, day, morning etc.).</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by glen at Feb 26, 2012 08:51
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437769"></a>
                                    <font class="smallfont"><p>Hi</p>

<p>I assume it's a sensor defined on the designer using a Time Command from the DateTime protocol</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by yannph at Feb 26, 2012 09:11
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437773"></a>
                                    <font class="smallfont"><p>In this case it's a dummy sensor which is created by the test-suite: <a href="https://openremote.svn.sourceforge.net/svnroot/openremote/workspace/juha/Controller_EP_SNAP_20111129/test/org/openremote/controller/statuscache/rules/RuleEngineTest.java">https://openremote.svn.sourceforge.net/svnroot/openremote/workspace/juha/Controller_EP_SNAP_20111129/test/org/openremote/controller/statuscache/rules/RuleEngineTest.java</a></p>

<p>You will need a real sensor from eg. the DateTime protocol (which Yann mentioned) but that only supports "isDay" or "isNight". <br/>
Check the DateTime-Howto.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 26, 2012 09:36
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437775"></a>
                                    <font class="smallfont"><p>Marcus just beat me to it, the How-to is <a href="http://www.openremote.org/display/docs/OpenRemote+2.0+How+To+-+DateTime+Protocol">here</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ebariaux at Feb 26, 2012 09:41
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437776"></a>
                                    <font class="smallfont"><p>Hi</p>

<p>Thank you all. I played around in the designer but managed to miss the DateTime protocol. I'm on my way to learn how to implement drools in my setup.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by glen at Feb 26, 2012 09:47
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437799"></a>
                                    <font class="smallfont"><p>This is perfect, just what I was looking for (I think) Thanks for the response !!</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by bolki at Feb 26, 2012 14:05
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437804"></a>
                                    <font class="smallfont"><p>But I get an error on the controller:</p>

<p>org.openremote.controller.exception.NoSuchCommandBuilderException: Cannot find 'datetimeBuilder' by 'datetime' protocol., please check the property 'commandBuil<br/>
ders' configuration of bean 'commandFactory' in applicationContext.xml</p>

<p>Is there something else I need to install? </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by bolki at Feb 26, 2012 15:21
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437806"></a>
                                    <font class="smallfont"><p>You probably don't have the latest controller:
<a href="http://sourceforge.net/projects/openremote/files/For%20Developers/OpenRemote-Controller-2.0.0_SNAPSHOT_20120103.zip/download">http://sourceforge.net/projects/openremote/files/For%20Developers/OpenRemote-Controller-2.0.0_SNAPSHOT_20120103.zip/download</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 26, 2012 15:28
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437807"></a>
                                    <font class="smallfont"><p>You were correct I didn't have that version of the controller, however having loaded that I now only get timeout messages:<br/>
Had timeout waiting for status change</p>

<p>Do you know what could be the reason for that? </p>

<p>This worked ok with the older version of the controller</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by bolki at Feb 26, 2012 15:43
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437810"></a>
                                    <font class="smallfont"><p>Where do you have that message? Do you have a trace?<br/>
I think that is nor critical.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 26, 2012 15:55
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437811"></a>
                                    <font class="smallfont"><p>I have that message in the controller screen:<br/>
Exception in thread "Polling Sensor Thread ID = 191, Name ='Meter'" java.lang.NullPointerException<br/>
        at org.openremote.controller.statuscache.rules.RuleEngine.push(RuleEngine.java:145)<br/>
        at org.openremote.controller.statuscache.EventProcessorChain.push(EventProcessorChain.java:188)<br/>
        at org.openremote.controller.statuscache.StatusCache.update(StatusCache.java:260)<br/>
        at org.openremote.controller.model.sensor.Sensor.update(Sensor.java:342)<br/>
        at org.openremote.controller.model.sensor.Sensor$DeviceReader.run(Sensor.java:608)<br/>
        at java.lang.Thread.run(Thread.java:722)<br/>
Exception in thread "Polling Sensor Thread ID = 190, Name ='Office'" java.lang.NullPointerException<br/>
        at org.openremote.controller.statuscache.rules.RuleEngine.push(RuleEngine.java:145)<br/>
        at org.openremote.controller.statuscache.EventProcessorChain.push(EventProcessorChain.java:188)<br/>
        at org.openremote.controller.statuscache.StatusCache.update(StatusCache.java:260)<br/>
        at org.openremote.controller.model.sensor.Sensor.update(Sensor.java:342)<br/>
        at org.openremote.controller.model.sensor.Sensor$DeviceReader.run(Sensor.java:608)<br/>
        at java.lang.Thread.run(Thread.java:722)<br/>
Feb 26, 2012 5:01:35 PM org.openremote.controller.utils.Logger info<br/>
INFO: Querying changed state from ChangedStatus table...<br/>
Feb 26, 2012 5:01:35 PM org.openremote.controller.utils.Logger info<br/>
INFO: Not Found: <span class="error">&#91;device =&gt; 355067041131186, sensorIDs =&gt; 190,191,188,197,196,193,182,192,180,195,194&#93;</span> in ChangedStatus table.<br/>
Feb 26, 2012 5:01:35 PM org.openremote.controller.utils.Logger info<br/>
INFO: DEVICEID:355067041131186  sensorID:190, 191, 188, 197, 196, 193, 182, 192, 180, 195, 194statusChangedSensorID:[]Waiting...<br/>
Feb 26, 2012 5:02:25 PM org.openremote.controller.utils.Logger info<br/>
INFO: Had timeout for waiting status change.</p>

<p>It seems to preventing anything from updating</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by bolki at Feb 26, 2012 16:03
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437812"></a>
                                    <font class="smallfont"><p>Please delete controller.xml and panel.xml and deploy openremote.zip again.<br/>
It looks like something does not fit together.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 26, 2012 16:07
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437815"></a>
                                    <font class="smallfont"><p> That doesn't seem to help, started from scratch and no luck</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by bolki at Feb 26, 2012 16:20
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437820"></a>
                                    <font class="smallfont"><p>For your info, I've got the same message, in a loop at every sensor status Changed with the latest controller:<br/>
INFO: Had timeout for waiting status change.<br/>
26-fÚvr.-2012 18:06:54 org.openremote.controller.utils.Logger info<br/>
INFO: Querying changed state from ChangedStatus table...<br/>
26-fÚvr.-2012 18:06:54 org.openremote.controller.utils.Logger info<br/>
INFO: Found: <span class="error">&#91;device =&gt; 52c8927ffca9b3faea92987c61d7a5ac94f81069, sensorIDs =&gt; 1034,1038,994,1026&#93;</span> in ChangedStatus table.<br/>
26-fÚvr.-2012 18:06:54 org.openremote.controller.utils.Logger info<br/>
INFO: DEVICEID:52c8927ffca9b3faea92987c61d7a5ac94f81069 sensorID:994, 1026, 1034, 1038statusChangedSensorID:[]Waiting...<br/>
26-fÚvr.-2012 18:07:44 org.openremote.controller.utils.Logger info<br/>
INFO: Had timeout for waiting status change.<br/>
26-fÚvr.-2012 18:07:44 org.openremote.controller.utils.Logger info<br/>
INFO: Querying changed state from ChangedStatus table...<br/>
26-fÚvr.-2012 18:07:44 org.openremote.controller.utils.Logger info<br/>
INFO: Found: <span class="error">&#91;device =&gt; 52c8927ffca9b3faea92987c61d7a5ac94f81069, sensorIDs =&gt; 1034,1038,994,1026&#93;</span> in ChangedStatus table.<br/>
26-fÚvr.-2012 18:07:44 org.openremote.controller.utils.Logger info<br/>
INFO: DEVICEID:52c8927ffca9b3faea92987c61d7a5ac94f81069 sensorID:994, 1026, 1034, 1038statusChangedSensorID:[]Waiting...<br/>
26-fÚvr.-2012 18:08:34 org.openremote.controller.utils.Logger info<br/>
INFO: Had timeout for waiting status change.</p>

<p>Regards</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by yannph at Feb 26, 2012 17:13
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437837"></a>
                                    <font class="smallfont"><p>That is ok. <br/>
You don't have the exeception.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 26, 2012 21:23
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437838"></a>
                                    <font class="smallfont"><p>On a closer look, the exception is caused by the rule engine.<br/>
Please check, if you have these lines at the top of your rule definition:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.protocol

global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;
</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 26, 2012 21:26
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437860"></a>
                                    <font class="smallfont"><p>Tried that as well, but no luck, seems like there is an issue with the changedstatus table</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by bolki at Feb 27, 2012 05:19
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437870"></a>
                                    <font class="smallfont"><p>Tried also without success.<br/>
Marcus, if more debug info is needed, I can send you my logs files in debug via email.<br/>
Regards</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by yannph at Feb 27, 2012 07:40
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437871"></a>
                                    <font class="smallfont"><p>Hi Yann,<br/>
are you also getting these "Exception in thread "Polling Sensor Thread ID = XX" when you start up the controller?</p>

<p>Then there also is the <br/>
INFO: Not Found: <span class="error">&#91;device =&gt; 355067041131186, sensorIDs =&gt; 190,191,188,197,196,193,182,192,180,195,194&#93;</span> in ChangedStatus table.</p>

<p>At the beginning especially the NOT part is a bit worrying I think.<br/>
Is there an older controller version that works with the datetime protocol? I tried reusing the class from the new version in an older one but that obviously didn't work. </p>

<p>Cheers<br/>
David</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by bolki at Feb 27, 2012 08:00
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437874"></a>
                                    <font class="smallfont"><p>Can you remove your rules and see if just a plain datetime command/sensor works?<br/>
Here is the How-to for DateTime: <a href="http://www.openremote.org/display/docs/OpenRemote+2.0+How+To+-+DateTime+Protocol">http://www.openremote.org/display/docs/OpenRemote+2.0+How+To+-+DateTime+Protocol</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 27, 2012 09:02
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437876"></a>
                                    <font class="smallfont"><p>Tried that as well, no rules, taking the working config from the old controller directly into the new one, with and without the datetime and it still failed.<br/>
I can share my remote design if that is helpful</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by bolki at Feb 27, 2012 09:11
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437877"></a>
                                    <font class="smallfont"><p>can you just email me your openremote.zip ?<br/>
email: marcus (at) openremote (dot) org</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 27, 2012 09:13
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19437878"></a>
                                    <font class="smallfont"><p>Done</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by bolki at Feb 27, 2012 09:16
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19438026"></a>
                                    <font class="smallfont"><p>I don't see any datetime protocol in that design. For me this does not work, since I don't have your KNX group addresses.</p>

<p>Maybe you can create yourself a second designer account and start with a simple datetime command and sensor (look at the datetime howto).</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 27, 2012 23:07
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19438156"></a>
                                    <font class="smallfont"><p>Hi Marcus,<br/>
I removed the datetime part as I was wondering whether it would work at all with my current configuration. As that works fine with the old controller and not with the new one. It is a bit pointless of having the datetime function work but nothing else. So for me it is more a question of getting the controller I have running now to work with the new one (even without the datetime function). I will try it as well with just the simple design. I am in Capetown at the moment so a bit difficult to test without having a connection to my KNX. I can play around with the datetime only.</p>


<p>cheers<br/>
David</p>

<p>Tried doing that but not sure if that is working via the hotel wifi....</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by bolki at Feb 28, 2012 19:00
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439857"></a>
                                    <font class="smallfont"><p>In the test suite I see different sets of "declarations" that I do not understand.<br/>
Is there a one_set_fits_all? (I see at least an additional LevelFacade levels  </p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> org.openremote.controller.model.event
global org.openremote.controller.statuscache.CommandFacade execute;

<span class="code-keyword">package</span> org.openremote.controller.model.event

<span class="code-keyword">package</span> org.openremote.controller.model.event
global org.openremote.controller.statuscache.SwitchFacade switches;

<span class="code-keyword">package</span> org.openremote.controller.model.event
global org.openremote.controller.statuscache.CommandFacade execute;
<span class="code-keyword">import</span> org.openremote.controller.protocol.*;

<span class="code-keyword">package</span> org.openremote.controller.protocol
global org.openremote.controller.statuscache.LevelFacade levels;

<span class="code-keyword">package</span> org.openremote.controller.protocol
global org.openremote.controller.statuscache.CommandFacade execute;

<span class="code-keyword">package</span> org.openremote.controller.protocol
<span class="code-keyword">import</span> org.openremote.controller.model.event.*;
global org.openremote.controller.statuscache.CommandFacade execute;
</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 22, 2012 10:45
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439861"></a>
                                    <font class="smallfont"><p>There are different facades depending on what should be done from the rule.<br/>
The facades exist to have easy access to the object model from the rules.<br/>
You can just add all of them if you would like.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 22, 2012 11:07
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858475"></a>
                                    <font class="smallfont"><p>I'm having some difficulty understanding drools and date/time sensors and commands. I have a bunch of sensors and commands defined (see below), but it's not clear to me how to use these within my drools rules. </p>

<p>Here's a simple test.drl file:</p>

<p>package org.openremote.controller.model.event<br/>
global org.openremote.controller.statuscache.CommandFacade execute;<br/>
global org.openremote.controller.statuscache.SwitchFacade switches;<br/>
import org.openremote.controller.protocol.*;</p>

<p>rule "Test Rule"</p>

<p>when</p>

<p>  Event(source=="isNight", value=="true")</p>

<p>then</p>

<p>  execute.command("den_shade_off");</p>

<p>end</p>


<p>The above doesn't work. Get following error:</p>

<p>ERROR 2013-03-10 21:29:07,394 : Rule definition 'test.drl' could not be deployed. See errors below.<br/>
ERROR main: Rule definition 'test.drl' could not be deployed. See errors below.<br/>
ERROR 2013-03-10 21:29:07,395 : Rule Compilation error Cannot return a void result<br/>
ERROR main: Rule Compilation error Cannot return a void result<br/>
Rule Compilation error : Rule name='Test Rule'<br/>
        org/openremote/controller/model/event/Rule_Test_Rule_0.java (8:383) : Cannot return a void result</p>

<p>ERROR 2013-03-10 21:29:07,397 : There was an error parsing the rule definition 'test.drl' : Could not parse knowledge.<br/>
java.lang.IllegalArgumentException: Could not parse knowledge.</p>


<p>With the above, I feel like I'm guessing at syntax and rules. I guess I don't understand how to tie in the commands and sensors within OpenRemote with the WHEN clause in drools.</p>


<p>After this, I want to do a bit for complex stuff like comparing dates.</p>

<p>ie.<br/>
if now() &gt; sunrise and now() &lt; (sunrise + 3hours) then execute command</p>

<p>Any ideas how I can accomplish this in drools? Thanks.</p>

<p>(The only thing I've been able to do with drools is cron based stuff. I'd rather use the sunrise/senset and data/time stuff specified in the designer)</p>

<p>Regards,<br/>
Joe</p>


<p>Here's snippet of controller.xml (show's datatime sensors and commands):</p>


<p>    &lt;sensor id="100601" name="sunrise_sensor" type="custom"&gt;<br/>
      &lt;include type="command" ref="285" /&gt;<br/>
    &lt;/sensor&gt;<br/>
    &lt;sensor id="100419" name="isDay_sensor" type="custom"&gt;<br/>
      &lt;include type="command" ref="282" /&gt;<br/>
    &lt;/sensor&gt;<br/>
    &lt;sensor id="100603" name="sunset_sensor" type="custom"&gt;<br/>
      &lt;include type="command" ref="287" /&gt;<br/>
    &lt;/sensor&gt;<br/>
    &lt;sensor id="100422" name="datetime_sensor" type="custom"&gt;<br/>
      &lt;include type="command" ref="284" /&gt;<br/>
    &lt;/sensor&gt;<br/>
    &lt;sensor id="100420" name="date_sensor" type="custom"&gt;<br/>
      &lt;include type="command" ref="281" /&gt;<br/>
    &lt;/sensor&gt;<br/>
    &lt;sensor id="100421" name="isNight_sensor" type="custom"&gt;<br/>
      &lt;include type="command" ref="283" /&gt;<br/>
    &lt;/sensor&gt;<br/>
    &lt;sensor id="100602" name="time_sensor" type="custom"&gt;<br/>
      &lt;include type="command" ref="286" /&gt;<br/>
    &lt;/sensor&gt;</p>

<p>    &lt;command id="281" protocol="datetime"&gt;<br/>
      &lt;property name="timezone" value="US/Eastern" /&gt;<br/>
      &lt;property name="command" value="date" /&gt;<br/>
      &lt;property name="format" value="MM/dd/yyyy" /&gt;<br/>
      &lt;property name="name" value="date" /&gt;<br/>
    &lt;/command&gt;<br/>
    &lt;command id="282" protocol="datetime"&gt;<br/>
      &lt;property name="timezone" value="US/Eastern" /&gt;<br/>
      &lt;property name="command" value="isDay" /&gt;<br/>
      &lt;property name="longitude" value="x" /&gt;<br/>
      &lt;property name="latitude" value="y" /&gt;<br/>
      &lt;property name="name" value="isDay" /&gt;<br/>
    &lt;/command&gt;<br/>
    &lt;command id="283" protocol="datetime"&gt;<br/>
      &lt;property name="timezone" value="US/Eastern" /&gt;<br/>
      &lt;property name="command" value="isNight" /&gt;<br/>
      &lt;property name="longitude" value="x" /&gt;<br/>
      &lt;property name="latitude" value="y" /&gt;<br/>
      &lt;property name="name" value="isNight" /&gt;<br/>
    &lt;/command&gt;<br/>
    &lt;command id="284" protocol="datetime"&gt;<br/>
      &lt;property name="timezone" value="US/Eastern" /&gt;<br/>
      &lt;property name="command" value="date" /&gt;<br/>
      &lt;property name="longitude" value="x" /&gt;<br/>
      &lt;property name="latitude" value="y" /&gt;<br/>
      &lt;property name="format" value="MM/dd/yyyy h:mm a" /&gt;<br/>
      &lt;property name="name" value="datetime" /&gt;<br/>
    &lt;/command&gt;<br/>
    &lt;command id="285" protocol="datetime"&gt;<br/>
      &lt;property name="timezone" value="US/Eastern" /&gt;<br/>
      &lt;property name="command" value="sunrise" /&gt;<br/>
      &lt;property name="longitude" value="x" /&gt;<br/>
      &lt;property name="latitude" value="y" /&gt;<br/>
      &lt;property name="format" value="HH:mm" /&gt;<br/>
      &lt;property name="name" value="sunrise" /&gt;<br/>
    &lt;/command&gt;<br/>
    &lt;command id="286" protocol="datetime"&gt;<br/>
      &lt;property name="timezone" value="US/Eastern" /&gt;<br/>
      &lt;property name="command" value="date" /&gt;<br/>
      &lt;property name="longitude" value="x" /&gt;<br/>
      &lt;property name="latitude" value="y" /&gt;<br/>
      &lt;property name="format" value="hh:mm" /&gt;<br/>
      &lt;property name="name" value="time" /&gt;<br/>
    &lt;/command&gt;<br/>
    &lt;command id="287" protocol="datetime"&gt;<br/>
      &lt;property name="timezone" value="US/Eastern" /&gt;<br/>
      &lt;property name="command" value="sunset" /&gt;<br/>
      &lt;property name="longitude" value="x" /&gt;<br/>
      &lt;property name="latitude" value="y" /&gt;<br/>
      &lt;property name="format" value="HH:mm" /&gt;<br/>
      &lt;property name="name" value="sunset" /&gt;<br/>
    &lt;/command&gt;</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by joefm1218 at Mar 11, 2013 04:09
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858551"></a>
                                    <font class="smallfont"><p>You need to use the sensor name and also use the concrete Event class which is CustomState for your custom sensor.<br/>
Try this rule:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.model.event
global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;
<span class="code-keyword">import</span> org.openremote.controller.protocol.*;

rule <span class="code-quote">"Test Rule"</span>
when
  CustomState(source==<span class="code-quote">"isNight_sensor"</span>, value==<span class="code-quote">"<span class="code-keyword">true</span>"</span>)
then
  execute.command(<span class="code-quote">"den_shade_off"</span>);
end
</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 12, 2013 22:57
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858552"></a>
                                    <font class="smallfont"><p>Thanks Marcus. That worked. I also see that commands exist for minutesToSunrise and minutesToSunset. So, I guess I can do something like the following:</p>

<p>package org.openremote.controller.model.event<br/>
global org.openremote.controller.statuscache.CommandFacade execute;<br/>
global org.openremote.controller.statuscache.SwitchFacade switches;<br/>
import org.openremote.controller.protocol.*;</p>

<p>rule "Lower Den Shade - 3hr after Sunset"<br/>
when<br/>
  CustomState(source=="minutesToSunset_sensor", value==(2400-(3*60)))<br/>
then<br/>
  execute.command("den_shade_off");<br/>
end</p>

<p>rule "Raise Den Shade - 3hr after Sunrise"<br/>
when<br/>
   CustomState(source=="minutesToSunrise_sensor", value==(2400-(3*60)))<br/>
then<br/>
   execute.command("den_shade_dim", 85);<br/>
end</p>

<p>Regards,<br/>
Joe</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by joefm1218 at Mar 13, 2013 03:56
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858559"></a>
                                    <font class="smallfont"><p>Marcus,<br/>
This leaves me with the question how to determine when to use Event, and when to use the <em>concrete</em> Event class. The manual (<a href="http://www.openremote.org/display/docs/Designer+2.0+-+Controller+Rules?showComments=false">http://www.openremote.org/display/docs/Designer+2.0+-+Controller+Rules?showComments=false</a>) uses Event in one of the sensor examples</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 13, 2013 08:48
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858560"></a>
                                    <font class="smallfont"><p>The manual sometimes uses Event and sometimes the concrete class.<br/>
Maybe it works with both, but I am not sure.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 13, 2013 09:18
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858561"></a>
                                    <font class="smallfont"><p>According to the manual (as far as I understand it after reading through once more) Joe's original example should work. I remember having run into the same problem with rules, which was a reason for me to give up. I'll try your CustomState suggestion once I have OR up and running again.<br/>
Pieter</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 13, 2013 10:01
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858562"></a>
                                    <font class="smallfont"><p>Except that the sensor name was wrong.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 13, 2013 11:43
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858563"></a>
                                    <font class="smallfont"><p>Thanks, that clarifies. I hadn't noticed the name issue <img class="emoticon" src="images/icons/emoticons/sad.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 13, 2013 11:49
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858571"></a>
                                    <font class="smallfont"><p>Marcus,</p>

<p>I think I tried every possible combination of CustomState / Event declarative statemenst when using minutesToSunrise_sensor (or Sunset). Nothing seems to work. The only thing that works is isNight_sensor (or day). </p>

<p>Is it because isNight_sensor returns a boolean string?</p>

<p>Tried all of the following separately:</p>

<p>CustomState(source == "minutesToSunset_sensor", <span class="error">&#91;val : value, eval(Integer.valueOf((String)val) &lt; 1160)&#93;</span>)<br/>
CustomState(source == "minutesToSunset_sensor", value&lt;1160)<br/>
CustomState(source == "minutesToSunset_sensor", value&lt;"1160")</p>

<p>Event(source == "minutesToSunset_sensor", value&lt;1160)<br/>
Event(source == "minutesToSunset_sensor", value&lt;"1160")</p>

<p>Even tried:<br/>
CustomState(source == "minutesToSunset_sensor", value==1160) (when value was indeed 1160)<br/>
CustomState(source == "minutesToSunset_sensor", value=="1160") (when value was indeed 1160)</p>

<p>No joy for all of the above iterations.</p>

<p>Any thoughts here?</p>

<p>Thank you,<br/>
Joe</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by joefm1218 at Mar 14, 2013 04:57
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858573"></a>
                                    <font class="smallfont"><p>I noticed that in this <a href="https://openremote.svn.sourceforge.net/svnroot/openremote/workspace/juha/Controller_EP_SNAP_20111129/test/org/openremote/controller/fixture/statuscache/rules/range-limits/rules/RangeLimits.drl">example for a range sensor</a> (found in Juha's post earlier in this thread) the event handler is specified with a * at the end:<br/>
<b>import org.openremote.controller.model.event.</b>*<br/>
Could that make the difference whether you have to use a concrete class or not? (I am only guessing, as I have no knowledge of what is inside the coffee mug)<br/>
Pieter</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 14, 2013 10:30
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858575"></a>
                                    <font class="smallfont"><p>No, that is just the needed Java syntax for the rule to compile. <br/>
It makes all classes in the .event package available to the compiler.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 14, 2013 10:40
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858576"></a>
                                    <font class="smallfont"><p>I did not look at the DateTime protocol for a long time.<br/>
It definetly has to be a custom sensor, so CustomState is correct.<br/>
Also, the eval() is needed since the sensor internally only uses a string.</p>


<p>You can link your sensor to a label in the UI to see the actual value that is returned.<br/>
Maybe that can help.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 14, 2013 10:42
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858674"></a>
                                    <font class="smallfont"><p>Hi.</p>

<p>I have basic knowadge in C but no knowladge in Java.<br/>
I am trying to set up rules that use variables that are shared among few rules like setting few option to activate a water tank (1 hour, 2 hours etc.).<br/>
This is my code I have used to define some variables and test them.</p>

<p>package org.openremote.controller.model.event<br/>
global org.openremote.controller.statuscache.CommandFacade execute;<br/>
global org.openremote.controller.statuscache.SwitchFacade switches;<br/>
global org.openremote.controller.statuscache.LevelFacade levels;<br/>
global org.openremote.controller.statuscache.RangeFacade ranges;<br/>
import org.openremote.controller.model.event.*;<br/>
import org.openremote.controller.protocol.Event;<br/>
import java.io.*;<br/>
import java.util.*;<br/>
import java.lang.Float;<br/>
//------------------------------------------------------------------------------------------<br/>
declare Water_Tank_Status <br/>
    Is_On : boolean<br/>
    Duration : int<br/>
    Time_Left : int<br/>
end<br/>
//----------------------------------------------------------------------------------------<br/>
rule "Init_System"<br/>
no-loop<br/>
when<br/>
    eval ( true )<br/>
then<br/>
    Water_Tank_Status.Is_On = false;<br/>
    Water_Tank_Status.Duration = 121;<br/>
    Water_Tank_Status.Time Left = Water_Tank_Status.Duration;<br/>
end<br/>
//----------------------------------------------------------------------------------------<br/>
rule "Water_Tank_Just_Turned_On_120_Minutes"  <br/>
// Start CountDown when Water Tank is switched on <br/>
when<br/>
    Event ( source == "Water Tank Panel Status Light" )<br/>
    Switch ( source == "Water Tank Panel Status Light", value == "on" )<br/>
then<br/>
    // Switch (source == "Water_Tank (ON) );   // May not be needed ??????????<br/>
    System.out.println ( "Water Tank was turned ON!!" );<br/>
    System.out.println ( "Water Tank is " + Water_Tank_Status.Is_On);<br/>
    System.out.println ( "Water Tank is " + Water_Tank_Status.Duration);<br/>
    System.out.println ( "Water Tank is " + Water_Tank_Status.Time_Left);<br/>
end</p>


<p>I get some errors I can not debug. I am missing some thing here that is related to variables etc.</p>

<p>2013-03-16 19:55:35,157 ERROR Controller Definition File Watcher for Default Deployer: Rule definition 'modeler_rules.drl' could not be deployed. See errors below.<br/>
2013-03-16 19:55:35,161 ERROR Controller Definition File Watcher for Default Deployer: Error creating field accessors for 'Water_Tank_Status' for type 'Water_Tank_Status'<br/>
2013-03-16 19:55:35,167 ERROR Controller Definition File Watcher for Default Deployer: There was an error parsing the rule definition 'modeler_rules.drl' : Could not parse knowledge.<br/>
java.lang.IllegalArgumentException: Could not parse knowledge.<br/>
	at org.drools.builder.impl.KnowledgeBuilderImpl.newKnowledgeBase(KnowledgeBuilderImpl.java:58)<br/>
	at org.openremote.controller.statuscache.rules.RuleEngine.getValidKnowledgePackages(RuleEngine.java:532)<br/>
	at org.openremote.controller.statuscache.rules.RuleEngine.start(RuleEngine.java:253)<br/>
	at org.openremote.controller.statuscache.EventProcessorChain.start(EventProcessorChain.java:112)<br/>
	at org.openremote.controller.statuscache.StatusCache.start(StatusCache.java:120)<br/>
	at org.openremote.controller.deployer.Version20ModelBuilder.buildSensorModel(Version20ModelBuilder.java:633)<br/>
	at org.openremote.controller.deployer.Version20ModelBuilder.build(Version20ModelBuilder.java:555)<br/>
	at org.openremote.controller.deployer.AbstractModelBuilder.buildModel(AbstractModelBuilder.java:154)<br/>
	at org.openremote.controller.service.Deployer.startup(Deployer.java:840)<br/>
	at org.openremote.controller.service.Deployer.softRestart(Deployer.java:420)<br/>
	at org.openremote.controller.service.Deployer$ControllerDefinitionWatch.run(Deployer.java:1268)<br/>
	at java.lang.Thread.run(Unknown Source)</p>

<p>Need help with basic example or correction to the code. What is need is the way use variables that are public to all rules I define.<br/>
I have no issue with rules that involve KNX sensing and controlling. The variables are the issue.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 16, 2013 21:19
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858675"></a>
                                    <font class="smallfont">
<p>declared variables need to start with a lower case:<br/>
declare Water_Tank_Status <br/>
is_On : boolean<br/>
duration : int<br/>
time_Left : int<br/>
end</p>

<p>Also,</p>

<p>I think for your init, you should try something like as you have no object created (only declared type):</p>

<p>rule "Init_System"<br/>
 no-loop<br/>
when<br/>
 eval (true)<br/>
then<br/>
 insert(new Water_Tank_Status(false, 121, 121);<br/>
end</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by joefm1218 at Mar 16, 2013 23:55
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858676"></a>
                                    <font class="smallfont"><p>Ok, finally got it! Following rules work...</p>

<p>rule "Lower Den Shade"<br/>
when<br/>
  CustomState(source=="minutesUntilSunset_sensor", val : value, eval(Integer.val) == 1250))<br/>
then<br/>
  execute.command("den_shade_off");<br/>
end</p>

<p>//-----------------------------------------------------------------</p>

<p>rule "Raise Den Shade"<br/>
when<br/>
  CustomState(source=="minutesUntilSunrise_sensor", val : value,  eval(Integer.val) == 1200))<br/>
then<br/>
  execute.command("den_shade_dim", 85);<br/>
end</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by joefm1218 at Mar 17, 2013 00:27
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858691"></a>
                                    <font class="smallfont"><p>Hi again.</p>

<p>I have corrected as was suggested and still see errors I can not understand.</p>

<p>Here is the new code (I have left with the same errors so I have put some of the code in remark to try and focus on the basics):</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.model.event
global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;
global org.openremote.controller.statuscache.LevelFacade levels;
global org.openremote.controller.statuscache.RangeFacade ranges;
<span class="code-keyword">import</span> org.openremote.controller.protocol.*;
<span class="code-keyword">import</span> java.io.*;
<span class="code-keyword">import</span> java.util.*;
<span class="code-keyword">import</span> java.lang.<span class="code-object">Float</span>;
<span class="code-comment">//------------------------------------------------------------------------------------------
</span>declare Water_Tank_Status 
    is_on : <span class="code-object">boolean</span>
    duration : <span class="code-object">int</span>
    time_left : <span class="code-object">int</span>
end
<span class="code-comment">//----------------------------------------------------------------------------------------
</span>rule <span class="code-quote">"Init_System_120"</span>
no-loop
when
    eval ( <span class="code-keyword">true</span> )
then
    insert ( <span class="code-keyword">new</span> Water_Tank_Status ( <span class="code-keyword">false</span>, 121, 121 ) );
end
<span class="code-comment">//----------------------------------------------------------------------------------------
</span>rule <span class="code-quote">"Water_Tank_Just_Turned_On_120_Minutes"</span>  
when
    Event ( source == <span class="code-quote">"Water Tank Panel Status Light"</span> )
    Switch ( source == <span class="code-quote">"Water Tank Panel Status Light"</span>, value == <span class="code-quote">"on"</span> )
then
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank was turned ON!!"</span> );
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank is "</span> + Water_Tank_Status.is_on);
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank is "</span> + Water_Tank_Status.duration);
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank is "</span> + Water_Tank_Status.time_left);
end
<span class="code-comment">//------------------------------------------------------------------------------------------
</span>/*
rule <span class="code-quote">"Water_Tank_CountDown_120_Done"</span>  
timer (cron: * 0-59 * * * *)
when
    not ( Event ( source == <span class="code-quote">"Water Tank Panel Status Light"</span> ) )
    Switch ( source == <span class="code-quote">"Water Tank Panel Status Light"</span>, value == <span class="code-quote">"on"</span> )
    eval ( Water_Tank_Status.time_left )
then
    update ( --Water_Tank_Status.time_left );
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank Time Left is: "</span> +  Water_Tank_Status.time_left );
end
<span class="code-comment">//------------------------------------------------------------------------------------------
</span>rule <span class="code-quote">"Water_Tank_End_of_CountDown_120_Minutes"</span>  
timer (cron: * 0-59 * * * *)
when
    not ( Event ( source == <span class="code-quote">"Water Tank Panel Status Light"</span> ) )
    Switch ( source == <span class="code-quote">"Water Tank Panel Status Light"</span>, value == <span class="code-quote">"on"</span> )
    eval ( Water_Tank_Statu.time_left == 0)
then
    Switch (source == "Water_Tank (OFF) );
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank was turned OFF!!"</span> );
end
*/
</pre>
</div></div>

<p>What i get is lack of visibility to variables as follows:</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>2013-03-17 18:28:05,191 ERROR [Controller Definition File Watcher for Default Deployer]: 
Rule definition 'modeler_rules.drl' could not be deployed. See errors below.
2013-03-17 18:28:05,195 ERROR [Controller Definition File Watcher for Default Deployer]: 
Rule Compilation error The constructor Water_Tank_Status(boolean, int, int) is undefined
2013-03-17 18:28:05,200 ERROR [Controller Definition File Watcher for Default Deployer]: 
Rule Compilation error The field Water_Tank_Status.is_on is not visible
The field Water_Tank_Status.duration is not visible
The field Water_Tank_Status.time_left is not visible
2013-03-17 18:28:05,266 ERROR [Controller Definition File Watcher for Default Deployer]: 
There was an error parsing the rule definition 'modeler_rules.drl' : Could not parse knowledge.
java.lang.IllegalArgumentException: Could not parse knowledge.
	at org.drools.builder.impl.KnowledgeBuilderImpl.newKnowledgeBase(KnowledgeBuilderImpl.java:58)
	at org.openremote.controller.statuscache.rules.RuleEngine.getValidKnowledgePackages(RuleEngine.java:532)
	at org.openremote.controller.statuscache.rules.RuleEngine.start(RuleEngine.java:253)
	at org.openremote.controller.statuscache.EventProcessorChain.start(EventProcessorChain.java:112)
	at org.openremote.controller.statuscache.StatusCache.start(StatusCache.java:120)
	at org.openremote.controller.deployer.Version20ModelBuilder.buildSensorModel(Version20ModelBuilder.java:633)
	at org.openremote.controller.deployer.Version20ModelBuilder.build(Version20ModelBuilder.java:555)
	at org.openremote.controller.deployer.AbstractModelBuilder.buildModel(AbstractModelBuilder.java:154)
	at org.openremote.controller.service.Deployer.startup(Deployer.java:840)
	at org.openremote.controller.service.Deployer.softRestart(Deployer.java:420)
	at org.openremote.controller.service.Deployer$ControllerDefinitionWatch.run(Deployer.java:1268)
	at java.lang.Thread.run(Unknown Source)
</pre>
</div></div>

<p>I need help with this.</p>

<p>Thanks.</p>

<p>Nir</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 17, 2013 16:36
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858697"></a>
                                    <font class="smallfont"><p>I think the Drools 5.1.1 might not be creating parameterized constructors yet, only a no-args constructor (a quick glance at documentation for Drools 5.2 seems to have added parameterized constructor generation).</p>

<p>In the 5.1.1 docs the declare example is :</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>rule "Using a declared Type" when
  $p : Person( name == "Bob" )
then
  // Insert Mark, who is Bob's mate.
  Person mark = new Person(); 
  mark.setName("Mark"); 
  insert( mark );
end
</pre>
</div></div>

<p>In your case the insert in init rule should be something like:</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>then
  Water_Tank_Status status = new Water_Tank_Status();
  status.setIs_on(false);
  status.setDuration(121);
  status.setTime_left(121);
  insert(status);
end
</pre>
</div></div>

<p>Can you try that and see if it moves things forward?</p>

</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Mar 17, 2013 18:22
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858701"></a>
                                    <font class="smallfont"><p>Hi Juha</p>

<p>This is what I have updated:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
declare Water_Tank_Status 
    is_on : <span class="code-object">boolean</span>
    duration : <span class="code-object">int</span>
    time_left : <span class="code-object">int</span>
end
<span class="code-comment">//----------------------------------------------------------------------------------------
</span>rule <span class="code-quote">"Init_System_120"</span>
no-loop
when
    eval ( <span class="code-keyword">true</span> )
then
    Water_Tank_Status status = <span class="code-keyword">new</span> Water_Tank_Status();
    status.setis_on( <span class="code-keyword">false</span> );
    status.setduration (121 );
    status.settime_left( 121 );
    insert ( status );
    <span class="code-comment">// insert ( <span class="code-keyword">new</span> Water_Tank_Status ( <span class="code-keyword">false</span>, 121, 121 ) );
</span>end
<span class="code-comment">//----------------------------------------------------------------------------------------
</span>rule <span class="code-quote">"Water_Tank_Just_Turned_On_120_Minutes"</span>  
when
    Event ( source == <span class="code-quote">"Water Tank Panel Status Light"</span> )
    Switch ( source == <span class="code-quote">"Water Tank Panel Status Light"</span>, value == <span class="code-quote">"on"</span> )
then
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank was turned ON!!"</span> );
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank is "</span> + Water_Tank_Status.is_on);
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank is "</span> + Water_Tank_Status.duration);
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank is "</span> + Water_Tank_Status.time_left);
end
<span class="code-comment">//-----------------------------------------------------------------------------------------</span>
</pre>
</div></div>

<p>I am not sure I understand the issue with capital letters at the beginning of each variable. I have changed them to non capital this afternoon. Not sure you have noticed.</p>

<p>The result is still with errors:</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>2013-03-17 20:52:35,307 ERROR [Controller Definition File Watcher for Default Deployer]: 
Rule definition 'modeler_rules.drl' could not be deployed. See errors below.
2013-03-17 20:52:35,311 ERROR [Controller Definition File Watcher for Default Deployer]: 
Rule Compilation error The method setis_on(boolean) is undefined for the type Water_Tank_Status
The method setduration(int) is undefined for the type Water_Tank_Status
The method settime_left(int) is undefined for the type Water_Tank_Status
2013-03-17 20:52:35,324 ERROR [Controller Definition File Watcher for Default Deployer]: 
Rule Compilation error The field Water_Tank_Status.is_on is not visible
The field Water_Tank_Status.duration is not visible
The field Water_Tank_Status.time_left is not visible
2013-03-17 20:52:35,354 ERROR [Controller Definition File Watcher for Default Deployer]: 
There was an error parsing the rule definition 'modeler_rules.drl' : Could not parse knowledge.
java.lang.IllegalArgumentException: Could not parse knowledge.
</pre>
</div></div>

<p>Thanx.</p>

<p>Nir</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 17, 2013 18:58
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858702"></a>
                                    <font class="smallfont"><p>The capitalization is relevant. So it needs to be used as in the original example (which is why you are now getting errors on undefined methods).</p>

<p>It is a typical Java naming convention &#8211; a variable name such as 'duration' will be exposed with methods setDuration and getDuration, i.e. the first character will get capitalized after get/set.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Mar 17, 2013 19:01
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858706"></a>
                                    <font class="smallfont"><p>Checking.<br/>
Missing Java knowladge.</p>

<p>Sorry.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 17, 2013 19:09
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858708"></a>
                                    <font class="smallfont"><p>Still no luck.</p>

<p>Here is the code:</p>

<p>declare Water_Tank_Status <br/>
    is_on : boolean<br/>
    duration : int<br/>
    time_left : int<br/>
end<br/>
//----------------------------------------------------------------------------------------<br/>
rule "Init_System_120"<br/>
no-loop<br/>
when<br/>
    eval ( true )<br/>
then<br/>
    Water_Tank_Status status = new Water_Tank_Status();<br/>
    status.setIs_on(false);<br/>
    status.setDuration(121);<br/>
    status.setTime_left(121);<br/>
    insert (status);<br/>
    // insert ( new Water_Tank_Status ( false, 121, 121 ) );<br/>
end<br/>
//----------------------------------------------------------------------------------------<br/>
rule "Water_Tank_Just_Turned_On_120_Minutes"  <br/>
when<br/>
    Event ( source == "Water Tank Panel Status Light" )<br/>
    Switch ( source == "Water Tank Panel Status Light", value == "on" )<br/>
then<br/>
    System.out.println ( "Water Tank was turned ON!!" );<br/>
    System.out.println ( "Water Tank is " + Water_Tank_Status.is_on);<br/>
    System.out.println ( "Water Tank is " + Water_Tank_Status.duration);<br/>
    System.out.println ( "Water Tank is " + Water_Tank_Status.time_left);<br/>
end<br/>
//------------------------------------------------------------------------------------------</p>


<p>I get the following errors:</p>

<p>2013-03-17 21:12:16,680 ERROR Controller Definition File Watcher for Default Deployer: Rule definition 'modeler_rules.drl' could not be deployed. See errors below.<br/>
2013-03-17 21:12:16,683 ERROR Controller Definition File Watcher for Default Deployer: Rule Compilation error The field Water_Tank_Status.is_on is not visible<br/>
The field Water_Tank_Status.duration is not visible<br/>
The field Water_Tank_Status.time_left is not visible<br/>
2013-03-17 21:12:16,704 ERROR Controller Definition File Watcher for Default Deployer: There was an error parsing the rule definition 'modeler_rules.drl' : Could not parse knowledge.<br/>
java.lang.IllegalArgumentException: Could not parse knowledge.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 17, 2013 19:14
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858709"></a>
                                    <font class="smallfont"><p>Change these:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank is "</span> + Water_Tank_Status.is_on);
...
</pre>
</div></div>

<p>To</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank is "</span> + Water_Tank_Status.getIs_on());
...
</pre>
</div></div>

<p>And so on...</p>

</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Mar 17, 2013 19:19
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858710"></a>
                                    <font class="smallfont"><p>Checking.</p>

<p>We are almost on line....<br/>
Thanks.</p>

<p>BTW, I did not see such examples in the forum so I hope it will be of help to others.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 17, 2013 19:20
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858712"></a>
                                    <font class="smallfont"><p>Not working yet.</p>

<p>The code is as you have asked:</p>

<p>declare Water_Tank_Status <br/>
    is_on : boolean<br/>
    duration : int<br/>
    time_left : int<br/>
end<br/>
//----------------------------------------------------------------------------------------<br/>
rule "Init_System_120"<br/>
no-loop<br/>
when<br/>
    eval ( true )<br/>
then<br/>
    Water_Tank_Status status = new Water_Tank_Status();<br/>
    status.setIs_on(false);<br/>
    status.setDuration(121);<br/>
    status.setTime_left(121);<br/>
    insert (status);<br/>
    // insert ( new Water_Tank_Status ( false, 121, 121 ) );<br/>
end<br/>
//----------------------------------------------------------------------------------------<br/>
rule "Water_Tank_Just_Turned_On_120_Minutes"  <br/>
when<br/>
    Event ( source == "Water Tank Panel Status Light" )<br/>
    Switch ( source == "Water Tank Panel Status Light", value == "on" )<br/>
then<br/>
    System.out.println ( "Water Tank was turned ON!!" );<br/>
    System.out.println ( "Water Tank is " + Water_Tank_Status.getIs_on() );<br/>
    System.out.println ( "Water Tank is " + Water_Tank_Status.getDuration() );<br/>
    System.out.println ( "Water Tank is " + Water_Tank_Status.getTime_left() );<br/>
end<br/>
//-------------------------------------------------------------------------</p>

<p>2013-03-17 21:23:20,795 ERROR Controller Definition File Watcher for Default Deployer: Rule definition 'modeler_rules.drl' could not be deployed. See errors below.<br/>
2013-03-17 21:23:20,799 ERROR Controller Definition File Watcher for Default Deployer: Rule Compilation error The method getIs_on() is undefined for the type Water_Tank_Status<br/>
Cannot make a static reference to the non-static method getDuration() from the type Water_Tank_Status<br/>
Cannot make a static reference to the non-static method getTime_left() from the type Water_Tank_Status<br/>
2013-03-17 21:23:20,825 ERROR Controller Definition File Watcher for Default Deployer: There was an error parsing the rule definition 'modeler_rules.drl' : Could not parse knowledge.<br/>
java.lang.IllegalArgumentException: Could not parse knowledge.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 17, 2013 19:26
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858713"></a>
                                    <font class="smallfont"><p>Try this for the second rule:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
rule <span class="code-quote">"Water_Tank_Just_Turned_On_120_Minutes"</span> when
  Event ( source == <span class="code-quote">"Water Tank Panel Status Light"</span> )
  Switch ( source == <span class="code-quote">"Water Tank Panel Status Light"</span>, value == <span class="code-quote">"on"</span> )
  $status : Water_Tank_Status()

then
  <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank was turned ON!!"</span> );
  <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank is "</span> + status.getIs_on() );
  <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank is "</span> + status.getDuration() );
  <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank is "</span> + status.getTime_left() );
end
</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Mar 17, 2013 19:33
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858715"></a>
                                    <font class="smallfont"><p>Why $status and not status?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 17, 2013 19:43
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858716"></a>
                                    <font class="smallfont"><p>Same errors.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 17, 2013 19:45
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858718"></a>
                                    <font class="smallfont"><p>Checked the status : Water_Tank_Status() as well.<br/>
Same stuff.<br/>
Not working.<br/>
I was looking for the Drools 5.1.1 documentation and could not find it. Only newer versions.<br/>
I was no aware to the big difference with new versions.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 17, 2013 20:22
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858719"></a>
                                    <font class="smallfont"><p>I have played with the code a little bit more.<br/>
I understand the code better now and I also understand the bug.<br/>
If the Is_on is defined as a boolean I get the error. If I define it as int it works (or actually does not fine any errors).<br/>
Going to sleep now so I hope by tomorrow you can find and explanation for that.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 17, 2013 20:44
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21858750"></a>
                                    <font class="smallfont"><p>I posted a link to the 5.1.1 documentation on one of the wiki pages that deals with rules.<br/>
The comment is here: <a href="http://www.openremote.org/display/docs/Designer+2.0+-+Controller+Rules?focusedCommentId=21529677#comment-21529677">http://www.openremote.org/display/docs/Designer+2.0+-+Controller+Rules?focusedCommentId=21529677#comment-21529677</a></p>

<p>Most of the text is irrelevant to end users. See section 4 or 5 which deals with rules syntax. I don't know if it will help you a lot. The main problem with rules in OpenRemote is that you do have to have quite a bit of knowledge of Java to do this on your own.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 18, 2013 08:19
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859087"></a>
                                    <font class="smallfont"><p>Hi again.</p>

<p>Still having some problems.<br/>
1. The timer generates some errors when put to work. The rule engine is working but generates some errors and timer is not working at all.<br/>
2. Still have issues with variables, fields etc.</p>

<p>This is my code:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.model.event
global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;
global org.openremote.controller.statuscache.LevelFacade levels;
global org.openremote.controller.statuscache.RangeFacade ranges;
<span class="code-keyword">import</span> org.openremote.controller.model.event.*;
<span class="code-keyword">import</span> org.openremote.controller.protocol.*;
<span class="code-keyword">import</span> java.io.*;
<span class="code-keyword">import</span> java.util.Timer;
<span class="code-keyword">import</span> java.util.TimerTask;
<span class="code-keyword">import</span> java.lang.<span class="code-object">Float</span>;
<span class="code-comment">//------------------------------------------------------------------------------------------
</span>declare Water_Tank_Status 
    time_left : <span class="code-object">int</span>
end
<span class="code-comment">//----------------------------------------------------------------------------------------
</span>rule <span class="code-quote">"Init_System_120"</span>
no-loop
when
    eval ( <span class="code-keyword">true</span> )
then
    Water_Tank_Status status = <span class="code-keyword">new</span> Water_Tank_Status();
    status.setTime_left(120);
    insert (status);
 end
<span class="code-comment">//----------------------------------------------------------------------------------------
</span>rule <span class="code-quote">"Water_Tank_Just_Turned_On_120_Minutes"</span>  
when
    Event ( source == <span class="code-quote">"Water Tank Panel Status Light"</span> ) &amp;&amp; 
    Switch ( source == <span class="code-quote">"Water Tank Panel Status Light"</span>, value == <span class="code-quote">"on"</span> )
    status : Water_Tank_Status()
then
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank was turned ON!!"</span> );
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank Time Left "</span> + status.getTime_left() + <span class="code-quote">" Minutes"</span>);
end
<span class="code-comment">//------------------------------------------------------------------------------------------
</span>rule <span class="code-quote">"Water_Tank_End_of_CountDown_120_Minutes"</span>  
timer ( <span class="code-object">int</span> : 1m 1m )                   &lt;-----------------   Timer problem
when
    Event ( source == <span class="code-quote">"Water Tank Panel Status Light"</span> ) &amp;&amp; 
    Switch ( source == <span class="code-quote">"Water Tank Panel Status Light"</span>, value == <span class="code-quote">"off"</span> )
    status : Water_Tank_Status() 
    <span class="code-comment">// eval ( status.getTime_left )
</span>then
    <span class="code-comment">//Switch (source == "Water Tank (OFF) );
</span>    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank was turned OFF!!"</span> );
    <span class="code-comment">//<span class="code-object">System</span>.out.println ( <span class="code-quote">"Time of switching "</span> + status.getTime_left );  &lt;---- variables problem
</span>end
</pre>
</div></div>

<p>When ever the timer is put into the code (see &lt;------- timer marking)' I get the following errors which I have no idea what is the reason.</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>DEBUG 2013-03-21 21:13:41,405 : Adding Rule 'modeler_rules.drl'...
ERROR 2013-03-21 21:13:41,506 : Error in rule definition 'modeler_rules.drl' : null
java.lang.ArrayStoreException
	at java.util.ArrayList.toArray(Unknown Source)
	at org.drools.compiler.PackageBuilder.getErrors(PackageBuilder.java:1274)
	at org.drools.builder.impl.KnowledgeBuilderImpl.getErrors(KnowledgeBuilderImpl.java:70)
	at org.openremote.controller.statuscache.rules.RuleEngine.getValidKnowledgePackages(RuleEngine.java:508)
	at org.openremote.controller.statuscache.rules.RuleEngine.start(RuleEngine.java:253)
	at org.openremote.controller.statuscache.EventProcessorChain.start(EventProcessorChain.java:112)
	at org.openremote.controller.statuscache.StatusCache.start(StatusCache.java:120)
	at org.openremote.controller.deployer.Version20ModelBuilder.buildSensorModel(Version20ModelBuilder.java:615)
	at org.openremote.controller.deployer.Version20ModelBuilder.build(Version20ModelBuilder.java:537)
	at org.openremote.controller.deployer.AbstractModelBuilder.buildModel(AbstractModelBuilder.java:148)
	at org.openremote.controller.service.Deployer.startup(Deployer.java:760)
	at org.openremote.controller.service.Deployer.softRestart(Deployer.java:373)
	at org.openremote.controller.service.Deployer$ControllerDefinitionWatch.run(Deployer.java:1188)
	at java.lang.Thread.run(Unknown Source)
ERROR 2013-03-21 21:13:41,556 : Cannot start event processor 'Drools Rule Engine' : null
java.lang.ArrayStoreException
	at java.util.ArrayList.toArray(Unknown Source)
	at org.drools.compiler.PackageBuilder.getErrors(PackageBuilder.java:1274)
	at org.drools.builder.impl.KnowledgeBuilderImpl.getErrors(KnowledgeBuilderImpl.java:70)
	at org.drools.builder.impl.KnowledgeBuilderImpl.newKnowledgeBase(KnowledgeBuilderImpl.java:53)
	at org.openremote.controller.statuscache.rules.RuleEngine.getValidKnowledgePackages(RuleEngine.java:532)
	at org.openremote.controller.statuscache.rules.RuleEngine.start(RuleEngine.java:253)
	at org.openremote.controller.statuscache.EventProcessorChain.start(EventProcessorChain.java:112)
	at org.openremote.controller.statuscache.StatusCache.start(StatusCache.java:120)
	at org.openremote.controller.deployer.Version20ModelBuilder.buildSensorModel(Version20ModelBuilder.java:615)
	at org.openremote.controller.deployer.Version20ModelBuilder.build(Version20ModelBuilder.java:537)
	at org.openremote.controller.deployer.AbstractModelBuilder.buildModel(AbstractModelBuilder.java:148)
	at org.openremote.controller.service.Deployer.startup(Deployer.java:760)
	at org.openremote.controller.service.Deployer.softRestart(Deployer.java:373)
	at org.openremote.controller.service.Deployer$ControllerDefinitionWatch.run(Deployer.java:1188)
	at java.lang.Thread.run(Unknown Source)
</pre>
</div></div>

<p>When I put the &lt;---- variables problem line (without the timer), I get other error. It is the same as the previous rule syntax yet causing the rule engine to halt due to the following error:</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>DEBUG 2013-03-21 21:17:04,276 : Adding Rule 'modeler_rules.drl'...
ERROR 2013-03-21 21:17:04,377 : Rule definition 'modeler_rules.drl' could not be deployed. See errors below.
ERROR 2013-03-21 21:17:04,381 : Rule Compilation error status.getTime_left cannot be resolved or is not a field
ERROR 2013-03-21 21:17:04,391 : There was an error parsing the rule definition 'modeler_rules.drl' : Could not parse knowledge.
java.lang.IllegalArgumentException: Could not parse knowledge.
	at org.drools.builder.impl.KnowledgeBuilderImpl.newKnowledgeBase(KnowledgeBuilderImpl.java:58)
	at org.openremote.controller.statuscache.rules.RuleEngine.getValidKnowledgePackages(RuleEngine.java:532)
	at org.openremote.controller.statuscache.rules.RuleEngine.start(RuleEngine.java:253)
	at org.openremote.controller.statuscache.EventProcessorChain.start(EventProcessorChain.java:112)
	at org.openremote.controller.statuscache.StatusCache.start(StatusCache.java:120)
	at org.openremote.controller.deployer.Version20ModelBuilder.buildSensorModel(Version20ModelBuilder.java:615)
	at org.openremote.controller.deployer.Version20ModelBuilder.build(Version20ModelBuilder.java:537)
	at org.openremote.controller.deployer.AbstractModelBuilder.buildModel(AbstractModelBuilder.java:148)
	at org.openremote.controller.service.Deployer.startup(Deployer.java:760)
	at org.openremote.controller.service.Deployer.softRestart(Deployer.java:373)
	at org.openremote.controller.service.Deployer$ControllerDefinitionWatch.run(Deployer.java:1188)
	at java.lang.Thread.run(Unknown Source)
</pre>
</div></div>

<p>In this case, the engine stops running.<br/>
Need help.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 21, 2013 19:20
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859112"></a>
                                    <font class="smallfont"><p>Resolved the timer with cron and ? at the end.<br/>
Stiil having problem with variables.<br/>
I just need to run a countdown starting from an initial value down to 0. I got the exapmle above to set the initial value which is OK.<br/>
I am still having problem updating it each minute. I need the variable to be able to disply it over a panel.</p>

<p>Need help as I lack Java skills, but I am learning fromthe examples.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 22, 2013 19:10
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859117"></a>
                                    <font class="smallfont"><p>Not sure exactly what you are trying to do, but here's a simple test case that I ran on my controller succesfully:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.model.event
global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;
global org.openremote.controller.statuscache.LevelFacade levels;
global org.openremote.controller.statuscache.RangeFacade ranges;
<span class="code-keyword">import</span> org.openremote.controller.model.event.*;
<span class="code-keyword">import</span> org.openremote.controller.protocol.*;
<span class="code-keyword">import</span> java.io.*;
<span class="code-keyword">import</span> java.util.Timer;

declare Water_Tank_Status
 time_left : <span class="code-object">int</span>
end

<span class="code-comment">//------------------------------------------------------------------------------
</span>
rule <span class="code-quote">"Init_System_120"</span>
  no-loop
when
  eval(<span class="code-keyword">true</span>)
then
  Water_Tank_Status status = <span class="code-keyword">new</span> Water_Tank_Status();
  status.setTime_left(120);
  insert (status);
end

rule <span class="code-quote">"Water_Tank_End_of_CountDown_120_Minutes"</span>
  timer (cron:* 0/1 * * * ?)
when
   $test : Water_Tank_Status()
   eval(<span class="code-keyword">true</span>)
then
   <span class="code-object">System</span>.out.println (<span class="code-quote">"Time Left:"</span> + $test.getTime_left());
   $test.setTime_left($test.getTime_left()-1);
end
</pre>
</div></div>

<p>This simple example will decrement the value in Java every 1s.</p>

<p>Hope this helps...</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by joefm1218 at Mar 23, 2013 02:57
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859121"></a>
                                    <font class="smallfont"><p>Hi Joe.</p>

<p>No change. I have tried it this way myself.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.model.event
global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;
global org.openremote.controller.statuscache.LevelFacade levels;
global org.openremote.controller.statuscache.RangeFacade ranges;
<span class="code-keyword">import</span> org.openremote.controller.model.event.*;
<span class="code-keyword">import</span> org.openremote.controller.protocol.*;
<span class="code-keyword">import</span> java.io.*;
<span class="code-keyword">import</span> java.util.Timer;
<span class="code-keyword">import</span> java.util.TimerTask;
<span class="code-keyword">import</span> java.lang.<span class="code-object">Float</span>;
<span class="code-comment">//------------------------------------------------------------------------------------------
</span>declare Water_Tank_Status 
    time_left : <span class="code-object">int</span>
end
<span class="code-comment">//----------------------------------------------------------------------------------------
</span>rule <span class="code-quote">"Init_System_120"</span>
no-loop
when
    eval ( <span class="code-keyword">true</span> )
then
    Water_Tank_Status status = <span class="code-keyword">new</span> Water_Tank_Status();
    status.setTime_left(120);
    insert (status);
end
<span class="code-comment">//----------------------------------------------------------------------------------------
</span>rule <span class="code-quote">"Water_Tank_Just_Turned_On_120_Minutes"</span>  
when
    Event ( source == <span class="code-quote">"Water Tank Panel Status Light"</span> ) &amp;&amp; 
    Switch ( source == <span class="code-quote">"Water Tank Panel Status Light"</span>, value == <span class="code-quote">"on"</span> )
    status : Water_Tank_Status()
then
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank was turned ON!!"</span> );
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank Time Left "</span> + status.getTime_left() + <span class="code-quote">" Minutes"</span>);
end
<span class="code-comment">//------------------------------------------------------------------------------------------
</span>rule <span class="code-quote">"Test_Time"</span>
timer (cron: 0/60 * * * * ?)
when
     $countdown : Water_Tank_Status()
     eval ( <span class="code-keyword">true</span> )   
then
    $countdown.setTime_left($countdown.getTime_left() - 1);
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"1 Minute has passed"</span> + $countdown.getTime_left);
end
</pre>
</div></div>

<p>I get the same errors:</p>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>DEBUG : Initializing event processor: Drools Rule Engine
DEBUG : Adding Rule 'modeler_rules.drl'...
ERROR : Rule definition 'modeler_rules.drl' could not be deployed. See errors below.
ERROR : Rule Compilation error $countdown.getTime_left cannot be resolved or is not a field
ERROR : There was an error parsing the rule definition 'modeler_rules.drl' : Could not parse knowledge.
java.lang.IllegalArgumentException: Could not parse knowledge.
	at org.drools.builder.impl.KnowledgeBuilderImpl.newKnowledgeBase(KnowledgeBuilderImpl.java:58)
	at org.openremote.controller.statuscache.rules.RuleEngine.getValidKnowledgePackages(RuleEngine.java:532)
	at org.openremote.controller.statuscache.rules.RuleEngine.start(RuleEngine.java:253)
	at org.openremote.controller.statuscache.EventProcessorChain.start(EventProcessorChain.java:112)
	at org.openremote.controller.statuscache.StatusCache.start(StatusCache.java:120)
	at org.openremote.controller.deployer.Version20ModelBuilder.buildSensorModel(Version20ModelBuilder.java:615)
	at org.openremote.controller.deployer.Version20ModelBuilder.build(Version20ModelBuilder.java:537)
	at org.openremote.controller.deployer.AbstractModelBuilder.buildModel(AbstractModelBuilder.java:148)
	at org.openremote.controller.service.Deployer.startup(Deployer.java:760)
	at org.openremote.controller.service.Deployer.softRestart(Deployer.java:373)
	at org.openremote.controller.service.Deployer$ControllerDefinitionWatch.run(Deployer.java:1188)
	at java.lang.Thread.run(Unknown Source)
INFO : Initialized event processor : Drools Rule Engine
</pre>
</div></div>

<p>The Drools does not recognize the fact (the countdown time) through the binding variable.</p>

<p>Strange.<br/>
Hope you can be of help.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 23, 2013 10:59
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859123"></a>
                                    <font class="smallfont"><p>@ Nir, Joe,<br/>
Could you please include your code and log entries {code}...{code} tags? (no backslash in last tag! I think the forum administrator has done that in some of your earlier posts. It makes the posts easier to read.<br/>
Thanks for your contributions, and thanks to Juha for the recent Wiki pages on rules which have been improved tremendously!</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 23, 2013 11:15
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859124"></a>
                                    <font class="smallfont">
<p>getTime_left is not a field, it's a method, and therefore requires parenthesis (which were correctly shown in Joe's example, and which is why the error says it cannot be resolved to a field). Change:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-object">System</span>.out.println ( <span class="code-quote">"1 Minute has passed"</span> + $countdown.getTime_left);
</pre>
</div></div>

<p>to:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-object">System</span>.out.println ( <span class="code-quote">"1 Minute has passed"</span> + $countdown.getTime_left());
</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by admin at Mar 23, 2013 12:39
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859143"></a>
                                    <font class="smallfont"><p>Hi all. </p>

<p>Thanks for the help. It was under the flashlight...<br/>
Now that I understand and revised my code I bumped into the same issue but can't find the error:</p>

<p>package org.openremote.controller.model.event<br/>
global org.openremote.controller.statuscache.CommandFacade execute;<br/>
global org.openremote.controller.statuscache.SwitchFacade switches;<br/>
global org.openremote.controller.statuscache.LevelFacade levels;<br/>
global org.openremote.controller.statuscache.RangeFacade ranges;<br/>
import org.openremote.controller.model.event.*;<br/>
import org.openremote.controller.protocol.*;<br/>
import java.io.*;<br/>
import java.util.Timer;<br/>
import java.util.TimerTask;<br/>
import java.lang.Float;<br/>
//------------------------------------------------------------------------------------------<br/>
declare Water_Tank_Timer<br/>
    time_left : int<br/>
end<br/>
declare Water_Tank_Prev_State<br/>
    wt_old_state : boolean<br/>
end<br/>
//----------------------------------------------------------------------------------------<br/>
rule "Init_Water_Tank"<br/>
no-loop<br/>
when<br/>
    eval(true)<br/>
then<br/>
    Water_Tank_Prev_State wt_state = new Water_Tank_Prev_State();<br/>
    wt_state.setWt_old_state( false );<br/>
    insert ( wt_state );<br/>
	System.out.println ( "Water Tank Initiated" );<br/>
	end<br/>
//----------------------------------------------------------------------------------------<br/>
rule "Water_Tank_Just_Turned_On_60_Minutes"  <br/>
no-loop<br/>
when<br/>
    $wt_status : Water_Tank_Prev_State()<br/>
    eval ($wt_status.getWt_old_state() == false )                    &lt;------------- The cause of the error<br/>
    Switch ( source == "Water Tank Panel Status Light", value == "on" )<br/>
then<br/>
    Water_Tank_Timer status = new Water_Tank_Timer();<br/>
    status.setTime_left(60);<br/>
    insert (status);<br/>
	$wt_status.setWt_old_state(true);<br/>
    System.out.println ( "Water Tank was turned ON for 60 minutes!!" );    <br/>
end<br/>
//-----------------------------------------------------------------------------------------<br/>
rule "Water_Tank_CountDown"  <br/>
timer (cron: 0/60 * * * * ?)<br/>
when<br/>
    $countdown : Water_Tank_Timer()<br/>
    eval ( $countdown.getTime_left() &gt; 0) &amp;&amp; Switch ( source == "Water Tank Panel Status Light", value == "on" )<br/>
then<br/>
    $countdown.setTime_left($countdown.getTime_left() - 1);<br/>
    System.out.println ( "Water Tank Time Left is: " +  $countdown.getTime_left());<br/>
end</p>

<p>The error is the same yet it is all now OK as per your correction. The error is:<br/>
ERROR 2013-03-23 20:44:03,479 : Rule definition 'modeler_rules.drl' could not be deployed. See errors below.<br/>
ERROR 2013-03-23 20:44:03,480 : Rule Compilation error The method getWt_old_state() is undefined for the type Water_Tank_Prev_State<br/>
ERROR 2013-03-23 20:44:03,484 : There was an error parsing the rule definition 'modeler_rules.drl' : Could not parse knowledge.<br/>
java.lang.IllegalArgumentException: Could not parse knowledge.</p>

<p>I have revised the code since I believe there is some kind of a bug with Event or I do not understand something.<br/>
I have set the following:</p>

<p>timer ( cron : 0/15 * * * * ?)<br/>
when<br/>
    Event ( source == "Water Tank Panel Status Light" ) ...<br/>
The rule fires every 15 second regardless of any change in the state of the "Water Tank Panel Status Light".</p>

<p>Once again, need help. </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 23, 2013 19:02
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859146"></a>
                                    <font class="smallfont"><p>"when" clause follows drools convention.<br/>
"then" clause follows java convention.</p>

<p>Also, use the dialect "mvel" convention for drools when clause...</p>


<p>try:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
rule <span class="code-quote">"Water_Tank_Just_Turned_On_60_Minutes"</span> 
dialect <span class="code-quote">"mvel"</span>
no-loop
when
 $wt_status : Water_Tank_Prev_State()
 eval ($wt_status.wt_old_state == <span class="code-keyword">false</span> )
 Switch ( source == <span class="code-quote">"Water Tank Panel Status Light"</span>, value == <span class="code-quote">"on"</span> )
then
 Water_Tank_Timer status = <span class="code-keyword">new</span> Water_Tank_Timer();
 status.setTime_left(60);
 insert (status);
 $wt_status.setWt_old_state(<span class="code-keyword">true</span>);
 <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank was turned ON <span class="code-keyword">for</span> 60 minutes!!"</span> ); 
end
</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by joefm1218 at Mar 23, 2013 21:15
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859147"></a>
                                    <font class="smallfont"><p>Thanks.<br/>
Wiil try tomorrow.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 23, 2013 21:41
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859149"></a>
                                    <font class="smallfont"><p>Hi Joe.</p>

<p>It works. Now I have to fully understand the dialect stuff which I have neglected.</p>

<p>Thanks.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 24, 2013 04:29
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859342"></a>
                                    <font class="smallfont"><p>Sure. No problem. For me, I had no issues using cron or timers in drools (plenty of examples). However, what I really wanted to do is automate based off of sunrise and sunset. Cron based jobs will not adjust for exact sun movements. As the day get's longer/shorter, you might need to re-adjust. OpenRemote includes in the designer the ability to setup sensors based off of the sun. The sample below uses sunrise/setset to automate a Hunter Douglas shade with a ZWave controlled Somfy Motor. I'm using a standard dimmer in the designer to control the shade (ie. den_shade_off, den_shade_on, den_shade_dim). I had no issues programming the ZWave Somfy motor with the USB Stick.</p>

<p>Prerequisite - DateTime protocol sensors must be setup for your Longitude/Latitude:
<a href="http://www.openremote.org/display/docs/OpenRemote+2.0+How+To+-+DateTime+Protocol">http://www.openremote.org/display/docs/OpenRemote+2.0+How+To+-+DateTime+Protocol</a></p>

<p>den_shade.drl file saved in Synology /volume1/@appstore/OpenRemote/webapps/controller/rules directory:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.model.event
global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;
<span class="code-keyword">import</span> org.openremote.controller.protocol.*;
<span class="code-keyword">import</span> java.util.*;
<span class="code-keyword">import</span> java.lang.<span class="code-object">Integer</span>;

<span class="code-comment">//-----------------------------------------------------------------
</span><span class="code-comment">// DayDef to be used to store the # of minutes in day
</span>
declare DayDef
  minutesInDay : <span class="code-object">int</span>
end

<span class="code-comment">//-----------------------------------------------------------------
</span><span class="code-comment">// Initialize the system by setting minutes in day
</span>
rule <span class="code-quote">"Init_System"</span>
  no-loop
when
  eval(<span class="code-keyword">true</span>)
then
  insert(<span class="code-keyword">new</span> DayDef(24*60));
end

<span class="code-comment">//------------------------------------------------------------------
</span>
rule <span class="code-quote">"Lower Den Shade - 1hr after sunset"</span>
dialect <span class="code-quote">"mvel"</span>
when
  $d : DayDef()
  CustomState(source==<span class="code-quote">"minutesUntilSunset_sensor"</span>, val : value,
    eval(<span class="code-object">Integer</span>.valueOf((<span class="code-object">String</span>)val) == $d.minutesInDay-(1*60)))
then
  execute.command(<span class="code-quote">"den_shade_off"</span>);
end

<span class="code-comment">//-----------------------------------------------------------------
</span>
rule <span class="code-quote">"Raise Den Shade - 3hr after sunrise"</span>
dialect <span class="code-quote">"mvel"</span>
when
  $d : DayDef()
  CustomState(source==<span class="code-quote">"minutesUntilSunrise_sensor"</span>, val : value,
    eval(<span class="code-object">Integer</span>.valueOf((<span class="code-object">String</span>)val) == $d.minutesInDay-(3*60)))
then
  execute.command(<span class="code-quote">"den_shade_dim"</span>, 46);
end

<span class="code-comment">//-----------------------------------------------------------------
</span>
rule <span class="code-quote">"Raise Den Shade - 4hr after sunrise"</span>
dialect <span class="code-quote">"mvel"</span>
when
  $d : DayDef()
  CustomState(source==<span class="code-quote">"minutesUntilSunrise_sensor"</span>, val : value,
    eval(<span class="code-object">Integer</span>.valueOf((<span class="code-object">String</span>)val) == $d.minutesInDay-(4*60)))
then
  execute.command(<span class="code-quote">"den_shade_dim"</span>, 85);
end

</pre>
</div></div>


<p>Somfy parts used for shade:</p>
<ul class="alternate" type="square">
	<li>Somfy Z-Wave to ILT Interface</li>
	<li>Somfy Sonesse ST30 RS-485 24V-DC Rollup Motor</li>
	<li>1.5" Crown and Drive Rollease Tube (used to fit motor to shade tube. Rubberized piece that attaches to end of motor)</li>
	<li>24VDC Power supply</li>
	<li>ST30 Limit Setting Tool (used to trim upper and lower bounds of shade)</li>
</ul>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by joefm1218 at Mar 29, 2013 04:24
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859366"></a>
                                    <font class="smallfont"><p>Hi again.</p>

<p>I just got into a strange situation where I use a In Memory Virtual Command to be used in a panel.<br/>
The is the sensor of this command, yet I get a no viable alternative error on this Switch inquiry.<br/>
This is my rule (just a portion of my rule set to isolate the problem):</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.model.event
global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;
global org.openremote.controller.statuscache.LevelFacade levels;
global org.openremote.controller.statuscache.RangeFacade ranges;
<span class="code-keyword">import</span> org.openremote.controller.model.event.*;
<span class="code-keyword">import</span> org.openremote.controller.protocol.*;
<span class="code-keyword">import</span> java.io.*;
<span class="code-keyword">import</span> java.util.Timer;
<span class="code-keyword">import</span> java.util.TimerTask;
<span class="code-keyword">import</span> java.lang.<span class="code-object">Float</span>;

rule <span class="code-quote">"Check V Switch"</span>
timer (cron : 0/15 * * * * ?)
when 
    Switch(source == <span class="code-quote">"V_WT_Sensor_60"</span>, value = <span class="code-quote">"ON"</span>)   &lt;----- Error 101
then
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"WT V Sensor is ON"</span> );
end
</pre>
</div></div>

<p>This sensor has a device id (1269 in my case) yet I get an error.</p>

<p>Nir Help.<br/>
Further more, I see some bugs of the new controller and web console. Wher shoule I report them in?<br/>
BTW, the but with the Android over 3G is not addressed yet. Can't operate my system from outside the house.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 29, 2013 16:47
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859400"></a>
                                    <font class="smallfont"><p>Chances are that it is case sensitive so use 'on' instead.</p>

<p>Please create a new forum thread for suspected bugs so they can be qualified.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by admin at Mar 31, 2013 11:35
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859403"></a>
                                    <font class="smallfont"><p>Tested and not working.I have tested both upper and lower case in both the rules and devices.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 31, 2013 18:56
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859405"></a>
                                    <font class="smallfont"><p>And also double equal signs '=='. Sorry missed that earlier.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by admin at Mar 31, 2013 19:04
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859411"></a>
                                    <font class="smallfont"><p>You are correct. Both of us missed it in the 1st place.<br/>
Removing from bug list.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Mar 31, 2013 20:26
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859777"></a>
                                    <font class="smallfont"><p>Hi Joe.</p>

<p>Have you managed the time CustomeState to work. I need to get the time in mSec in order to check for a short/long button press. I have to get the time in mSec each off to on and on to off. Then the diff will determine the short / long pressing.<br/>
Need this for shades control.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Apr 06, 2013 19:44
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859785"></a>
                                    <font class="smallfont"><p>yes, I posted on Mar 29th the working code for CustomState wich now controls my shade successfully. I'm using it to take action off of time sensor defined in the designer. Did you see this posting?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by joefm1218 at Apr 07, 2013 05:10
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859935"></a>
                                    <font class="smallfont"><p>Hi Joe.</p>

<p>I own Hunter Duglas shades as well but controlled by KNX. The basic operation done by the KNX Hardware is handling angle (performed bby a short button pushing), while a long one drives the shades all the up or down depending on the button. Any re-pushong the sitch during movement stops the movement.<br/>
That means that I have to get the press time. The short press is less then 600mSec. I have tryed using the TimeDate with SSS fore mSec. I have sent the mSec to. Lable at a panel and it seams like thevpanel shows the same 3 digit number (slow move up). It looks like the Lable polling is 1 sec. Have you tryed it?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Apr 08, 2013 21:18
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860056"></a>
                                    <font class="smallfont"><p>I have encountered the strangest thing.<br/>
The rule I set does not fire in a simple eval.<br/>
I have a trace printout which shoew a 0 value yet the rule does not file.</p>


<p>rule "Water_Tank_CountDown_60"<br/>
timer (cron: 0/60 * * * * ?)<br/>
when<br/>
    $wt_timer : Water_Tank_Timer()<br/>
    Switch ( source == "V_WT_Sensor_60", value == "on" )<br/>
then<br/>
    $wt_timer.setTime_left( $wt_timer.getTime_left() - 1 );<br/>
    insert ( $wt_timer );<br/>
    System.out.println ( "60 :  Water Tank Time Left is: " +  $wt_timer.getTime_left());<br/>
end</p>

<p>rule "Water_Tank_Count_60_Min_Done"  // End of countdown<br/>
//dialect "mvel"<br/>
when<br/>
    $wt_timer : Water_Tank_Timer()<br/>
    eval ( $wt_timer.getTime_left() == 0)               &lt;------ does not fire the rule<br/>
then<br/>
    $wt_timer.setTime_left(-1);<br/>
    insert ( $wt_timer ); <br/>
    execute.command("Water_Tank_60M_OFF" );     <br/>
    execute.command("Water Tank (OFF)");<br/>
    System.out.println ( "Water Tank 60 Min countdown is Done" +  $wt_timer.getTime_left());<br/>
end</p>


<p>The 1st rule prints the countdown and when it gets to zero 2nd rule does not fire as expected from the condition of the eval().<br/>
Need an idea as I have run out of ideas.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Apr 10, 2013 16:45
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860066"></a>
                                    <font class="smallfont"><p>Hi Joe.</p>

<p>The shades example you set is when all timimng is handled by the controller. In the KNX and Schneider case it is different. There are two bits. One is up/down and one is start/stop.<br/>
If you an up or down command the wall panel also sends start command. If the press is short (less then 600mSec or so), the get a tilt in the shades(each time you do that - open or close).<br/>
That means I have to measure the time of pressing to get it to work on a panel the same way (not the brutal way using 3 buttons). I am trying the read through the customstate the time in ss.SSS (seconds and milisecinds) while I press on and release the button. All examples do not transfere the time to a variable but uses a condition inside the custom state.<br/>
I need a help with this one as I have tried and no luck.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Apr 10, 2013 19:06
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860080"></a>
                                    <font class="smallfont"><p>I'm a bit new to drools as well, but I think your problem might be related to the fact that you are not telling the drools engine that the state of your JavaBean has changed. So, the engine will never fire on a property change. I would have thought the insert() statement would handle this, but maybe not?</p>

<p>So, try the modify($wt_timer) clause when setting the property.</p>

<p>ie.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
rule <span class="code-quote">"Water_Tank_CountDown_60"</span>
 timer (cron: 0/60 * * * * ?)
 when
 $wt_timer : Water_Tank_Timer()
 Switch ( source == <span class="code-quote">"V_WT_Sensor_60"</span>, value == <span class="code-quote">"on"</span> )
 then
   modify($wt_timer) {
     setTime_left( $wt_timer.getTime_left() - 1 );
   }
   <span class="code-object">System</span>.out.println ( <span class="code-quote">"60 : Water Tank Time Left is: "</span> + $wt_timer.getTime_left());
 end
</pre>
</div></div>


<p>Also, have you tried using mvel?</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
rule <span class="code-quote">"Water_Tank_Count_60_Min_Done"</span> <span class="code-comment">// End of countdown
</span> dialect <span class="code-quote">"mvel"</span>
 when
  $wt_timer : Water_Tank_Timer()
 eval ( $wt_timer.time_left == 0) &lt;------ does not fire the rule
 then
</pre>
</div></div>

<p>I wouldn't think this matters, but just curious..</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by joefm1218 at Apr 11, 2013 04:04
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860083"></a>
                                    <font class="smallfont"><p>Hi Joe.</p>

<p>I do not think this is the issue. The time_left is goind down as expected. The System.out.println does show countdown. As for dialect I think I have tried this but I am not sure.<br/>
I had the same issue in another rule but in that rule I had a workaround solution so I have solved it.<br/>
In this case I see no option in terms of LHS of the rule condition. If I woud have counted upwards then I had to stop at 60 and not 0 but then it is the same syntax.<br/>
I also have tried to put a System.out.println command in the line before the eval() to verify that's wrong but it fires an error so I gave it up.<br/>
Tried changing 2nd rule to mvel but still not working. 1st rule is working any way.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Apr 11, 2013 05:53
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860171"></a>
                                    <font class="smallfont"><p>Nir,</p>

<p>You saw my comment about "modify" vs. "insert", yes? Setting the Javebean is different then notifying the drools rules event engine that the property has changed.</p>

<p>Joe</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by joefm1218 at Apr 12, 2013 04:13
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860210"></a>
                                    <font class="smallfont"><p>Hi Joe.<br/>
It dows not work. It just drives the system crazy. I am posting the whole relevant set of rules.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
declare Water_Tank_Timer
    time_left : <span class="code-object">int</span>
end
declare Shades_Switch_Event
    shades_on_time: <span class="code-object">float</span>
    shades_on2off_time : <span class="code-object">float</span>
    long_short_ready : <span class="code-object">boolean</span>
end
declare Water_Tank_Factors
    acc_temp : <span class="code-object">double</span>
    acc_light : <span class="code-object">double</span>
end
declare Shades_press
    shades_p : <span class="code-object">double</span>
end

rule <span class="code-quote">"Init_Water_Tank"</span>
no-loop
when
    eval ( <span class="code-keyword">true</span> )
then
    Water_Tank_Timer $wt_timer = <span class="code-keyword">new</span> Water_Tank_Timer();
    insert ( $wt_timer );
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank Vars Initiated"</span> );
end

rule <span class="code-quote">"Water_Tank_Just_Turned_On_60_Minutes"</span>      &lt;---------- This rule runs like hell once 1 minute passes. No pressing takes place after turn on.
when
    $wt_timer : Water_Tank_Timer()
    Event ( source == <span class="code-quote">"V_WT_Sensor_60"</span> )
    Switch ( source == <span class="code-quote">"V_WT_Sensor_60"</span>, value == <span class="code-quote">"on"</span> )
then
    execute.command( <span class="code-quote">"Water Tank (ON)"</span> ); 
    $wt_timer.setTime_left( 2 );
    insert ( $wt_timer );
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank was turned ON <span class="code-keyword">for</span> 60 minutes!! Starting at : "</span> + $wt_timer.getTime_left()); 
end

rule <span class="code-quote">"Water_Tank_CountDown_60"</span>
timer (cron: 0/60 * * * * ?)
when
    $wt_timer : Water_Tank_Timer()
    Switch ( source == <span class="code-quote">"V_WT_Sensor_60"</span>, value == <span class="code-quote">"on"</span> )
then
    modify($wt_timer)
    {
     setTime_left( $wt_timer.getTime_left() - 1 );
     }
   <span class="code-object">System</span>.out.println ( <span class="code-quote">"60 : Water Tank Time Left is: "</span> + $wt_timer.getTime_left());
end

rule <span class="code-quote">"Water_Tank_Count_60_Min_Done"</span>  <span class="code-comment">// End of countdown
</span>dialect <span class="code-quote">"mvel"</span>
when
    $wt_timer : Water_Tank_Timer()
    eval ( $wt_timer.time_left == 0 )
then
    execute.command(<span class="code-quote">"Water_Tank_60M_OFF"</span> );     
    execute.command(<span class="code-quote">"Water Tank (OFF)"</span>);
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank 60 Min countdown is Done. Value :  "</span> +  $wt_timer.getTime_left());
end

rule <span class="code-quote">"Water_Tank_Just_Turned_Off_60"</span>  
when
    $wt_timer : Water_Tank_Timer()
    Event ( source == <span class="code-quote">"V_WT_Sensor_60"</span> )
    Switch ( source == <span class="code-quote">"V_WT_Sensor_60"</span>, value == <span class="code-quote">"off"</span> )
then
    $wt_timer.setTime_left(-1);
    insert ( $wt_timer );
    execute.command(<span class="code-quote">"Water Tank (OFF)"</span>);
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank was turned OFF <span class="code-keyword">for</span> 60 minutes by user !! "</span> +  $wt_timer.getTime_left());    
end
</pre>
</div></div>

<p>Originally, the rule "Water_Tank_Count_60_Min_Done" was not firing at all. <br/>
Now it is such a mess. I can't see what is in the terminal as it runs so fast and it still does not stop at the proper time.<br/>
Besides the "Water_Tank_Just_Turned_On_60_Minutes" rule that now fires like hell, the other rules also fiers every few seconds.<br/>
I no idea what to do. It does not looks like syntax. It very much like other exampls<br/>
Everything is according to the examples yet it does to fire the rule.</p>

<p>I will glad to get some help on this one.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Apr 13, 2013 11:27
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860211"></a>
                                    <font class="smallfont"><p>Please do include the code and output parts of your posts in {code} tags. Makes reading so much easier for others.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Apr 13, 2013 11:33
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860235"></a>
                                    <font class="smallfont"><p>HHHHHELP.</p>

<p>I have tried any combination of the above "Water_Tank_Count_60_Min_Done" rule that is supposed to stop the countdown when counting the proper duration. <br/>
Even reveres the counting to make it upcounting and compare to duration value, thinking the is a bug while comaring to 0 as some environments do have that.</p>

<p>IT DOES NOT WORK. The rule does not file what so ever. BUG or my knowladge but it looks too trivial so</p>

<p>PLEASE HELP  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Apr 13, 2013 19:29
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860251"></a>
                                    <font class="smallfont"><p>Please stop all caps and shouting. It is disrespectful to other forum users who help here on their own free time.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by admin at Apr 14, 2013 10:46
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860260"></a>
                                    <font class="smallfont"><p>OK. Sorry.<br/>
It just express my frustration.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Apr 14, 2013 11:50
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860286"></a>
                                    <font class="smallfont"><p>I think you might need to take a step back and understand what is going on. If it's running like hell, it means you created an infinite loop. So, you must understand what condition is causing the loop.</p>

<p>Looking at the rule:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
rule <span class="code-quote">"Water_Tank_Just_Turned_On_60_Minutes"</span>      &lt;---------- This rule runs like hell once 1 minute passes. No pressing takes place after turn on.
when
    $wt_timer : Water_Tank_Timer()
    Event ( source == <span class="code-quote">"V_WT_Sensor_60"</span> )
    Switch ( source == <span class="code-quote">"V_WT_Sensor_60"</span>, value == <span class="code-quote">"on"</span> )
then
    execute.command( <span class="code-quote">"Water Tank (ON)"</span> ); 
    $wt_timer.setTime_left( 2 );
    insert ( $wt_timer );
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank was turned ON <span class="code-keyword">for</span> 60 minutes!! Starting at : "</span> + $wt_timer.getTime_left()); 
end
</pre>
</div></div>

<p>It looks like you are executing a command to set the sensor to "on" in the then clause. In the when clause, the condition is evaluated to true which calls the then clause again. This will repeat infinitely. In general, state machines like drools is powerful, but requires care. Infinite loops are easily created if not careful.</p>

<p>Recommendations:<br/>
1) Do not use "insert" when changing Javabean properties. Use "modify" as previously discussed.<br/>
2) If you run into an infinite loop scenario, look at the actions you are taking in ALL then clauses. In the above, try removing the execute.command( "Water Tank (ON)" ); in the then clause of your "Water_Tank_Just_Turned_On_60_Minutes" rule.<br/>
3) Remember that you have the power to guard from infinite loops by either modifying your then actions OR creating a guarded state variable.</p>

<p>Guarded state example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
declare Water_Tank_Timer
    time_left : <span class="code-object">int</span>
    guard : <span class="code-object">int</span>
end

rule <span class="code-quote">"Init_Water_Tank"</span>
no-loop
when
    eval ( <span class="code-keyword">true</span> )
then
    Water_Tank_Timer $wt_timer = <span class="code-keyword">new</span> Water_Tank_Timer();
    $wt_timer.setGuard(0);
    insert ( $wt_timer );
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank Vars Initiated"</span> );
end

rule <span class="code-quote">"Water_Tank_Just_Turned_On_60_Minutes"</span>    
when
    $wt_timer : Water_Tank_Timer()
    Event ( source == <span class="code-quote">"V_WT_Sensor_60"</span> )
    Switch ( source == <span class="code-quote">"V_WT_Sensor_60"</span>, value == <span class="code-quote">"on"</span> )
    eval ($wt_timer.getGuard() == 0)
then
    execute.command( <span class="code-quote">"Water Tank (ON)"</span> );             &lt;-------------------- <span class="code-keyword">if</span> you absolutely need <span class="code-keyword">this</span>, use a guarded state
    modify($wt_timer) {
       setGuard(1);
    }
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Water Tank was turned ON <span class="code-keyword">for</span> 60 minutes!! Starting at : "</span> + $wt_timer.getTime_left()); 
end
</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by joefm1218 at Apr 15, 2013 01:54
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860292"></a>
                                    <font class="smallfont"><p>Finally got it.<br/>
It all works great. I have several timing with adjacent operation disable the one within the next hour or so.<br/>
On the other hand, I have found some more bugs while using webconsole with IE9 which does not exist in Chrome (have not tested other browsers.<br/>
In the IE 9 the panel can not be set to 800 pixels wide over 480 pixels high. In Chrome it works great.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Apr 15, 2013 04:34
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860559"></a>
                                    <font class="smallfont"><p>Hi Joe.</p>

<p>I just had the time to look over what you have sent. I do not set a positive loopback here.<br/>
You lack some information what made you think I do:<br/>
1. I have a physical KNX switch which can turn On and Off the water tank This is the "Water Tank (ON)" &amp; "Water Tank (OFF)".<br/>
2. In parallel I have a tablet.<br/>
3. All V_.... prefix entities (switches and sensors) are "virtual in memory" and reflects the control and status of the switch over the panel.<br/>
4. Once I detect a V_ button pressed (an Event,) I set to On/Off the water tank as per the state of the button. They are not linked to one another.</p>

<p>I understand the mess was a loop but I still have no idea why the loop was created.<br/>
The timer (int:60m 0s) just gave the state machine one chance of acting as per the state of the V_ switch.<br/>
I am adding some more logic to my system so I will look it up again.</p>

<p>Correction. I found my bug. Now all is working great. The modify command was the issue along with a positive loop.</p>

<p>Thanks for the effort.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Apr 18, 2013 16:12
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860569"></a>
                                    <font class="smallfont"><p>There are some threads regarding webconsole. <br/>
You should probably post your problem there or open a new thread.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Apr 19, 2013 08:07
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860581"></a>
                                    <font class="smallfont"><p>OK.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at Apr 19, 2013 16:25
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413347"></a>
                                    <font class="smallfont"><p>Need example to print on console the current time (System.out.println...).<br/>
I have a sensor that reads HH:mm already but can't figure out that is the proper syntax for that.<br/>
I use the following rule and get an error "source can not be resolved" on the marked line.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
declare Activated_time
    the_time : <span class="code-object">float</span>
end

rule <span class="code-quote">"Water_Tank_Just_Turned_On_60_Minutes"</span>
when
    $wt_timer : Water_Tank_Timer()
    $t : Activated_time()
    Event ( source == <span class="code-quote">"V_WT_Sensor_60"</span> )
    Switch ( source == <span class="code-quote">"V_WT_Sensor_60"</span>, value == <span class="code-quote">"on"</span> )
    eval ($wt_timer.getTime_running() == 0)
then
    execute.command( <span class="code-quote">"Water Tank (ON)"</span> );
    modify($wt_timer)
    {
       setTime_count(0);
     }
    modify($wt_timer)
    {
        setTime_running(1);
    }
    modify ($t)
    {
        setThe_time( CustomState ( source == <span class="code-quote">"Get HH and MM"</span>  ) );   &lt;------------- The Error
    } 
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Panel Water Tank was just turned ON <span class="code-keyword">for</span> 60 minutes!!"</span>);
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Time turned on was:"</span> + $t.getThe_time() );
end
</pre>
</div></div>

<p>I tested the "Activated_time" as float and as double as I was not sure. Both fail.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at May 01, 2013 16:41
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413360"></a>
                                    <font class="smallfont"><p>You don't need a command and sensor for that <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/><br/>
Just use java directly: System.currentTimeInMillis() returns milliseconds sind 1.1.1970.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at May 01, 2013 20:17
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413374"></a>
                                    <font class="smallfont"><p>OK.<br/>
Thanks.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at May 02, 2013 05:26
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413402"></a>
                                    <font class="smallfont"><p>I am getting an error "the method System.currentTimeInMillis() is undefined for the type System.<br/>
I have added "import java.lang.System;" yet I am still getting the error.<br/>
Which call should be used?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at May 02, 2013 16:03
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413407"></a>
                                    <font class="smallfont"><p>I guess I have a typo in the method name: <a href="http://lmgtfy.com/?q=java+system+currenttimeinmillis">http://lmgtfy.com/?q=java+system+currenttimeinmillis</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at May 02, 2013 19:17
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413493"></a>
                                    <font class="smallfont"><p>I am using a IPAS KNX DALI gateway for my lighting that allows me a status object only on the Value or Switch. I have chosen to use the status object on the Value which causes my switch sensor not to work. The ON, OFF and switch sensor are on the same group address. The Switch sensor works fine when I use my KNX keypads but does not change state when I use my OR device (iPod Touch).</p>

<p>I am trying to use the rules engine to work around this problem by trying the following :</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
rule <span class="code-quote">"Switch on State"</span>

when

  Level( source == <span class="code-quote">"Dimmer Status Value"</span>, value &gt; 0 )

then

  execute.command(<span class="code-quote">"Switch Status"</span>, <span class="code-quote">"on"</span>);

end

rule <span class="code-quote">"Switch off State"</span>

when

  Level( source == <span class="code-quote">"Dimmer Status Value"</span>, value == 0 )

then

  execute.command(<span class="code-quote">"Switch Status"</span>, <span class="code-quote">"off"</span>);

end

</pre>
</div></div>

<p>Dimmer Status Value and Switch Status are the KNX status commands.</p>

<p>Can the rules engine read the KNX "Dimmer Status Value", do a comparision and change the KNX "Switch Status" ?</p>

<p>What am I doing wrong here? How can this logic be implemented with rules engine?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ggraja at May 04, 2013 08:07
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413543"></a>
                                    <font class="smallfont"><p>Hi,<br/>
I am new with OpenRemote and need some help on Rules.<br/>
I have a Panasonic TV that I control via IR (iTach), the remote only has a Power button (OnOff)</p>

<p>I would like to automatically switch on my TV when I go from (e.g.) my "Lights" screen to my "Television" screen.<br/>
Now when I watch TV I want to go back to my "Light" screen to control my lights.<br/>
Then when I go back to my "Television" screen, I don't need to switch it back on as it was already on...</p>

<p>So basically I would like to program a "flag" in rules to know if the TV is on or off.</p>

<p>Can somebody help me furher please?</p>

<p>Thanks!</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by dclaeys at May 05, 2013 07:28
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413599"></a>
                                    <font class="smallfont"><p>Dieter,<br/>
What you need is Discreet on and Discreet off commands for your TV. What model Panasonic TV do you have?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ggraja at May 05, 2013 18:13
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413603"></a>
                                    <font class="smallfont"><p>I finally solved this myself. refer to <a href="http://openremote.org/display/forums/Scenes?focusedCommentId=22413597&amp;#comment-22413597">SCENES</a> thread.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ggraja at May 05, 2013 18:22
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413635"></a>
                                    <font class="smallfont"><p>Govinda,<br/>
The model is a Panasonic TH-P50C30C<br/>
Regards,<br/>
Dieter</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by dclaeys at May 06, 2013 04:50
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413661"></a>
                                    <font class="smallfont"><p>Getting back to the issue I have left off a few days back.</p>

<p>The relevant code is:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">import</span> java.lang.<span class="code-object">System</span>;

declare Water_Tank_Timer
    time_count : <span class="code-object">int</span>
    time_running : <span class="code-object">int</span>
    skip_one_time : <span class="code-object">int</span>
end
declare Activated_time
    milliseconds : <span class="code-object">long</span>
    the_time_MM : <span class="code-object">int</span>
    the_time_HH : <span class="code-object">int</span>
end

rule <span class="code-quote">"Water_Tank_Just_Turned_On_60_Minutes"</span>
when
    $wt_timer : Water_Tank_Timer()
    $t : Activated_time()
    Event ( source == <span class="code-quote">"V_WT_Sensor_60"</span> )
    Switch ( source == <span class="code-quote">"V_WT_Sensor_60"</span>, value == <span class="code-quote">"on"</span> )
    eval ($wt_timer.getTime_running() == 0)
then
    execute.command( <span class="code-quote">"Water Tank (ON)"</span> );
    modify($wt_timer)
    {
       setTime_count(0);
     }
    modify($wt_timer)
    {
        setTime_running(1);
    }
    $t.setMilliseconds ( <span class="code-object">System</span>.currentTimeInMillis());
    $t.setThe_time_MM ( ( $t.getMilliseconds() / 1000 ) / 60 );
    $t.setThe_time_HH (  $t.getThe_time_MM() /  60 );
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Panel Water Tank was just turned ON <span class="code-keyword">for</span> 60 minutes!!"</span>);
    <span class="code-object">System</span>.out.println ( <span class="code-quote">"Time turned on was:"</span> + $t.getThe_time_HH()+<span class="code-quote">":"</span>+$t.getThe_time_MM() );
end
</pre>
</div></div>

<p>I still get the same basic error which I understand as the class "java.lang.System" does not contain the System.currentTimeInMillis() or else I am missing something here.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at May 06, 2013 16:05
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413665"></a>
                                    <font class="smallfont"><p>I thought my link was info enough <img class="emoticon" src="images/icons/emoticons/sad.gif" height="20" width="20" align="absmiddle" alt="" border="0"/><br/>
The method name is: System.currentTimeMillis()</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at May 06, 2013 16:43
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413666"></a>
                                    <font class="smallfont"><p>Sorry. <br/>
I got that 2 minutes after I posted it. Tried to erase but it does not let me.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at May 06, 2013 16:56
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413670"></a>
                                    <font class="smallfont"><p>Deleted</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niraviry at May 06, 2013 17:04
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413704"></a>
                                    <font class="smallfont"><div style="max-width: 800px;"><p>Try these, I think Panasonic has been using same IR codes for years on all plasma models</p>

<p>Off:<br/>
sendir,5:2,1,36682,4,1,128,63,16,16,16,48,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,48,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,48,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,48,16,48,16,48,16,48,16,48,16,48,16,16,16,16,16,48,16,48,16,48,16,48,16,48,16,48,16,16,16,48,16,2712</p>

<p>On:<br/>
sendir,5:2,1,36682,4,1,128,63,16,16,16,48,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,48,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,48,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,48,16,48,16,48,16,48,16,48,16,16,16,16,16,16,16,48,16,48,16,48,16,48,16,48,16,16,16,48,16,2712</p>

<p>Be sure to adapt the output in the GC commands to your configuration.</p></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ebariaux at May 07, 2013 11:57
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413776"></a>
                                    <font class="smallfont"><p>Dear Eric,</p>

<p>The operation of the TV works perfect.<br/>
I want to program a switch in my UI for it.<br/>
But for a switch you need a sensor command, which the Panasonic TV does not send back unfortunately.</p>

<p>Regards,<br/>
Dieter</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by dclaeys at May 08, 2013 02:39
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413801"></a>
                                    <font class="smallfont"><p>You can use a in-memory virtual command which works well with a switch.<br/>
After that you use the rules to trigger your ir command when the switch turns on or off.<br/>
There are some examples gathered through the forums.<br/>
Actually, the scenes thread mentioned in the next post already demonstrates this.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at May 08, 2013 08:04
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413803"></a>
                                    <font class="smallfont"><p>Marcus,<br/>
Yes, I know, and tried this.<br/>
But unfortunately doesn't work so far.<br/>
I even copy/paste it.<br/>
Does Rules not work in my application?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by dclaeys at May 08, 2013 08:08
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22413806"></a>
                                    <font class="smallfont"><p>It should work unless you have an error in the rules file which you should see in the logs.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at May 08, 2013 08:22
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22874202"></a>
                                    <font class="smallfont"><p>Sorry for reopening this thread but I did not found a better place. I have a problem with variables as described above. Here is my code:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
declare MyTestType 
    isTrue : <span class="code-object">boolean</span>
end

rule <span class="code-quote">"Init_System"</span>
  no-loop
when
  eval ( <span class="code-keyword">true</span> )
then
  MyTestType TestVariable = <span class="code-keyword">new</span> MyTestType();
  TestVariable.setIsTrue(<span class="code-keyword">false</span>);
  insert (TestVariable);
end

rule <span class="code-quote">"Alive"</span>
  timer (cron: 0 * * * * ?)
when
  $status : MyTestType()
  eval (<span class="code-keyword">true</span>)
then
  <span class="code-object">System</span>.out.println (status.istrue)  <span class="code-comment">// ERROR
</span>  
  <span class="code-comment">//$status.setIsTrue(not $status.getIsTrue());  //<span class="code-keyword">this</span> is what I <span class="code-keyword">finally</span> want!
</span>end</pre>
</div></div>

<p>I'm not able to read the value I stored before. I tried all versions I could imagine but no one works:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
  <span class="code-object">System</span>.out.println ($status.getIsTrue()); <span class="code-comment">// Rule Compilation error The method getIsTrue() is undefined <span class="code-keyword">for</span> the type MyTestType
</span>  <span class="code-object">System</span>.out.println ($status.getisTrue()); <span class="code-comment">// Rule Compilation error The method getisTrue() is undefined <span class="code-keyword">for</span> the type MyTestType
</span>  <span class="code-object">System</span>.out.println ($status.getIsTrue); <span class="code-comment">// Rule Compilation error $status.getIsTrue cannot be resolved or is not a field
</span>  <span class="code-object">System</span>.out.println ($status.getisTrue); <span class="code-comment">// Rule Compilation error $status.getisTrue cannot be resolved or is not a field
</span>  <span class="code-object">System</span>.out.println ($status.IsTrue()); <span class="code-comment">// Rule Compilation error The method IsTrue() is undefined <span class="code-keyword">for</span> the type MyTestType
</span>  <span class="code-object">System</span>.out.println ($status.IsTrue); <span class="code-comment">// Rule Compilation error $status.IsTrue cannot be resolved or is not a field
</span>  <span class="code-object">System</span>.out.println ($status.isTrue()); <span class="code-comment">// Rule Compilation error The method isTrue() is undefined <span class="code-keyword">for</span> the type MyTestType
</span>  <span class="code-object">System</span>.out.println ($status.isTrue); <span class="code-comment">// Rule Compilation error The field MyTestType.isTrue is not visible
</span>
  <span class="code-object">System</span>.out.println (status.getIsTrue()); <span class="code-comment">// Rule Compilation error status cannot be resolved
</span>  <span class="code-object">System</span>.out.println (status.getisTrue()); <span class="code-comment">// Rule Compilation error status cannot be resolved
</span>  <span class="code-object">System</span>.out.println (status.getIsTrue); <span class="code-comment">// Rule Compilation error status.getIsTrue cannot be resolved to a type
</span>  <span class="code-object">System</span>.out.println (status.getisTrue); <span class="code-comment">// Rule Compilation error status.getisTrue cannot be resolved to a type
</span>  <span class="code-object">System</span>.out.println (status.IsTrue()); <span class="code-comment">// Rule Compilation error status cannot be resolved
</span>  <span class="code-object">System</span>.out.println (status.IsTrue); <span class="code-comment">// Rule Compilation error status.IsTrue cannot be resolved to a type
</span>  <span class="code-object">System</span>.out.println (status.isTrue()); <span class="code-comment">// Rule Compilation error status cannot be resolved
</span>  <span class="code-object">System</span>.out.println (status.isTrue); <span class="code-comment">// Rule Compilation error status.isTrue cannot be resolved to a type</span>
</pre>
</div></div>

<p>Can anybody help to find the error?!?!</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by sinonimo at Jul 30, 2013 12:12
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22874203"></a>
                                    <font class="smallfont"><p>Following Java's idiosyncrasies (yes we need to find a way not to expose users to them too much) the boolean naming convention would be $status.isIsTrue()</p>

<p>Which means you probably will want to rename your variable to keep the code readable, e.g. 'foo : boolean' and then $status.isFoo()</p>

<p>Just working on a hunch, didn't try it so you'll have to try and see. I could be wrong. But if getIsTrue() is not responding then isIsTrue() might.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jul 30, 2013 12:38
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875221"></a>
                                    <font class="smallfont"><p>I tried to add the <b>CustomState</b> line to my working rule "Sunshades Up". I did make a isNight command and isNight Sensor, which seems to work OK according to a label on my Android screen:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.protocol

global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;
<span class="code-keyword">import</span> org.openremote.controller.protocol.*;

rule <span class="code-quote">"Turn Laundromat On"</span> when

  Event( source == <span class="code-quote">"SolarPowerLevel"</span>, value &gt; 1000 )

then

  execute.command( <span class="code-quote">"Switch12On"</span> );

end

rule <span class="code-quote">"Sunshades Up"</span> when

  Event( source == <span class="code-quote">"WindGust"</span>, value &gt; 38 )

  CustomState(source==<span class="code-quote">"isNight"</span>, value==<span class="code-quote">"<span class="code-keyword">true</span>"</span>)

then

  execute.command( <span class="code-quote">"SunScreenUP"</span> );

end
</pre>
</div></div>

<p>I do get the following error:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
ERROR 2013-08-21 18:26:38,181 : Rule definition 'modeler_rules.drl' could not be deployed. See errors below.
ERROR 2013-08-21 18:26:38,182 : Unable to resolve ObjectType 'CustomState'
ERROR 2013-08-21 18:26:38,185 : There was an error parsing the rule definition 'modeler_rules.drl' : Could not parse knowledge.
java.lang.IllegalArgumentException: Could not parse knowledge.
</pre>
</div></div>

<p>What am I doing wrong? I assume that my two clauses <em>Event</em> and <em>CustomState</em> are interpreted as OR</p>

<p>PS: I still use extra blank lines in rules. Is that still necessary?<br/>
Thanks,<br/>
Pieter</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Aug 21, 2013 20:06
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875230"></a>
                                    <font class="smallfont"><p>Probably CustomState() sits in a different package. My guess is org.openremote.controller.model.event so try to add</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">import</span> org.openremote.controller.model.event.*;
</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aktur at Aug 22, 2013 08:50
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875234"></a>
                                    <font class="smallfont"><p>Thanks for the response. Yes I reviewed the header yesterday evening late and came to the same conslusion. So I changed the header into</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.model.event

global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;
<span class="code-keyword">import</span> org.openremote.controller.protocol.*;
</pre>
</div></div>
<p>Which made the the error go away, but now the <em>WindGust</em> doesn't seem to trigger anymore.</p>

<p>I am a bit confused about usage of <b>package</b> and <b>import</b>. I'll try your suggestion and add that import line</p>

<p>FYI: I am developing this rule set as a demo for document <a href="http://www.openremote.org/display/docs/OpenRemote+2.0+How+To+-+Control+Sunshades+-+Somfy+with+Raspberry+Pi" title="OpenRemote 2.0 How To - Control Sunshades - Somfy with Raspberry Pi">OpenRemote 2.0 How To &#45; Control Sunshades &#45; Somfy with Raspberry Pi</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Aug 22, 2013 09:53
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875292"></a>
                                    <font class="smallfont"><p>I got rid of the Error with the following rewritten rule. Unfortunately it does not act on IsNight sensor value turning to true.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> org.openremote.controller.model.event

global org.openremote.controller.statuscache.CommandFacade execute;
global org.openremote.controller.statuscache.SwitchFacade switches;
<span class="code-keyword">import</span> org.openremote.controller.model.event.*;
<span class="code-keyword">import</span> org.openremote.controller.protocol.*;

rule <span class="code-quote">"Sunshades Up"</span> when

  Event( source == <span class="code-quote">"WindGust"</span>, value &gt; 38 )

  CustomState(source==<span class="code-quote">"isNight"</span>, value==<span class="code-quote">"<span class="code-keyword">true</span>"</span>)

then

  execute.command( <span class="code-quote">"SunScreenUP"</span> );

end
</pre>
</div></div>

<p>I think I have tried almost all permutations of header declarations. So I am lost. (probably on something stupid)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Aug 22, 2013 20:16
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875319"></a>
                                    <font class="smallfont"><p>Well, about something stupid. I don't know your application (yet) but you are aware that the rule will be fired only when WindGust sensor is above 38 AND isNight is true. Moreover, the rule will fire only when at least one of the sensors changes its value. Maybe this helps? </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aktur at Aug 22, 2013 22:13
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875325"></a>
                                    <font class="smallfont"><p>Thanks, but I think I am qualified being only half stupid <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/> because I had my doubts there in my original question where I asked:</p>
<blockquote><p>What am I doing wrong? I assume that my two clauses Event and CustomState are interpreted as OR</p></blockquote>
<p>I'll dig further to find out how to do this OR. I did look into the examples on the OR site earlier, and did not find any. </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Aug 23, 2013 07:40
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875352"></a>
                                    <font class="smallfont"><p>With these explicitly OR-ed clauses:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
rule <span class="code-quote">"Sunshades Up"</span> when

  (Event( source == <span class="code-quote">"WindGust"</span>, value &gt; 38 ) or 
  CustomState(source==<span class="code-quote">"isNight"</span>, value==<span class="code-quote">"<span class="code-keyword">true</span>"</span>))

then

  execute.command( <span class="code-quote">"SunScreenUP"</span> );

end 
</pre>
</div></div>
<p>it did respond to WindGust changing to a value that exceeded the preset value. Will see later tonight if the second clause will make it fire as well. If successfull, I will the rule on the application page: <a href="http://www.openremote.org/display/docs/OpenRemote+2.0+How+To+-+Control+Sunshades+-+Somfy+with+Raspberry+Pi" title="OpenRemote 2.0 How To - Control Sunshades - Somfy with Raspberry Pi">OpenRemote 2.0 How To &#45; Control Sunshades &#45; Somfy with Raspberry Pi</a><br/>
Thanks for your help.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Aug 23, 2013 11:46
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875355"></a>
                                    <font class="smallfont"><p>I know this from the time when I was fighting to make the rule for my single button TV switch demo. As you see in the code there is an explicit or in the when statement.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aktur at Aug 23, 2013 12:01
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875356"></a>
                                    <font class="smallfont"><p>The "Switch TV" rule example indeed is on your <a href="http://mqlservice.net/openremote/category/bose/">blog</a>. I hadn't found it here.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Aug 23, 2013 12:17
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875608"></a>
                                    <font class="smallfont"><p>I have looked in vain into ways to call a macro from a rule. Is there some work-around for that? I did tried to make a command calling a rule, but that also is not possible (for obvious reasons however, because in most places you can use either a command or a macro).<br/>
The only solution I found was to "copy" the macro contents to the rule, which is awkward from a consistency point of view.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Aug 28, 2013 10:23
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875611"></a>
                                    <font class="smallfont"><p>The macro construct only exists in the designer, not on the controller side. So you can only invoke individual commands from rules.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Aug 28, 2013 11:21
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22875615"></a>
                                    <font class="smallfont"><p>Thanks, now I understand its limitations.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Aug 28, 2013 11:38
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22878203"></a>
                                    <font class="smallfont"><p>Just my 2cts:<br/>
In the meantime I have added one more clause in the LHS part of that rule. As I found it looking a bit messy with all the "or" statements at the end of the line I did change from <em>infix or</em> to <em>prefix or</em> syntax, wich makes it easier to read imho:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
rule <span class="code-quote">"Sunshades Up"</span> when
  (or
   Event( source == <span class="code-quote">"WindGust"</span>, value &gt; 38 )
   CustomState(source==<span class="code-quote">"isNight_sensor"</span>, value==<span class="code-quote">"<span class="code-keyword">true</span>"</span>)
   CustomState(source==<span class="code-quote">"isItRaining"</span>, value==<span class="code-quote">"<span class="code-keyword">true</span>"</span>)
  )
then
  execute.command( <span class="code-quote">"SunScreenUP"</span> );
end
</pre>
</div></div> 
<p>I do apply a similar prefix syntax for "and" clauses. Knowing that the "and" is implicit, I rather see it specified.  </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Oct 15, 2013 12:11
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 10:45</font></td>
		    </tr>
	    </table>
    </body>
</html>