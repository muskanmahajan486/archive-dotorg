<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Switch on, off example with shell exe. - Raspberry Pi</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Switch on, off example with shell exe. - Raspberry Pi
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Mar 23, 2015 by <font color="#0050B2">jesperlykke</font>.
				    </div>

				    <p>Hello all here.</p>

<p>I have made this RPI-HomeBox, which contains 4 relays for main power, IR-blaster, and IR reciver.</p>

<p>While it all works, i have tried to make a switch for switching some of the relays on|off<br/>
I have made a lot of different shell scripts, for testing, but need a switch with on|off state now!</p>


<p>I would really like an example of a shell (.sh) script, which returns a value, which is usefull for a sensor.<br/>
Does anybody have the possibility to paste such a script here ?</p>

<p>Rgds; Jesper</p>

<p><span class="error">Cannot resolve external resource into attachment.</span></p>

<p><span class="error">Cannot resolve external resource into attachment.</span></p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23597161/23789817.png">5.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23597161/23789818.png">6.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23597161/23789844.png">22stat.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23597161/23789845.png">22OFF.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23597161/23789846.png">22ON.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23597161/23789847.png">22Sensor.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23597161/23789848.png">22switch.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23597161/23789849.png">Panel.PNG</a> (image/png)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-23597186"></a>
                                    <font class="smallfont"><p>Soo <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>No matter what i do, i cannot make it work.</p>

<p>I got the sensor, i got the switch, and i got commands for turn on, and turn off... and ofcause the sensor status command.</p>

<p>I tried every possible exit's from my shell scripts, therefore i got both echo "on", exit 1 etc...</p>

<p>I think i can make it work, if i just know how the exit of my script must look like?<br/>
Also i have doubt, if i must use a sensor name.</p>

<p>Anybody got some working scripts (#!/bin/sh) ??</p>

<p>Rgds; Jesper.</p>

<p>----------------------------------------</p>

<p>#!/bin/sh</p>
<ol>
	<li>turn on gpio 20<br/>
/usr/local/bin/gpio write 20 1<br/>
echo "on"<br/>
echo "1"<br/>
exit 1</li>
</ol>


<p>----------------------------------------</p>

<p>#!/bin/sh</p>
<ol>
	<li>turn off gpio 20<br/>
/usr/local/bin/gpio write 20 0<br/>
echo "off"<br/>
echo "0"<br/>
exit 0</li>
</ol>


<p>----------------------------------------</p>

<p>#!/bin/sh</p>
<ol>
	<li>sensor<br/>
status=$(/usr/local/bin/gpio read 20)</li>
</ol>


<p>if [ $status = 1 ]; then<br/>
echo "on" <br/>
#/usr/local/bin/gpio write 20 1<br/>
exit 1</p>

<p>fi<br/>
echo "off"<br/>
#/usr/local/bin/gpio write 20 0<br/>
exit 0</p>

<p>-------------------------------------------</p>

<p><span class="error">Cannot resolve external resource into attachment.</span></p>

<p><span class="error">Cannot resolve external resource into attachment.</span></p>

</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jesperlykke at Mar 24, 2015 19:05
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597193"></a>
                                    <font class="smallfont"><p>Hi Jesper</p>

<p>I managed to work with the GPIO's through the Webiopi.</p>

<p>Check the link below.</p>

<p><a href="http://www.openremote.org/pages/viewpage.action?pageId=23593362" title="WEBIOPI">http://www.openremote.org/pages/viewpage.action?pageId=23593362</a></p>

<p>Hope this helps.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by edgi at Mar 25, 2015 07:06
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597194"></a>
                                    <font class="smallfont"><blockquote>
<p>No matter what i do, i cannot make it work.</p></blockquote>
<p>You should always reboot the controller (stop/start) after amending and uploading a new design with shell command protocol. There is a bug in the implementation that it work properly only from the cool boot.</p>

<p>echo "on", echo "1" should be OK.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aktur at Mar 25, 2015 07:31
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597195"></a>
                                    <font class="smallfont"><p>Hi Thanks.</p>

<p>I will check it out... <br/>
I see in link, you made it work with openremote integration ? -Right?</p>

<p>Anyway, thanks for answer!</p>

<p>Rgds; Jesper.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jesperlykke at Mar 25, 2015 08:11
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597196"></a>
                                    <font class="smallfont"><p>Hi.</p>

<p>Thanks for confirming that echo "on" and/or echo "1" gives the right return from shell (!#/bin/sh).<br/>
So my scripts again :</p>

<p>#!/bin/sh<br/>
#turn on gpio 20<br/>
/usr/local/bin/gpio write 20 1 # &lt;--- working<br/>
echo "on" # &lt;---- NOT neccesary i think?<br/>
exit </p>

<p>#!/bin/sh<br/>
#turn on gpio 20<br/>
/usr/local/bin/gpio write 20 0 # &lt;--- working<br/>
echo "off" # &lt;---- NOT neccesary i think?<br/>
exit </p>

<p>#!/bin/sh</p>
<ol>
	<li>on-off sensor<br/>
status=$(/usr/local/bin/gpio read 20) # &lt;---- Working<br/>
if [ $status = 1 ]; then              # &lt;---- If gpio reads 1 = relay on then echo on<br/>
echo "on" <br/>
exit<br/>
fi                                    # &lt;---- If gpio reads 0 = relay off then echo off                          <br/>
echo "off"<br/>
exit</li>
</ol>


<p>Can anybody see, whats wrong, or has anybody ever made a switch/sensor/shellexe combi WORK ???</p>

<p>I allways, reboot my PI with the controller, when i make changes (Read this somewhere else)Thanks.</p>

<p>Rgds; Jesper.</p>

</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jesperlykke at Mar 25, 2015 08:24
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597197"></a>
                                    <font class="smallfont"><p>Yes, you must to install WEBIOPI in the RPI, after checking the installation according to the installation instructions in this <a href="https://code.google.com/p/webiopi/wiki/INSTALL">LINK</a> you can porceder to perform the configuration on the OpenRemote designer. ( Look at the Troubleshooting in the LINK I send you above )</p>

<p>After the completion of the configuration you must reboot the system (controller / RaspberryPi) as indicated by Michal.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by edgi at Mar 25, 2015 08:32
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597198"></a>
                                    <font class="smallfont"><p>Cool <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>So i will try to install it later.</p>

<p>I allready got openremote controller installed on the PI, but does not look to be a problem, having more services running according to CPU-load.</p>

<p>Rgds; Jesper.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jesperlykke at Mar 25, 2015 08:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597199"></a>
                                    <font class="smallfont"><blockquote>
<p>Can anybody see, whats wrong, or has anybody ever made a switch/sensor/shellexe combi WORK ???</p></blockquote>
<p>I've made lot of them, even implementing whole new protocols through shellexe. Now, look at the output of log file logs/shellexe.log, maybe you will find some clues there. At least you should see your script being executed and returning some value.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aktur at Mar 25, 2015 08:51
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597201"></a>
                                    <font class="smallfont"><p>Okay...</p>

<p>Will report back later!</p>

<p>Thanks</p>

<p>Rgds; Jesper.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jesperlykke at Mar 25, 2015 09:20
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597216"></a>
                                    <font class="smallfont"><p>Hi again here <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>So i have been studying my shell log, and pasted some of the outputs here.</p>

<p>But i can't see why, it says "regex evaluation did not find a match" ??</p>

<p>Rgds; Jesper.</p>

<p>#!/bin/sh<br/>
/usr/local/bin/gpio write 20 1<br/>
exit </p>

<p>#!/bin/sh<br/>
/usr/local/bin/gpio write 20 0<br/>
exit </p>

<p>#!/bin/sh<br/>
status=$(/usr/local/bin/gpio read 20)<br/>
if [ $status = 1 ]; then<br/>
echo "1"<br/>
exit<br/>
fi<br/>
echo "0"<br/>
exit </p>

<p>&#8211; SNIP &#8211;<br/>
DEBUG 2015-03-25 16:03:59,715 (Shell): Will start shell command: /home/pi/scripts/switch/sensor.sh and use params: null<br/>
DEBUG 2015-03-25 16:03:59,746 (Shell): Shell command: /home/pi/scripts/switch/sensor.sh returned: 0<br/>
INFO 2015-03-25 16:03:59,747 (Shell): regex evaluation did not find a match<br/>
DEBUG 2015-03-25 16:04:00,067 (Shell): Building ShellExe command<br/>
DEBUG 2015-03-25 16:04:00,068 (Shell): ShellExe Command: commandPath= /home/pi/scripts/power-20-on.sh<br/>
DEBUG 2015-03-25 16:04:00,069 (Shell): ShellExe Command created successfully<br/>
DEBUG 2015-03-25 16:04:00,105 (Shell): Will start shell command: /home/pi/scripts/power-20-on.sh and use params: null<br/>
DEBUG 2015-03-25 16:04:00,131 (Shell): Shell command: /home/pi/scripts/power-20-on.sh returned:<br/>
DEBUG 2015-03-25 16:04:01,686 (Shell): Will start shell command: /home/pi/scripts/switch/sensor.sh and use params: null<br/>
DEBUG 2015-03-25 16:04:01,712 (Shell): Shell command: /home/pi/scripts/switch/sensor.sh returned: 1<br/>
INFO 2015-03-25 16:04:01,713 (Shell): regex evaluation did not find a match<br/>
 &#8211; SNIP &#8211;</p>

<p><span class="error">Cannot resolve external resource into attachment.</span></p>

<p><span class="error">Cannot resolve external resource into attachment.</span></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jesperlykke at Mar 25, 2015 16:47
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597219"></a>
                                    <font class="smallfont"><blockquote><p>But i can't see why, it says "regex evaluation did not find a match" ??</p></blockquote>
<p>If I understand correctly, the values that the scripts return to your status sensor are either "1" or "0". Yet in your sensor you apply RegEx <b>on|off</b>. That does not make sense to me. Have you tried leaving RegEx empty?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 25, 2015 20:16
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597225"></a>
                                    <font class="smallfont"><p>PZ1, Thanks that did it.</p>

<p>Removing the on|off in regex did the trick.</p>

<p>I am currious now, how this works. - So will test when i am back home from work today <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>I created both a custom, and a switch sensor. The shell return 1 / 0 OR the on / off, works flawlessly now.</p>

<p>Maybe i have to give echo "Sensorname on" for regex to work ?</p>

<p>Rgds; Jesper</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jesperlykke at Mar 26, 2015 10:38
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597634"></a>
                                    <font class="smallfont"><p>Hi Jesper,</p>

<p>Thanks for this post and to keep posting until resolution.  I very new at this and i have a similar setup that i can get to make it work. Since you already make your works, maybe you or someone else can shed some light on whats wrong.   </p>

<p>Currently i only have one simple LED connected to the GPIO22 of my Raspberry Pi that i want to turn on and off. For testing learning purposes i want to start with something really basic and then move on.</p>

<p>Ok, so this are the scripts i have, similiar as yours.</p>

<p>poweron.sh<br/>
#!/bin/sh<br/>
/usr/local/bin/gpio -g mode 22 out<br/>
/usr/local/bin/gpio -g write 22 0<br/>
exit</p>

<p>poweroff.sh<br/>
#!/bin/sh<br/>
/usr/local/bin/gpio -g mode 22 out<br/>
/usr/local/bin/gpio -g write 22 1<br/>
exit</p>

<p>powerstatus.sh<br/>
#!/bin/sh<br/>
status=$(/usr/local/bin/gpio -g read 22)<br/>
if [ $status = 1 ]; then<br/>
echo "1"<br/>
exit<br/>
fi<br/>
echo "0"<br/>
exit</p>

<p>This are the screenshots of the configuration of each of the items i have <br/>
<img src="attachments/23597161/23789844.png" align="absmiddle" border="0"/></p>

<p><img src="attachments/23597161/23789846.png" align="absmiddle" border="0"/></p>

<p><img src="attachments/23597161/23789845.png" align="absmiddle" border="0"/></p>

<p><img src="attachments/23597161/23789847.png" align="absmiddle" border="0"/></p>

<p><img src="attachments/23597161/23789848.png" align="absmiddle" border="0"/></p>

<p>On the panel view i just have a single switch<br/>
<img src="attachments/23597161/23789849.png" align="absmiddle" border="0"/></p>

<p>When get on my phone to the controller and press the button (which is labeled by "off")  the led turns on and thats it.   it will stay like that no matter how many times i press the button.</p>

<p>Anyone has any advise?</p>




</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jsanjur at Apr 15, 2015 02:34
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597635"></a>
                                    <font class="smallfont"><p>EDIT:  I think the problem was the interval polling time i had on the status command.</p>

<p>Will confirm later</p>


<p>Confirmed.  Added the polling interval as 3s on the status and its working now.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jsanjur at Apr 15, 2015 02:59
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:32</font></td>
		    </tr>
	    </table>
    </body>
</html>