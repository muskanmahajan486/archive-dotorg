<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Security in OpenRemote</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Security in OpenRemote
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Mar 05, 2012 by <font color="#0050B2">vincentkriek</font>.
				    </div>

				    <p>Hi,</p>

<p>We are currently working on an internship in which the goal will be to integrate authentication and authorization into the OpenRemote project. We want to secure the connection between the client application and the controller and we would like to do this without a username and password.</p>

<p>The global idea is to be able to authorize devices which are uniquely recognized in the controller. For this we are going to use SSL client certificates to identify clients.</p>

<p>We have already researched this topic a bit and documented this. Attached to this message is a PDF with our research document about the security.</p>

<p>With kind regards,<br/>
Melroy van den Berg<br/>
&amp;<br/>
Vincent</p>

<p>Security research: <a href="https://docs.google.com/document/d/1N2f_zkaP-EKBfqHxviSA4L1fPBcuooiU23WXIWRvDcg/edit">https://docs.google.com/document/d/1N2f_zkaP-EKBfqHxviSA4L1fPBcuooiU23WXIWRvDcg/edit</a></p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439381/19398817.png">TopLevelDesignORSecurity.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19439381/19398818.png">DomoTopSequenceDiagram.png</a> (image/png)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-19439761"></a>
                                    <font class="smallfont"><p>We have made some progress these weeks, proof of concept is now up and running. Code can be found on <a href="https://github.com/DomoTop/DomoTop">github</a>. A brief overview what has been done this week can be found <a href="https://docs.google.com/document/d/1_cQGQcpHUp-AB5vA5ccuiuTVT3zzoEAnBT8gzSfdvto/edit">here</a>.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by vincentkriek at Mar 16, 2012 07:45
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439762"></a>
                                    <font class="smallfont"><p>This looks very interesting. Thanks and keep up the good work <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/><br/>
Beside the certificate generation and exchange, did you already include the group assignment within the designer? <br/>
This is not new and a few people already asked for it.<br/>
--Marcus</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Mar 16, 2012 08:49
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19439763"></a>
                                    <font class="smallfont"><p>Hi Marcus!</p>

<p>We have not yet included the group assignment within the designer, this will be done further in the project. The first step is being able to authorize people to use the entire ORB after which groups will be implemented.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by vincentkriek at Mar 16, 2012 08:54
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19440285"></a>
                                    <font class="smallfont"><p>Hi,</p>

<p>We have an update to announce. We created your first stable release (v1.1) of our OpenRemote Security project.</p>

<p>We created 2 diagrams to explain our basic software design.</p>

<p>The image below is a flowchart which represents the first initial request of the client:  <br/>
<img src="attachments/19439381/19398817.png" align="absmiddle" border="0"/></p>

<p>The second image is a sequence diagram about how the client ask for permissions and the administrator approves it:<br/>
<img src="attachments/19439381/19398818.png" align="absmiddle" border="0"/></p>

<p>We use GitHub/Git to host <a href="https://github.com/DomoTop/DomoTop">our files</a> the tags can be found here:<br/>
<a href="https://github.com/DomoTop/DomoTop/tags">https://github.com/DomoTop/DomoTop/tags</a></p>

<p>Version 1.1 is the latest tag.</p>

<p>We also created a War &amp; APK for you.<br/>
OpenRemote Controller (WAR): <a href="http://openlaptop.nl/openremote/controller.war">http://openlaptop.nl/openremote/controller.war</a> (Right click -&gt; Save as...)<br/>
OpenRemote Android Application (APK): <a href="http://openlaptop.nl/openremote/OpenRemoteConsole.apk">http://openlaptop.nl/openremote/OpenRemoteConsole.apk</a> (Right click -&gt; Save as...)</p>

<p>Note <img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/>:<br/>
Only installing the WAR is not enough, so please follow our README (Installing) line by line at:
<a href="https://github.com/DomoTop/DomoTop/tree/master/Product">https://github.com/DomoTop/DomoTop/tree/master/Product</a></p>

<p>If you have any remarks and/or additions we like to know them. You can either place it on this topic or create a new issue on our GitHub page:<br/>
<a href="https://github.com/DomoTop/DomoTop/issues?state=open">https://github.com/DomoTop/DomoTop/issues?state=open</a></p>

<p>We would like to hear from you soon.</p>

<p>Thanks in advance.</p>

<p>Kind regards,</p>

<p>Vincent Kriek<br/>
&amp;<br/>
Melroy van den Berg</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by danger89 at Apr 20, 2012 12:43
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19988808"></a>
                                    <font class="smallfont"><p>Guys, we would like to integrate your code in out opensource code base.<br/>
I think Juha already mentioned our "code contribution formular". <br/>
Once you have signed we can talk about integration.</p>

<p>We also want to use certificates to authenticate a controller against a designer account so that the controller can publish discovered devices to the designer and perform syncing automatically without user interaction once a controller is linked to an account.</p>

<p>All the handling of certificates is supposed to move into Beehive and there should be REST/JSON interface where you can create certificates and download/delete them.<br/>
The frontend to deal with the account/certificate service should be integrated into the designer.</p>

<p>I will publish some more info about this in a new forum thread soon. </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at May 22, 2012 09:49
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19988812"></a>
                                    <font class="smallfont"><p>Hi Marcus!</p>

<p>We are very excited that you are so positive about our additions. We would love to work with you to get our changes integrated. We are currently working with our employer to get the code contribution formular signed and out of the way.</p>

<p>However we have a few remarks about moving the certificates from the controller to the designer. Having them on the controller was a decision we made that we think is correct. Let me explain. </p>

<p>In our system we have a "database" of clients on the Controller. These clients have requested access to the controller and might have gotten access as well. They have gotten certificates created specifically for this installation of the OpenRemote controller. It allows encrypted traffic between the Controller and the client, and just that controller and client.</p>

<p>Having this in the beehive feels counterintuitive to us. Why would you want to have a database of all the users in the beehive? Isn't it more logical to keep them in the controller? Our question is, what are your reasons for wanting that in the Beehive and designer?  </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by vincentkriek at May 22, 2012 12:27
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19988813"></a>
                                    <font class="smallfont"><p>A controller is not the first element in the chain, it's a user account from the Designer.<br/>
The user there (maybe an installer) has multiple installations and each installation needs a controller.<br/>
Also each controller is controlled by clients which have to be authorized by the original user or<br/>
somebody who has the needed permission todo so.</p>

<p>We don't want to have different interfaces for maintaining things which means all can be done from<br/>
the Designer and a user does not have to access a Controller webpage to maintain certificates.<br/>
The current Controller "Sync page" will be removed also.</p>

<p>From an installer point of view, he just want's to setup everything for his paying customer and not<br/>
have the customer have to deal with permissions on the Controller. Maybe he want's to charge if the<br/>
customer wants to add a new device to control the house.</p>

<p>Please read my new post for more answers.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at May 22, 2012 13:04
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19988816"></a>
                                    <font class="smallfont"><p>Thanks for the explanation Marcus! where can I find your new post, I don't see it anywhere?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by vincentkriek at May 22, 2012 13:54
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19988817"></a>
                                    <font class="smallfont"><p>I am currently working on it <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/><br/>
As soon as it's online, I will post a link here.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at May 22, 2012 13:57
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19988821"></a>
                                    <font class="smallfont"><p>The new post can be found here: <a href="http://www.openremote.org/display/forums/Beehive+AccountService%2C+Security+and+Certificates">http://www.openremote.org/display/forums/Beehive+AccountService%2C+Security+and+Certificates</a><br/>
Just post any comments there so we can brainstorm some more and create a "good foundation" for ongoing development.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at May 22, 2012 15:32
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19988862"></a>
                                    <font class="smallfont"><p>Guys,</p>

<p>some questions:</p>
<ul class="alternate" type="square">
	<li>Is the first client request without SSL connection, since certificate is not there yet?</li>
	<li>Does the client create the private key and the controller only signs the CSR or does the controller creates key and sign certificate?</li>
	<li>Is the server.jks defined in server.xml the same you reference in CertificateServiceImpl ?</li>
	<li>Where do you use the HSQLDB?</li>
</ul>


<p>--Marcus</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at May 25, 2012 16:26
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19988883"></a>
                                    <font class="smallfont"><p>Hey Marcus,</p>

<ul>
	<li>This is correct.</li>
	<li>Correct as well, client creates a keypair and a CSR, controller signs that CSR which creates a certificate and sents that back. This CSR and certificate only contain the public key</li>
	<li>Correct</li>
	<li>We use HSQLDB to keep track of settings and current approved users. We use a TomCat realm to check if a client certificate is valid when a client connects, this uses HSQLDB as well.</li>
</ul>


<p>Vincent</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by vincentkriek at May 28, 2012 09:36
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19988886"></a>
                                    <font class="smallfont"><p>Ok, thanks for the clarification. </p>

<p>I am currently working on the Beehive "UserAccountService" which is going to be an independet REST/JSON API to handle all kinds of user/account/certificate issues. Beehive is already using MySQL for data storage, so it would be easy to extend the "account", "controller" and "user" tables to hold extra information which are used by your services. It should not be to hard to move your CertificateService to Beehive. Please use the other thread for further information and discussions on that topic.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at May 28, 2012 09:54
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597660"></a>
                                    <font class="smallfont"><p>what's the actual status ? </p>

<p>Is it possible to secure the controller with client authentication ? <br/>
How Can I use client authentication from my android app ?<br/>
thanks,<br/>
Klaus</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by klaus1 at Apr 16, 2015 11:05
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597661"></a>
                                    <font class="smallfont"><p>With the stuff mentioned earlier in this thread it should be possible.<br/>
The whole security and certificate stuff is not integrated yet.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Apr 16, 2015 11:12
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597663"></a>
                                    <font class="smallfont"><p>Correct, we haven a proof of concept. And we even implement this proof of concept 3 years ago.</p>

<p>Please check out the code in GH:
<a href="https://github.com/DomoTop/DomoTop/tree/master/Product">https://github.com/DomoTop/DomoTop/tree/master/Product</a></p>

<p>I tried to merge the changes into the OpenRemote code archive, but back in the days OpenRemote didn't allow to do so. Because "they had a different opinion of OpenRemote security".</p>

<p>Hopefully they changed there minds?</p>

<ul class="alternate" type="square">
	<li>Melroy</li>
</ul>


<p>Developer of OpenRemote Security using TLS (SSL) &amp; certificate authority</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by danger89 at Apr 16, 2015 13:39
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23597666"></a>
                                    <font class="smallfont"><p>Downloading the war file tells me: The requested URL /openremote/controller.war was not found on this server.</p>

<p>Is it possible to run hqsldb and new controller on my raspberrypi too?<br/>
At the moment I have ssl connection on my tomcat and tomcat user in users.xml with standard openremote controller working.</p>

<p>Rest services tells correctly that authentication is needed:</p>


<p>description This request requires HTTP authentication ()</p>

<p>Id there sny security problem?</p>

<p>thanks,<br/>
Klaus</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by klaus1 at Apr 16, 2015 19:32
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:31</font></td>
		    </tr>
	    </table>
    </body>
</html>