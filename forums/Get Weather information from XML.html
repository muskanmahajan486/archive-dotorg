<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Get Weather information from XML</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Get Weather information from XML
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Mar 28, 2013 by <font color="#0050B2">hank</font>.
				    </div>

				    <p>Hi</p>

<p>Since Google weather information API no longer works, i want to use YR.no instead.</p>

<p>I want to extract information from below site:</p>

<p><a href="http://www.yr.no/place/Sweden/V">http://www.yr.no/place/Sweden/V</a>ästra_Götaland/Torslanda/forecast.xml</p>

<p>To view it please check <a href="http://www.yr.no/place/Sweden/V">http://www.yr.no/place/Sweden/V</a>ästra_Götaland/Torslanda/</p>

<p>I guess i should use a HTTP command and add the adress to URL.<br/>
I think to use "GET" in "Http Method", but what should i write in "Xpath Expression" to get let´s say the temperature value for example today etc.</p>

<p>Best Regards<br/>
Henrik</p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/21859317/22052969.png">Torslanda.png</a> (image/png)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-21859325"></a>
                                    <font class="smallfont"><p>That URL does not return a URL. Sites like the one you refer to are not very well suited for parsing. <br/>
There is a site <a href="http://www.wunderground.com">http://www.wunderground.com</a> where you can register and get access to a wheater report in XML. I don't remember how you get it.<br/>
Look at that site if it fits you. If you have problems with the XPATH, I am happy to help (Parsing this kind of data is on my longer term agenda anyhow.)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 28, 2013 15:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859326"></a>
                                    <font class="smallfont"><p>Thanks Pe Zanstra for your quick replay.</p>

<p>Explain for me what you mean with "That URL does not return a URL"  <a href="http://www.yr.no/place/Sweden/V">http://www.yr.no/place/Sweden/V</a>ästra_Götaland/Torslanda/forecast.xml<br/>
I´m a newbie with XML, so the above link doesn´t give you a good XML site?</p>

<p>Wunderground is a good alternative but doesn´t have weather info at my area so good.</p>

</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hank at Mar 28, 2013 15:43
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859330"></a>
                                    <font class="smallfont"><p>Sorry, I missed the first URL. I am busy right now, but will give you an example for the Xpath later tonight</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 28, 2013 16:08
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859331"></a>
                                    <font class="smallfont"><p>Thanks for your support, I try to learn step by step how to get the most out of OR.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hank at Mar 28, 2013 16:11
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859335"></a>
                                    <font class="smallfont"><p>This xml is more complex than I ever handled before. So I couldn't find a quick solution.  The Wunderground site I use gives me simple real time information. Yours has several more or less identical periods. Do you need all the information for the multiple time slots?  (<b>edit: added xml header which was invisible in browser</b>)</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;?xml version=<span class="code-quote">"1.0"</span> encoding=<span class="code-quote">"utf-8"</span>?&gt;</span>
<span class="code-tag">&lt;weatherdata&gt;</span>
  <span class="code-tag">&lt;location&gt;</span>
    <span class="code-tag">&lt;name&gt;</span>Torslanda<span class="code-tag">&lt;/name&gt;</span>
    <span class="code-tag">&lt;type&gt;</span>Town<span class="code-tag">&lt;/type&gt;</span>
    <span class="code-tag">&lt;country&gt;</span>Sweden<span class="code-tag">&lt;/country&gt;</span>
    <span class="code-tag">&lt;timezone id=<span class="code-quote">"Europe/Stockholm"</span> utcoffsetMinutes=<span class="code-quote">"60"</span> /&gt;</span>
    <span class="code-tag">&lt;location altitude=<span class="code-quote">"26"</span> latitude=<span class="code-quote">"57.72432"</span> longitude=<span class="code-quote">"11.77013"</span> geobase=<span class="code-quote">"geonames"</span> geobaseid=<span class="code-quote">"2667809"</span> /&gt;</span>
  <span class="code-tag">&lt;/location&gt;</span> 
....lines removed
  <span class="code-tag">&lt;forecast&gt;</span>
    <span class="code-tag">&lt;tabular&gt;</span>
      <span class="code-tag">&lt;time from=<span class="code-quote">"2013-03-28T19:00:00"</span> to=<span class="code-quote">"2013-03-29T00:00:00"</span> period=<span class="code-quote">"3"</span>&gt;</span>
        <span class="code-tag"><span class="code-comment">&lt;!-- Valid from 2013-03-28T19:00:00 to 2013-03-29T00:00:00 --&gt;</span></span>
        <span class="code-tag">&lt;symbol number=<span class="code-quote">"3"</span> name=<span class="code-quote">"Partly cloudy"</span> var=<span class="code-quote">"mf/03n.54"</span> /&gt;</span>
        <span class="code-tag">&lt;precipitation value=<span class="code-quote">"0"</span> /&gt;</span>
        <span class="code-tag"><span class="code-comment">&lt;!-- Valid at 2013-03-28T19:00:00 --&gt;</span></span>
        <span class="code-tag">&lt;windDirection deg=<span class="code-quote">"352.2"</span> code=<span class="code-quote">"N"</span> name=<span class="code-quote">"North"</span> /&gt;</span>
        <span class="code-tag">&lt;windSpeed mps=<span class="code-quote">"3.5"</span> name=<span class="code-quote">"Gentle breeze"</span> /&gt;</span>
        <span class="code-tag">&lt;temperature unit=<span class="code-quote">"celsius"</span> value=<span class="code-quote">"1"</span> /&gt;</span>
        <span class="code-tag">&lt;pressure unit=<span class="code-quote">"hPa"</span> value=<span class="code-quote">"1019.5"</span> /&gt;</span>
      <span class="code-tag">&lt;/time&gt;</span>
      <span class="code-tag">&lt;time from=<span class="code-quote">"2013-03-29T00:00:00"</span> to=<span class="code-quote">"2013-03-29T06:00:00"</span> period=<span class="code-quote">"0"</span>&gt;</span>
        <span class="code-tag"><span class="code-comment">&lt;!-- Valid from 2013-03-29T00:00:00 to 2013-03-29T06:00:00 --&gt;</span></span>
        <span class="code-tag">&lt;symbol number=<span class="code-quote">"2"</span> name=<span class="code-quote">"Fair"</span> var=<span class="code-quote">"mf/02n.58"</span> /&gt;</span>
        <span class="code-tag">&lt;precipitation value=<span class="code-quote">"0"</span> /&gt;</span>
        <span class="code-tag"><span class="code-comment">&lt;!-- Valid at 2013-03-29T00:00:00 --&gt;</span></span>
        <span class="code-tag">&lt;windDirection deg=<span class="code-quote">"103.1"</span> code=<span class="code-quote">"ESE"</span> name=<span class="code-quote">"East-southeast"</span> /&gt;</span>
        <span class="code-tag">&lt;windSpeed mps=<span class="code-quote">"4.9"</span> name=<span class="code-quote">"Gentle breeze"</span> /&gt;</span>
        <span class="code-tag">&lt;temperature unit=<span class="code-quote">"celsius"</span> value=<span class="code-quote">"-2"</span> /&gt;</span>
        <span class="code-tag">&lt;pressure unit=<span class="code-quote">"hPa"</span> value=<span class="code-quote">"1018.5"</span> /&gt;</span>
      <span class="code-tag">&lt;/time&gt;</span>
      <span class="code-tag">&lt;time from=<span class="code-quote">"2013-03-29T00:00:00"</span> to=<span class="code-quote">"2013-03-29T06:00:00"</span> period=<span class="code-quote">"0"</span>&gt;</span>
....
</pre>
</div></div> 

<p>Afaik the Xpath to get the name off the location should be </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">//weatherdata/location/name/</span></pre>
</div></div>
<p>Can't get that to work, while I have similar example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;response&gt;</span>
	<span class="code-tag">&lt;current_observation&gt;</span>
		<span class="code-tag">&lt;wind_gust_kph&gt;</span>13.4<span class="code-tag">&lt;/wind_gust_kph&gt;</span>
		<span class="code-tag">&lt;pressure_mb&gt;</span>1011<span class="code-tag">&lt;/pressure_mb&gt;</span>
		<span class="code-tag">&lt;pressure_in&gt;</span>29.86<span class="code-tag">&lt;/pressure_in&gt;</span>
		<span class="code-tag">&lt;pressure_trend&gt;</span>0<span class="code-tag">&lt;/pressure_trend&gt;</span>	
		<span class="code-tag">&lt;/current_observation&gt;</span>
<span class="code-tag">&lt;/response&gt;</span></pre>
</div></div>
<p>That works well with XPATH</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">//response/current_observation/wind_gust_kph</span></pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 28, 2013 18:53
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859341"></a>
                                    <font class="smallfont"><p>Maybe because they have a typo in their tag name? &lt;wheatherdata&gt;</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by admin at Mar 29, 2013 04:02
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859348"></a>
                                    <font class="smallfont"><p>You got me! That was a misspelling on my side in the example as represented here. In my post I here typed the XPATH from the top of my head <img class="emoticon" src="images/icons/emoticons/sad.gif" height="20" width="20" align="absmiddle" alt="" border="0"/><br/>
Edit: I double checked with the original sources, and adapted my post above.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 29, 2013 08:12
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859358"></a>
                                    <font class="smallfont"><p><a class="confluence-thumbnail-link 388x478" href='http://www.openremote.org/download/attachments/21859317/Torslanda.png'><img src="attachments/thumbnails/21859317/22052969" align="left" border="0"/></a><br/>
I got one step further. I did copy the forecast.xml contents to the Openremote/webapps/private subdirectory of my controller:</p>

<p>Now the location information does appear on screen. So apparently the XML from the Swedish site is somehow different from the file I read through Tomcat from my private directory. (I vaguely remember having had this experience before but did not yet find a note about that in my piles)</p>

<p>I can now also read the first occurrence of windSpeed, which is held in an attribute named <b>mps</b>. Attributes are referenced via an "@", The XPATH has to be:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">//@mps</span></pre>
</div></div>

<p>I have as yet to find out how to select the n-th occurrence. (And the issue with the live XML of course)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Mar 29, 2013 11:30
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859584"></a>
                                    <font class="smallfont"><p>Sorry not to hear back from you</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Apr 04, 2013 08:15
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859585"></a>
                                    <font class="smallfont"><p>Sorry fro my lack of response PE ZANSTRA.<br/>
I has been traveling for some days now and didn´t have the oportunity to test your progress.<br/>
Thanks alot for your help I really would like to get info about the weather from this XML.</p>

<p>Do you need to copy the XML file to your harddrive to been able to read it?</p>

<p>Best Regards<br/>
Henrik</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hank at Apr 04, 2013 08:20
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859586"></a>
                                    <font class="smallfont"><p>When you use //@mps in XPATH you get the first comming windspeed?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hank at Apr 04, 2013 08:21
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859588"></a>
                                    <font class="smallfont"><p>Indeed, you do get the first occurence. I vaguely remember someone dealing with the n-th occurence last year, but I haven't been able yet to spot that.<br/>
As you can see from my previous posts I did manage to get a copy on my local server, and get it to work from there.<br/>
In getting through old threads I also found that some of the XPATH stuff did work on an older version, but not on a newer. I have not tracked if that has anything to do with your problem, or that this has been resolved in the mean time.</p>

<p>Another question I raised was what you actually want to achien with thes wheatherdata?<br/>
Pieter</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Apr 04, 2013 08:28
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21859593"></a>
                                    <font class="smallfont"><p>Hi Pieter</p>

<p>I try to create my own look a like Gira Home Server interface.<br/>
What i want to achive is to been able just to display the weather for 5-days.</p>

<p>Needed data to read:<br/>
-Temperature<br/>
-Windspeed<br/>
-Symbol number<br/>
-Name of the weather</p>

<p>/Henrik</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hank at Apr 04, 2013 08:48
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22414555"></a>
                                    <font class="smallfont"><p>I found the solution for the selection of the n-th occurence of a value. In your specific case for the wind speed try the following XPATH expression if you want the second measurement:</p>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>//weatherdata/forecast/tabular/time[2]/windSpeed/@mps</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at May 19, 2013 19:52
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22414567"></a>
                                    <font class="smallfont"><p>Great news PE ZANSTRA.<br/>
Now I can continue my work with the weather data.</p>

<p>I guess i just use:<br/>
//weatherdata/forecast/tabular/time2/temperature/@value<br/>
to get the temp for the 2nd entery?</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hank at May 20, 2013 11:38
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22414569"></a>
                                    <font class="smallfont"><p>Yes,</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">//weatherdata/forecast/tabular/time[2]/temperature/@value</span></pre>
</div></div>
<p>should work.<br/>
Please note that I still can not read it directly from the address you gave. I have to copy the xml to my machine first. May have to do with diacritical characters in the URL. I haven't looked into that any further though.</p>

<p>I am in the process of writing a small Howto for Xpath. Unfortunately I don't know yet how to make that visible for users.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at May 20, 2013 11:52
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22415005"></a>
                                    <font class="smallfont"><p>Here is the page that describes <a href="http://www.openremote.org/display/docs/OpenRemote+2.0+How+To+-+Use+XML+Data+Sources">how to deal with XPath</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at May 26, 2013 12:26
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872635"></a>
                                    <font class="smallfont"><p>Did you manage to get this working directly from the wheather URL in the meantime?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 12, 2013 23:23
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872647"></a>
                                    <font class="smallfont"><p>Dear PE ZANSTRA</p>

<p>It works perfectly for me directly from the URL, i don´t need to download the XML.<br/>
Your work has been very important to me, Thanks!</p>

<p>The only problem is that i don´t had time to work with my project lately.</p>

<p>I will let you know my progress as soon as im up and running again!</p>

<p>Best Regards<br/>
Henrik</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by hank at Jun 13, 2013 08:03
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872648"></a>
                                    <font class="smallfont"><p>Thanks for the confirmation</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 13, 2013 08:05
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:30</font></td>
		    </tr>
	    </table>
    </body>
</html>