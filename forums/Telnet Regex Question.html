<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Telnet Regex Question</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Telnet Regex Question
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Dec 07, 2011 by <font color="#0050B2">pjmm</font>.
				    </div>

				    <p>I have a device which I can send commands and receive status responses from.</p>

<p>I use Regex Filter to extract "on" or "off" for Openremote to change <br/>
my display.</p>

<p>I have tested my Regex Filter using <a href="http://www.fileformat.info/tool/regex.htm">http://www.fileformat.info/tool/regex.htm</a><br/>
and can confirm that both strings give me an "On" or "Off".</p>

<p>I cannot get the display to change using these settings.<br/>
There are no errors showing in the Controller Log.</p>

<p>The only way that I can get Openremote to change the display is to set <br/>
default read response to On<br/>
Have a Regex string which extracts "Off" from the off response and<br/>
have the Regex not give any decode  for the On response.</p>

<p>Then my display will work. <br/>
When I look at the Controller Log  I see an error when it tries to decode the On string.</p>

<p>Controller2011-11-28 19:30:41,480 INFO Thread\-6 org.openremote.controller.protocol.telnet.TelnetCommand.read(372) | Telnet Read Status: No Match using Regex</p>

<p>Is this a bug or am I doing something wrong</p>

<p>Pierce</p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19434096/19398712.jpg">Image Openremote.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19434096/19398711.jpg">Image Openremote.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19434096/19398714.jpg">TestJpg.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19434096/19398716.jpg">TestJpg.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19434096/19398715.png">TestPng.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19434096/19398713.jpg">TestJpg.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19434096/19398718.jpg">Regex.jpg</a> (image/jpeg)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-19434100"></a>
                                    <font class="smallfont"><p>Looks like the RegEx dialect of Java is different from the one you used to validate on the Internet.<br/>
You could try this one since it is actually a Java program: <a href="http://www.cis.upenn.edu/~matuszek/General/RegexTester/regex-tester.html">http://www.cis.upenn.edu/~matuszek/General/RegexTester/regex-tester.html</a></p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Dec 07, 2011 22:02
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19434246"></a>
                                    <font class="smallfont"><p>Hi Marcus </p>

<p>many thanks for your reply I have tested using your  RegEx link and I get "group(1) = "On"" ""group(1) = "Off"</p>

<p>The 2 strings I am reading are</p>

<p>0021003000380040    0ABCObjectFlag.GetOn<br/>
0021003000380040    0ABCObjectFlag.GetOff</p>

<p>The RegEx string I am using to decode is <br/>
<img src="attachments/19434096/19398718.jpg" align="absmiddle" border="0"/></p>

<p>If I use these settings I cannot get the display to change</p>

<p>Pierce</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pjmm at Dec 12, 2011 21:10
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19434720"></a>
                                    <font class="smallfont"><p>Pierce,<br/>
sorry I never followed up on this on.<br/>
Do you still see the "No Match using Regex" error in the log files?</p>

<p>I just looked at the code in TelnetCommand and it looks that the Regex extension from Richard is specific to his needs <img class="emoticon" src="images/icons/emoticons/sad.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>The code says:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
               filteredResponse.replaceAll(<span class="code-quote">"1|on"</span>, <span class="code-quote">"<span class="code-keyword">true</span>"</span>);
               <span class="code-object">Boolean</span> bool = <span class="code-object">Boolean</span>.parseBoolean(filteredResponse);
               <span class="code-keyword">if</span> (bool) {
                  readResponse = <span class="code-quote">"on"</span>;
               } <span class="code-keyword">else</span> {
                  readResponse = <span class="code-quote">"off"</span>;  
               }
</pre>
</div></div>

<p>Since you only receive "On" and "Off", this would not work.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jan 02, 2012 20:12
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19434721"></a>
                                    <font class="smallfont"><p>Hi Marcus</p>

<p>in the Telnet Tutorial it says</p>

<p>For a switch sensor to work correctly a boolean "on" or "off" responds is required. </p>

<p>Using Regex he extracts Groupe(1) On from his responce </p>

<p>Does the Code match the Tutorial?</p>

<p>Can the code be changed?</p>

<p>Pierce</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pjmm at Jan 02, 2012 20:51
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19434722"></a>
                                    <font class="smallfont"><p>In my opinion the code does not match the tutorial.<br/>
I will double check with Juha.<br/>
If needed, we can change the code.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jan 02, 2012 21:30
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19434723"></a>
                                    <font class="smallfont"><p>Hi Marcus </p>

<p>many thanks for looking at this Let me knoe if and when you can change the code</p>

<p>Pierce</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pjmm at Jan 02, 2012 22:11
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19434728"></a>
                                    <font class="smallfont"><p>The replaceAll uses either "1" or "on" to evaluate to true which then returns "on".<br/>
Your telnet result returns "On" which is the reason why it does not work.<br/>
Is it possible for you to have your device return "on" with small letters?</p>

<p>I will also change the code to evaluate "1", "on", "On", "ON" as true.<br/>
Which should then return "on" as a result of the command.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jan 03, 2012 12:36
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19434739"></a>
                                    <font class="smallfont"><p>I just created a snapshot of the latest controller code where I did some fixes for the telnet regex stuff.<br/>
You can try this version: www.redeker-consulting.de/openremote/OpenRemote-Controller-2.0.0_SNAPSHOT_20120103.zip</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jan 03, 2012 22:19
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19434756"></a>
                                    <font class="smallfont"><p>Hi Marcus</p>

<p>I have tested your version and can confirm it now works as it should</p>

<p>I tested using ON On on  and OFF Off off and all now work correctly.</p>

<p>Please let me know when this makes it into the general release</p>

<p>Many thanks</p>

<p>Pierce</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pjmm at Jan 04, 2012 22:12
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19434757"></a>
                                    <font class="smallfont"><p>Great to hear.<br/>
The snapshot is based on what will come <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/><br/>
Juha had some minor issues but the 2.0 release should be coming pretty soon.</p>

<p>We are currently removing some bugs from the designer because the 2.0 designer should be released the same time.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jan 04, 2012 22:17
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19434758"></a>
                                    <font class="smallfont"><p>I too tested the snapshot and I now have OpenRemote nicely interacting with Misterhouse. Woohoo! I'm stoked.</p>

<p>I'll do up a little tutorial once I've added a bunch more switches and things. Just to be sure there's no other gotchas.</p>

<p>Nice work guys. Thanks so much.</p>

<p>Garry</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by doucga at Jan 05, 2012 02:34
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19434788"></a>
                                    <font class="smallfont"><p>Hi Marcus</p>

<p>I've noticed since yesterday that the status of my switch will suddenly stop working. The error in the log is:</p>

<p>INFO: Found: <span class="error">&#91;device =&gt; c1cd86edd8abae1471a32888d0b3172c693cf668, sensorIDs =&gt; 1321&#93;</span> in ChangedStatus table.<br/>
5-Jan-2012 10:23:03 PM org.openremote.controller.utils.Logger info<br/>
INFO: DEVICEID:c1cd86edd8abae1471a32888d0b3172c693cf668 sensorID:1321statusChangedSensorID:[]Waiting...<br/>
Controller 2012-01-05 22:23:08,866 ERROR Polling Sensor Thread ID = 1321, Name ='UnderDeckSENSOR' org.openremote.controller.protocol.telnet.TelnetCommand.read(375) | Telnet Read Status: No Match using Regex: '^(?i)(?s)(?m).<b>state\s+(\w+).</b>$' on response from command 'null|status Under_Deck'<br/>
Exception in thread "Polling Sensor Thread ID = 1321, Name ='UnderDeckSENSOR'" java.lang.NullPointerException<br/>
        at org.openremote.controller.model.sensor.Sensor.isUnknownSensorValue(Sensor.java:161)<br/>
        at org.openremote.controller.model.sensor.StateSensor.processEvent(StateSensor.java:231)<br/>
        at org.openremote.controller.model.sensor.Sensor.update(Sensor.java:338)<br/>
        at org.openremote.controller.model.sensor.Sensor$DeviceReader.run(Sensor.java:608)<br/>
        at java.lang.Thread.run(Thread.java:662)<br/>
5-Jan-2012 10:23:34 PM org.openremote.controller.utils.Logger info<br/>
INFO: Querying changed state from ChangedStatus table...<br/>
5-Jan-2012 10:23:34 PM org.openremote.controller.utils.Logger info</p>

<p>After that, there's no more response. It looks like something is crashing when there's no match for the regex filter. </p>

<p>If I restart the controller and reload the console everything starts working again. It's happened twice in the last 24 hours.</p>

<p>Let me know if there's anything else I can test for you.</p>

<p>Regards,</p>

<p>Garry</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by doucga at Jan 06, 2012 19:52
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19434790"></a>
                                    <font class="smallfont"><p>Garry,</p>

<p>You have to define a "statusDefault" attribute which is returned in case the Regex expression finds no match.<br/>
If you don't have that "null" is returned which causes your problem. <br/>
You could either use "off" as a default or something like "N/A" or just "".</p>

<p>Please try and let me know.</p>

<p>--Marcus</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jan 06, 2012 21:11
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19434791"></a>
                                    <font class="smallfont"><p>That's easy.</p>

<p>Thanks Marcus</p>

<p>Garry</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by doucga at Jan 06, 2012 21:53
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-20451919"></a>
                                    <font class="smallfont"><p>Marcus,</p>

<p>is there any way I could get hold of the controller code, in which you fixed the telnet regex stuff? As in Garry's case my target device responds "ON" and "OFF" rather than "on" and "off".</p>

<p>Many thanks,</p>

<p>Othmar</p>

<p>P.S. The link to the file you provided in your post does not work anymore.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by othmark at Oct 14, 2012 14:51
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-20451959"></a>
                                    <font class="smallfont"><p>Try the 2.1 developer snapshot from sourceforge. That should already include it.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Oct 14, 2012 17:29
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-20452188"></a>
                                    <font class="smallfont"><p>Thanks a lot for the tip. I downloaded and installed 2.1 as recommended.<br/>
In the meantime I found an additional limitation of the Telnet implementation. I am controlling a Denon AVR3313 using Telnet. Since I still had problems getting regular expression matches I built a custom sensor to see what my sensor actually receives and in parallel monitored with Wireshark what the Denon unit actually sent. It turns out that in longer responses the Telnet application misses the first packet. So instead of</p>

<p>Z2OFF\rZ2IRadio\rZ228\rSVSOURCE </p>

<p>which is actually being sent (inside three Telnet packets) the sensor only sees </p>

<p>rZ2IRadio\rZ228\rSVSOURCE</p>

<p>In addition the continuous polling of the sensors leads to larger numbers of Telnet collisions, which makes the display of the sensor information unstable. </p>

<p>A nice extension could be if one could configure the sensor polling interval to one-time. One could then do a macro sending a command with a one-time-sensor-request afterwards. This would minimize polling and telnet sessions overall and in addition would avoid Telnet collisions, since sensor polls would only always occur right after a command.</p>

<p>Many thanks,</p>

<p>Othmar</p>

</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by othmark at Oct 16, 2012 01:40
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-20452191"></a>
                                    <font class="smallfont"><p>Othmar, thank you for digging into this! It seems we're dealing with very similar challenges.</p>

<p>I also am struggling to get a Marantz AV7005 working with Telnet status sensors for power and volume, and despite all regexp validators that showed the filters should be correct, the sensors both time out most of the time (I suspect the Marantz only allows a single connection at once), and give an error about no matching data found.</p>

<p>Also the handy power status messages from the Marantz are "PWRON" and "PWRSTANDBY" for its two states. I guess it would still work to set OFF manually as statusDefault (haven't yet managed to test this since the power-on status filter isn't working).</p>

<p>It might add a lot more compatibility if instead of expecting the device to output "on" and "off" strings, the Telnet command setup in Designer allowed us to map arbitrary output strings to sensor states.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by frand at Oct 16, 2012 06:23
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-21860087"></a>
                                    <font class="smallfont"><p>Re: Marantz &#8211; think Eric has a dedicated protocol for Marantz coming up (and may be already available in the Pro version). To be followed up.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Apr 11, 2013 06:15
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 10:45</font></td>
		    </tr>
	    </table>
    </body>
</html>