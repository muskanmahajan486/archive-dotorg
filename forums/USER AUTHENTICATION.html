<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : USER AUTHENTICATION</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : USER AUTHENTICATION
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jun 17, 2011 by <font color="#0050B2">marimon</font>.
				    </div>

				    <p>Congratulations, I am surprised with Openremote.<br/>
I am a vocational teacher, and I am wondering to teach Openremote to our students.<br/>
I would like to know something else about two topics:</p>
<ul class="alternate" type="square">
	<li>It's possible any king of user authentication?</li>
	<li>In UI designer when you put a button, I've seen a navigation action LOGIN and LOGOUT. What those it means? What user/password can I use?<br/>
Thanks.</li>
</ul>


				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-17039616"></a>
                                    <font class="smallfont"><p>Yes, authentication is supported through the web container.<br/>
It uses the standard mechanism defined by the servlet API and can be configured in the web.xml file and in your container (e.g. tomcat)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ebariaux at Jun 23, 2011 16:47
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-17039655"></a>
                                    <font class="smallfont"><p>Thanks for your answer.<br/>
I've been looking for information but I don't understand very well how to do it.<br/>
May you tell me some places to look for how to edit web.xml to use authentication?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by marimon at Jun 26, 2011 11:49
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-17956935"></a>
                                    <font class="smallfont"><p>Look toward the end of web.xml, where you should several several commented out &lt;security-constraint&gt; elements.   Uncomment them.  In the simplest case, you can just edit tomcat-users.xml in the Tomcat conf directory to add users with passwords, which will need to have the "openremote" role.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by cortextual at Jul 01, 2011 18:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-17956975"></a>
                                    <font class="smallfont"><p>Thanks, I did what you said and I got what I need. <br/>
If somebody needs a sample of configuration changes I can show it.<br/>
Thanks.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by marimon at Jul 04, 2011 09:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-17956983"></a>
                                    <font class="smallfont"><p>Sample configuration and documentation is most welcome.</p>

<p>Can post it here or create a separate wiki page to explain it.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by admin at Jul 05, 2011 10:59
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-17956984"></a>
                                    <font class="smallfont"><p>Sample configuration:<br/>
CONFIGURATION CHANGES TO USE USERS AND PASSWORDS.</p>

<p>1. Uncomment "SECURITY CONFIGURATION" at the end of the file web.xml (...\webapps\controller\WEB-INF&#41;:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml">

  <span class="code-tag">&lt;security-constraint&gt;</span>
      <span class="code-tag">&lt;web-resource-collection&gt;</span>
        <span class="code-tag">&lt;web-resource-name&gt;</span>Control command RESTful service of Openremote Controller<span class="code-tag">&lt;/web-resource-name&gt;</span>
        <span class="code-tag">&lt;description&gt;</span>Control command RESTful service of Openremote Controller<span class="code-tag">&lt;/description&gt;</span>
        <span class="code-tag">&lt;url-pattern&gt;</span>/rest/control/*<span class="code-tag">&lt;/url-pattern&gt;</span>
        <span class="code-tag">&lt;http-method&gt;</span>GET<span class="code-tag">&lt;/http-method&gt;</span>
        <span class="code-tag">&lt;http-method&gt;</span>POST<span class="code-tag">&lt;/http-method&gt;</span>
      <span class="code-tag">&lt;/web-resource-collection&gt;</span>
      <span class="code-tag">&lt;auth-constraint&gt;</span>
        <span class="code-tag">&lt;role-name&gt;</span>openremote<span class="code-tag">&lt;/role-name&gt;</span>
      <span class="code-tag">&lt;/auth-constraint&gt;</span>
    <span class="code-tag">&lt;/security-constraint&gt;</span>
  

  <span class="code-tag"><span class="code-comment">&lt;!-- Constraint resource: /rest/panel/* --&gt;</span></span>
  
    <span class="code-tag">&lt;security-constraint&gt;</span>
      <span class="code-tag">&lt;web-resource-collection&gt;</span>
        <span class="code-tag">&lt;web-resource-name&gt;</span>Panel identity RESTful service of Openremote Controller<span class="code-tag">&lt;/web-resource-name&gt;</span>
        <span class="code-tag">&lt;description&gt;</span>Panel identity RESTful service of Openremote Controller<span class="code-tag">&lt;/description&gt;</span>
        <span class="code-tag">&lt;url-pattern&gt;</span>/rest/panel/*<span class="code-tag">&lt;/url-pattern&gt;</span>
        <span class="code-tag">&lt;http-method&gt;</span>GET<span class="code-tag">&lt;/http-method&gt;</span>
        <span class="code-tag">&lt;http-method&gt;</span>POST<span class="code-tag">&lt;/http-method&gt;</span>
      <span class="code-tag">&lt;/web-resource-collection&gt;</span>
      <span class="code-tag">&lt;auth-constraint&gt;</span>
        <span class="code-tag">&lt;role-name&gt;</span>openremote<span class="code-tag">&lt;/role-name&gt;</span>
      <span class="code-tag">&lt;/auth-constraint&gt;</span>
    <span class="code-tag">&lt;/security-constraint&gt;</span>
  

  
   <span class="code-tag">&lt;security-constraint&gt;</span>
     <span class="code-tag">&lt;web-resource-collection&gt;</span>
       <span class="code-tag">&lt;web-resource-name&gt;</span>Status command RESTful service of Openremote Controller<span class="code-tag">&lt;/web-resource-name&gt;</span>
       <span class="code-tag">&lt;description&gt;</span>Status command RESTful service of Openremote Controller<span class="code-tag">&lt;/description&gt;</span>
       <span class="code-tag">&lt;url-pattern&gt;</span>/rest/status/*<span class="code-tag">&lt;/url-pattern&gt;</span>
       <span class="code-tag">&lt;http-method&gt;</span>GET<span class="code-tag">&lt;/http-method&gt;</span>
       <span class="code-tag">&lt;http-method&gt;</span>POST<span class="code-tag">&lt;/http-method&gt;</span>
     <span class="code-tag">&lt;/web-resource-collection&gt;</span>
     <span class="code-tag">&lt;auth-constraint&gt;</span>
       <span class="code-tag">&lt;role-name&gt;</span>openremote<span class="code-tag">&lt;/role-name&gt;</span>
     <span class="code-tag">&lt;/auth-constraint&gt;</span>
   <span class="code-tag">&lt;/security-constraint&gt;</span>
   <span class="code-tag">&lt;security-constraint&gt;</span>
     <span class="code-tag">&lt;web-resource-collection&gt;</span>
       <span class="code-tag">&lt;web-resource-name&gt;</span>Polling command RESTful service of Openremote Controller<span class="code-tag">&lt;/web-resource-name&gt;</span>
       <span class="code-tag">&lt;description&gt;</span>Polling command RESTful service of Openremote Controller<span class="code-tag">&lt;/description&gt;</span>
       <span class="code-tag">&lt;url-pattern&gt;</span>/rest/polling/*<span class="code-tag">&lt;/url-pattern&gt;</span>
       <span class="code-tag">&lt;http-method&gt;</span>GET<span class="code-tag">&lt;/http-method&gt;</span>
       <span class="code-tag">&lt;http-method&gt;</span>POST<span class="code-tag">&lt;/http-method&gt;</span>
     <span class="code-tag">&lt;/web-resource-collection&gt;</span>
     <span class="code-tag">&lt;auth-constraint&gt;</span>
       <span class="code-tag">&lt;role-name&gt;</span>openremote<span class="code-tag">&lt;/role-name&gt;</span>
     <span class="code-tag">&lt;/auth-constraint&gt;</span>
   <span class="code-tag">&lt;/security-constraint&gt;</span>
  

  
    <span class="code-tag">&lt;login-config&gt;</span>
      <span class="code-tag">&lt;auth-method&gt;</span>BASIC<span class="code-tag">&lt;/auth-method&gt;</span>
      <span class="code-tag">&lt;realm-name&gt;</span>OPENREMOTE_Controller<span class="code-tag">&lt;/realm-name&gt;</span>
    <span class="code-tag">&lt;/login-config&gt;</span>
    <span class="code-tag">&lt;security-role&gt;</span>
      <span class="code-tag">&lt;role-name&gt;</span>openremote<span class="code-tag">&lt;/role-name&gt;</span>
    <span class="code-tag">&lt;/security-role&gt;</span>

</pre>
</div></div>


<p>2. Edit users.xml file (...\security&#41;:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml">

<span class="code-tag">&lt;tomcat-users&gt;</span>
  <span class="code-tag">&lt;role rolename=<span class="code-quote">"openremote"</span>/&gt;</span>
  <span class="code-tag">&lt;user username=<span class="code-quote">"openremote"</span> password=<span class="code-quote">"Tomcat"</span> roles=<span class="code-quote">"openremote"</span>/&gt;</span>
<span class="code-tag">&lt;/tomcat-users&gt;</span>

</pre>
</div></div>



<p>You can create diferent users, with their own password and assign the role: openremote.</p>

<p>This way use plain text passwords, but I know that there are others ways to encode passwords (digesting user passwords (SHA, MD2 or MD5)). I am going to try but now I do not know how to do.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by marimon at Jul 05, 2011 12:43
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-17956990"></a>
                                    <font class="smallfont"><p>Thanks.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by admin at Jul 06, 2011 08:47
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19435997"></a>
                                    <font class="smallfont"><p>Hi Jordi,</p>

<p>I tried the settings you mention and it works, but it requests a password to the user to access the server anyway.</p>

<p>Could you explain in which cases you use this configuration? How the Login option at Navigation is used? </p>

<p>I'm trying to prompt the user a password to access a particular screen, ie a security screen where you can activate the alarm, close valves, etc.., but for the rest not.</p>

<p>Any suggestions?</p>

<p>Thanx!</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aamo at Feb 13, 2012 08:24
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19436286"></a>
                                    <font class="smallfont"><p>There is currently no way to limit access to a particular screen, only to a particular panel.<br/>
Once the UI is defined, you should "replicate" the UI from one panel to the other and remove the screen that should be protected.</p>

<p>There are ways to make this replication much easier than I would seem.<br/>
Unfortunately, I've discovered that a few bugs in the modeler make those difficult / impossible for now.<br/>
As soon as a new version of the modeler is online with fixes to those, I'll post back here and explain a bit more how this works.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ebariaux at Feb 15, 2012 12:10
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19989123"></a>
                                    <font class="smallfont"><p>Hi Eric,</p>

<p>I have one question. How to specify particular password for particular panel?</p>


<p>Thanks for the help.</p>

<p>Regards,<br/>
Nejc</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nejc at Jun 07, 2012 10:25
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-19989143"></a>
                                    <font class="smallfont"><p>What you can do is have 2 different users, assign a specific role to each user and protect each panel access with a different role.</p>

<p>Protect the panels like this</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;Panel identity RESTful service of Openremote Controller&lt;/web-resource-name&gt;
&lt;description&gt;Panel identity RESTful service of Openremote Controller&lt;/description&gt;
&lt;url-pattern&gt;/<span class="code-keyword">rest</span>/panel/panel1&lt;/url-pattern&gt;
&lt;http-method&gt;GET&lt;/http-method&gt;
&lt;http-method&gt;POST&lt;/http-method&gt;
&lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;role-name&gt;panel1role&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;/security-constraint&gt;

&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;Panel identity RESTful service of Openremote Controller&lt;/web-resource-name&gt;
&lt;description&gt;Panel identity RESTful service of Openremote Controller&lt;/description&gt;
&lt;url-pattern&gt;/<span class="code-keyword">rest</span>/panel/panel2&lt;/url-pattern&gt;
&lt;http-method&gt;GET&lt;/http-method&gt;
&lt;http-method&gt;POST&lt;/http-method&gt;
&lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;role-name&gt;panel2role&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;/security-constraint&gt;
</pre>
</div></div>

<p>Define the 2 roles</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
&lt;login-config&gt;
&lt;auth-method&gt;BASIC&lt;/auth-method&gt;
&lt;realm-name&gt;OPENREMOTE_Controller&lt;/realm-name&gt;
&lt;/login-config&gt;
&lt;security-role&gt;
&lt;role-name&gt;panel1role&lt;/role-name&gt;
&lt;role-name&gt;panel2role&lt;/role-name&gt;
&lt;/security-role&gt;
</pre>
</div></div>

<p>Then in the tomcat users definition, create user1 with panel1role and user2 with panel2role.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ebariaux at Jun 08, 2012 09:25
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-20451087"></a>
                                    <font class="smallfont"><p>Eric, thanks for your explanation of Panel identity part in Security Configuration.</p>

<p>Now I would like to find out a bit more about Control, Status and Polling command part. In which case they can be used?</p>

<p>Thanks again for your explanation.</p>


<p>Regards,<br/>
Nejc</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by nejc at Sep 27, 2012 11:24
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22415168"></a>
                                    <font class="smallfont"><p>Hello,</p>

<p>I use open remote to control a chacon devices with my raspberry for that I develop my protocol with a 433 Mhz transmitter.</p>

<p>I installed on my raspberry applications:<br/>
-Controller<br/>
-WebConsole (to use the application when I do not go through a smartphone)<br/>
-Designer (to add the xml file protocol HomeEasy)<br/>
-Beehive (to synchronize Designer with Controller)</p>

<p>All applications work fine, I created my user with the Designer, I enabled the mail...</p>

<p>The only problem is authentication on the controller, it does not know the database defined in the Designer and Beehive. Authentication is done with tags defined in the web.xml (login-config, etc ...)</p>

<p>But now that it passes through the tomcat-users.xml file.</p>

<p>Someone there is an implementation of "org.apache.catalina.Realm" to connect with the login password defined in the Designer?</p>

<p>If this is not the case, I start <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>Thanks</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by marco93 at May 29, 2013 10:05
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22415169"></a>
                                    <font class="smallfont"><p>Tomcat Realm and Designer authentication are not connected. The Tomcat realm is used for authenticating between the panel and controller (HTTP request authentication). The authentication between controller and designer is done by entering your usename/password on the controller home page <a href="http://localhost:8080/controller">http://localhost:8080/controller</a></p>

<p>HTH</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at May 29, 2013 10:19
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22415170"></a>
                                    <font class="smallfont"><p>yes, I think I explained wrong, my English is bad <img class="emoticon" src="images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>


<p>I would use the login and password recorded in the designer to use between the panel and the controller.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by marco93 at May 29, 2013 10:27
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22415172"></a>
                                    <font class="smallfont"><p>use Designer authentication with http resquest authentication for web service rest</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by marco93 at May 29, 2013 10:56
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22415179"></a>
                                    <font class="smallfont"><p>The REST security configuration is explained in this thread: <a href="controller2.0.1 user name password set up.html" title="controller2.0.1 user name password set up">controller2.0.1 user name password set up</a></p>

<p>You will need to set up the /security/user.xml as such:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml">

<span class="code-tag">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="code-tag">&lt;tomcat-users&gt;</span>
  <span class="code-tag">&lt;role rolename=<span class="code-quote">"openremote"</span>/&gt;</span>
  <span class="code-tag">&lt;user username=<span class="code-quote">"test"</span> password=<span class="code-quote">"tomcat"</span> roles=<span class="code-quote">"openremote"</span>/&gt;</span>
<span class="code-tag">&lt;/tomcat-users&gt;</span>

</pre>
</div></div>

<p>HTH</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at May 29, 2013 12:21
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22415182"></a>
                                    <font class="smallfont"><p>Yes it's work fine to add tomcat users, it's work fine</p>

<p>It is necessary to add this information to a file.</p>

<p>What I want install the applications on the raspberry.</p>

<p>After, it isn't me to using the application, but a user.</p>

<p>And even when it is easier for the user to register the designer and use the same account for web services.</p>

<p>User has no computer knowledge.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by marco93 at May 29, 2013 12:32
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22415183"></a>
                                    <font class="smallfont"><p>I suppose you could add a small tool or web script in your RPi that generates/modifies this file.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at May 29, 2013 12:36
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22415184"></a>
                                    <font class="smallfont"><p>yes, it's a solution or implement "org.apache.catalina.Realm" to call a service controller to call database information.</p>

<p>I think both solutions to see what suits me best.</p>

<p>If you are interested, I can make a return.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by marco93 at May 29, 2013 12:46
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22415186"></a>
                                    <font class="smallfont"><p>Yes, do let us know what you find and how you decided to solve it.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at May 29, 2013 13:21
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872507"></a>
                                    <font class="smallfont"><p>I realized an implementation that allows for an authenticated without informing the "tomcat-users.xml" file connection.<br/>
The proposed solution is useful in some cases but not all:<br/>
• Interesting to not fill in the login and password in the tomcat-users file<br/>
• Interesting when a designer and beehive applications installed on its own domain and we do not use the external application <a href="https://composer.openremote.org/demo">https://composer.openremote.org/demo</a></p>


<p>Operation to the connection to the controller, the implementation of authentication Realm will perform a http call on the beehive application using the login and password provided by the user if the beehive application returns an HTTP code 200, this means that the user exists and then opens the connection.</p>

<p>Small precision:<br/>
• The url used is that used by beehive to retrieve the file openremote.zip<br/>
• If the connection is successful, the login and password is specified in a map, it can not make another http call. (Of course it is stored in memory and this information is lost every time to shutdown tomcat)</p>



<p>How to use:<br/>
• Put a context.xml file in the application controller:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;Context&gt;
	&lt;Realm className=<span class="code-quote">"fr.ms.raspberry.openremote.controller.catalina.realm.ControllerAuthRealm"</span>/&gt;
&lt;/Context&gt;
</pre>
</div></div>

<p>• Place the jar containing the implementation in the "catalina.home\lib" or "catalina.base\lib" directory (if your tomcat specifies the directory in the file catalina.properties)</p>

<p>That's it.</p>

<p>The URL used to communicate with the rest service beehive is: <a href="http://localhost:8080/beehive/rest/">http://localhost:8080/beehive/rest/</a><br/>
If you want to change you can add in the context.xml file</p>


<p>Example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;Context&gt;
	&lt;Realm className=<span class="code-quote">"fr.ms.raspberry.openremote.controller.catalina.realm.ControllerAuthRealm"</span> urlRestBeehive=<span class="code-quote">""http:<span class="code-comment">//localhost:8080/beehive/<span class="code-keyword">rest</span>/<span class="code-keyword">super</span>/"</span>/&gt;
</span>&lt;/Context&gt;
</pre>
</div></div>



<p>Here is the url of the jar: <a href="http://dl.free.fr/mpexKysc3">http://dl.free.fr/mpexKysc3</a><br/>
PS: This is an implementation made a few minutes, it is not very complicated, if you are in case you do not have an instance of the application "designer" and "beehive", this solution isn't appropriate because it would open access to your controller to anyone who has an account on Designer "https://composer.openremote.org/demo." The solution would be interesting is to inquire into the Realm implementation, the user at the time of synchronization between the beehive and the controller. As only the user has synchronized the controller can connect to the service rest of the application.</p>

<p>Here's the implementation:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">package</span> fr.ms.raspberry.openremote.controller.catalina.realm;

<span class="code-keyword">import</span> java.net.ConnectException;
<span class="code-keyword">import</span> java.net.HttpURLConnection;
<span class="code-keyword">import</span> java.net.URI;
<span class="code-keyword">import</span> java.net.URL;
<span class="code-keyword">import</span> java.net.URLConnection;
<span class="code-keyword">import</span> java.security.MessageDigest;
<span class="code-keyword">import</span> java.security.Principal;
<span class="code-keyword">import</span> java.util.ArrayList;
<span class="code-keyword">import</span> java.util.Collections;
<span class="code-keyword">import</span> java.util.HashMap;
<span class="code-keyword">import</span> java.util.List;
<span class="code-keyword">import</span> java.util.Map;

<span class="code-keyword">import</span> org.apache.catalina.realm.GenericPrincipal;
<span class="code-keyword">import</span> org.apache.catalina.realm.RealmBase;
<span class="code-keyword">import</span> org.apache.catalina.util.Base64;
<span class="code-keyword">import</span> org.apache.juli.logging.Log;
<span class="code-keyword">import</span> org.apache.juli.logging.LogFactory;

<span class="code-keyword">public</span> class ControllerAuthRealm <span class="code-keyword">extends</span> RealmBase
{

    <span class="code-keyword">private</span> <span class="code-keyword">static</span> Log log = LogFactory.getLog(ControllerAuthRealm.class);

    <span class="code-keyword">private</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">String</span> NAME = <span class="code-quote">"ControllerAuthRealm"</span>;

    <span class="code-keyword">private</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">String</span> ROLE = <span class="code-quote">"openremote"</span>;

    <span class="code-keyword">private</span> <span class="code-keyword">final</span> Map&lt;<span class="code-object">String</span>, Principal&gt; principals = Collections
            .synchronizedMap(<span class="code-keyword">new</span> HashMap&lt;<span class="code-object">String</span>, Principal&gt;());

    <span class="code-keyword">private</span> <span class="code-object">String</span> urlRestBeehive = <span class="code-quote">"http:<span class="code-comment">//localhost:8080/beehive/<span class="code-keyword">rest</span>/"</span>;
</span>
    @Override
    <span class="code-keyword">protected</span> <span class="code-object">String</span> getName()
    {
        <span class="code-keyword">return</span> NAME;
    }

    @Override
    <span class="code-keyword">protected</span> <span class="code-object">String</span> getPassword(<span class="code-object">String</span> username)
    {
        username = username.trim();

        <span class="code-keyword">final</span> GenericPrincipal principal = (GenericPrincipal) principals
                .get(username);

        <span class="code-keyword">if</span> (principal != <span class="code-keyword">null</span>)
        {
            <span class="code-keyword">return</span> principal.getPassword();
        }
        <span class="code-keyword">else</span>
        {
            <span class="code-keyword">return</span> <span class="code-keyword">null</span>;
        }
    }

    @Override
    <span class="code-keyword">protected</span> Principal getPrincipal(<span class="code-object">String</span> username)
    {
        username = username.trim();

        <span class="code-keyword">return</span> principals.get(username);
    }

    @Override
    <span class="code-keyword">public</span> Principal authenticate(<span class="code-object">String</span> username, <span class="code-object">String</span> credentials)
    {
        username = username.trim();
        credentials = credentials.trim();

        Principal principal = getPrincipal(username);

        <span class="code-keyword">if</span> (principal == <span class="code-keyword">null</span>)
        {
            <span class="code-keyword">synchronized</span> (<span class="code-keyword">this</span>) {
                principal = getPrincipal(username);
                <span class="code-keyword">if</span> (principal == <span class="code-keyword">null</span>)
                {
                    principal = checkUser(username, credentials);
                    <span class="code-keyword">if</span> (principal != <span class="code-keyword">null</span>)
                    {
                        log.info(<span class="code-quote">"Ajout d'un nouvel utilisateur : "</span> + username);
                        principals.put(username, principal);
                    }
                }
            }
        }
        <span class="code-keyword">return</span> principal;
    }

    <span class="code-keyword">public</span> <span class="code-keyword">final</span> <span class="code-keyword">static</span> <span class="code-object">String</span> HTTP_AUTHORIZATION_HEADER = <span class="code-quote">"Authorization"</span>;

    <span class="code-keyword">public</span> <span class="code-keyword">final</span> <span class="code-keyword">static</span> <span class="code-object">String</span> HTTP_BASIC_AUTHORIZATION = <span class="code-quote">"Basic "</span>;

    <span class="code-keyword">private</span> <span class="code-keyword">final</span> <span class="code-keyword">static</span> <span class="code-object">String</span> BEEHIVE_REST_USER_DIR = <span class="code-quote">"user"</span>;

    <span class="code-keyword">private</span> <span class="code-keyword">final</span> <span class="code-keyword">static</span> <span class="code-object">String</span> BEEHIVE_REST_OPENREMOTE_ZIP = <span class="code-quote">"openremote.zip"</span>;

    <span class="code-keyword">private</span> Principal checkUser(<span class="code-keyword">final</span> <span class="code-object">String</span> username, <span class="code-keyword">final</span> <span class="code-object">String</span> password)
    {
        log.info(<span class="code-quote">"username : "</span> + username + <span class="code-quote">" - password : "</span> + password);
        <span class="code-keyword">if</span> (username.length() == 0 || password.length() == 0)
        {
            <span class="code-keyword">return</span> <span class="code-keyword">null</span>;
        }

        <span class="code-keyword">try</span>
        {
            <span class="code-keyword">final</span> <span class="code-object">String</span> httpURI = BEEHIVE_REST_USER_DIR + <span class="code-quote">"/"</span> + username + <span class="code-quote">"/"</span>
                    + BEEHIVE_REST_OPENREMOTE_ZIP;

            <span class="code-keyword">final</span> URL beehiveBaseURL = <span class="code-keyword">new</span> URL(urlRestBeehive);
            <span class="code-keyword">final</span> URI beehiveUserURI = beehiveBaseURL.toURI().resolve(httpURI);

            log.info(<span class="code-quote">"url : "</span> + beehiveUserURI);
            <span class="code-keyword">final</span> URLConnection connection = beehiveUserURI.toURL()
                    .openConnection();

            <span class="code-keyword">if</span> (!(connection <span class="code-keyword">instanceof</span> HttpURLConnection))
            {
                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> ConnectException(<span class="code-quote">"The ''"</span> + BEEHIVE_REST_USER_DIR
                        + <span class="code-quote">"'' property ''"</span> + urlRestBeehive
                        + <span class="code-quote">"'' must be a URL with http:<span class="code-comment">// schema."</span>);
</span>            }

            <span class="code-keyword">final</span> HttpURLConnection http = (HttpURLConnection) connection;

            http.setDoInput(<span class="code-keyword">true</span>);
            http.setRequestMethod(<span class="code-quote">"GET"</span>);

            <span class="code-keyword">final</span> <span class="code-object">String</span> encodePassword = encode(username, password);
            <span class="code-keyword">final</span> <span class="code-object">String</span> authString = username + <span class="code-quote">":"</span> + encodePassword;
            <span class="code-keyword">final</span> <span class="code-object">byte</span>[] authEncBytes = Base64.encode(authString.getBytes());

            <span class="code-keyword">final</span> <span class="code-object">String</span> basicAuthn = <span class="code-keyword">new</span> <span class="code-object">String</span>(authEncBytes);
            http.addRequestProperty(HTTP_AUTHORIZATION_HEADER,
                    HTTP_BASIC_AUTHORIZATION + basicAuthn);

            http.connect();

            <span class="code-keyword">final</span> <span class="code-object">int</span> response = http.getResponseCode();

            log.info(<span class="code-quote">"Http Code Beehive : "</span> + response);

            <span class="code-keyword">switch</span> (response)
            {
            <span class="code-keyword">case</span> HttpURLConnection.HTTP_OK:
                <span class="code-keyword">final</span> List&lt;<span class="code-object">String</span>&gt; roles = <span class="code-keyword">new</span> ArrayList&lt;<span class="code-object">String</span>&gt;();
                roles.add(ROLE);
                <span class="code-keyword">final</span> GenericPrincipal principal = <span class="code-keyword">new</span> GenericPrincipal(
                        <span class="code-keyword">this</span>, username, password, roles);
                <span class="code-keyword">return</span> principal;
            }

            <span class="code-keyword">return</span> <span class="code-keyword">null</span>;
        } <span class="code-keyword">catch</span> (<span class="code-keyword">final</span> Exception e)
        {
            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> RuntimeException(e);
        }
    }

    <span class="code-keyword">private</span> <span class="code-keyword">static</span> <span class="code-object">String</span> encode(<span class="code-keyword">final</span> <span class="code-object">String</span> username, <span class="code-keyword">final</span> <span class="code-object">String</span> password)
    {
        <span class="code-keyword">final</span> <span class="code-object">String</span> concat = password + <span class="code-quote">"{"</span> + username + <span class="code-quote">"}"</span>;
        <span class="code-keyword">final</span> <span class="code-object">String</span> md5Hex = MD5Hex(concat);
        <span class="code-keyword">return</span> md5Hex;
    }

    <span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-object">String</span> MD5Hex(<span class="code-keyword">final</span> <span class="code-object">String</span> s)
    {
        <span class="code-object">String</span> result = <span class="code-keyword">null</span>;
        <span class="code-keyword">try</span>
        {
            <span class="code-keyword">final</span> MessageDigest md5 = MessageDigest.getInstance(<span class="code-quote">"MD5"</span>);
            <span class="code-keyword">final</span> <span class="code-object">byte</span>[] digest = md5.digest(s.getBytes(<span class="code-quote">"UTF-8"</span>));
            result = toHex(digest);
        } <span class="code-keyword">catch</span> (<span class="code-keyword">final</span> Exception e)
        {
            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> RuntimeException(e);
        }
        <span class="code-keyword">return</span> result;
    }

    <span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-object">String</span> toHex(<span class="code-keyword">final</span> <span class="code-object">byte</span>[] a)
    {
        <span class="code-keyword">final</span> StringBuilder sb = <span class="code-keyword">new</span> StringBuilder(a.length * 2);
        <span class="code-keyword">for</span> (<span class="code-keyword">final</span> <span class="code-object">byte</span> element : a)
        {
            sb.append(<span class="code-object">Character</span>.forDigit((element &amp; 0xf0) &gt;&gt; 4, 16));
            sb.append(<span class="code-object">Character</span>.forDigit(element &amp; 0x0f, 16));
        }
        <span class="code-keyword">return</span> sb.toString();
    }

    <span class="code-keyword">public</span> void setUrlRestBeehive(<span class="code-keyword">final</span> <span class="code-object">String</span> urlRestBeehive) {
        <span class="code-keyword">this</span>.urlRestBeehive = urlRestBeehive;
    }
}
</pre>
</div></div></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by marco93 at Jun 10, 2013 13:51
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872532"></a>
                                    <font class="smallfont"><p>You have to put code int {code}...{code} tags.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Jun 11, 2013 08:08
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22872616"></a>
                                    <font class="smallfont"><p>Hi Jordi, you mentioned that you considered teaching to your students. Did you have anything specific in mind?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pierre kil at Jun 12, 2013 13:04
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22873095"></a>
                                    <font class="smallfont"><p>Marco,</p>

<p>Thank you for sharing your implementation.</p>

<p>Best regards,</p>

<p>&#8211; Juha</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Jun 19, 2013 15:12
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:32</font></td>
		    </tr>
	    </table>
    </body>
</html>