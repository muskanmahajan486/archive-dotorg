<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Request for help with Shell Execution Protocol</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Request for help with Shell Execution Protocol
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jun 17, 2015 by <font color="#0050B2">niedejb</font>.
				    </div>

				    <p>Coming here for help as I have struggled to get a batch file to run from the Shell Execution Protocol portion of Openremote.</p>

<p><img src="attachments/23599603/23789880.jpg" align="absmiddle" border="0"/></p>

<p>Full path: C:\\Users\\Public\\OpenRemote\\bin<br clear="all" />lifx6.bat</p>


<p>Log file returns:<br/>
[DEBUG 2015-06-15 18:15:58,872 (Shell): Found cached ShellExe command with id: 568<br/>
DEBUG 2015-06-15 18:15:58,872 (Shell): Will start shell command: C:\\Users\\Public\\OpenRemote\\bin<br clear="all" />lifx6.bat and use params: null]</p>

<p>I have restarted the machine running the controller per some of the search guidance with no luck.</p>

<p>The batch file runs with no issues when I open it via windows (executes the power toggle to the LIFX light), but it doesn't execute when I use openremote (I use a button in the design to trigger the command).</p>

<p>Batch file syntax:</p>

<p>[@echo off</p>

<p>echo curl "https://api.lifx.com/v1beta1/lights/all/toggle"  -H "authorization: Bearer XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXx" --data "selector=all" --compressed&gt;fjaf3892ajofw3298a8.ps1<br/>
powershell.exe -ExecutionPolicy Bypass -File "fjaf3892ajofw3298a8.ps1"<br/>
del fjaf3892ajofw3298a8.ps1]</p>

<p>Struggling with what I'm missing here, but I feel like I'm close....any tips on what I'm doing wrong?</p>

<p>Thanks in advance,</p>

<p>Jeremy</p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23599603/23789880.jpg">command data.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23599603/23789883.jpg">lifx6.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/23599603/23789941.jpg">bat.jpg</a> (image/jpeg)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-23599612"></a>
                                    <font class="smallfont"><p>I think you must set a polling interval for this command to work</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 17, 2015 07:55
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599617"></a>
                                    <font class="smallfont"><p>I'm not a windows guru, but IMHO *bat file is not a correct program for executing. For similar task on a linux machine I put /bin/sh as Path: and shell script name as Command parameter:. Therefore, I think that for windows you should probably put cmd.exe, with whole path is you want to be sure, in the Path: and lifx6.bat as Command parameter.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aktur at Jun 17, 2015 09:56
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599618"></a>
                                    <font class="smallfont"><p>In the past I did run .bat files with the shell execution protocol under Windows 7<br/>
(Example <a href="http://www.openremote.org/x/TyVdAQ">documented here</a>)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 17, 2015 10:49
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599664"></a>
                                    <font class="smallfont"><p>Set the polling interval to 500 with no luck...appreciate the help though.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niedejb at Jun 19, 2015 23:22
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599665"></a>
                                    <font class="smallfont"><p>I changed the path to:  C:\Users\Public\OpenRemote\webapps\controller\cmd.exe and the path to lifx.bat:</p>

<p><img src="attachments/23599603/23789883.jpg" align="absmiddle" border="0"/></p>

<p>Log shows success (I guess...not really sure):</p>

<p>[DEBUG 2015-06-19 17:21:56,121 (Shell): Found cached ShellExe command with id: 568<br/>
DEBUG 2015-06-19 17:21:56,121 (Shell): Will start shell command: C:\Users\Public\OpenRemote\webapps\controller\cmd.exe and use params: lifx6.bat]</p>

<p>...But the batch file doesn't execute/toggle the light with the above set up either.</p>

<p>Any other tips?</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niedejb at Jun 19, 2015 23:38
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599669"></a>
                                    <font class="smallfont"><p>But the cmd.exe is a windows system program and its path should be somewhere in the system folder.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by aktur at Jun 20, 2015 06:48
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23599671"></a>
                                    <font class="smallfont"><p>At the time, the Shell Execution protocol proved to be unreliable. (system hangs). So I did change to a cron scheduler. That is running fine for quite a while now.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by pz1 at Jun 20, 2015 08:35
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23600119"></a>
                                    <font class="smallfont"><p>Back with a "fix":</p>

<p><img src="attachments/23599603/23789941.jpg" align="absmiddle" border="0"/></p>

<p>Full path in the above:<br/>
C:\Users\Public\OpenRemote\bin\lifx6.bat</p>

<p>Confirmed that the <b>.bat file MUST be in the "</b>\OpenRemote\bin" folder or it will not work.</p>

<p>My issue turned out to be an issue with security certificate for the cURL command.  Once I put the right cert in the above directory with curl.exe (which is called from my batch file) everything worked.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by niedejb at Jul 12, 2015 01:36
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:33</font></td>
		    </tr>
	    </table>
    </body>
</html>