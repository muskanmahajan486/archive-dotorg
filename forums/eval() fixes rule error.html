<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : eval() fixes rule error</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : eval() fixes rule error
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on May 31, 2015 by <font color="#0050B2">garitron</font>.
				    </div>

				    <p>****Using command "Get Fan1 T" with 1-wire, DS18B20, temperature, F, 1s poll.<br/>
****Using Sensor: "Fan1 T" invoking "Get Fan1 T" command with custom &amp; no Custom State items. </p>

<p>****This does not work:</p>

<p>package org.openremote.controller.protocol<br/>
global org.openremote.controller.statuscache.CommandFacade execute;<br/>
global org.openremote.controller.statuscache.SwitchFacade switches;<br/>
import org.openremote.controller.protocol.*;<br/>
import org.openremote.controller.model.event.*;<br/>
import java.lang.Float;</p>

<p>rule "Fan1 ON by T" <br/>
when<br/>
  CustomState(source == "Fan1 T",  <br/>
       Float.valueOf(value) &gt; 100f  &amp;&amp;  Float.valueOf(value) &lt; 150f)<br/>
then<br/>
  execute.command("Sw Fan1 ON");<br/>
end</p>

<p>****Produces these errors:</p>

<p>ERROR 2015-05-30 15:51:06,697 : ERR 101 Line 11:21 no viable alternative at input 'value' in rule "Fan1 ON by T" in pattern CustomState<br/>
ERROR 2015-05-30 15:51:06,697 : ERR 101 Line 11:59 no viable alternative at input ')' in rule "Fan1 ON by T" in pattern CustomState in pattern Float.valueOf</p>

<p>****What does "no viable alternative" mean??</p>

<p>****This works:</p>

<p>package org.openremote.controller.protocol<br/>
global org.openremote.controller.statuscache.CommandFacade execute;<br/>
global org.openremote.controller.statuscache.SwitchFacade switches;<br/>
import org.openremote.controller.protocol.*;<br/>
import org.openremote.controller.model.event.*;<br/>
import java.lang.Float;</p>

<p>rule "Fan1 ON by T" <br/>
when<br/>
  CustomState(source == "Fan1 T",  <br/>
       eval(Float.valueOf(value) &gt; 100f)  &amp;&amp;  eval(Float.valueOf(value) &lt; 150f))<br/>
then<br/>
  execute.command("Sw Fan1 ON");<br/>
end</p>

<p>****I'm not a Java programmer, but my 1098 page Java book (Thinking In Java; Eckel) does not describe an "eval" function.<br/>
****Neither can I find an example/requirement for its use in the OR documentation... I found an example after extensive<br/>
****perusal of the forum posts....  </p>

<p>****Apparently the Drools rules are just Java in disguise. True? ... except for some "extras"... where are the "extras" documented?</p>



				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:33</font></td>
		    </tr>
	    </table>
    </body>
</html>