<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Trouble with Fibaro FGS-221 on razberry with the new zwave release</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Trouble with Fibaro FGS-221 on razberry with the new zwave release
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 29, 2015 by <font color="#0050B2">mobaer</font>.
				    </div>

				    <p>Hi,</p>

<p>I've finally setup my raspberry pi with the razberry module and openremote with the new zwave release. <br/>
It uses /dev/AMA0 as the serial port and I could disable the Z-Way server of the razberry. <br/>
<b>Thanks for the good work guys!</b><br/>
I have some switches, wall-plugs and shutters running fine. However there is one problem with the Fibaro FGS-221: <br/>
Both ports can be steered without problems in openremote. Switching the devices with their physical switches does not work.<br/>
Using a physical switch of any other device works good, and I can see the messages in the zwave-debug.log, however when switching one or both ports of the FGS-221 not even one log entry appears in the debug log. Did I miss something in the Setup? Is there a special mode that needs to be set for the FGS-221?</p>

<p>Here is the configuration for that specific node. It is the generated one, no changes done so far.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
&lt;?xml version=<span class="code-quote">"1.0"</span> encoding=<span class="code-quote">"UTF-8"</span>?&gt;
&lt;node id=<span class="code-quote">"4"</span>&gt;
  &lt;manufacturer id=<span class="code-quote">"271"</span>&gt;Fibargroup&lt;/manufacturer&gt;
  &lt;basic-device-class id=<span class="code-quote">"0x04"</span>&gt;BASIC_TYPE_ROUTING_SLAVE&lt;/basic-device-class&gt;
  &lt;<span class="code-keyword">generic</span>-device-class id=<span class="code-quote">"0x10"</span>&gt;GENERIC_TYPE_SWITCH_BINARY&lt;/<span class="code-keyword">generic</span>-device-class&gt;
  &lt;specific-device-class id=<span class="code-quote">"0x01"</span>&gt;SPECIFIC_TYPE_POWER_SWITCH_BINARY&lt;/specific-device-class&gt;
  &lt;product-type id=<span class="code-quote">"0x0200"</span> /&gt;
  &lt;product id=<span class="code-quote">"0x100A"</span> /&gt;
  &lt;listening&gt;<span class="code-keyword">true</span>&lt;/listening&gt;
  &lt;routing&gt;<span class="code-keyword">true</span>&lt;/routing&gt;
  &lt;command-classes&gt;
    &lt;command-class id=<span class="code-quote">"0x60"</span> version=<span class="code-quote">"2"</span> name=<span class="code-quote">"COMMAND_CLASS_MULTI_CHANNEL_V2"</span> type=<span class="code-quote">"supported"</span> /&gt;
    &lt;command-class id=<span class="code-quote">"0x70"</span> version=<span class="code-quote">"1"</span> name=<span class="code-quote">"COMMAND_CLASS_CONFIGURATION"</span> type=<span class="code-quote">"supported"</span> /&gt;
    &lt;command-class id=<span class="code-quote">"0x20"</span> version=<span class="code-quote">"1"</span> name=<span class="code-quote">"COMMAND_CLASS_BASIC"</span> type=<span class="code-quote">"supported"</span> /&gt;
    &lt;command-class id=<span class="code-quote">"0x72"</span> version=<span class="code-quote">"1"</span> name=<span class="code-quote">"COMMAND_CLASS_MANUFACTURER_SPECIFIC"</span> type=<span class="code-quote">"supported"</span> /&gt;
    &lt;command-class id=<span class="code-quote">"0x85"</span> version=<span class="code-quote">"2"</span> name=<span class="code-quote">"COMMAND_CLASS_ASSOCIATION_V2"</span> type=<span class="code-quote">"supported"</span> /&gt;
    &lt;command-class id=<span class="code-quote">"0x25"</span> version=<span class="code-quote">"1"</span> name=<span class="code-quote">"COMMAND_CLASS_SWITCH_BINARY"</span> type=<span class="code-quote">"supported"</span> /&gt;
    &lt;command-class id=<span class="code-quote">"0x86"</span> version=<span class="code-quote">"1"</span> name=<span class="code-quote">"COMMAND_CLASS_VERSION"</span> type=<span class="code-quote">"supported"</span> /&gt;
    &lt;command-class id=<span class="code-quote">"0x8E"</span> version=<span class="code-quote">"1"</span> name=<span class="code-quote">"COMMAND_CLASS_MULTI_INSTANCE_ASSOCIATION"</span> type=<span class="code-quote">"supported"</span> /&gt;
    &lt;command-class id=<span class="code-quote">"0x60"</span> version=<span class="code-quote">"2"</span> name=<span class="code-quote">"COMMAND_CLASS_MULTI_CHANNEL_V2"</span> type=<span class="code-quote">"controlled"</span> /&gt;
    &lt;command-class id=<span class="code-quote">"0x25"</span> version=<span class="code-quote">"1"</span> name=<span class="code-quote">"COMMAND_CLASS_SWITCH_BINARY"</span> type=<span class="code-quote">"controlled"</span> /&gt;
  &lt;/command-classes&gt;
  &lt;endpoints&gt;
    &lt;endpoint number=<span class="code-quote">"1"</span>&gt;
      &lt;<span class="code-keyword">generic</span>-device-class id=<span class="code-quote">"0x10"</span>&gt;GENERIC_TYPE_SWITCH_BINARY&lt;/<span class="code-keyword">generic</span>-device-class&gt;
      &lt;specific-device-class id=<span class="code-quote">"0x01"</span>&gt;SPECIFIC_TYPE_POWER_SWITCH_BINARY&lt;/specific-device-class&gt;
      &lt;command-classes&gt;
        &lt;command-class id=<span class="code-quote">"0x25"</span> version=<span class="code-quote">"1"</span> name=<span class="code-quote">"COMMAND_CLASS_SWITCH_BINARY"</span> type=<span class="code-quote">"supported"</span> /&gt;
      &lt;/command-classes&gt;
    &lt;/endpoint&gt;
    &lt;endpoint number=<span class="code-quote">"2"</span>&gt;
      &lt;<span class="code-keyword">generic</span>-device-class id=<span class="code-quote">"0x10"</span>&gt;GENERIC_TYPE_SWITCH_BINARY&lt;/<span class="code-keyword">generic</span>-device-class&gt;
      &lt;specific-device-class id=<span class="code-quote">"0x01"</span>&gt;SPECIFIC_TYPE_POWER_SWITCH_BINARY&lt;/specific-device-class&gt;
      &lt;command-classes&gt;
        &lt;command-class id=<span class="code-quote">"0x25"</span> version=<span class="code-quote">"1"</span> name=<span class="code-quote">"COMMAND_CLASS_SWITCH_BINARY"</span> type=<span class="code-quote">"supported"</span> /&gt;
      &lt;/command-classes&gt;
    &lt;/endpoint&gt;
  &lt;/endpoints&gt;
  &lt;configuration hash=<span class="code-quote">"7F34045B013D6E938A787765C321BD93"</span>&gt;
    &lt;associations&gt;
      &lt;association-group id=<span class="code-quote">"1"</span> capacity=<span class="code-quote">"5"</span>&gt;
        &lt;association&gt;
          &lt;node&gt;1&lt;/node&gt;
          &lt;endpoint&gt;1&lt;/endpoint&gt;
        &lt;/association&gt;
        &lt;association&gt;
          &lt;node&gt;1&lt;/node&gt;
        &lt;/association&gt;
      &lt;/association-group&gt;
      &lt;association-group id=<span class="code-quote">"2"</span> capacity=<span class="code-quote">"5"</span>&gt;
        &lt;association&gt;
          &lt;node&gt;1&lt;/node&gt;
          &lt;endpoint&gt;2&lt;/endpoint&gt;
        &lt;/association&gt;
        &lt;association&gt;
          &lt;node&gt;1&lt;/node&gt;
        &lt;/association&gt;
      &lt;/association-group&gt;
      &lt;association-group id=<span class="code-quote">"3"</span> capacity=<span class="code-quote">"1"</span>&gt;
        &lt;association&gt;
          &lt;node&gt;1&lt;/node&gt;
        &lt;/association&gt;
      &lt;/association-group&gt;
    &lt;/associations&gt;
    &lt;parameters&gt;
      &lt;parameter&gt;
        &lt;number&gt;14&lt;/number&gt;
        &lt;value&gt;0&lt;/value&gt;
        &lt;size&gt;1&lt;/size&gt;
      &lt;/parameter&gt;
    &lt;/parameters&gt;
  &lt;/configuration&gt;
&lt;/node&gt;
</pre>
</div></div>
<p>Any help would be appreciated as I need to switch back to Z-Way in case there is no solution for the problem.<br/>
Cheers<br/>
Jochen</p>

				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-23596047"></a>
                                    <font class="smallfont"><p>I have the Fibaro Double Relay Switch FGS-221 and it works with the following settings even if the device is controlled locally with attached physical switches:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
&lt;associations&gt;
  &lt;association-group id=<span class="code-quote">"1"</span> capacity=<span class="code-quote">"5"</span> /&gt;
  &lt;association-group id=<span class="code-quote">"2"</span> capacity=<span class="code-quote">"5"</span> /&gt;
  &lt;association-group id=<span class="code-quote">"3"</span> capacity=<span class="code-quote">"1"</span>&gt;
    &lt;association&gt;
      &lt;node&gt;1&lt;/node&gt;
    &lt;/association&gt;
  &lt;/association-group&gt;
&lt;/associations&gt;
&lt;parameters&gt;
  &lt;parameter&gt;
    &lt;number&gt;14&lt;/number&gt;
    &lt;value&gt;0&lt;/value&gt;
    &lt;size&gt;1&lt;/size&gt;
  &lt;/parameter&gt;
&lt;/parameters&gt;
</pre>
</div></div>

<p>OpenRemote Designer Commands (example: Z-Wave node ID=4):</p>

<p><b>Enpoint 1</b></p>

<p>Z-Wave nodeID: 4:1<br/>
Command: ON</p>

<p>Z-Wave nodeID: 4:1<br/>
Command: OFF</p>

<p>Z-Wave nodeID: 4:1<br/>
Command: STATUS</p>

<p><b>OR</b> (endpoint number is not needed for first endpoint)</p>

<p>Z-Wave nodeID: 4<br/>
Command: ON</p>

<p>Z-Wave nodeID: 4<br/>
Command: OFF</p>

<p>Z-Wave nodeID: 4<br/>
Command: STATUS</p>

<p><b>Endpoint 2</b></p>

<p>Z-Wave nodeID: 4:2<br/>
Command: ON</p>

<p>Z-Wave nodeID: 4:2<br/>
Command: OFF</p>

<p>Z-Wave nodeID: 4:2<br/>
Command: STATUS</p>

<p>The &lt;association&gt; section differs from my configuration. It seems that Z-Way has added 2 additional associations (group1, group2) that are not necessarily needed.</p>

<p>I'ld suggest that you 'exclude' the node from the Z-Wave network and afterwards 'include' it to the network in order to reset the device and configure the commands as specified.</p>

<p>OpenRemote configures the FGS-221 so that it can be used in combination with momentary switches. If you have <b>toggle</b> switches you have to edit the &lt;parameter&gt; section as follows:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
&lt;parameter&gt;
  &lt;number&gt;14&lt;/number&gt;
  &lt;value&gt;1&lt;/value&gt;
  &lt;size&gt;1&lt;/size&gt;
&lt;/parameter&gt;
</pre>
</div></div>

<p>How to configure parameters see <a href="http://www.openremote.org/display/forums/New+Z-Wave+2.0.0+Release">New Z-Wave 2.0.0 Release</a></p>


</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by rhitz at Jan 29, 2015 13:15
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-23596057"></a>
                                    <font class="smallfont"><p>Danke Rainer!</p>

<p>It's been the configuration for the toggle switches.<br/>
I stopped OR,<br/>
Changed the nodeX.xml to the parameters you suggested (as I have toggle switches)<br/>
and started OR again.</p>

<p>Now everything works as expected.</p>

<p>Thanks again<br/>
Jochen</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mobaer at Jan 29, 2015 14:13
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:39</font></td>
		    </tr>
	    </table>
    </body>
</html>