<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Forums : Openremote+DomotiGa+ jsonrpc</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Forums : Openremote+DomotiGa+ jsonrpc
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Feb 06, 2014 by <font color="#0050B2">juha</font>.
				    </div>

				    <p>Dear Openremote,</p>

<p>I have been trying to use Openremote and data extracted from Domotiga using JSONRPC. I have tested the followings</p>

<ul class="alternate" type="square">
	<li>Openremote+ XBMC using JSONRPC : Working</li>
	<li>Openremote+ DomotiGa using JSONRPC: NOT WORKING</li>
</ul>


<p>This are the configurations I have done in Openremote:</p>

<p><img src="attachments/22883966/23036450.jpg" align="absmiddle" border="0"/></p>

<p><img src="attachments/22883966/23036448.jpg" align="absmiddle" border="0"/></p>

<p>with the following workloads</p>

<p><img src="attachments/22883966/23036452.jpg" align="absmiddle" border="0"/></p>

<p>while testing from the terminal with the following command:</p>
<div style="max-width: 800px;"><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
curl -sS -X POST -H <span class="code-quote">"Content-Type: application/json"</span> -H <span class="code-quote">"Accept: application/json"</span> -d '{<span class="code-quote">"jsonrpc"</span>: <span class="code-quote">"2.0"</span>, <span class="code-quote">"method"</span>: <span class="code-quote">"device.set"</span>,<span class="code-quote">"params"</span>: {<span class="code-quote">"device_id"</span>: 5,<span class="code-quote">"value"</span>: <span class="code-quote">"Off"</span>}, <span class="code-quote">"id"</span>: 1}' localhost:9099
</pre>
</div></div>

<p>everything worked fine bun when I try with Openremote I get the following errors:</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>
ERROR [main]: Could not start VeraClient: 
java.lang.IllegalArgumentException: Host name may not be null
	at org.apache.http.HttpHost.&lt;init&gt;(HttpHost.java:83)
	at org.apache.http.impl.client.AbstractHttpClient.determineTarget(AbstractHttpClient.java:586)
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:708)
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:700)
	at org.openremote.controller.protocol.vera.VeraClient.requestStatus(VeraClient.java:244)
	at org.openremote.controller.protocol.vera.VeraClient.startVeraClient(VeraClient.java:79)
	at org.openremote.controller.protocol.vera.VeraCommandBuilder.startVeraClient(VeraCommandBuilder.java:155)
	at org.openremote.controller.protocol.vera.VeraCommandBuilder.&lt;init&gt;(VeraCommandBuilder.java:68)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:534)
	at org.openremote.controller.command.CommandFactory.updateCommandBuilders(CommandFactory.java:104)
	at org.openremote.controller.deployer.Version20ModelBuilder.build(Version20ModelBuilder.java:552)
	at org.openremote.controller.deployer.AbstractModelBuilder.buildModel(AbstractModelBuilder.java:154)
	at org.openremote.controller.service.Deployer.startup(Deployer.java:858)
	at org.openremote.controller.service.Deployer.startController(Deployer.java:336)
	at org.openremote.controller.spring.SpringContext.initializeController(SpringContext.java:109)
	at org.openremote.controller.service.ServiceContext.init(ServiceContext.java:383)
	at org.openremote.controller.bootstrap.Startup.loadServiceContext(Startup.java:85)
	at org.openremote.controller.bootstrap.servlet.ServletStartup.initializeServiceContext(ServletStartup.java:190)
	at org.openremote.controller.bootstrap.servlet.ServletStartup.contextInitialized(ServletStartup.java:109)
	at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:3843)
	at org.apache.catalina.core.StandardContext.start(StandardContext.java:4342)
	at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:791)
	at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:771)
	at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:525)
	at org.apache.catalina.startup.HostConfig.deployDirectory(HostConfig.java:926)
	at org.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:889)
	at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:492)
	at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1149)
	at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:311)
	at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:117)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1053)
	at org.apache.catalina.core.StandardHost.start(StandardHost.java:719)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1045)
	at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:443)
	at org.apache.catalina.core.StandardService.start(StandardService.java:516)
	at org.apache.catalina.core.StandardServer.start(StandardServer.java:710)
	at org.apache.catalina.startup.Catalina.start(Catalina.java:578)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:622)
	at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:288)
	at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:413)
INFO 2014-02-05 18:03:11,539 : No rule definitions found in '/home/ckbsmart/OpenRemote-Controller-2.1.0_SNAPSHOT-2013-06-17/webapps/controller/rules'.
INFO 2014-02-05 18:03:11,539 : Initialized event processor : Drools Rule Engine
INFO 2014-02-05 18:03:11,626 : Initialized event processor : RRD4J Data Logger
INFO 2014-02-05 18:03:11,627 : Initialized event processor : EmonCMS Data Logger
INFO 2014-02-05 18:03:11,685 : Registered sensor : Sensor (Name = 'deviceID12_SENSOR', ID = '3699935', State Mappings: {})
INFO 2014-02-05 18:03:11,686 : Registered sensor : Sensor (Name = 'Weather sensor cond', ID = '3698156', State Mappings: {})
INFO 2014-02-05 18:03:11,703 : Registered sensor : Sensor (Name = 'Weather sensor temp', ID = '3698151', State Mappings: {})
INFO 2014-02-05 18:03:11,711 : Startup complete.
INFO 2014-02-05 18:03:11,726 : Controller Definition File Watcher for Default Deployer started.
Feb 5, 2014 6:03:12 PM org.apache.coyote.http11.Http11Protocol start
INFO: Starting Coyote HTTP/1.1 on http-8080
Feb 5, 2014 6:03:12 PM org.apache.catalina.startup.Catalina start
INFO: Server startup in 3922 ms
ERROR [Polling thread for sensor: deviceID12_SENSOR]: ClientProtocolException when executing HTTP method
org.apache.http.client.HttpResponseException: Request Entity Too Large
	at org.apache.http.impl.client.BasicResponseHandler.handleResponse(BasicResponseHandler.java:67)
	at org.apache.http.impl.client.BasicResponseHandler.handleResponse(BasicResponseHandler.java:54)
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:735)
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:709)
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:700)
	at org.openremote.controller.protocol.http.HttpGetCommand.requestURL(HttpGetCommand.java:231)
	at org.openremote.controller.protocol.http.HttpGetCommand.run(HttpGetCommand.java:245)
	at java.lang.Thread.run(Thread.java:701)
ERROR [Polling thread for sensor: deviceID12_SENSOR]: Could not perform jsonpath evaluation
java.lang.IllegalArgumentException: json can not be null or empty
	at org.apache.commons.lang.Validate.notEmpty(Validate.java:363)
	at com.jayway.jsonpath.JsonPath.read(JsonPath.java:304)
	at org.openremote.controller.protocol.http.HttpGetCommand.run(HttpGetCommand.java:282)
	at java.lang.Thread.run(Thread.java:701)
ERROR [Polling thread for sensor: deviceID12_SENSOR]: ClientProtocolException when executing HTTP method
org.apache.http.client.HttpResponseException: Request Entity Too Large
	at org.apache.http.impl.client.BasicResponseHandler.handleResponse(BasicResponseHandler.java:67)
	at org.apache.http.impl.client.BasicResponseHandler.handleResponse(BasicResponseHandler.java:54)
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:735)
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:709)
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:700)
	at org.openremote.controller.protocol.http.HttpGetCommand.requestURL(HttpGetCommand.java:231)
	at org.openremote.controller.protocol.http.HttpGetCommand.run(HttpGetCommand.java:245)
	at java.lang.Thread.run(Thread.java:701)
ERROR [Polling thread for sensor: deviceID12_SENSOR]: Could not perform jsonpath evaluation
java.lang.IllegalArgumentException: json can not be null or empty
	at org.apache.commons.lang.Validate.notEmpty(Validate.java:363)
	at com.jayway.jsonpath.JsonPath.read(JsonPath.java:304)
	at org.openremote.controller.protocol.http.HttpGetCommand.run(HttpGetCommand.java:282)
	at java.lang.Thread.run(Thread.java:701)
</pre>
</div></div>

<p>and when I press the button for the command i get:</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>ERROR [HTTP-Thread-2]: ClientProtocolException when executing HTTP method
org.apache.http.client.HttpResponseException: Request Entity Too Large
	at org.apache.http.impl.client.BasicResponseHandler.handleResponse(BasicResponseHandler.java:67)
	at org.apache.http.impl.client.BasicResponseHandler.handleResponse(BasicResponseHandler.java:54)
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:735)
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:709)
	at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:700)
	at org.openremote.controller.protocol.http.HttpGetCommand.requestURL(HttpGetCommand.java:231)
	at org.openremote.controller.protocol.http.HttpGetCommand.send(HttpGetCommand.java:162)
	at org.openremote.controller.service.impl.ControlCommandServiceImpl.trigger(ControlCommandServiceImpl.java:95)
	at org.openremote.controller.rest.ControlCommandRESTServlet.handleRequest(ControlCommandRESTServlet.java:77)
	at org.openremote.controller.rest.RESTAPI.doPost(RESTAPI.java:159)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:637)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.openremote.controller.rest.support.json.JSONCallbackFilter.doFilter(JSONCallbackFilter.java:63)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:78)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:77)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:286)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:845)
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)
	at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:354)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1146)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:701)
^CFeb 5, 2014 6:03:33 PM org.apache.coyote.http11.Http11Protocol pause
INFO: Pausing Coyote HTTP/1.1 on http-8080
Feb 5, 2014 6:03:34 PM org.apache.catalina.core.StandardService stop
INFO: Stopping service Catalina
Feb 5, 2014 6:03:34 PM org.apache.catalina.core.StandardWrapper unload
INFO: Waiting for 1 instance(s) to be deallocated
</pre>
</div></div></div>

<p>can someone please help me or at least point me where I can find more info on what those errors are..</p>

<p>Thank you in advance</p>


				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">Attachments:</a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22883966/23036449.jpg">1422664_707318805967661_985106041_n.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22883966/23036451.jpg">status.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22883966/23036447.jpg">1422664_707318805967661_985106041_n.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22883966/23036450.jpg">on.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22883966/23036448.jpg">status.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/22883966/23036452.jpg">com.jpg</a> (image/jpeg)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">Comments:</a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-22884025"></a>
                                    <font class="smallfont"><blockquote>
<p>HTTP 413 - Request Entity Too Large</p>

<p>The server is refusing to process a request because the request entity is larger than the server is willing or able to process. </p></blockquote>

<p>The server is for some reason rejecting your request &#8211; as too large which doesn't really make sense since the payload is rather small. But for whatever reason it doesn't seem to like it.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Feb 06, 2014 14:53
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884026"></a>
                                    <font class="smallfont"><p>But also strange that it would accept the curl request just fine....</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Feb 06, 2014 14:55
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884029"></a>
                                    <font class="smallfont"><p>You're using different URLs in your curl example and in your OR config:</p>

<p>localhost:9099</p>

<p>vs</p>

<p>localhost:9099/jsonrpc</p>

<p>does that make a difference?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Feb 06, 2014 15:02
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884037"></a>
                                    <font class="smallfont"><p>Thank you for the reply. I will test that as soon as I get back to my pc.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ckbsmart at Feb 06, 2014 18:08
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884039"></a>
                                    <font class="smallfont"><p>I tested and I get exactly the same error, but if I press the button 4 times consecutively the action is performed and the device is turned on, same if I want to turn it off. Which is very strange...</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ckbsmart at Feb 06, 2014 19:03
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884040"></a>
                                    <font class="smallfont"><p>double click I can turn on and off the device and I only get the error once.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ckbsmart at Feb 06, 2014 19:27
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884041"></a>
                                    <font class="smallfont"><p>With curl you are setting an "Accept:" header. OpenRemote does not set that header.<br/>
Maybe that causes the problem.<br/>
Can you leave that away with curl and see if you have the same issue then?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 06, 2014 20:27
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884042"></a>
                                    <font class="smallfont"><div style="max-width: 800px;"></div>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
curl -sS -X POST -H <span class="code-quote">"Content-Type: application/json"</span> -d '{<span class="code-quote">"jsonrpc"</span>: <span class="code-quote">"2.0"</span>, <span class="code-quote">"method"</span>: <span class="code-quote">"device.set"</span>,<span class="code-quote">"params"</span>: {<span class="code-quote">"device_id"</span>: 5,<span class="code-quote">"value"</span>: <span class="code-quote">"On"</span>}, <span class="code-quote">"id"</span>: 1}' localhost:9099
{<span class="code-quote">"jsonrpc"</span>: <span class="code-quote">"2.0"</span>, <span class="code-quote">"result"</span>: <span class="code-keyword">true</span>, <span class="code-quote">"id"</span>: 1}
</pre>
</div></div>

<p>works fine without the accept part. But if I eliminate the "Content-Type: application/json"  it does not work anymore.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ckbsmart at Feb 06, 2014 21:35
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884043"></a>
                                    <font class="smallfont"><p>Is it the same error if you leave Content-Type out?<br/>
Maybe your version of the controller does not support Content-Type?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 06, 2014 21:37
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884044"></a>
                                    <font class="smallfont"><p>if I leave the Content-Type out in curl it is not working but no error is given. It simply does nothing.</p>

<p>I am using : OpenRemote-Controller-2.1.0_SNAPSHOT-2013-06-17 and currently I am a free user that uses the preview for design.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ckbsmart at Feb 06, 2014 21:39
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884093"></a>
                                    <font class="smallfont"><p>Is there something else I can try or test to find out how I can eliminate the error?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ckbsmart at Feb 07, 2014 17:39
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884096"></a>
                                    <font class="smallfont"><p>Since it sometimes works and sometimes not I don't have any other idea.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 07, 2014 20:30
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884199"></a>
                                    <font class="smallfont"><p>Can you send me the tcpdump on the JSON-RPC port when you do the action from openremote? The command is e.g. tcpdump -i any -s 0 -w /var/tmp/foralex.eth port 9090</p>

<p>(I wrote the DomotiGa JSON-RPC server)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ualex73 at Feb 09, 2014 19:10
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884201"></a>
                                    <font class="smallfont"><p>I got an idea why it is going wrong, can you confirm if OpenRemote is using HTTP/1.0 or HTTP/1.1?</p>

<p>If it is a HTTP/1.1 request, it is a bug in OpenRemote (they generate an invalid content-length, which is 1 byte/char off)</p>

<p>BTW: I will think of a workaround for the BUG in OpenRemote and implement it in the next 1-2 weeks in DomotiGa</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ualex73 at Feb 09, 2014 19:49
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884224"></a>
                                    <font class="smallfont"><p>I am sorry but I don't know the answere to your questions. Are those for me? I am more than happy to help with what I can. Thank you for the interest.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ckbsmart at Feb 10, 2014 12:26
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884229"></a>
                                    <font class="smallfont"><blockquote>
<p>If it is a HTTP/1.1 request, it is a bug in OpenRemote (they generate an invalid content-length, which is 1 byte/char off)</p>

<p>BTW: I will think of a workaround for the BUG in OpenRemote and implement it in the next 1-2 weeks in DomotiGa</p>
</blockquote>

<p>Hmm, we don't set content-length at all, as far as I'm able to tell. This is done for us by Apache's HTTP client library. Is this then a known issue with Apache's client library?</p>

</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Feb 10, 2014 15:04
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884635"></a>
                                    <font class="smallfont"><p>The workaround for OpenRemote will be included in DomotiGa 1.0.015 (hopefully be released tonight or tomorrow)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ualex73 at Feb 22, 2014 15:55
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884636"></a>
                                    <font class="smallfont"><p>I don't know the Apache client itself, but i noticed earlier that what OpenRemote sends is 1 byte more then the HTTP header says.</p>

<p>Take the following example HTTP valid example:</p>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>POST /jsonrpc HTTP/1.1
User-Agent: curl/7.29.0
Host: localhost:9090
Accept: */*
Content-Type: application/json
Content-Length: 57

{"jsonrpc": "2.0", "method": "domotiga.version", "id": 1}
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ &lt;= 57 bytes
</pre>
</div></div>

<p>The Apache library sends something like (with an extra 0x13 - carriage return):</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>POST /jsonrpc HTTP/1.0
User-Agent: curl/7.29.0
Host: localhost:9090
Expect: 100-Continue
Accept: */*
Content-Type: application/json
Content-Length: 57

{"jsonrpc": "2.0", "method": "domotiga.version", "id": 1}0x13
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ &lt;= 58 bytes
</pre>
</div></div>

<p>The HTTP/1.0 spec isn't 100% clear how the content-length should be calculated, but if sending HTTP/1.1 it is clear.</p>

<p>Also - can OpenRemote remove the "Expect: 100-Continue" header please? It is only adding overhead and delays to the requests (we aren't sending megabytes of requests)</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ualex73 at Feb 22, 2014 16:01
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884643"></a>
                                    <font class="smallfont"><p>We already removed the 100-Continue header in the latest version of HTTP protocol.<br/>
You could try and replace the apache httpclient library with the latest version.<br/>
Maybe that will fix the content-length issue.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by mredeker at Feb 22, 2014 19:08
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22884678"></a>
                                    <font class="smallfont"><p>I don't use OpenRemote myself, I help developing DomotiGa.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ualex73 at Feb 23, 2014 17:32
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-22885094"></a>
                                    <font class="smallfont"><p>Thanks for digging into the details on this.</p>

<p>Will add tests at some point to confirm the behavior you've reported and check if the HTTP client library can be configured to behave differently (it should at least if it can be modified to use HTTP/1.1 instead). The trailing CRLF seems to be a legacy of old HTTP/1.0 implementations.</p>

<p>&#8211; Juha</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by juha at Mar 09, 2014 01:24
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:29</font></td>
		    </tr>
	    </table>
    </body>
</html>