<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Community : Source Code Conventions</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Community : Source Code Conventions
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Oct 18, 2013 by <font color="#0050B2">juha</font>.
				    </div>

				    <h1><a name="SourceCodeConventions-SourceCodeConventions"></a>Source Code Conventions</h1>

<p>These guidelines should be followed for all new source files added to the repository. If you're making changes to existing source files, make a best guess on what the used convention is and try to follow it. Do avoid reformatting existing source.</p>




<div style="margin: 40px;"><div class="panel" style="border-width: 1px;"><div class="panelContent">
<div class='toc'>
<ul>
    <li><a href='#SourceCodeConventions-JavaSourceCodeConventions'>Java Source Code Conventions</a></li>
    <li><a href='#SourceCodeConventions-iOSSourceCodeConventions'>iOS Source Code Conventions</a></li>
    <li><a href='#SourceCodeConventions-GWTtips%2Fguidelines'>GWT tips / guidelines</a></li>
</ul></div>
</div></div></div>


<h2><a name="SourceCodeConventions-JavaSourceCodeConventions"></a>Java Source Code Conventions</h2>


<p>Some basic ground rules for Java source code:</p>

<div class = "note">
  <img class="noteimage" src="attachments/11960350/12582917.png"/><p>In general avoid reformatting code unless necessary. Reformatting code is a sure way of getting into an unsortable Subversion merge mess. Only reformat an existing source if you know for certain that no one else is working in the same area (i.e. you're currently the sole owner of the area of code in question). If you do decide to reformat code (you probably shouldn't so stop right there) then <b>always</b> commit the reformatting separate from any and <b>all</b> code changes &#8211; otherwise your code changes will be impossible to find from the diffs and are at great risk of being rejected altogether.</p>

<p>Given all of the above, you don't want to reformat existing source files. Therefore, the code conventions below apply only when developing new code on new source files. (The legacy code will get reformatted to conventions by those who will have sole ownership of the codebase at specific periods of time).</p>
</div>




<p>1. Always use soft tabs (spaces), never ever use real hard tab characters<br/>
2. Indent with 2 spaces (4 spaces for line continuations)<br/>
3. Limit source lines at 100 characters<br/>
4. For indentation and braces, use ANSI style, i.e.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">

<span class="code-keyword">public</span> class Foo <span class="code-keyword">extends</span> Bar <span class="code-keyword">implements</span> Acme
{

  <span class="code-keyword">protected</span> void doSomething()
  {
    <span class="code-keyword">while</span> (x == y)
    {
      something();
      somethingElse();
    }
 
    finalThing();
  }
}

</pre>
</div></div>

<p>5. Add a license at the top of each source file, before the package declaration</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
/*
 * OpenRemote, the Home of the Digital Home.
 * Copyright 2008-2013, OpenRemote Inc.
 *
 * See the contributors.txt file in the distribution <span class="code-keyword">for</span> a
 * full listing of individual contributors.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Affero General Public License <span class="code-keyword">for</span> more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with <span class="code-keyword">this</span> program. If not, see &lt;http:<span class="code-comment">//www.gnu.org/licenses/&gt;.
</span> */
</pre>
</div></div>


<p>6. Format JavaDoc comments as follows:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
  /**
   * Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed <span class="code-keyword">do</span> eiusmod tempor 
   * incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud 
   * exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute 
   * irure dolor in reprehenderit in voluptate velit esse 
   *
   * @see org.openremote.controller.foo.Bar
   * @see org.openremote.controller.bar.Foo
   *
   * @param foo     lorem ipsum dolor sit amet
   * @param bar     consectetur adipisicing elit
   * @param acme    Sed <span class="code-keyword">do</span> eiusmod tempor incididunt ut labore et dolore magna aliqua. 
   *                Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris 
   *                nisi ut aliquip ex ea commodo consequat.   
   *
   * @<span class="code-keyword">return</span>    Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris 
   *            nisi ut aliquip ex ea commodo consequat.  
   *
   */
</pre>
</div></div>

<p>Alternative formatting for @param, @throws and @return elements is also acceptable:</p>


<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
  /**
   * Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed <span class="code-keyword">do</span> eiusmod tempor 
   * incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud 
   * exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute 
   * irure dolor in reprehenderit in voluptate velit esse 
   *
   * @param myLongParamName     
   *            lorem ipsum dolor sit amet
   *
   * @param anotherParamName     
   *            consectetur adipisicing elit
   *
   * @param theFinalParamName    
   *            Sed <span class="code-keyword">do</span> eiusmod tempor incididunt ut labore et dolore magna aliqua. 
   *            Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris 
   *            nisi ut aliquip ex ea commodo consequat.   
   *
   * @<span class="code-keyword">throws</span> OpenRemoteParameterException
   *            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed <span class="code-keyword">do</span> eiusmod tempor 
   *            incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud 
   *            exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute 
   *            irure dolor in reprehenderit in voluptate velit esse 
   */
</pre>
</div></div>



<h2><a name="SourceCodeConventions-iOSSourceCodeConventions"></a>iOS Source Code Conventions</h2>

<p>These guidelines are based on the Zarra Studios public guidelines available at <a href="http://www.cimgf.com/zds-code-style-guide/">http://www.cimgf.com/zds-code-style-guide/</a> but have been adapted for the OpenRemote project.</p>

<p>1. Spacing</p>

<p>Code is to be indented 2 spaces and no tabs. If you want to wrap a long line of code then make sure it is colon aligned per Xcode's formatting. However I prefer if you did not wrap the lines. Xcode formats them rather nicely.<br/>
Keywords such as if, while, do, switch, etc. should have a space after them.<br/>
Wasted vertical space should be avoided. There should be only one empty line between methods.</p>

<p>2. Brackets</p>

<p>Method brackets should be on the following line and flush left. Code should be indented 2 spaces from the opening bracket.<br/>
When brackets are needed in a switch they are to be left aligned with the case line and on their own line. NOTE: brackets in switches should be avoided.<br/>
All other brackets should inline.</p>

<p>3. Method signatures</p>

<p>Method signatures should be left aligned. There should be a space after the scope (the plus or the minus sign). There should be a space between the method segments.<br/>
There should be a space between the class name and the pointer character (&#42;), not after.</p>

<p>4. Booleans</p>

<p>Objective-C uses YES and NO. Therefore true and false are incorrect. Also since nil resolves to NO it is unnecessary to compare it in conditions. For example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">if</span> (someObject == nil) ...</pre>
</div></div>
<p>Is redundant and should be written as:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">if</span> (!someObject) ...</pre>
</div></div>
<p>Likewise, if a method call returns a BOOL then checking it against a BOOL is redundant.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">if</span> ([someObject boolValue] == NO) ...</pre>
</div></div>
<p>is incorrect and should be written:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">if</span> (![someObject boolValue]) ...</pre>
</div></div>

<p>5. Variable names</p>

<p>Variable names should be descriptive of what they represent. Single letter variable name should never be used, except for incrementers.</p>

<p>6. Empty methods</p>

<p>Any method that is empty or just calls super should be removed from the source code as they are redundant.<br/>
In case a method is required by the implementation of a protocol and nothing should be done, a single comment line must be used to indicate this is intentional.</p>

<p>7. Comments</p>

<p>Comments should be rare. Code is easier to read than comments. Comments go stale, code doesn't. The only comments should be along the lines of:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
/* We are doing <span class="code-keyword">this</span> in a strange way because the normal solution resulted in ...
 * Therefore <span class="code-keyword">this</span> solution is the correct one.
 */
</pre>
</div></div>
<p>If the code is self explanatory (as it should be with descriptive variable names and methods) then comments are not necessary.</p>

<p>8. dealloc</p>

<p>-dealloc is important and should be placed directly below the -init methods of any class. If there are no -init methods then it should be the first method after class level methods.</p>

<p>9. @synthesize and @dynamic</p>

<p>Both @synthesize and @dynamic are boiler-plate code. They should be put at the top of the class just below the @implementation. Each @synthesize and @dynamic should be on a single line.</p>

<p>10. @property</p>

<p>Property definitions should be used in place of iVars. As of Xcode 3.2.5, we should no longer be declaring iVars at all. This will help to insure proper memory management. In addition, direct iVar access should be avoided except during initialization of the variable and in the -viewDidUnload and -dealloc methods.</p>

<p>11. Protocols</p>

<p>Protocol implementations should be separated out by #pragma marks.</p>

<p>12. Code width</p>

<p>Code should not be set to an arbitrary width. We have wide monitors and an editor that smart wraps the code. Do not limit code to 80 columns or any other arbitrary width unless it is to be printed.</p>

<h2><a name="SourceCodeConventions-GWTtips%2Fguidelines"></a>GWT tips / guidelines</h2>

<p>Not really coding conventions per se but some explanations on how we architect some of the features implemented in the modeler.</p>

<h4><a name="SourceCodeConventions-Fileuploadinwizards"></a>File upload in wizards</h4>

<p>Summary: have a wizard that takes a file uploaded by user and allows creation of "objects" in the designer. The file is first loaded and the GUI updated with the information read from the file. Upon confirmation, the import happens and the wizard window is closed.<br/>
With current technology, the file must be sent to the server for processing and cannot be directly processed on the client side. This is something that might change in the future.</p>

<p>Have a FileUpload element in the form for the user to select a file. The import button submits the form.<br/>
The form must be configured as follows:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
    uploadForm.setEncoding(FormPanel.ENCODING_MULTIPART);
    uploadForm.setMethod(FormPanel.METHOD_POST);
    uploadForm.setAction(GWT.getModuleBaseURL() + <span class="code-quote">"fileUploadController.htm?method=importLutron"</span>);
</pre>
</div></div>

<p>The name after the method= part being specific to each wizard. This names corresponds to the method name in the FileUploadController class that will handle that particular import.</p>

<p>The import routine processes the file and extracts the information required to:</p>
<ul class="alternate" type="square">
	<li>display appropriate information to the user to decide what to import</li>
	<li>have enough information for the creation of objects by the final import routine<br/>
This information is packaged in a JSON structure that is returned as the response of the POST request.</li>
</ul>


<p>Import: you must set the response content to text/html for the JSON structure to be correctly retrieved by GWT. This is done with</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
      response.setHeader(<span class="code-quote">"content-type"</span>, <span class="code-quote">"text/html"</span>);
</pre>
</div></div>

<p>The most efficient way to process and use the returned JSON structure in the GWT client is the use JavaScript Overlays.</p>

<p>This is for instance the top level overlay used by the Lutron Homeworks import wizard:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">public</span> class LutronImportResultOverlay <span class="code-keyword">extends</span> JavaScriptObject {

  <span class="code-comment">// Overlay types always have <span class="code-keyword">protected</span>, zero-arg ctors
</span>  <span class="code-keyword">protected</span> LutronImportResultOverlay() { } 
    
  <span class="code-comment">// Typically, methods on overlay types are JSNI
</span>  <span class="code-keyword">public</span> <span class="code-keyword">final</span> <span class="code-keyword">native</span> <span class="code-object">String</span> getErrorMessage() /*-{ <span class="code-keyword">return</span> <span class="code-keyword">this</span>.errorMessage; }-*/;

  <span class="code-keyword">public</span> <span class="code-keyword">final</span> <span class="code-keyword">native</span> ProjectOverlay getProject() /*-{ <span class="code-keyword">return</span> <span class="code-keyword">this</span>.project; }-*/;

  <span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">native</span> LutronImportResultOverlay fromJSONString(<span class="code-object">String</span> jsonString) /*-{
    <span class="code-keyword">return</span> eval('(' + jsonString + ')');
  }-*/;
  
}
</pre>
</div></div>

<p>Note that this object also includes an errorMessage field. This is the mechanism used to report errors occurring on server side (e.g. bad file format) to the client.</p>

<p>Having this in place, the return of the form submit can be handled with code such as</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
    uploadForm.addSubmitCompleteHandler(<span class="code-keyword">new</span> FormPanel.SubmitCompleteHandler() {
    
      @Override
      <span class="code-keyword">public</span> void onSubmitComplete(SubmitCompleteEvent event) {
        LutronImportResultOverlay importResult = LutronImportResultOverlay.fromJSONString(event.getResults());
...
</pre>
</div></div>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://www.openremote.org/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 05, 2016 09:24</font></td>
		    </tr>
	    </table>
    </body>
</html>